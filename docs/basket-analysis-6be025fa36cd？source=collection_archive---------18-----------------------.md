# 篮子分析

> 原文：<https://towardsdatascience.com/basket-analysis-6be025fa36cd?source=collection_archive---------18----------------------->

## 确认琐碎，揭开神秘，发掘有用

什么是购物篮分析？

![](img/fa85f75dcbbf8cbad0a55e056d50efd0.png)

所有这些商品都属于同一个顾客购物篮吗？——朱利叶斯·德罗斯特在 Unsplash 上的照片

篮子分析是一个非常简单的概念。想象顾客在杂货店购物。他们从货架上拿起商品，走到收银台付款。然后，您收集来自客户的所有收据，并逐个客户地创建一个他们购买了什么的列表(即，他们的购物篮或购物车中有什么)。您可能会得到如下结果，其中{…}表示客户购物篮中的商品:

*   顾客 A:{花生酱、果冻、面包、米饭、麦片、牛奶}
*   顾客 B:{花生酱、果冻、香草、土豆}
*   顾客 C:{花生酱、面包、麦片、牛奶}
*   顾客 D:{牛奶，麦片}

看看这些购物品，有几个明显的联想:

*   {花生酱} = > {果冻}有 67%的可能性(即，2/3 装了花生酱的篮子里也有果冻)
*   {花生酱} = > {面包}有 67%的可能性(也就是说，2/3 装了花生酱的篮子里也有面包)
*   { bread } = > {花生酱}有 100%的可能性(也就是说，每个装面包的篮子里都有花生酱)
*   {面包、谷物} = > {牛奶} 100%概率(即，每个有面包和谷物的篮子里也有牛奶)
*   {麦片，牛奶} = > {面包}有 67%的可能性(即，有麦片和牛奶的 2/3 篮子里也有面包)

这些被称为*关联规则*或者简称为*关联规则*。它们告诉我们哪些产品倾向于一起选择，以及知道一个产品在篮子里将如何预测篮子里可能还有什么。这种类型的信息非常有用(很快会有更多)。

发现关联的挑战在于可能组合的绝对数量。想象一个有 100 种不同产品的商店。购物篮中只有一件商品的顾客可以有 100 种可能的组合。拥有两种产品的客户可以有(100 x 99)/2 = 4，950 种可能的组合。如果项目数增加到 3，则有(100*99*98)/(3*2) = 161，700 种可能的组合。有了四种产品，就有了 3921255 种可能的组合。这是一个经典的组合问题，你有一组 N 个项目，并从中选择 R；给出可能组合数的方程是 N！/[R！* (N-R)！].组合数学的增长甚至比指数增长还要快得多——这使得分析数据来识别相关产品变得不可能，除非你使用一个聪明的算法；无论你的计算资源如何，试图彻底检查每一个可能的组合都是不可行的。

**Apriori 算法**

幸运的是，有一个聪明的算法:“Apriori 算法”，它被设计成通过一个简单的*先验*假设来快速评估非常大的数据集。对于被认为是关联的一组项目，该组必须以足够的频率出现。**但是如果一组项目频繁出现，那么这些项目的子集也一定频繁出现。**这意味着我们可以简单地通过排除不常出现的子集来排除大量的候选关联。在我们这个微不足道的例子中，只有一个顾客购买了大米，但是有 3 个顾客购买了花生酱。这意味着米饭只出现了 25%,而花生酱出现了 75%。浏览列表，我们看到客户购物篮中的每种产品出现的频率如下:

*   谷物=> 75%
*   牛奶=> 75%
*   花生酱=> 75%
*   果冻=> 50%
*   面包=> 50%
*   大米=> 25%
*   草药=> 25%
*   土豆=> 25%

由于草药和土豆出现的频率相对较低，我们可以将它们排除在考虑范围之外，因为这些项目加上其他项目的组合也很少出现。这将搜索空间从 8 个项目减少到只有 6 个项目，从而将可能的集合数量从 256 个减少到只有 64 个。Apriori 算法将这种假设应用于所有可能的子集(例如，{花生酱、果冻}、{牛奶、谷物})，以快速消除整个潜在关联组，这使得处理大型数据集变得可行。

我真心推荐感兴趣的读者购买[带 R 的机器学习](http://www.amazon.com/Machine-Learning-R-Brett-Lantz/dp/1782162143)，里面有关于 Apriori 算法的精彩章节。在 r 中使用这种技术非常简单。作为一个例子，让我从概念上向您展示应用这种算法需要多少行代码:

```
library(‘a rules’);data <- read.csv(file=”segment.csv”, sep=”,”)data_xtabs <- as.data.frame.matrix(xtabs(~account_id+segment_name, data));data_xtabs_logical <- as.data.frame(data_xtabs > 0);transactions <- as(data_xtabs_logical, “transactions”);summary(transactions);rules <- apriori(transactions, parameter = list(support = 0.01, confidence = 0.5, minlen = 2));summary(rules);
```

尽管我强烈建议您在使用 Apriori 算法之前先理解它背后的理论…是的，它确实很容易使用。完全公开我从我的例子中删除了 3-4 行对我们的讨论不重要的代码，但是上面的 R 代码非常有代表性，只有 8 行。在这 8 行代码中，一行用于加载 Apriori 库，四行用于加载数据，两行分别用于打印数据和规则的摘要。您可以看到为什么我是 R 的狂热爱好者，并强烈推荐那些对开发强大的分析功能非常感兴趣的组织习惯于使用 R(或 Python)并远离像 Excel 这样的简单工具。

当使用 Apriori 算法时，有三个关键概念你必须理解:支持、信任和提升。这些很容易理解:

*   *Support* —这是对一组项目出现在数据中的频率的度量。例如，如果花生酱的支持度为 50%，这意味着 50%的顾客在购物篮中放了花生酱。同样，如果{花生酱、果冻}的支持度是 25%，那么每 4 个顾客中就有 1 个顾客的篮子里有*的*花生酱和果冻。所需的支持度越高，Apriori 算法不考虑的数据就越多。
*   *信心*——这是对一组相关产品预测能力的衡量。例如，如果{花生酱} =>{果冻}的置信度为 75%，这意味着每个放有花生酱的篮子也有 75%的机会在同一个篮子中放有果冻。类似地，说{面包，谷物} =>{牛奶}的置信度是 100%意味着*每个既有面包又有谷物的*篮子也有牛奶。所以信心告诉你，你能在多大程度上信任这个协会。置信度越高，您将删除的关联就越多(即，不予考虑)。
*   *提升* —这是衡量您对相关产品组合的惊讶程度；不是普通意义上的惊讶，而是统计学意义上的惊讶。例如，假设你有一个篮子，里面有 1 个蓝球和 9 个红球。如果你伸手去抓一个随机的球，你有 10%的几率得到一个蓝球，90%的几率得到一个红球。让我们假设你把手伸进篮子 3 次，随机抓一个球，看看颜色，然后把球放回篮子里。据统计，得到 3 个蓝球的概率只有 0.1%，这意味着每 1000 次尝试中，你应该只有一次得到 3 个蓝球(平均)。如果你继续尝试，在这 1000 次尝试中，最终得到这样的结果 50 次，而不是 1 次或 2 次，那么你应该会非常惊讶。得到 50 次而不是 1 次这样的结果意味着它发生的频率是随机概率预测的 50 倍。所以 lift 基本上是用关联发生的频率除以关联偶然发生的概率(即关联不是真实的)。

在使用 Apriori 算法分析数据时，对于支持度、置信度或升力应该是多少，并没有正确的答案。然而，我喜欢使用一个简单的经验法则:

*   *支持* —这应该根据您的数据进行缩放。例如，如果您正在查看客户群相互关联的频率，但只有 10%的客户重复购买，那么您的支持度不能超过 10%，因为 90%的数据都只有一件商品。所以我通常使用一个简单的规则，即支持度应该至少是我期望项目子集出现在数据中的频率的 1%。
*   *信心*——一个没有预测性的关联是没有用的，所以一般来说，只要有可能，我喜欢看到至少 50%的信心，这样当你使用这个关联时，你往往是“正确的”。
*   *升力* —任何升力小于 10x 的尺子都应谨慎使用；我喜欢看到这种提升至少比偶然性高一个数量级，让我觉得这是一种真实的联系，而不仅仅是一种随机的巧合

**琐碎的、神秘的、有用的**

每当您使用像 Apriori 算法这样的算法来建立关联时，您通常会得到可分为三组的规则:

1.  琐碎的事情
2.  神秘的
3.  有用的

琐碎的规则是显而易见的关联。例如，如果你用这种技巧告诉商业领袖，购买尿布的顾客也购买婴儿配方奶粉，你可能会被他们笑出房间。或者买花生酱的顾客也买果冻。这些都是显而易见的，不需要千兆字节的数据和复杂的算法就能发现。一般来说，您会从大多数业务数据中获得大量“琐碎”的规则。

神秘的规则是数据中出现的关联，但很难解释，即使关联是真实的而不是随机的，也不一定是你会做的事情。例如，假设您发现购买牛奶与购买自动铅笔密切相关。这将是一个令人挠头的规则，因为没有理由——至少我能想到——为什么把牛奶放入购物车的顾客也会放自动铅笔。你可能不会重新布置你的商店，把铅笔和钢笔放在牛奶区。所以我会把这些类型的挠头联想归类为“神秘”——尽管这并不意味着知道它们没有用。你用这些做什么取决于你的策略…这将在稍后讨论。

最后是有用的规则。这些规则并不琐碎，也不“神秘”或“怪异”，而且你实际上可以立即投入使用。你有没有想过，为什么当你走过家得宝或其他大型五金店时，他们会习惯性地在过道上挂一些不相关但看起来合适的产品样品？例如，我注意到我当地的家得宝会在木材区放少量的锤子和钉子…整个过道里的钉子比你需要的还要多，锤子的种类也比大多数人见过的多，但出于某种原因，他们还是在木材区放了一些样品。为什么？这是因为联想。通过人工分析、轶事或使用 Apriori 算法等技术，有人注意到购买木材的人也倾向于购买锤子和钉子。这不是一个微不足道的规则，因为我会假设大多数从木材通道购买木材的人已经至少有一把锤子和大量的钉子，因为木材不是大多数人心血来潮购买的东西。然而，人们仍然倾向于一起购买这些东西…如果你处理木材，也许你永远不会有足够的锤子和钉子？

**分析！=策略…是的，我的朋友，你必须思考！**

分析师和数据科学家有时会犯错误，认为分析就是一切。那是一个错误。没有战略的分析就像购买大量水泥和木材，然后期待房子自己建造。分析只是一个构建模块…战略实际上是使用这些构建模块来完成一些有用的事情。所以你用 R 写了 8 行代码，发现了一系列神秘而有用的关联(希望你明白我的意思，忽略那些无关紧要的)…现在恭喜你，你打算用这些关联做什么呢？如果你是一名分析师或数据科学家，像商业人士一样思考并问自己这个问题是很重要的:“那又怎样？”

如果你曾经逛过杂货店，你会注意到牛奶区总是在杂货店的后面。这是有目的的:它迫使你在杂货店徘徊，这将增加你购买更多东西而不仅仅是牛奶的机会。这就是策略！让我们考虑一个类似{花生酱} = > {果冻}的琐碎联想。对于这种关联，您可以采取两种基本策略:

1.  将花生酱放在远离果冻的另一个通道，迫使购物者四处逛逛，增加他们购买其他东西的机会
2.  将花生酱放在同一个过道上，以增加顾客在拿到花生酱时购买果冻的机会

哪种策略更好？没有正确的答案。事实上，我见过一些杂货店使用一种策略，而另一家使用另一种策略。将花生酱和果冻放在远离彼此的地方可能会增加顾客在寻找两种产品时抓住另一种产品的机会，但如果他或她不想玩“捉迷藏”，则可能会有顾客只抓住一种并离开的风险。将花生酱和果冻放在同一个货架上，增加了顾客同时拿到两种产品的机会，并轻松创造更多收入，但如果顾客被迫四处闲逛，他们可能会拿到第三种产品。决定的唯一方法是运行 A/B 测试，比较每个策略产生的收入。如果你想更好地理解 A/B *真正衡量的是什么*，我也为[写了一篇关于这个的文章](/what-does-an-a-b-test-measure-adebf56ae68a)。