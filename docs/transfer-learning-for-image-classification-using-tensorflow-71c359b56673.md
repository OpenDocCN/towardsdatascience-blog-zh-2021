# 基于张量流的图像分类迁移学习

> 原文：<https://towardsdatascience.com/transfer-learning-for-image-classification-using-tensorflow-71c359b56673?source=collection_archive---------8----------------------->

## 案例研究:图像分类预测它是否是一种食物

![](img/d332ca409bff8fdec93acc5e4a654464.png)

尼克·萨莫伊洛夫在 [Unsplash](https://unsplash.com/s/photos/food-plate?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上的照片

# 介绍

图像分类是一项任务，其中计算机将预测图像属于哪一类。在深度学习开始蓬勃发展之前，像图像分类这样的任务无法达到人类水平的性能。这是因为机器学习模型无法学习图像的邻居信息。该模型仅获得像素级信息。

得益于深度学习的力量，使用一种称为卷积神经网络(CNN)的模型，图像分类任务可以达到人类水平的性能。

CNN 是一种深度学习模型，从图像中学习表示。这种模型可以在没有人类参与的情况下从低级到高级特征进行学习。

该模型不仅学习像素级的信息。该模型还通过一种称为卷积的机制从图像中学习邻居信息。卷积通过将一个区域中的像素集合相乘并将它们相加为一个值来聚合邻域信息。这些特征将用于将图像分类成一类。

深度学习虽然可以达到人类水平的性能，但是需要大量的数据。如果我们没有他们呢？我们可以用一个叫做迁移学习的概念。

迁移学习是一种方法，在这种方法中，我们将使用针对我们的问题在大规模数据上训练过的模型。所以我们只通过微调模型来训练他们。我们将得到的好处是模型将在短时间内训练。

本文将向您介绍如何使用 TensorFlow 使用迁移学习进行图像分类。因为预处理步骤是必不可少的过程，所以我也将向您展示如何为我们的深度学习模型准备数据。没有进一步，让我们开始吧！

# 实施

## 导入库

我们需要做的第一步是导入库。我们需要 TensorFlow，NumPy，os，还有熊猫。如果您还没有安装软件包，您可以使用 pip 命令来安装这些库。

> 请注意，我将使用的 TensorFlow 是版本 2.4.1，所以请确保安装该版本。
> 
> 还有，如果你想用 GPU 来训练深度学习模型，请安装 11.0 版本的 CUDA，因为那个版本支持 2.4.1 版本的 TensorFlow。你可以在这里下载 CUDA 软件[T5。](https://developer.nvidia.com/cuda-11.0-download-archive)

下面是安装和加载库的代码。

## 准备数据

加载库之后，下一步是准备数据集。在这种情况下，我们将使用一个名为 Food-5K 的数据集。

该数据集由 5000 幅图像组成，分为食物和非食物两类。此外，数据已经分为训练、验证和测试数据集。我们数据集的文件夹结构看起来像这样，

```
**\---Food-5K
    +---evaluation
    |       0_0.jpg
    |       1_0.jpg
    |       
    +---training
    |       0_0.jpg
    |       1_1.jpg
    |       
    \---validation
    |       0_0.jpg
    |       1_0.jpg**
```

正如您在上面看到的，每个文件夹都由图像组成，其中每个图像文件名都包含它的类和标识符。标识符由下划线分隔。

对于该文件夹结构，我们需要生成包含图像文件名和标签列的数据帧。准备数据集的代码如下所示，

这是数据帧的预览，

下一步是准备一个对象，将图像放入模型中。我们将首先使用 tf.keras.preprocessing.image 库中的 ImageDataGenerator 对象。

使用该对象，我们将生成图像批。此外，我们可以扩大我们的图像，以增加数据集的数量。因为我们也放大那些图像，所以我们也为图像放大方法设置参数。

此外，因为我们使用数据帧作为关于数据集的信息，所以我们将使用 flow_from_dataframe 方法来生成批处理并扩充图像。

下面是代码的样子，

## 训练模型

生成批次后，现在我们可以用迁移学习方法训练模型。因为我们使用那种方法，我们不需要从头实现 CNN 架构。相反，我们将使用现有的和已经过预训练的架构。

我们将使用 ResNet-50 作为我们新模型的主干。我们将创建输入，并根据类的数量用新的线性图层更改 ResNet-50 的最终线性图层。

下面是构建模型的代码，

现在我们来训练模型。我们将使用 fit 方法来训练它。下面是代码的样子，

## 测试模型

在我们训练模型之后，现在让我们在测试数据上测试模型。此外，我们需要添加 pillow 库来加载和调整图像的大小，并添加 scikit-learn 来计算模型性能。

我们将使用 scikit-learn 库中的 classification_report 来生成一个关于模型性能的报告。此外，我们将从中可视化混淆矩阵。下面是预测测试数据集及其结果的代码，

从上面可以看出，该模型的性能已经达到了 95%以上。因此，我们可以在构建图像分类器 API 的情况下使用该模型。

## 保存模型

如果您希望将模型用于以后的使用或部署，您可以使用 save 方法保存模型，如下所示，

如果要加载加载模型，可以像这样使用 load_model 函数，

# 结束语

干得好！现在你知道如何使用 TensorFlow 实现迁移学习了。希望这篇文章对你有所帮助，尤其是想用有限的数据训练一个深度学习模型的人。

如果你对这篇文章感兴趣，可以关注我的**媒**。另外，如果你想与我交谈，你可以在 [**LinkedIn**](https://www.linkedin.com/in/alghaniirfan/) 上与我联系。

谢谢你看我的文章！