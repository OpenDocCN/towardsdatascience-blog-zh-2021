# 提升熊猫技能的四个功能

> 原文：<https://towardsdatascience.com/four-functions-to-level-up-your-pandas-skills-c89f95a1773a?source=collection_archive---------6----------------------->

## 分配、映射、查询和分解。城里最热门的方法

![](img/91f1695d56b3d134840b8198d6e400d8.png)

照片由[斯蒂芬妮·克莱帕奇](https://unsplash.com/@sklepacki?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄

# 介绍

无论你是数据科学家、数据工程师、数据分析师还是机器学习专家，你都必须处理表格数据。如果您是 Python 用户，那么在处理表格数据时，最常用的库是 [Pandas](https://pandas.pydata.org/) 🐼。由于表格数据无处不在，Pandas 可能是所有美国数据人员中使用最多的库之一。

Pandas 提供了一个功能丰富的 API，用于转换数据和提取有价值的见解。不幸的是，许多人，包括过去的我自己，没有充分利用它提供的所有功能。这经常导致庞大、过度复杂和低性能的熊猫代码😔。

我想为改变这种情况做出贡献，并帮助你提升你的熊猫知识，这样你未来的代码将更好读，也更有性能💪！为此，在这篇文章中，我向你介绍四种不同的熊猫功能，即`assign, map, query,`和`exlpode`。当掌握了这些，我们就在考虑清晰度和性能的正确方向上迈出了一步！

你准备好了吗？我们开始吧！

# 神奇四侠

在我们研究具体的 Pandas 功能之前，我们首先需要一些数据来处理。在下面的例子中，我使用了著名的[虹膜数据集](https://archive.ics.uci.edu/ml/datasets/iris)。如果你不想为了获取数据而安装一个专用的库，只需输入`data = pd.read_csv('https://raw.githubusercontent.com/mwaskom/seaborn-data/master/iris.csv')`就可以了。

在我们开始之前的最后一句话，下面的大多数例子在内容上可能没有太多意义，但是阐明了每个函数的细节。

都准备好了吗？让我们开始吧！

## 分配

我们要看的第一种方法是`[assign](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.assign.html)`方法。此方法允许您向数据帧添加列。代码最好用代码来解释，所以这里来一个例子

我们在这里做了什么？这相当容易！我们使用`assign`创建了两个新列，将这些列的名称作为关键字参数传递给函数，并使用*为它们分配结果列应该包含的值。如您所见，要分配实际值，您有三种不同的选择。*

1.  您可以使用一个*标量值*，它将新列的所有条目设置为该值。
2.  您可以使用一个*数组或系列*，这将导致该数组被用作列的值。该数组的长度必须与调用 assign-method 的数据帧的长度相同。
3.  您可以使用一个*函数*，或者更一般的一个*可调用函数*，它将一个数据帧作为其唯一的输入，并返回一个标量或序列。当返回一个序列时，它的长度必须与输入数据帧的长度相同。
    这个选项的巧妙之处在于，可调用函数的输入数据帧就是调用 assign-method 的数据帧。这意味着什么，为什么它是整洁的？例如，如果您首先对聚合执行`[g](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.assign.html)roupby`，然后调用`assign`，那么您可以在函数中使用聚合来计算新列的值。这也是您在示例代码中看到的。对我来说，这真的很紧凑，同时还很有表现力。

如示例所示，可以用一个分配调用来*创建多个列。因此，你只需要传递多个关键字参数；每个要创建的列一个。这很酷，因为以后的赋值可以利用以前创建或修改的列。举个简单的例子，您可以运行`df.assign(x_axis=np.random.rand(len(df)), y_axis=**lambda** in_: in_.x_axis ** 2)`，其中第二个赋值使用了第一个赋值中创建的列。*

最后，我想提到一个小技巧，它允许您*创建没有正确 Python 变量名的列*。为此，您必须创建一个字典，将列名作为键，将赋值操作作为值，并将这个字典解包后传递给赋值方法😵。这听起来比实际要难。为了更清楚，让我们用一个例子来结束这一段，在这个例子中，我们用无效的 Python 变量名`df.assign(**{'X-Axis': np.random.rand(len(df)), 'Y-Axis': **lambda** in_: in_['X-Axis'] ** 2})`创建了两个新列。

## 地图

可以在 Pandas 系列对象上调用的另一个方便的函数是`[map](https://pandas.pydata.org/docs/reference/api/pandas.Series.map.html)`函数。使用`map`,您可以用另一个值替换*系列*中的每个值。这是一个简单的例子，我用赋值函数调用做了一些 dogfooding😃

在这段代码中，我们使用`map`有条件地将`to_big_to_small`列的条目设置为两个不同的字符串。此外，我们使用`map`来添加一个新列`inverted_name`，它保存每个物种的颠倒名称。当然，这个例子在内容方面不是很有用，尽管它举例说明了如何调用`map`的两个选项。

1.  您向 map 函数传递一个集合类型，比如字典或序列。将要发生的是，你的序列的*值将被用作*键，从给定的集合中查找相应的值*。任何不属于集合的值都将被映射到`NaN`或`None`。为了不那么枯燥，我给你另一个玩具例子`pd.Series(range(3)).map({1:'medium', 2:'high'})`。当您执行该操作时，会产生一系列条目`[NaN, 'medium', 'high']`。*
2.  您向`map`传递一个函数或 callable，它将一个标量作为输入并返回一个标量值。这样做时，该函数将使用每个值作为输入参数，按元素方式应用于序列的每个条目。这就是你在第 6 行看到的，我们颠倒了花卉物种的名称。
    作为建议，*不要用那种方法做任何数学运算*。当直接应用于一个系列时，这可以更有效地完成，因为它在后面利用了 NumPy 矢量化。

最后，如果您想对整个数据帧而不是一个序列进行元素操作，您可以使用`[applymap](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.applymap.html)`函数，它的行为与`map`相同。

## 询问

在我们研究了操作数据容器的函数之后，让我们看看如何从数据帧中提取数据。*提取行*的一个有用的函数是`query`函数。当然，我们从一些代码开始

我们在这里做了什么？我们使用传递给`query`的逻辑过滤表达式选择了所有行的子集。过滤器表达式是一个字符串，可以包含各种逻辑比较，如`>,<,>=,<=,!=,==,`等，以比较数据帧的列。然后，`query`函数对该表达式求值，并将表达式求值的所有行返回给`**True**`。

在表达式中，通过使用列的名称来引用列。要引用不是有效 Python 变量名的列名，必须用反斜线将它们括起来，如第 6 行所示。

如果您想从外部作用域引用任何变量，您可以通过在它们的名称前加上@字符来实现，正如您看到的`length_th`变量。

值得注意的是，您可以使用索引操作来执行相同的操作。然而，当您使用`query`时，产生的代码不那么冗长，更好阅读。

## 激增

我们在这篇文章中讨论的最后一个函数是`[explode](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.explode.html)`，显然是名字最引人注目的一个💣。这个功能有什么用？当一列的条目类似于列表时,`explode`函数很有用。具体地说，它使您能够为这些列表的每个条目创建一个新行。进行此操作时，*一行的所有其他条目都将被复制，索引*也是如此。您可以通过传递包含类似列表的对象的列的名称来调用它。和往常一样，让我们用一个例子来说明这一点

在给定的示例中，我们首先创建一个包含 3 行的数据帧。列`a`的条目最初分别是长度为 1、2 和 4 的列表。分解列`a`上的数据帧后，得到的数据帧大小为 1+2+4 = 7。我可以推荐复制这个例子，并对它进行试验。

现在你可能明白为什么这个函数叫做 explode 了；当使用它时，你的数据帧的尺寸会爆炸。抛开小玩具的例子，假设您有一个 500_000 行的数据帧，有一列包含 100 个条目的列表。当您对该列调用 explode 时，最终会得到 50_000_000 行。这可能是一个问题。所以我的建议是:*慎用！*

需要知道的一件重要事情是，explode 不会改变它所应用的列的数据类型。由于 Pandas 用 object 类型存储类似列表的值，这意味着在展开一列后，它仍然是 object 类型。如果您想改变这一点，您必须使用`astype`方法显式地这样做。这也是您在示例代码中看到的。

![](img/681617bc8e57036f07a92f150aa7d00c.png)

[伊登·康斯坦丁诺](https://unsplash.com/@edenconstantin0?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

# 包裹

在这篇文章中，我们看了四个不同的熊猫函数来处理数据帧和序列。当您开始使用这些函数时，您未来的代码将更加优雅、易读和高效。相信我。如果你真的想的话，你也可以利用这些函数来给你的同事留下深刻的印象😎。

感谢您关注这篇文章。一如既往，如果有任何问题、意见或建议，请随时联系我或关注我，无论是在 medium 还是通过 [LinkedIn](https://www.linkedin.com/in/simon-hawe-75832057) 。