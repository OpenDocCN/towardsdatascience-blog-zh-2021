# å¦‚ä½•æ„å»º Scikit-åƒä¸“å®¶ä¸€æ ·å­¦ä¹ ç®¡é“

> åŸæ–‡ï¼š<https://towardsdatascience.com/how-to-build-scikit-learn-pipelines-like-a-pro-107c1ffec225?source=collection_archive---------17----------------------->

## é€šè¿‡ä¸€ä¸ªè¿·ä½ é¡¹ç›®ï¼Œå­¦ä¹ æ„å»ºé¢„å¤„ç†ã€å»ºæ¨¡ä»¥åŠç½‘æ ¼æœç´¢ç®¡é“çš„ç®€å•æ–¹æ³•

![](img/dead7783d27a4a09bd050f9dc5c9535b.png)

[é©¬å…‹è€æ¿](https://unsplash.com/@vork?utm_source=medium&utm_medium=referral)åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹ç…§

æ¯æ¬¡ä¸ºé¡¹ç›®é€‰æ‹©æ•°æ®é›†æ—¶ï¼Œæ‚¨çš„ä»»åŠ¡éƒ½æ˜¯æ¸…ç†å’Œé¢„å¤„ç†æ•°æ®ã€å¤„ç†ç¼ºå¤±æ•°æ®å’Œå¼‚å¸¸å€¼ã€å»ºæ¨¡ï¼Œç”šè‡³æ‰§è¡Œè¶…å‚æ•°æœç´¢ä»¥æ‰¾åˆ°ç”¨äºè¯„ä¼°çš„æœ€ä½³è¶…å‚æ•°é›†ã€‚

æ˜¾ç„¶ï¼Œåœ¨ä»£ç ä¸­ç”¨**ç®¡é“**å¯ä»¥æ–¹ä¾¿å¿«æ·åœ°åšåˆ°è¿™ä¸€ç‚¹ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æµè§ˆä¸€ä¸ªç›¸å½“æµè¡Œçš„ Kaggle æ•°æ®é›†ï¼Œæ‰§è¡Œæ‰€æœ‰è¿™äº›æ­¥éª¤ï¼Œå¹¶æ„å»ºä¸€ä¸ªçœŸæ­£çš„ sklearn ç®¡é“æ¥å­¦ä¹ ã€‚

æˆ‘ä»¬å¼€å§‹å§ğŸ‘‡

# æ¢ç´¢æ•°æ®é›†

æˆ‘ä»¬å°†åœ¨è¿™ä¸ªè¿·ä½ é¡¹ç›®ä¸­ä½¿ç”¨çš„æ•°æ®é›†å°†æ¥è‡ª Kaggle â€” [å¿ƒåŠ›è¡°ç«­æ£€æµ‹è¡¨æ ¼æ•°æ®é›†](https://www.kaggle.com/andrewmvd/heart-failure-clinical-data)ï¼Œå¯åœ¨ Creative Common çš„è®¸å¯ä¸‹è·å¾—ã€‚ä»ä¸‹é¢çš„ Kaggle é“¾æ¥è·å–:

[](https://www.kaggle.com/andrewmvd/heart-failure-clinical-data) [## å¿ƒåŠ›è¡°ç«­é¢„æµ‹

### é¢„æµ‹æ­»äº¡äº‹ä»¶çš„ 12 ä¸ªä¸´åºŠç‰¹å¾ã€‚

www.kaggle.com](https://www.kaggle.com/andrewmvd/heart-failure-clinical-data) 

æˆ‘ä»¬å¯¼å…¥ä¸€ä¸‹ï¼Œçœ‹çœ‹æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼

![](img/2405a967fa038bd7003472f9517e3d1f.png)

æŒ‰ä½œè€…åˆ†ç±»çš„å›¾åƒ-æ•°æ®é¢„è§ˆ

ä¸‹ä¸€æ­¥æ˜¯å°†æ•°æ®é›†åˆ†æˆè®­ç»ƒé›†å’Œæµ‹è¯•é›†ã€‚é™¤äº†æœ€åä¸€åˆ—æ˜¯â€œ**æ­»äº¡äº‹ä»¶**â€ä¹‹å¤–ï¼Œæˆ‘ä»¬æœ‰æ‰€æœ‰ç”¨äºè®­ç»ƒçš„ç‰¹å¾ã€‚æŸ¥çœ‹æœ€åä¸€åˆ—ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ª**äºŒè¿›åˆ¶åˆ†ç±»**ä»»åŠ¡ã€‚

åˆ—è½¦æµ‹è¯•åˆ†ç¦»

```
The shape of the data:Output:((209, 12), (90, 12), (209,), (90,))
```

æœ€åï¼Œæˆ‘ä»¬æ¢ç´¢æ•°æ®é›†çš„æ‰€æœ‰æ•°å­—åˆ—:

```
X_train.describe().T
```

![](img/fd8103337c165c49825b66ce2c9b121a.png)

æŒ‰ä½œè€…åˆ†ç±»çš„å›¾åƒ-æè¿°æ•°æ®é›†

æŸ¥çœ‹åˆ†ç±»æ•°æ®ï¼Œæˆ‘ä»¬ç¡®è®¤æ²¡æœ‰:

```
# there are no categorical featurescategorical_features = X_train.select_dtypes(exclude='number').columns.tolist()categorical_features
```

![](img/c73bd814d923630329f9d16b8a3a81f2.png)

ä½œè€…æä¾›çš„å›¾ç‰‡-æ— çŒ«ç‰¹å¾

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­å»ºè®¾æˆ‘ä»¬çš„ç®¡é“äº†ï¼

# æˆ‘ä»¬çš„ Scikit-learn ç®¡é“

## é¢„å¤„ç†æµæ°´çº¿

é¦–å…ˆï¼Œæˆ‘ä»¬æ„å»ºé¢„å¤„ç†ç®¡é“ã€‚å®ƒå°†ç”±ä¸¤ä¸ªç»„ä»¶ç»„æˆâ€”â€”1)ä¸€ä¸ªç”¨äºå°†æ•°æ®è½¬æ¢åˆ°(0ï¼Œ1)ä¹‹é—´çš„`**MinMaxScalar**`å®ä¾‹ï¼Œä»¥åŠ 2)ä¸€ä¸ªç”¨äºä½¿ç”¨åˆ—ä¸­ç°æœ‰å€¼çš„å¹³å‡å€¼å¡«å……ç¼ºå¤±å€¼çš„`**SimpleImputer**`å®ä¾‹ã€‚

```
col_transformation_pipeline = Pipeline(steps=[ ('impute', SimpleImputer(strategy='mean')), ('scale', MinMaxScaler())])
```

æˆ‘ä»¬ç”¨ä¸€ä¸ª`**ColumnTransformer**`æŠŠå®ƒä»¬æ”¾åœ¨ä¸€èµ·ã€‚

A `**ColumnTransformer**` å¯ä»¥æ¥å—ç”±æˆ‘ä»¬éœ€è¦åº”ç”¨äºæ•°æ®çš„ä¸åŒåˆ—è½¬æ¢ç»„æˆçš„å…ƒç»„ã€‚å¯¹äºæ¯ä¸ªè½¬æ¢ï¼Œå®ƒè¿˜éœ€è¦ä¸€ä¸ªåˆ—åˆ—è¡¨ã€‚å› ä¸ºè¿™é‡Œåªæœ‰æ•°å­—åˆ—ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†æ‰€æœ‰çš„åˆ—éƒ½æä¾›ç»™åˆ—è½¬æ¢å™¨å¯¹è±¡ã€‚

é‚£ä¹ˆè®©æˆ‘ä»¬æŠŠå®ƒä»¬æ”¾åœ¨ä¸€èµ·:

å‰å®³ï¼æˆ‘ä»¬ç®¡é“çš„ç¬¬ä¸€éƒ¨åˆ†å®Œæˆäº†ï¼

è®©æˆ‘ä»¬ç°åœ¨å»å»ºç«‹æˆ‘ä»¬çš„æ¨¡å‹ã€‚

## æ¨¡å‹ç®¡é“

æˆ‘ä»¬ä¸ºæ­¤ä»»åŠ¡é€‰æ‹©äº†ä¸€ä¸ªéšæœºçš„æ£®æ—åˆ†ç±»å™¨ã€‚è®©æˆ‘ä»¬æ—‹è½¬ä¸€ä¸ªå¿«é€Ÿåˆ†ç±»å™¨å¯¹è±¡:

```
# random forest classifierrf_classifier = RandomForestClassifier(n_estimators = 11, criterion='entropy', random_state=0)
```

è€Œä¸”ï¼Œæˆ‘ä»¬å¯ä»¥å°†é¢„å¤„ç†å’Œæ¨¡å‹ç»“åˆåœ¨ä¸€ä¸ªç®¡é“ä¸­:

```
rf_model_pipeline = Pipeline(steps=[ ('preprocessing', columns_transformer), ('rf_model', rf_classifier),])
```

ç°åœ¨ï¼Œæ‹Ÿåˆæˆ‘ä»¬çš„è®­ç»ƒæ•°æ®éå¸¸ç®€å•:

```
rf_model_pipeline.fit(X_train, y_train)
```

æœ€åï¼Œæˆ‘ä»¬å¯ä»¥é¢„æµ‹æˆ‘ä»¬çš„æµ‹è¯•é›†ï¼Œå¹¶è®¡ç®—æˆ‘ä»¬çš„å‡†ç¡®åº¦åˆ†æ•°:

```
# predict on test sety_pred = rf_model_pipeline.predict(X_test)
```

ç»¼åˆèµ·æ¥çœ‹:

è¿™ä¸€åˆ‡éƒ½å¾ˆå¥½ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘è¯´æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªç®¡é“æ‰§è¡Œç½‘æ ¼æœç´¢æ¥æŸ¥æ‰¾æœ€ä½³è¶…å‚æ•°ï¼Œé‚£ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿé‚£ä¸æ˜¯å¾ˆé…·å—ï¼Ÿ

æ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥æ¢ç´¢ä¸€ä¸‹ï¼

# åœ¨æˆ‘ä»¬çš„ç®¡é“ä¸­ä½¿ç”¨ GridSearch

æˆ‘ä»¬å·²ç»å»ºç«‹å¹¶ä½¿ç”¨æˆ‘ä»¬çš„æ¨¡å‹æ¥é¢„æµ‹æˆ‘ä»¬çš„æ•°æ®é›†ã€‚æˆ‘ä»¬ç°åœ¨å°†å…³æ³¨äºä¸ºæˆ‘ä»¬çš„éšæœºæ£®æ—æ¨¡å‹å¯»æ‰¾æœ€ä½³è¶…å‚æ•°ã€‚

è®©æˆ‘ä»¬é¦–å…ˆå»ºç«‹æˆ‘ä»¬çš„å‚æ•°ç½‘æ ¼:

```
params_dict = {'rf_model__n_estimators' : np.arange(5, 100, 1), 'rf_model__criterion': ['gini', 'entropy'], 'rf_model__max_depth': np.arange(10, 200, 5)}
```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç€é‡äºè°ƒæ•´æ¨¡å‹çš„ä¸‰ä¸ªå‚æ•°:

1.  **n_estimators** :éšæœºæ£®æ—ä¸­çš„æ ‘æœ¨æ•°é‡ï¼Œ

2.**æ ‡å‡†**:æµ‹é‡åˆ†å‰²è´¨é‡çš„åŠŸèƒ½ï¼Œä»¥åŠ

3.**æœ€å¤§æ·±åº¦:**æ ‘çš„æœ€å¤§æ·±åº¦

**è¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ä»¶é‡è¦äº‹æƒ…æ˜¯**:åœ¨æˆ‘ä»¬çš„ç½‘æ ¼ä¸­ï¼Œæˆ‘ä»¬ä¸æ˜¯ç®€å•åœ°ä½¿ç”¨`**n_estimators**`ä½œä¸ºå‚æ•°åï¼Œè€Œæ˜¯ä½¿ç”¨:`**rf_model__n_estimators**`ã€‚è¿™é‡Œçš„`**rf_model__**`å‰ç¼€æ¥è‡ªæˆ‘ä»¬ä¸ºç®¡é“ä¸­çš„éšæœºæ£®æ—æ¨¡å‹é€‰æ‹©çš„åç§°ã€‚(å‚è€ƒä¸Šä¸€èŠ‚)ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç®€å•åœ°ä½¿ç”¨ GridSearch æ¨¡å—æ¥è®­ç»ƒæˆ‘ä»¬çš„åˆ†ç±»å™¨:

```
grid_search = GridSearchCV(rf_model_pipeline, params_dict, cv=10, n_jobs=-1)grid_search.fit(X_train, y_train)
```

è®©æˆ‘ä»¬æŠŠæ‰€æœ‰è¿™äº›æ”¾åœ¨ä¸€èµ·:

ç°åœ¨ï¼Œç”¨æˆ‘ä»¬çš„`**grid_search**`ç‰©ä½“æ¥é¢„æµ‹å¾ˆå®¹æ˜“ï¼Œå°±åƒè¿™æ ·:

![](img/5b7ee3dd0a4d225d670080d28aa91397.png)

æŒ‰ä½œè€…åˆ†ç±»çš„å›¾åƒâ€”å‡†ç¡®åº¦åˆ†æ•°

å‰å®³ï¼æˆ‘ä»¬ç°åœ¨å·²ç»ä¸ºæˆ‘ä»¬çš„é¡¹ç›®å»ºç«‹äº†ä¸€ä¸ªå®Œæ•´çš„ç®¡é“ï¼

# å‡ å¥ä¸´åˆ«èµ è¨€â€¦

æ‰€ä»¥ï¼Œä½ æœ‰å®ƒï¼ç”±é¢„å¤„ç†å™¨ã€æ¨¡å‹å’Œç½‘æ ¼æœç´¢ç»„æˆçš„å®Œæ•´ sklearn ç®¡é“éƒ½åœ¨ Kaggle çš„ä¸€ä¸ªè¿·ä½ é¡¹ç›®ä¸Šè¿›è¡Œå®éªŒã€‚æˆ‘å¸Œæœ›ä½ ä¼šå‘ç°è¿™ç¯‡æ•™ç¨‹å¾ˆæœ‰å¯å‘æ€§ï¼Œå¹¶ä¸”å¾ˆå®¹æ˜“ç†è§£ã€‚

æ˜¯æ—¶å€™è¡¨æ‰¬ä¸€ä¸‹è‡ªå·±äº†ï¼ğŸ˜€

åœ¨è¿™é‡Œæ‰¾åˆ°æœ¬æ•™ç¨‹çš„å®Œæ•´ä»£ç ã€‚è¿™æ˜¯æˆ‘æ‰€æœ‰æ•°æ®ç§‘å­¦æ–‡ç« çš„ä»£ç åº“ã€‚å¦‚æœä½ æ„¿æ„çš„è¯ï¼Œè¯·ç»™å®ƒæ ‡ä¸Šæ˜Ÿå·å’Œä¹¦ç­¾ï¼

å°†æ¥ï¼Œæˆ‘ä¼šå›æ¥å†™æ›´å¤šåŸºäº Scikit-learn çš„æ–‡ç« ã€‚æ‰€ä»¥[è·Ÿç€æˆ‘](https://ipom.medium.com/)åœ¨åª’ä½“ä¸Šï¼Œå¹¶ç•™åœ¨å¾ªç¯ï¼

## [æˆ‘è¿˜å»ºè®®æˆä¸ºä¸€åä¸­ç­‰ä¼šå‘˜ï¼Œä¸è¦é”™è¿‡æˆ‘æ¯å‘¨å‘è¡¨çš„ä»»ä½•æ•°æ®ç§‘å­¦æ–‡ç« ã€‚](https://ipom.medium.com/membership/)åœ¨æ­¤åŠ å…¥ğŸ‘‡

[](https://ipom.medium.com/membership) [## é€šè¿‡æˆ‘çš„æ¨èé“¾æ¥åŠ å…¥ Mediumâ€”Yash pra kash

### ä½œä¸ºä¸€ä¸ªåª’ä½“ä¼šå‘˜ï¼Œä½ çš„ä¼šå‘˜è´¹çš„ä¸€éƒ¨åˆ†ä¼šç»™ä½ é˜…è¯»çš„ä½œå®¶ï¼Œä½ å¯ä»¥å®Œå…¨æ¥è§¦åˆ°æ¯ä¸€ä¸ªæ•…äº‹â€¦

ipom.medium.com](https://ipom.medium.com/membership) 

# æ¥é€šç”µè¯ï¼

> *å…³æ³¨æˆ‘* [*æ¨ç‰¹*](https://twitter.com/csandyash) *ã€‚* [*æŸ¥çœ‹æˆ‘æ‰€æœ‰æ•°æ®ç§‘å­¦å¸–å­çš„å®Œæ•´ä»£ç åº“ï¼*](https://github.com/yashprakash13/data-another-day)

æˆ‘çš„å…¶ä»–å‡ ç¯‡æ–‡ç« ä½ å¯èƒ½ä¼šæ„Ÿå…´è¶£:

[](/the-nice-way-to-deploy-an-ml-model-using-docker-91995f072fe8) [## ä½¿ç”¨ Docker éƒ¨ç½² ML æ¨¡å‹çš„å¥½æ–¹æ³•

### ä½¿ç”¨ FastAPI éƒ¨ç½² ML æ¨¡å‹å¹¶åœ¨ VSCode ä¸­è½»æ¾å°è£…å®ƒçš„å¿«é€ŸæŒ‡å—ã€‚

towardsdatascience.com](/the-nice-way-to-deploy-an-ml-model-using-docker-91995f072fe8) [](/31-datasets-for-your-next-data-science-project-6ef9a6f8cac6) [## æ‚¨ä¸‹ä¸€ä¸ªæ•°æ®ç§‘å­¦é¡¹ç›®çš„ 31 ä¸ªæ•°æ®é›†

### åŸºäºä»»åŠ¡çš„æ•°æ®é›†çš„æ±‡ç¼–ï¼Œå¯ç”¨äºæ„å»ºä¸‹ä¸€ä¸ªæ•°æ®ç§‘å­¦é¡¹ç›®

towardsdatascience.com](/31-datasets-for-your-next-data-science-project-6ef9a6f8cac6) [](/how-to-use-bash-to-automate-the-boring-stuff-for-data-science-d447cd23fffe) [## å¦‚ä½•ä½¿ç”¨ Bash æ¥è‡ªåŠ¨åŒ–æ•°æ®ç§‘å­¦çš„æ¯ç‡¥å·¥ä½œ

### ä½¿ç”¨å‘½ä»¤è¡Œä¸ºæ‚¨çš„æ•°æ®ç§‘å­¦é¡¹ç›®ç¼–å†™ä¸€äº›å¯é‡ç”¨ä»£ç çš„æŒ‡å—

towardsdatascience.com](/how-to-use-bash-to-automate-the-boring-stuff-for-data-science-d447cd23fffe)