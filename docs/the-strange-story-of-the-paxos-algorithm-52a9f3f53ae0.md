# Paxos 算法的奇怪故事

> 原文：<https://towardsdatascience.com/the-strange-story-of-the-paxos-algorithm-52a9f3f53ae0?source=collection_archive---------28----------------------->

## 我们每天使用的一个流行算法是如何作为一个关于古希腊议会的故事出版的，以及它是如何工作的

![](img/ec993e2b8eaa26eccc81ed53ae4549d7.png)

照片由 [ESR 法](https://unsplash.com/@esrlaw)在 [Unsplash](https://unsplash.com/photos/77ZDhsuETAA) 上拍摄

Paxos 算法是一系列协议，旨在解决具有不可靠节点的网络的一致性问题。它的[原始论文](https://www.microsoft.com/en-us/research/publication/part-time-parliament/)保持着最长出版延迟(超过 8 年)的记录，因为它有趣地传递了一个关于帕科斯岛上古希腊议会的故事。

> “我决定用古希腊岛屿上的议会来模拟算法……我给希腊立法者提供了在该领域工作的计算机科学家的名字，在吉巴斯的帮助下音译成一种伪造的希腊方言……写一个失落的文明让我能够消除无趣的细节，并通过说议会协议的一些细节已经丢失来表明概括。为了进一步展现这一形象，我以印第安纳·琼斯式考古学家的身份做了几次讲座，带着斯特森帽和酒壶。——莱斯利·兰波特(作者)

2001 年，在论文发表大约三年后，兰普森为他的论文写了一个更简单的版本，没有用希腊语描述算法。从那以后，这种算法变得非常流行，被科技行业中一些最大的公司(如谷歌、IBM、微软和亚马逊)使用。

> “我厌倦了每个人都说 Paxos 算法有多难理解，发表在[【122】](https://www.microsoft.com/en-us/research/publication/part-time-parliament/)。虽然人们如此沉迷于伪希腊名字，以至于他们发现这篇论文很难理解，但算法本身非常简单……当前版本有 13 页长，没有包含比 n1 > n2 更复杂的公式。”——莱斯利·兰波特(作者)

尽管它的交付很有趣，但这个算法非常简单，并且在处理一个重要问题时做得很好。有趣的是，我们可以看到 Lamport 是如何通过与先进的议会系统进行类比，将这种算法概念化的。在现实世界的问题和事件的背景下思考算法已经导致了计算机科学的一些巨大进步。一个重要的例子是试图复制人脑中神经元为神经网络工作的方式，这导致了行业中一些最先进和性能最好的模型。

# 共识算法:问题

在分布式系统(许多计算机相互通信的系统)中，一致性问题是一个很难解决的问题。Lamport 将一致性问题(他称之为安全性)描述为有三个组成部分:

1.  只能选择已建议的值(有效性)
2.  所有节点都同意相同的单个值(协定)
3.  如果实际上已经选择了(终止)，则节点仅知道已经选择了一个值

考虑一个只有一个文件的基本文件共享系统。两个用户试图同时写入该文件。哪个文件是“正确的”文件？系统应该如何响应用户？当另一个用户读取这个文件时，他们应该得到哪个？

在可以同时向系统提供多个值的情况下，满足这三个约束是具有挑战性的。我们每天依赖的许多网络都分布着许多并发的用户发出读写请求。因此，存在一种有效的算法来处理这种类型的行为是极其重要的。

引入网络中的计算机可以停止工作或重启的想法，使得这个问题变得更加具有挑战性。这就引入了一个概念，即每当一个更新的值被发送到一个节点时，这个值就有很小的可能永远不会到达它。在这种类型的网络[中，不可能确认所有节点之间的通信成功](https://groups.csail.mit.edu/tds/papers/Lynch/jacm85.pdf)。

在帕克森议会的背景下，兰波特将这个问题描述为议会需要“即使立法者不断进出议会大厅也能发挥作用。”立法者永远不知道特定的议员是否在任何特定的时间听到了议会中所说的话。

> “兼职议会的治理问题与当今容错分布式系统面临的问题有着显著的对应关系，在这种系统中，立法者对应于进程，离开议会对应于失败。”

# Paxos 算法

为了解释算法是如何工作的，我们将使用由 Paxos 制作的简单的纸。如果你想了解 Lamport 如何在古希腊岛屿议会的背景下描述该算法，可以在[这里](https://www.microsoft.com/en-us/research/uploads/prod/2016/12/The-Part-Time-Parliament.pdf)找到这篇论文。

## 角色

在该算法中，节点可以扮演三种角色:

1.  **提议者:**提议者向接受者发送消息，试图改变价值观。
2.  接受者:接受者接收来自提议者的消息，并且只有当足够数量的接受者接收到相同的消息时才接受它们。
3.  **学习者:**一旦消息被足够数量的接受者认可，学习者就负责执行请求并向客户端发送响应。

一个节点可以充当多个代理，但是将这些代理概念化为三个独立的角色是有帮助的。

法定人数被定义为大多数接受者节点。兰波特认为这就足够了，因为“任何两个多数至少有一个共同的接受者。”该算法可以扩展为给每个节点赋予权重。在这种情况下，仲裁将由一组节点组成，这些节点占分配给网络中所有接受者节点的总权重的一半以上。

## 提案编号

为了允许多个建议，该算法使用所谓的建议号。接受者不接受建议编号低于或等于他们已经看到的建议编号的消息。

## 准备请求并承诺回应

为了发送提议，提议者向接受者节点发送具有提议号(n)的消息。n 的值被定义为大于发送消息的提议者在先前提议中使用的任何数字。该消息被称为*准备*请求。

提议者期望接受者的回应(称为承诺),包括:

*   承诺绝不接受小于 n 的提案
*   具有小于 n 的最大数的建议，如果该值存在，则该建议已被接受。

接受者节点不必发送响应来确保算法的安全性。接受者节点可以通过告诉提议者它已经对另一个更高编号的提议作出承诺(这不是必需的，但是是性能优化)或者通过向提议者作出具有上述组件的承诺来响应准备请求。

## 接受请求

一旦提议者收到大多数接受者的承诺，它就向一组接受者(可以不同于准备请求的接受者)发送提议将被接受的请求(称为*接受*请求)。这些请求包括版本号(n)和值(v)，其中 v 是“[承诺响应]中编号最高的提议，或者是提议者选择的任何值，如果响应者没有报告任何提议。”

当且仅当它没有承诺不接受请求时，接受者才应该响应接受请求(它还没有承诺更大的版本号)。

## 学习价值观

一旦一个值被接受，学习者必须发现这个提议已经被法定人数的接受者接受。一旦接受者接受了一个值，它就将其接受发送给一组杰出的学习者，然后这些学习者可以通知所有其他学习者已经选择的值。

当在可靠性和通信复杂性之间选择杰出学习者集合的大小时，有一个折衷。更杰出的学习者将导致更好的可靠性。

# 结论

随着科技行业继续依赖分布式网络进行扩展，尽可能有效地解决这一共识问题变得越来越重要。

在一个至少有一个节点可能失效的系统中，在[这篇著名的论文](https://groups.csail.mit.edu/tds/papers/Lynch/jacm85.pdf)中已经被证明是不可能达成共识的。也就是说，不可能满足有效性、一致性和终止性的属性。Paxos 保证了前两个，并在保证终止性方面做得相对较好，这使它成为一个非常流行的共识算法。

虽然想象 Lamport 穿着印第安纳琼斯的服装在舞台上描述这种算法并讲述一个用虚构的希腊名字组成的议会的故事是很幽默的，但想想如果这篇论文以典型的方式发表并在八年前发表，分布式技术的发展可能会有什么不同也是很有趣的。

Paxos 算法及其变体用于分布式和云计算系统，我们每天都在使用技术与这些系统进行交互。它使得扩展分布式机器的大型系统更加可靠。想到这篇论文因为兰波特在发表他的观点时冒了创造性的风险而被驳回了近十年，真是好笑。

有时候，从一个不同的角度处理一个复杂的问题可以打开一个问题的新视角。它可以带来一些高效的解决方案。我只是不建议一旦你找到了解决方案，就发表一篇论文，装扮成印第安纳·琼斯来讨论你的解决方案。

感谢您阅读这篇文章。