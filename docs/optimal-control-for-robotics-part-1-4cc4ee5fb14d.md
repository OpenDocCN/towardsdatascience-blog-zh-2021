# 机器人的最佳控制:第一部分

> 原文：<https://towardsdatascience.com/optimal-control-for-robotics-part-1-4cc4ee5fb14d?source=collection_archive---------19----------------------->

## 如何以最省时的方式移动机械臂？

![](img/e0babbc5d9b84ed641fa09a5d85ef200.png)

图德 [**帕维尔**](https://www.pexels.com/fr-fr/@pavel-danilyuk?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels) **上** [**像素**](https://www.pexels.com/fr-fr/photo/homme-gens-femme-connexion-8439093/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)

如果您已经阅读了最优控制系列的前几篇文章(这里[这里](/optimal-control-a-preamble-6c0bc2b12ed6)和那里[那里](/insights-on-the-calculus-of-variations-f50825f0ca84)，您将会理解最优控制问题的公式化，以及如何在简单的情况下解决这些问题(使用一阶约束的变分法)。

现在，这一切都很好，但我们想知道更复杂的问题实际上是如何解决的。现实生活中的大多数约束都不够好，不足以让我们使用我们友好的变分法理论。

为了说明用于解决更复杂的最优控制问题的不同方法，我们将集中于机器人的例子，特别是机器人手臂的最优路径参数化。

使用机械臂通常意味着一天内重复执行数万次相同的动作。假设取出一个零件并将其插入到一个精确的位置。减少机器人从这两个位置移动所需的时间，即使是几分之一秒，也可以提高制造过程速度、分类速度或任何其他机器人任务的速度。出于这个原因，科学家们对这个话题产生了兴趣，并试图将最优控制理论应用于机器人手臂的运动。

注意:最佳的机器人动作对打乒乓球也很重要。

![](img/122fa2686215574cfb58e41b5920b890.png)

来源:决斗:提莫·波尔 vs 库卡机器人[https://www.youtube.com/watch?v=J3gvpaNFvZU](https://www.youtube.com/watch?v=J3gvpaNFvZU)

## 机械臂的运动规划管道

对于机器人手臂的复习，手臂可以用一个运动链来表示。

![](img/f916aee50c7c5a34b1fc9ca4a9482cad.png)

作者图片

机器人的每个关节通常以一个自由度连接两个连杆。一系列关节和链节形成了一个运动链。
链条末端的位置，即其顶端，由手臂的配置决定，换句话说，由每个关节的值决定(该值对应于与初始位置相比关节旋转或平移的程度)。当我们控制机器人时，我们分别控制机器人的每个关节，因为每个关节都有自己的马达。
对于机械臂，我们感兴趣的配置空间因此是所谓的关节空间，表示基于其关节值的机器人的所有可能配置。比如上图，机器人的构型可以用向量[关节 1，关节 2，关节 3，关节 4]来写。

现在，我们实际上如何计划让机械臂移动呢？要将手臂从配置 A 移动到配置 B，我们需要确定两件事:

*   中间配置的顺序
*   控制序列，能够从一个中间配置转换到另一个中间配置。

正如我们所看到的，第一个问题属于几何分析的范畴，而第二个问题与机器人的动力学有关。通常的方法是将问题分成两部分，首先找到一条**路径**，一系列在期望点开始和结束的有效机器人配置，然后采用这条路径，并根据速度和加速度确定输入到每个关节的控制，以便从路径的一个航点移动到另一个航点。这受到约束，因为关节马达具有速度约束和扭矩约束的实际限制(马达能够容纳多少有效载荷)。我们通常将这两个问题称为**路径规划**和**轨迹生成或路径参数化。**

为了举一个更容易理解的例子，你可以想象你是一个过山车设计师。你想计划一个新的旅程，从一个地方开始，到另一个地方结束，但是你确实有局限性，火车不能走得太快，因为车轮的限制，手推车不能经历快速加速或减速，因为有脱轨的风险。为了使问题变得简单，你首先画出一个几何路径，说明游乐设备将会是什么样子(路径规划)，然后尝试确定如何控制火车的马达，以便在任何地方都不会超过速度和加速度限制。通过这样做，您可以将几何路径转换为轨迹，并且能够在路径的每个点上关联所需的列车电机控制。

工业机器人最常见的路径规划工具是快速生长树 RRT，其功能是对任意点进行采样，确定它们是否是机器人的有效配置，然后尝试将它们链接在一起形成路径。下图是点被采样并连接在一起的动画。

![](img/1193a2fea68316968907c56d8ef2b2df.png)

来源[http://msl.cs.uiuc.edu](http://msl.cs.uiuc.edu/)RRT 的建设

本文将重点讨论机械臂的轨迹生成。

## 机械臂的轨迹生成

轨迹生成问题显然是一个控制问题，因为给定一条路径，我们必须确定手臂的控制序列，然而，这还不是一个最优控制问题。
给定一条路径，你可以找到无数种方法来移动手臂通过不同的路径点。你可以决定非常缓慢或非常快速地移动手臂，这两种方式都可以解决轨迹规划问题。然而，大多数时候我们关心的是尽快到达目的地。寻找一组控制以最小化某个成本函数？这看起来确实像一个最优控制问题。

让我们试着把这个问题公式化。

我们可以通过机器人每个关节的状态来表示机器人的每个配置，我们在这里称之为 **q** ，这是一个 n 维向量，n 是运动链的关节数量。
对于我们的参数化问题，我们知道已经设置了一条路径，我们可以用函数 **f(s)** 对这条路径建模。这里，s 是一个任意值，它使我们能够遍历路径。当 s = 0 时，我们在路径的起点，当 s = 1 时，我们在路径的终点。对于每个 s，函数 f 返回机器人的相应配置。

![](img/3e303d8ad42c28de30ce363bfac4c7a5.png)

当我们考虑使用 N 个关节的机器人配置时，为什么我们可以使用一维变量来表述问题？您会注意到，由于我们希望机器人的末端属于几何路径，选择一个关节的值会强制其他关节的值也是已知的。因此，这个问题可以简化为一维问题。
请注意，在此阶段，配方不依赖于时间。参数化的时候，我们要实现的是归纳出时序的概念。换句话说，我们想知道，在什么时候我们将到达路径描述的每个配置。

对于机器人的三个连续配置，如果我们知道我们需要达到它们的时间，那么我们可以推导出每个关节在两个分段上应该具有的速度，从而得出每个关节的加速度。
换句话说，我们的控制问题，在路径的每一点寻找电机的控制，等同于寻找路径执行的时机。

![](img/27df840ad866e948d07dc7c351547ee4.png)

《每日电讯报》对 https://giphy.com/gifs/telegraph-10Z3sr3ClZzUJy 的动画报道

重新表述这个问题:给定 f(s)，我们想找到 q'(t)，q''(t)，通过这样做找到 q(t)，从而找到 f(s(t))。我们在这里增加两个条件，分别是 q'(0) = 0 和 q'(T) = 0，T 是问题的最终时刻。

现在我们最优性的条件是找到控制(关节速度和关节加速度),使得我们尽可能快地达到 s(T) = 1:

![](img/98ca2855a370f03665cef9ef5fb8e39b.png)

我们在这里试图找到 T 的最小值，即到达路径终点的时间，在允许的控制集合中。请注意，通过改变变量，我们可以使用路径变量 s 来重新表述该问题。由于该方程涉及其对时间的导数，我们知道仍然涉及时间。然而，这种形式符合我们在以前的文章中看到的一般最优控制问题的表述。

这里的关键是容许控制的概念。我们可以变得疯狂，不断地给每个关节输入最大加速度。然而，我们可以看到，条件 q'(T) = 0(手臂停在终点)迫使考虑减速阶段。
不仅如此，我们还看到了马达在速度和扭矩方面的物理限制。我们还可以根据自己的喜好设置一些其他约束。例如，也可以设置加加速度约束(q ' '(t))来减少输出轨迹的加加速度。

既然我们用路径变量 s 重新表述了问题，这意味着我们也需要用路径变量 s 来表述约束。

机械臂的二阶约束可以表示为以下形式

![](img/35928d7609c6a0042b8b474a5d912a3c.png)

其中 n 是联合向量 q 的维数，C 是凸多面体。如果你从来没有亲眼见过多面体，要知道对于 n 维的情况，它只是构成多边形的 1d 线和构成多面体的 2d 面的一般等价。因此，我们的约束具有边界面的表达式，因为它是凸多面体。

但是，在 n 维中工作不是很方便。不管用什么方法解决问题，我们工作的维度越低越好。请记住，我们将最小化目标表示为参数路径 s 的函数。我们知道，我们可以将机器人遵循的路径表示为 **q(s)** 。通过使用链式法则，我们可以得到:

![](img/606088e897f6bc59f5e194dbe7aa786e.png)

现在，这允许我们只转换 s 的函数中的任何二阶约束:

![](img/b4d7c10854673265b3fdd1e881dea57f.png)

文献称之为将约束投射到路径上。可能奇怪的是，关节空间中的约束(例如速度限制或加速度限制)取决于机器人的配置，被减少到这个一维。这是因为我们已经知道了路径，所以我们对机器人可能具有的所有不同配置的完整约束集不感兴趣，而只是一个子集，即它在所考虑的路径上实际采用的子集。

我们优化问题现在可以表述如下:

![](img/992c5571234d60bb795197b2912cf9ea.png)

对于这个公式，我们需要在路径的起点和终点添加一些初始和最终的约束，为了简洁起见，这里省略了这些约束。这看起来很像最优控制问题的一般公式，带有二阶约束。

既然问题已经被正确地表述了，我们可以研究解决这个问题的不同方法，以及这如何导致现实世界的机器人解决方案。

我们离开了对变分法的研究，带着对解决更复杂问题的一些见解，提到了庞特里亚金先生。

他对最优控制理论的贡献提供了一个定理，该定理可被认为是欧拉-拉格朗日方程的扩展，但适用于二阶约束情况。如果我们只关注时间最优控制情况，问题可以写成一般形式:

![](img/ef188003f8682ab2133bce8c93c4c9ee.png)

其中 x 是状态变量，u 代表系统的控制。很容易看出，如果我们选择以下公式，则之前为机器人的路径参数化找到的公式与该公式相关:

![](img/0e6bd7e3731813efe1919d7a08787b18.png)

庞特里亚金从哈密顿量的概念中推导出他的结果。哈密尔顿函数是另一个类似于拉普拉斯的抽象函数，实际上是基于它的。例如，我们可以用哈密顿量导出运动方程，从而导出哈密顿力学。应用于时间最优控制的具体问题:

![](img/b79b6d80768b94c5d99aa73aab119aac.png)

等式(1)是基于拉格朗日 l 的哈密尔顿函数的定义。在这种情况下哈密尔顿函数是优选的原因是它提供了一些很好的数学特性，使得庞特里亚金可以推导出等式(2)。这个等式的好处是它对任何时间 t 都成立。等式(2)的问题是，对于每个时间 t，H 可以是最大值或最小值，或者根本不存在。所以这个条件还是没给台面带来多少东西。然而，庞特里亚金证明**有必要最大化**。

因此从我们的时间最优问题公式化开始，我们可以首先表达拉格朗日(以及考虑到约束的增广拉格朗日)，并且从那里使用等式(1)得到哈密顿量(分别为增广哈密顿量):

![](img/f35a6cb9075bc66cb4d6cc91161e8bd5.png)

等式(4)是等式(2)的重新表述，增加了 H 只能是最大值的知识。*符号代表最佳。然后我们用等价的哈密顿量来代替它。

给定控制 u 总是被一些可能的区间所有界(因为我们处理的是物理系统)，假设区间[u-，u+]，那么给定(lambda * B 的转置)的符号，我们可以说为了最优，我们的控制只能取两个可能的值:u-或 u+。

所以庞特里亚金证明的是，对于时间最优控制问题，最优控制是在每个时间 t 都处于其容许边界的极限的控制集合。要么在一边，要么在另一边。这种控制系统的方式被称为 Bang-Bang 控制，因为我们从一个极端控制切换到另一个极端控制。

对于一个非常复杂的演示来说，这实际上是一个非常简单的结果。举例来说，这让我们知道如果我们想赢得一场赛车比赛，如何踩油门。

![](img/add44208bc54d4c9a1e211b95a67f643.png)

克里斯·赫恩在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

让我们稍微修改一下规则，假设赛车驾驶员也需要在终点线以零速度停车。根据 bang-bang 控制原理，我们应该尽可能加速(完全踩下油门踏板)，然后达到我们的控制不再受加速度限制而是受最大速度限制的状态，在特定点，完全松开油门踏板并完全踩下刹车踏板(假设汽车不打滑)。

## 机械臂的开关控制

现在让我们回头看看我们的机械臂问题。我们证明了路径参数化问题的确是一个时间最优控制问题。现在，bang-bang 控制对机械臂意味着什么？我们知道，我们的控制是由一个向量[ṡ，ṡ'].
由于路径参数的导数与关节的速度和加速度相关，控制限制也与速度和加速度限制直接相关。

当我们运行最佳轨迹时，这转化为这样一个事实，即在每个时间点，至少关节电机达到其最大速度，或者其扭矩由于加速或减速而饱和。

现在人们可能会感到困惑，难道我们不是在试图找到每一个关节的控制吗？我们不可能同时加速和减速所有的关节。
这样想:
假设在给定的时间 t，我们决定完全加速一个关节。这意味着在时间δt 后，我们知道这个关节移动了多少。但是道路已经决定了。这相当于说，我们可以推导出在时间δt 期间，其他关节需要移动多少才能仍然属于该路径。

因此，庞特里亚金定理让我们知道，在轨迹的每一点，我们需要饱和一个关节，并在特定的切换点，在加速阶段和减速阶段之间交替。现在的问题是，我们如何找到所有这些开关点？关于机械臂控制的文献提出了不同的策略，以利用庞特里亚金的结果，并找到机器人在给定几何路径下移动的最快方式。请参阅本文的第 2 部分，了解可用于解决工业机械臂最优控制问题的不同技术的概述。

来源:

布拉格 CTU 的最优和鲁棒控制。所有的讲座都可以在 Youtube 上看到(频道“aa4cc”)。

机器人的实用时间最优轨迹规划:凸优化方法，Diederik Verscheure，Bram Demeulenaere，Jan Swevers，Joris De Schutter 和 Moritz Diehl。

基于可达性分析的时间最优路径参数化新方法。