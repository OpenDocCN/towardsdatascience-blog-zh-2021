# å¦‚ä½•ç”¨ Fastai åˆ¶ä½œä¸€ä¸ªè‰ºæœ¯æ¨¡å‹

> åŸæ–‡ï¼š<https://towardsdatascience.com/how-to-make-a-state-of-the-art-model-with-fastai-bd11e168b214?source=collection_archive---------39----------------------->

## ä½¿ç”¨å­¦ä¹ ç‡æŸ¥æ‰¾å™¨å’Œæ¸è¿›è°ƒæ•´å¤§å°æ–¹æ³•è¿›è¡Œå›¾åƒåˆ†ç±»ï¼Œä»¥ä¾¿åœ¨çŸ­æ—¶é—´å†…è·å¾—æœ€ä½³ç»“æœã€‚

![](img/fb960d44e47202846495a86434c37942.png)

Amy Hirschi åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šçš„ç…§ç‰‡

å½“æˆ‘ç¬¬ä¸€æ¬¡å¼€å§‹ fastai çš„æ—…ç¨‹æ—¶ï¼Œæˆ‘éå¸¸å…´å¥‹åœ°å»ºç«‹å’Œè®­ç»ƒä¸€ä¸ªæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œå®ƒå¯ä»¥åœ¨çŸ­æ—¶é—´å†…ç»™å‡ºæƒŠäººçš„ç»“æœã€‚æ—¢ç„¶æˆ‘ä»¬å·²ç»çœ‹åˆ°äº† fastai ä¸ä¸€äº› Pytorch åŸºæœ¬å‡½æ•°ä¸€èµ·ä½¿ç”¨çš„ä¸€äº›å¹•ååŸ¹è®­æœ¯è¯­ï¼Œç°åœ¨æ˜¯æ—¶å€™çœ‹çœ‹åœ¨æ„å»ºæ¨¡å‹æ–¹é¢å¤šåšä¸€ç‚¹åŠªåŠ›ä¼šäº§ç”Ÿä»€ä¹ˆç»“æœäº†ã€‚

> åœ¨è¿™ç¯‡æ–‡ç« çš„æœ€åï¼Œæˆ‘å°†é“¾æ¥æˆ‘ä»¥å‰çš„æ–‡ç« ï¼Œåœ¨è¿™äº›æ–‡ç« ä¸­ï¼Œæˆ‘è®°å½•äº†æˆ‘å¯¹ fastai çš„å­¦ä¹ ã€‚:)

## è·å–æ•°æ®

æˆ‘ä»¬éœ€è¦è¿™äº›æ•°æ®æ¥å¼€å§‹ã€‚å®ƒæ¥è‡ª Kaggle çš„çŸ³å¤´å‰ªå­å¸ƒæ•°æ®é›†ã€‚è¿™ä¸ªä»»åŠ¡å˜æˆäº†ä¸€ä¸ªå¤šç±»å›¾åƒåˆ†ç±»é—®é¢˜ï¼Œæœ‰ä¸‰ä¸ªç±»(æ¯ä¸ªç±»æœ‰è®­ç»ƒã€æœ‰æ•ˆã€æµ‹è¯•æ–‡ä»¶å¤¹)åŒ…å«å¤§å°ä¸º 300x300 çš„ RGB å½©è‰²å›¾åƒã€‚

ä¸º fastai vision çš„æ‰€æœ‰å†…å®¹æŒ‡å®šå¯¼å…¥å‡½æ•°ï¼Œå¹¶è®¾ç½® path å˜é‡ã€‚

```
**from** **fastai.vision.all** **import** ***path = Path('/storage/RockPaperScissors/RockPaperScissors/data/')
path.ls()**Output:
(#4) [Path('/storage/RockPaperScissors/RockPaperScissors/data/test2'),Path('/storage/RockPaperScissors/RockPaperScissors/data/valid'),Path('/storage/RockPaperScissors/RockPaperScissors/data/.DS_Store'),Path('/storage/RockPaperScissors/RockPaperScissors/data/train')]# make sure to set that path to wherever you've kept your data either locally or online.
```

ç°åœ¨æˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ªæ•°æ®å—æ¥ä»æ–‡ä»¶å¤¹ä¸­è·å–æ•°æ®ã€‚æˆ‘ä»¬æŒ‡å®šè¿™äº›æ¥ç¡®ä¿æˆ‘ä»¬çš„æ•°æ®åœ¨ç¼–å†™æœ€å°‘çš„ä»£ç æ—¶å¯¹æ¨¡å‹å¯ç”¨:

1.  å¦‚ä½•ç”¨ ***get_image_files*** å‡½æ•°è·å–å›¾åƒæ–‡ä»¶â€”â€”è¿™åªæ˜¯æ”¶é›†æˆ‘ä»¬çš„ç«è½¦å’Œæœ‰æ•ˆæ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰å›¾åƒæ–‡ä»¶
2.  è·å¾—å¸¦æœ‰ ***parent_label*** çš„ç±»ï¼Œè¿™ç¡®ä¿æˆ‘ä»¬è·å¾—ç›´æ¥çš„çˆ¶æ–‡ä»¶å¤¹åä½œä¸ºæˆ‘ä»¬çš„ç±»åï¼Œæœ€åï¼Œ
3.  ä½¿ç”¨***grand parent splitter***è¿›è¡Œè®­ç»ƒå’ŒéªŒè¯æ‹†åˆ†ï¼Œè¿™å°†ä¸ºæˆ‘ä»¬æä¾›å•ç‹¬çš„æ•°æ®é›†ï¼Œç”¨äºä½¿ç”¨æ–‡ä»¶å¤¹è¿›è¡Œè®­ç»ƒå’ŒéªŒè¯ï¼Œè¿™äº›æ–‡ä»¶å¤¹åœ¨å±‚æ¬¡ç»“æ„ä¸­å¤„äºä¸Šä¸€çº§ï¼Œæˆ–è€…è®­ç»ƒå’Œæœ‰æ•ˆæ–‡ä»¶å¤¹ã€‚

```
**def** get_dls(bs, size):
    dblock = DataBlock(blocks = (ImageBlock, CategoryBlock),
                       get_items = get_image_files,
                       get_y = parent_label,
                       splitter = GrandparentSplitter(),
                       item_tfms = Resize(size)
                      )
    **return** dblock.dataloaders(path, bs = bs)
```

è¿™å°†è¿”å›ä¸€ä¸ªæ•°æ®åŠ è½½å™¨ï¼Œå®ƒå°†ç»™å‡ºä¸€ä¸ªæ‰¹é‡å¤§å°ä¸º ***bs*** å’Œä¸€ä¸ªå›¾åƒå¤§å°ä¸º ***å¤§å°ä¸º*** çš„å›¾åƒã€‚

## ä»€ä¹ˆæ˜¯æ¸è¿›å¼è°ƒæ•´å¤§å°ï¼Œæˆ‘ä»¬å¦‚ä½•åº”ç”¨å®ƒï¼Ÿ

> æ­£å¦‚æ°ç‘ç±³Â·éœåå¾·åœ¨ä»–çš„ä¹¦ä¸­æ‰€è¯´çš„é‚£æ ·:ç”¨å°å›¾ç‰‡å¼€å§‹è®­ç»ƒï¼Œç”¨å¤§å›¾ç‰‡ç»“æŸè®­ç»ƒã€‚ä½¿ç”¨å°å›¾åƒè¿›è¡Œå¤§éƒ¨åˆ† epochs è®­ç»ƒæœ‰åŠ©äºè®­ç»ƒæ›´å¿«å®Œæˆã€‚ä½¿ç”¨å¤§å›¾åƒå®Œæˆè®­ç»ƒä½¿å¾—æœ€ç»ˆçš„å‡†ç¡®åº¦é«˜å¾—å¤šã€‚

è¿™æ˜¯ä¸€ç§å®éªŒæ€§çš„æŠ€æœ¯ï¼Œå·²ç»è¢«è¯æ˜æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œåœ¨è·å¾—æ›´é«˜çš„ç²¾ç¡®åº¦æ–¹é¢ï¼Œæ¯”åœ¨ä½¿ç”¨ç›¸åŒå¤§å°çš„å›¾åƒæ—¶è¦æœ‰ç”¨å¾—å¤šã€‚

ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹æ€æ ·æ‰èƒ½è®­ç»ƒå‡ºå¤šç§å°ºå¯¸ï¼Œå¥½å—ï¼Ÿ

æˆ‘ä»¬å°†å¾—åˆ°çš„æ‰¹é‡å¤§å°ä¸º 64ï¼Œå›¾åƒå¤§å°ä¸ºæ›´å°çš„ 128x128ã€‚

```
dls = get_dls(64, 128)
```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥è®¡ç®—ä¸€ä¸‹è¿™éƒ¨åˆ†åŸ¹è®­åº”è¯¥ä½¿ç”¨ä»€ä¹ˆæ ·çš„å­¦ä¹ ç‡ã€‚

## æ‰¾åˆ°åˆé€‚çš„å­¦ä¹ é€Ÿåº¦

é¦–å…ˆï¼Œæˆ‘ä»¬åˆ©ç”¨è¿ç§»å­¦ä¹ å»ºç«‹ä¸€ä¸ªæ¨¡å‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚

```
learn = cnn_learner(dls, resnet34, metrics=accuracy)
```

ç„¶åï¼Œæˆ‘ä»¬ç»˜åˆ¶ä¸€ä¸ªå›¾è¡¨ï¼Œçœ‹çœ‹å¦‚ä½•æ‰¾åˆ°å­¦ä¹ ç‡ã€‚

```
learn.lr_find()
```

è¾“å‡ºçœ‹èµ·æ¥åƒè¿™æ ·ï¼Œå¦‚æœæˆ‘ä»¬å–å­¦ä¹ ç‡çš„ä¸€ä¸ªç‰¹å®šå€¼ï¼Œæˆ‘ä»¬çš„æŸå¤±çœ‹èµ·æ¥ä¼šæ˜¯ä»€ä¹ˆæ ·å­ã€‚

![](img/67b68b5d75d11938413fdf9eacc76bfb.png)

å­¦ä¹ ç‡å›¾

çœ‹èµ·æ¥é‡‡ç”¨ 1e-3 å·¦å³çš„å­¦ä¹ ç‡å°†è¶³ä»¥ç¡®ä¿æˆ‘ä»¬çš„æŸå¤±éšç€è®­ç»ƒè€Œå‡å°‘ã€‚æˆ‘ä»¬ä¼šé€‰æ‹©é‚£ä¸ªã€‚

```
learn = cnn_learner(dls, resnet34, metrics=accuracy)
learn.fit_one_cycle(10, 1e-3)
```

æˆ‘ä»¬åœ¨æœ€åˆçš„å‡ ä¸ªæ—¶ä»£é‡Œçœ‹åˆ°äº†ç›¸å½“æ˜¾è‘—çš„ç»“æœã€‚

![](img/e685a58e1abc4e1634fa5bbcca8de727.png)

å­¦ä¹ ç¬¬ 1 éƒ¨åˆ†

> æ³¨æ„:æˆ‘åœ¨ GPU ä¸Šè®­ç»ƒè¿™ä¸ªæ¨¡å‹ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ¯ä¸ªå†å…ƒåªéœ€è¦å‡ ç§’é’Ÿã€‚
> 
> å¦‚æœä½ åªåœ¨ CPU ä¸Šè®­ç»ƒï¼Œè¿™å°†èŠ±è´¹æ›´é•¿çš„æ—¶é—´ï¼Œæœ‰æ—¶ç”šè‡³å¤§çº¦ 10 åˆ†é’Ÿã€‚

æ—¢ç„¶æˆ‘ä»¬å·²ç»åœ¨è¾ƒå°çš„å›¾åƒå°ºå¯¸ä¸Šè®­ç»ƒäº†æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œè®­ç»ƒçš„ç¬¬äºŒéƒ¨åˆ†ã€‚

æˆ‘ä»¬ä½¿ç”¨æ‰¹é‡å¤§å°ä¸º 128ï¼Œå›¾åƒå¤§å°ä¸º 224ï¼Œç”¨äºæ¨¡å‹çš„ä¸‹ä¸€æ¬¡å¾®è°ƒã€‚

```
learn.dls = get_dls(128, 224)
learn.fine_tune(5, 1e-3)
```

![](img/c884c317a08acb3ad0196af3f661600f.png)

å­¦ä¹ ç¬¬ 2 éƒ¨åˆ†

æ­£å¦‚æ‚¨å¯ä»¥æ¨æ–­çš„é‚£æ ·ï¼Œè¿™ä¸ºæˆ‘ä»¬çš„è®­ç»ƒå¸¦æ¥äº†å‡ ä¹ 95%çš„å‡†ç¡®ç‡ï¼Œå¹¶ä¸”åœ¨ GPU ä¸Šè®­ç»ƒåªéœ€è¦å¤§çº¦ä¸‰åˆ†é’Ÿï¼

## ç»“æŸâ€¦

Fastai ä½¿æˆ‘ä»¬èƒ½å¤Ÿå¿«é€Ÿå¼€å‘ä»»ä½•æ·±åº¦å­¦ä¹ ä»»åŠ¡ï¼Œæ­£å¦‚æˆ‘åœ¨å‰å‡ å‘¨å¯¹å®ƒè¿›è¡Œçš„å®éªŒä¸€æ ·ï¼Œæˆ‘å‘ç°è‡ªå·±è¶Šæ¥è¶Šå–œæ¬¢å®ƒè¶…çº§ç®€å•çš„æ–¹æ³•ã€‚å¦‚æœæ‚¨çƒ­è¡·äºè·Ÿéšæˆ‘çš„æ—…ç¨‹ï¼Œè¯·ç¡®ä¿å…³æ³¨æˆ‘çš„æŒç»­æ›´æ–°ï¼Œå› ä¸ºæˆ‘å°†ä½¿ç”¨è¿™ä¸ªç¥å¥‡çš„åº“æ¢ç´¢æ›´å¤šçš„æ·±åº¦å­¦ä¹ ä»»åŠ¡ã€‚

æ­£å¦‚æˆ‘ä¹‹å‰æ‰¿è¯ºçš„ï¼Œè¿™é‡Œæ˜¯æˆ‘ä¸º fastai å†™çš„å…¶ä»–æ–‡ç« ã€‚ç¼–ç å¿«ä¹ï¼ğŸ˜

1.  fastai å¿«é€Ÿå…¥é—¨:[FastAI å¿«é€Ÿå…¥é—¨â€”â€”æˆ‘çš„ç»å†](/a-fast-introduction-to-fastai-my-experience-b18d4457f6a5)
2.  åƒç´ ç›¸ä¼¼æ€§æ–¹æ³•â€”å¼•æ“ç›–ä¸‹ç¬¬ 1 éƒ¨åˆ†: [Fastai â€”æ¢ç´¢è®­ç»ƒè¿‡ç¨‹â€”åƒç´ ç›¸ä¼¼æ€§æ–¹æ³•](/fastai-exploring-the-training-process-the-pixel-similarity-approach-74bbdb844509)
3.  éšæœºæ¢¯åº¦ä¸‹é™å’Œä»é›¶å¼€å§‹è®­ç»ƒâ€”å¼•æ“ç›–ä¸‹ç¬¬ 2 éƒ¨åˆ†: [Fastai â€”ä»é›¶å¼€å§‹éšæœºæ¢¯åº¦ä¸‹é™çš„å¤šç±»åˆ†ç±»](/fastai-multi-class-classification-with-stochastic-gradient-descent-from-scratch-8410fe3fea22)

æ­¤å¤–ï¼Œè¿™é‡Œæ˜¯ GitHub repo é“¾æ¥ï¼ŒåŒ…å«æ‰€æœ‰ä»£ç :

[](https://github.com/yashprakash13/RockPaperScissorsFastAI) [## yashprakash 13/rock paper scissors fastai

### åœ¨ GitHub ä¸Šåˆ›å»ºä¸€ä¸ªå¸æˆ·ï¼Œä¸º yashprakash 13/rockppapersscissorsfastai çš„å¼€å‘åšå‡ºè´¡çŒ®ã€‚

github.com](https://github.com/yashprakash13/RockPaperScissorsFastAI) 

> ä½ æƒ³æ¯å‘¨æˆ–ä¸¤å‘¨æ”¶åˆ°ä¸€å°å…è´¹çš„ã€å¹²å‡€çš„ç”µå­é‚®ä»¶ï¼Œé‡Œé¢åŒ…å«æˆ‘å‘è¡¨çš„æœ€å¥½çš„ç­–åˆ’æ–‡ç« å’Œæ•™ç¨‹å—ï¼ŸåŠ å…¥æˆ‘çš„ä»£ç å¹¿æ’­å§ï¼

åœ¨[æ¨ç‰¹](https://twitter.com/csandyash)å’Œ [LinkedIn](https://www.linkedin.com/in/yashprakash13/) ä¸Šå’Œæˆ‘è”ç³»ï¼