# ä½¿ç”¨ Docker éƒ¨ç½² ML æ¨¡å‹çš„å¥½æ–¹æ³•

> åŸæ–‡ï¼š<https://towardsdatascience.com/the-nice-way-to-deploy-an-ml-model-using-docker-91995f072fe8?source=collection_archive---------3----------------------->

## ä½¿ç”¨ FastAPI éƒ¨ç½² ML æ¨¡å‹å¹¶åœ¨ VSCode ä¸­è½»æ¾å°è£…å®ƒçš„å¿«é€ŸæŒ‡å—ã€‚

![](img/3c5d174c93857df6655befc7deacfade.png)

åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šç”± [Toa Heftiba](https://unsplash.com/@heftiba?utm_source=medium&utm_medium=referral) æ‹æ‘„çš„ç…§ç‰‡

å½“ç”±å›¢é˜Ÿä¸­çš„ä¸åŒå¼€å‘äººå‘˜æ„å»ºå’Œè¿è¡Œ ML é¡¹ç›®æ—¶ï¼Œå­˜åœ¨ä¸ ML é¡¹ç›®ç›¸å…³çš„æŒ‘æˆ˜ã€‚æœ‰æ—¶ï¼Œä¾èµ–é¡¹å¯èƒ½ä¼šä¸åŒ¹é…ï¼Œç»™åŒä¸€ä¸ªé¡¹ç›®ä¸­çš„å…¶ä»–ä¾èµ–åº“å¸¦æ¥éº»çƒ¦ã€‚æ­¤å¤–ï¼Œå¦‚æœä½ æä¾›ä¸€ä¸ªå¿…é¡»ä»¥ç‰¹å®šæ–¹å¼æ‰§è¡Œçš„é¡¹ç›®ï¼Œä½ è¿˜éœ€è¦æœ‰ä¸€ä¸ªæ¸…æ™°çš„æ¯ä¸€æ­¥çš„æ–‡æ¡£ã€‚

é€šè¿‡ä½¿ç”¨ Dockerï¼Œæ‰€æœ‰è¿™äº›éƒ½å¯ä»¥å˜å¾—æ›´åŠ å®¹æ˜“å’Œå¿«æ·ã€‚æœ‰äº†å®¹å™¨åŒ–ï¼Œä½ å¯ä»¥èŠ‚çœå¾ˆå¤šæ—¶é—´ï¼Œ*å’Œ*æœ‰åŠ©äºä»é•¿è¿œæ¥çœ‹å¹³æ»‘ä½ çš„åº”ç”¨ç¨‹åºçš„éƒ¨ç½²è¿‡ç¨‹ã€‚

> å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾ä¸€ä¸ªåŒ…å«ä¸ºæ‚¨çš„é¡¹ç›®æ‰‹åŠ¨æ„å»ºå’Œè¿è¡Œ docker æ˜ åƒçš„å®Œæ•´æ­¥éª¤çš„æŒ‡å—ï¼Œæ‚¨å¯ä»¥åœ¨æœ¬æ–‡ä¸­æ‰¾åˆ°å®ƒ:

[](https://pub.towardsai.net/how-to-dockerize-your-data-science-project-a-quick-guide-b6fa2d6a8ba1) [## å¦‚ä½•å¯¹æ‚¨çš„æ•°æ®ç§‘å­¦é¡¹ç›®è¿›è¡Œåˆ†ç±»â€”â€”å¿«é€ŸæŒ‡å—

### æˆ‘æ˜¯å¦‚ä½•ä¸€ç›´ç”¨è¿™äº›ç®€å•æ˜“è¡Œçš„æ­¥éª¤åšåˆ°çš„ï¼

pub.towardsai.net](https://pub.towardsai.net/how-to-dockerize-your-data-science-project-a-quick-guide-b6fa2d6a8ba1) 

ç„¶è€Œï¼Œåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘å°†ä»‹ç»ä¸€ä¸ªæ›´ç®€å•çš„è¿‡ç¨‹æ¥ç®€åŒ– Docker å¼€å‘ï¼Œè¿™ä¸ªè¿‡ç¨‹å®Œå…¨å¯ä»¥åœ¨ VSCode æœ¬èº«çš„å¸®åŠ©ä¸‹å®Œæˆã€‚

è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æ„å»ºæ¨¡å‹çš„æ¯ä¸€æ­¥ï¼Œç„¶åæ˜¯ APIï¼Œæœ€åæ˜¯ dockerizingã€‚ğŸ‘‡

# æ„å»ºæˆ‘ä»¬çš„ ML æ¨¡å‹

æˆ‘ä»¬å°†ä½¿ç”¨ Spacy æ¥æ„å»ºä¸€ä¸ªç®€å•çš„æƒ…æ„Ÿåˆ†ç±»å™¨ï¼Œå®ƒä¸ºä¼ é€’ç»™å®ƒçš„ä»»ä½•ä¸€æ®µæ–‡æœ¬è¾“å‡ºä¸¤ä¸ªç»“æœ:

**ææ€§** â€”å®ƒæ˜¯ä¸€ä¸ªä½äº[-1ï¼Œ1]èŒƒå›´å†…çš„æµ®ç‚¹æ•°ï¼Œå…¶ä¸­ 1 è¡¨ç¤ºå®Œå…¨è‚¯å®šçš„é™ˆè¿°ï¼Œè€Œ-1 è¡¨ç¤ºå®Œå…¨å¦å®šçš„é™ˆè¿°ã€‚

**ä¸»è§‚æ€§**â€”*ä¸»è§‚*å¥ä¸€èˆ¬æŒ‡ä¸ªäººè§‚ç‚¹ã€æƒ…æ„Ÿæˆ–åˆ¤æ–­ï¼Œè€Œ*å®¢è§‚*åˆ™æŒ‡äº‹å®ä¿¡æ¯ã€‚å®ƒæ˜¯ä¸€ä¸ªä½äº[0ï¼Œ1]èŒƒå›´å†…çš„æµ®ç‚¹æ•°ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬å®‰è£…ä¸€äº›åŒ…æ¥å¼€å§‹æˆ‘ä»¬çš„å¼€å‘:

```
pipenv shell # make a new virtual environmentpipenv install pydantic fastapi uvicorn spacy spacytextblob # the packages to install
```

ç°åœ¨ï¼Œå°† **cd** æ”¾åˆ°é¡¹ç›®ä¸­ï¼Œå¹¶åˆ¶ä½œä¸€ä¸ªåä¸ºâ€œmodel.pyâ€çš„æ–°æ–‡ä»¶ã€‚

è®©æˆ‘ä»¬å¡«å†™è¯¥æ–‡ä»¶çš„ä»£ç :

```
import spacyfrom spacytextblob.spacytextblob import SpacyTextBlobfrom pydantic import BaseModel class SentimentQueryModel(BaseModel): 
    text : strclass SentimentModel:
    def get_sentiment(self, text): nlp = spacy.load('en_core_web_sm') nlp.add_pipe("spacytextblob") doc = nlp(text) polarity = doc._.polarity subjectivity = doc._.subjectivity return polarity, subjectivity
```

æˆ‘ä»¬ä½¿ç”¨**sentitenquerymodel**æ¥åŒ…å«æˆ‘ä»¬å¯¹è¿™ä¸ªæ¨¡å‹çš„å”¯ä¸€æŸ¥è¯¢â€”â€”æˆ‘ä»¬å°†ä¸ºå…¶é¢„æµ‹æƒ…æ„Ÿçš„æ–‡æœ¬ï¼Œä»¥åŠ**sentitenmodel**ä½œä¸ºåŠ è½½ spacy tokeniser å’Œ spacytextblob åº“å¹¶ä¸ºæˆ‘ä»¬çš„ç»™å®šæ–‡æœ¬æ‰§è¡Œæƒ…æ„Ÿé¢„æµ‹çš„ç±»ã€‚

æˆ‘ä»¬ç°åœ¨å°†è¿›å…¥ä¸‹ä¸€æ­¥ï¼Œæ„å»ºæˆ‘ä»¬çš„ APIã€‚

# åˆ¶ä½œ API

FastAPI æ˜¯ä¸€ç§æ›´æ–°ã€æ›´å¥½çš„æ–¹æ³•ï¼Œå¯ä»¥å°†æ‚¨çš„æœºå™¨å­¦ä¹ æ¨¡å‹éƒ¨ç½²ä¸º REST APIï¼Œä»¥ä¾¿åœ¨æ‚¨çš„ web åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ã€‚

è®©æˆ‘ä»¬åœ¨ä¸€ä¸ªåä¸ºâ€œmain.pyâ€çš„æ–°æ–‡ä»¶ä¸­ä½¿ç”¨æˆ‘ä»¬çš„â€œmodel.py â€,å¹¶ç”¨å®ƒæ„å»ºä¸€ä¸ª REST API:

```
import uvicornfrom fastapi import FastAPIfrom model import SentimentModel, SentimentQueryModelapp = FastAPI()model = SentimentModel() @app.post('/predict') def predict(data: SentimentQueryModel): data = data.dict() polarity, subjectivity = model.get_sentiment(data['text']) return { 'polarity': polarity, 'subjectivity': subjectivity }if __name__ == '__main__':
    uvicorn.run(app, host='0.0.0.0', port=8000)
```

è¿™ä¸ª API ç°åœ¨å°†åœ¨æœ¬åœ°ä¸»æœºç«¯å£ 8000 ä¸Šè¿è¡Œï¼Œæˆ‘ä»¬å°†é€šè¿‡åœ¨ç»ˆç«¯ä¸­è¿è¡Œæ¥éªŒè¯è¿™ä¸€ç‚¹:

```
python main.py
```

æ‚¨å°†çœ‹åˆ°è¾“å‡º:

![](img/4b48641f2de3b62b92be53f35c1cad2d.png)

æŒ‰ä½œè€…æ’åºçš„å›¾åƒâ€”è¿è¡Œ FastAPI çš„ç»ˆç«¯è¾“å‡º

å¦‚æœæ‚¨å¯¼èˆªåˆ° **localhost:8000/docs** ï¼Œæ‚¨å°†èƒ½å¤Ÿåœ¨æµè§ˆå™¨æœ¬èº«ä¸­æŸ¥çœ‹å’Œæµ‹è¯• APIï¼è¿™ä¸æ˜¯å¾ˆæ£’å—ï¼Ÿ

ä½†æ˜¯ç°åœ¨æˆ‘ä»¬æœ‰äº†æ¨¡å‹å’Œ APIï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥ç»§ç»­ç”¨å®ƒæ¥åˆ¶ä½œ Docker å®¹å™¨äº†ï¼

# ç”¨ç å¤´å·¥äººé›†è£…ç®±åŒ–

ç¡®ä¿æ‚¨çš„ VSCode ä¸­å®‰è£…äº† Docker by Microsoft æ‰©å±•ã€‚æ¥ä¸‹æ¥ï¼Œåœ¨ä½ çš„æœºå™¨ä¸Šå¯åŠ¨ Docker Desktopã€‚

ç°åœ¨ï¼Œè¿›å…¥ VSCodeï¼Œè¾“å…¥:Command + Shift + Pï¼Œè°ƒå‡ºå‘½ä»¤é¢æ¿ã€‚è¾“å…¥â€œæ·»åŠ  Docker æ–‡ä»¶â€,ä½ å°†å¾—åˆ°ä¸€ä¸ªé€‰é¡¹æ¥æ·»åŠ  Docker æ–‡ä»¶åˆ°ä½ çš„é¡¹ç›®ä¸­ã€‚è¿™ä¸€æµç¨‹å¤§å¤§ç®€åŒ–äº†æˆ‘ä»¬çš„æ•´ä¸ªå·¥ä½œæµç¨‹ã€‚

æŒ‰ç…§è¯´æ˜æ“ä½œï¼Œä¿æŒç«¯å£å·ä¸º **8080** ã€‚ä¸è¦å¿˜è®°ç«¯å£ 8000 æ˜¯ç”¨äºæˆ‘ä»¬çš„ API æœ¬èº«ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸åŒçš„ Docker æ¥è¿è¡Œï¼

ç°åœ¨ï¼Œåªéœ€å³é”®å•å‡»ä¾§è¾¹æ ä¸­çš„ Dockerfile å¹¶é€‰æ‹©â€œæ„å»ºå›¾åƒâ€ã€‚

![](img/fa8a26bf04dc708d74e79002c71359d9.png)

æŒ‰ä½œè€…åˆ†ç±»çš„å›¾åƒâ€”â€”æ„å»º docker å›¾åƒ

åœ¨æ„å»ºæ˜ åƒæ—¶ï¼Œæ‚¨å°†å¼€å§‹åœ¨ç»ˆç«¯ä¸­çœ‹åˆ°è¾“å‡ºã€‚

æ¥ä¸‹æ¥ï¼Œæ‚¨å¯ä»¥åˆ‡æ¢åˆ° VSCode ä¾§æ ä¸Šçš„ Docker é€‰é¡¹å¡ã€‚

åœ¨è¿™é‡Œï¼Œæ‚¨å°†çœ‹åˆ°ç³»ç»Ÿä¸­å·²æœ‰çš„å›¾åƒåˆ—è¡¨ã€‚æˆ‘ä»¬åˆšåˆšæ„å»ºçš„æ–°å›¾åƒä¹Ÿå°†åœ¨è¿™é‡Œæ˜¾ç¤ºå¦‚ä¸‹:

![](img/9424c51797d478bd5e57caa9ea804cea.png)

æŒ‰ä½œè€…åˆ†ç±»çš„å›¾åƒâ€”å±•ç¤ºæ„å»ºçš„ docker å›¾åƒ

ç°åœ¨ä½ åªéœ€è¦å³å‡»å›¾åƒåç§°ä¸‹çš„â€œ**æœ€æ–°**ï¼Œé€‰æ‹©**è¿è¡Œ**é€‰é¡¹ã€‚

æ‚¨å¯ä»¥é€šè¿‡å³é”®å•å‡»æ„å»ºçš„å®¹å™¨å¹¶å•å‡»â€œæŸ¥çœ‹æ—¥å¿—â€é€‰é¡¹æ¥æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ã€‚

ç°åœ¨ï¼Œå½“æ‚¨å¯¼èˆªåˆ° **localhost:8000/docs** æ—¶ï¼Œæ‚¨å°†çœ‹åˆ°ä»¥ä¸‹å±å¹•:

![](img/31808ebcbc0edeb6c641e5827f69194c.png)

æŒ‰ä½œè€…æ’åºçš„å›¾ç‰‡â€” API docs +åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œï¼

æ‚¨åªéœ€å•å‡»â€œExecute â€,è¿™å°†äº§ç”Ÿå¦‚ä¸‹è¾“å‡º:

![](img/ba70984c5c98ace3d4097dfee543d096.png)

æŒ‰ä½œè€…åˆ†ç±»çš„å›¾åƒâ€” API è¾“å‡ºå“åº”

# å‡ å¥ä¸´åˆ«èµ è¨€â€¦

æ‰€ä»¥ï¼Œç°åœ¨ä½ æœ‰äº†å®ƒâ€”â€”ä» ML æ¨¡å‹åˆ¶ä½œä¸€ä¸ª API å¹¶ä½¿ç”¨ Docker å°†å…¶å®¹å™¨åŒ–çš„å®Œæ•´ç®¡é“ï¼

æ­£å¦‚æ‚¨ç°åœ¨å¯èƒ½å·²ç»ç†è§£çš„é‚£æ ·ï¼ŒVSCode ä½¿å¾—ä»»ä½•å¯¹ Docker äº†è§£ä¸å¤šçš„äººéƒ½å¯ä»¥éå¸¸å®¹æ˜“åœ°åœ¨ä¸€ä¸ªå®¹å™¨ä¸­å¿«é€Ÿå¯åŠ¨ä»–ä»¬çš„é¡¹ç›®ã€‚æˆ‘å¸Œæœ›è¿™ç¯‡åˆå­¦è€…æ•™ç¨‹æœ‰åŠ©äºæ‚¨ç†Ÿæ‚‰ä½¿ç”¨ Docker éƒ¨ç½² ML æ¨¡å‹ã€‚

> ä¹Ÿè¯·æŸ¥çœ‹[è¿™ç¯‡å…³äºåœ¨æ¨¡å‹éƒ¨ç½²è¿‡ç¨‹ä¸­è¦é¿å…çš„å¸¸è§é”™è¯¯çš„æ–‡ç« ](https://neptune.ai/blog/model-deployment-mistakes)ï¼

å°†æ¥ï¼Œ[æˆ‘ä¼šå›æ¥](https://ipom.medium.com)åˆ¶ä½œä¸€äº›æ›´å¤æ‚çš„æ¨¡å‹ï¼Œå¹¶ç”¨ Docker å°†å®ƒä»¬æ‰“åŒ…ã€‚æ‰€ä»¥[è·Ÿæˆ‘æ¥](https://ipom.medium.com)ç•™åœ¨åœˆå­é‡Œï¼

## [***æˆä¸ºä¸€åä¸­ç­‰ä¼šå‘˜ï¼Œä»ä¸é”™è¿‡æˆ‘æ¯å‘¨å‘è¡¨çš„ä»»ä½•ä¸€ç¯‡æ•°æ®ç§‘å­¦æ–‡ç« ã€‚***](https://ipom.medium.com/membership/) ***åœ¨æ­¤åŠ å…¥ğŸ‘‡***

[](https://ipom.medium.com/membership/) [## é€šè¿‡æˆ‘çš„æ¨èé“¾æ¥åŠ å…¥ Medium

### ä½œä¸ºä¸€ä¸ªåª’ä½“ä¼šå‘˜ï¼Œä½ çš„ä¼šå‘˜è´¹çš„ä¸€éƒ¨åˆ†ä¼šç»™ä½ é˜…è¯»çš„ä½œå®¶ï¼Œä½ å¯ä»¥å®Œå…¨æ¥è§¦åˆ°æ¯ä¸€ä¸ªæ•…äº‹â€¦

ipom.medium.com](https://ipom.medium.com/membership/) 

# å’Œæˆ‘è”ç³»å§ï¼

> åœ¨æ¨ç‰¹ä¸Šå…³æ³¨æˆ‘ã€‚
> è®¢é˜…æˆ‘çš„[æ•°æ®ç§‘å­¦åˆŠç‰©](https://yashprakash.substack.com)ã€‚
> [æŸ¥çœ‹æˆ‘æ‰€æœ‰æ•°æ®ç§‘å­¦æ–‡ç« çš„å®Œæ•´ä»£ç åº“ï¼](https://github.com/yashprakash13/data-another-day)

æˆ‘çš„å¦å¤–å‡ ç¯‡æ–‡ç« ä½ å¯èƒ½ä¼šæ„Ÿå…´è¶£:

[](/heres-how-to-use-jupyter-notebooks-on-steroids-with-deepnote-c35251222358) [## ä»¥ä¸‹æ˜¯å¦‚ä½•åœ¨ Deepnote ä¸Šä½¿ç”¨ Jupyter ç¬”è®°æœ¬çš„æ–¹æ³•

### åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œäº†è§£ Google Colab çš„å®Œç¾æ›¿ä»£æ–¹æ¡ˆï¼

towardsdatascience.com](/heres-how-to-use-jupyter-notebooks-on-steroids-with-deepnote-c35251222358) [](/the-nice-way-to-manage-your-data-science-workflow-7fb92a2ee4a2) [## ç®¡ç†æ•°æ®ç§‘å­¦å·¥ä½œæµçš„å¥½æ–¹æ³•

### åœ¨åˆå­¦è€…ç¤ºä¾‹ä¸­å­¦ä¹ ä½¿ç”¨ Prefect æ„å»º ETL ç®¡é“

towardsdatascience.com](/the-nice-way-to-manage-your-data-science-workflow-7fb92a2ee4a2)