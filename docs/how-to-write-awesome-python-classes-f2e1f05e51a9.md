# 如何编写出色的 Python 类

> 原文：<https://towardsdatascience.com/how-to-write-awesome-python-classes-f2e1f05e51a9?source=collection_archive---------1----------------------->

## 这是一种魔法

![](img/1bac902b259e75a635fb6759da34e374.png)

Artem Maltsev 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

Python 是大多数数据科学和机器学习项目的首选语言。然而，并不是每个数据科学家都一定是经验丰富的 Python 开发人员，他们知道并利用了该语言提供的所有优秀特性。这当然可以理解，但同时也是不幸的。为什么？因为了解一门语言的细节可以让你编写出重复性更低、可读性更强、可维护性更好的代码。总的来说，当充分利用一门语言时，你的代码质量会变得更高，更重要的是，你和你的同事会有更多的乐趣，我想这是我们都喜欢的。

这就是为什么我想帮助提升你的 Python 知识，这样你就可以写出更棒的代码，也许会给你的伙伴或同事留下深刻印象，并获得更多乐趣！具体来说，在这篇文章中，我想谈一谈所谓的*邓德、特殊或神奇的*方法。好奇想知道这些是什么？让我们开始吧。

# 神奇的方法

正如标题所言，我们将讨论 *Python 魔术方法*。有时，你可能还会读到关于 *dunder* 或 *special* 方法，它们指的是同一个东西。在这篇文章中，我将使用术语魔术方法。那么那些神奇的方法是什么呢？

## 基础

魔法方法是属于一个类的函数。它们可以是实例和类方法。你可以很容易地识别它们，因为它们都以双下划线开始和结束，也就是说，它们看起来都像`__actual_name__`。这也是术语 *dunder* 的来源，**d**double**under**scores。我花了一段时间才发现😃

可能最重要的是*魔法方法不是让你直接调用*的！当然，你可以这样做，写一些类似于`YourClass().__actual_name__()`的东西，但是请不要这样做😃！

那么魔法方法是如何被调用的呢？它们是从应用于您的类或类的实例的某些操作中调用的。先睹为快，例如，调用`str(YourClass())`会调用神奇的方法`__str__`，或者`YourClass() + YourClass()`会调用`__add__`，如果你已经实现了它的话。

那么，魔法方法有什么好处呢？它们使您能够编写可以与 python 内置方法一起使用的类。如果你这样做，你的 c̶a̶n̶将会写出可读性更强、更简洁的代码。我希望这已经变得显而易见，从前面一段的小偷窥。

为了强调魔法方法是多么有用，并了解在进行机器学习或数据科学时如何从使用它们中受益，让我们跳到一个具体的例子中。

## 示例:自定义日期时间范围

作为一个例子，我想向您展示如何使用神奇的方法编写类似于内置的 [*范围*](https://docs.python.org/3/library/functions.html#func-range) 函数的东西。与内置版本相比，这个例子将提供更多的功能，更重要的是创建日期时间范围而不是数字范围。当然，你可以只使用 [Pandas](https://pandas.pydata.org/) 或者其他一些库来得到它，但是我认为这个例子的目的是促进我们对魔术方法背后的一般概念的理解。它还允许我向您展示一些最有用的神奇方法，尤其是在处理数据时。

只是谈论或写代码而没有看到真实的和工作的代码是很无聊的，不是吗？因此，让我们停止这样做，看看真正的日期时间范围实现

好了，这是相当多的代码。如果你现在害怕，容忍我，我们将揭示它。总的来说，我已经实现了六种不同的魔术方法，我将在下面解释。

第一个，也可能是最著名的一个是`__init__`方法。您肯定知道，这个方法主要用于初始化您的类的实例属性。在这里，我们设置范围类的*开始*和*结束*以及*步长*大小。这类似于我们在创建内置范围函数时所做的。

下一个是`__iter__`法。这可能是最重要的一个，因为它生成了我们的日期时间范围内的所有元素。这个函数是所谓的*生成器函数*，它一次创建一个元素，将它交给调用者，并允许调用者处理它。它一直这样做，直到到达范围的末端。当看到`yield`关键字时，你可以很容易地识别出一个发生器函数。该语句暂停函数，保存其所有状态，稍后在后续调用中继续。这允许您一次使用一个元素并使用它，而不需要将每个元素都存储在内存中。

当每个项目都占用大量内存，或者当您有大量项目时，不将所有内容都放在内存中会非常方便。例如，尝试执行`**list**(DateTimeRange(datetime(1900,1,1), datetime(2000,1,1))`或者不执行，因为这会创建一个包含 3184617600 个日期时间条目的列表。太大了，抱歉😃但是，使用生成器，您可以轻松地逐个处理这些元素。

现在你已经看到它不是一个列表或元组。然而，为了处理这个 DateTimeRange 类，就好像它是一个列表或元组一样，我添加了另外三个神奇的方法，即`__len__`、`__contains__`和`__getitem__`。

使用`__len__`，您可以通过调用`**len**(my_range)`来找出属于您的范围的元素的数量。这非常有帮助，例如当你迭代所有的元素，并且想知道你已经处理了多少个元素的时候。它可能还会告诉你，嘿，我要处理很多数据，请拿一杯☕️.咖啡

使用`__contains__`你可以使用内置语法`element **in** my_range`检查一个元素是否是你的范围的一部分。给定实现的好处是，这是使用纯数学来完成的，而不必将给定元素与该范围内的所有元素进行比较。这意味着检查一个元素是否是范围的一部分是一个常量时间操作，不依赖于实际范围实例的大小。同样，这对于我们在处理数据时经常看到的大范围来说会很方便。

使用`__getitem__`你可以使用索引语法从你的对象中检索条目。例如，你可以得到我们范围的最后一个元素`my_range[-1]`。我必须承认，对于具体的例子来说，这可能是最没用的方法。然而，一般来说，使用`__getitem__`可以让你写出非常干净易读的界面。

我添加的第六个也是最后一个魔法方法是`__str__`。这个方法允许你将类的实例转换成字符串。这在调用`**print**(my_range)`时变得非常方便，因为 print 必须将一个实例转换成一个字符串，因此使用了`__str__`方法。

![](img/5c7a4802b0553c5123cc88d0cf637511.png)

由 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的[美元吉尔](https://unsplash.com/@dollargill?utm_source=medium&utm_medium=referral)拍摄的照片

# 包裹

在本文中，我向您介绍了 Python 中魔术方法背后的基本概念。我已经向您展示了第一个示例，展示了如何使用这些方法，在我看来，这些方法在处理数据时非常方便。当然，还有很多，例如创建[上下文管理器](/context-managers-the-best-managers-for-python-developers-a5809fb7e428)或者[增强你的类](https://betterprogramming.pub/how-to-create-custom-classes-in-python-without-going-meta-5e8bfa97be6e)。我可以推荐你继续探索这个领域，继续学习！

我希望你现在已经准备好在将来创建神奇的界面，也许还可以向你的朋友和同事炫耀一下💪。

感谢您关注这篇文章。一如既往，如有任何问题、意见或建议，请随时联系我或关注我，或者通过 [LinkedIn](https://www.linkedin.com/in/simon-hawe-75832057/) 。