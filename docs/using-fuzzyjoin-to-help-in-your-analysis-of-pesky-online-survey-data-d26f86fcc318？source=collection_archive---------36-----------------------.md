# 使用 fuzzyjoin 帮助您分析讨厌的在线调查数据

> 原文：<https://towardsdatascience.com/using-fuzzyjoin-to-help-in-your-analysis-of-pesky-online-survey-data-d26f86fcc318?source=collection_archive---------36----------------------->

## … *名字不符的时候特别有用！*

几天前，我被要求帮助某人整理一项在线调查的结果。问题是，在线调查分两部分进行，每一部分都有自己的谷歌表格。请求是执行一个简单的线性回归模型，其中一个 Google 表单记录了响应变量，另一个 Google 表单记录了解释变量。然而，每个调查参与者都没有唯一的标识符，他们被告知输入的唯一信息是他们的名字。这会很有趣的！下面是我如何在 r 中使用`fuzzyjoin`来做这件事(及其背后的思考过程)的记录。

# 数据

为了让你更好地了解这些数据有多糟糕，这里有一个在两种表格中记录姓名的快照(姓名已被更改，因为这是个人数据，但这实际上是看起来的样子)。第一组数据记录了他们的总体幸福感…

![](img/091a8112a51ffbc60a37722c189f445a.png)

幸福数据

第二组数据记录了他们在工作和与孩子相处时面临的困难。第二组数据是在谷歌表单上完成的，但名字是用下拉列表。这就迫使这些名字按照他们注册的名字有固定的格式。

![](img/5626a4a2c3573a2f0717148b1a1f496a.png)

难度数据

所有 4 个名字都出现在两组数据中，但是正如你所看到的，在名字的输入上有相当多的差异。例如，在新加坡，许多老一辈的人只登记了中文名字(例如“郭丁丽”)，却采用了英文名字(例如“Mary Kwek”)，而没有在政府登记。事实证明这的确是个问题。

# 输入模糊连接

和我一起工作的人熟悉 R 语言，因此要求我用 R 语言做这个项目。看着各种可用的库，我最终决定用`fuzzyjoin`作为最好的前进方式。

导入文件后，我使用在`fuzzyjoin`库中找到的`stringdist_join`函数来执行两个文件的匹配和组合。在继续解释每一步的用途之前，我将把我使用的整个代码块放进去。

前两个参数，`by`和`mode`类似于通常的`dplyr`连接，所以我不会真的触及它们。

第一个重要论点是`method`。在这种情况下，method 允许您选择想要使用的度量，以便量化单词字符串之间的距离。点击，您可以找到完整的指标列表[。我并不真正熟悉**所有的**指标，但我知道有几个(例如 **Hamming** )肯定不合适，因为它们要求文本字符串具有相同的字符数。相反，为了找出哪种方法给了我最好的结果，我创建了数据集的一个子集，并尝试了几种方法，直到我找到一种我认为(通过目测结果)看起来最好的方法。如你所见，我最终选定了 **Jaro 距离**。经过反复试验，它给了我最好的结果。](https://www.rdocumentation.org/packages/stringdist/versions/0.9.6.3/topics/stringdist-metrics)

下一个参数是`ignore_case`,我显然将它设置为“TRUE ”,因为有些名字是大写的，而有些不是。

`max_dist`然后设置最大允许距离。在这种情况下，因为我使用“JW”返回 0 和 1 之间的距离，所以我选择了 0.5 之间的某个值。同样，这将涉及一点点的尝试和错误，以找到一个最佳的距离。`max_dist`越大，返回的匹配数越多，返回的数据帧也越大。在我的**子集中只有 25 个**名字，将其设置为 1.0 会返回 1078 行，而设置为 0.5 会得到 564 行。

`distance_col`允许你创建一个存储匹配之间距离的列——这是一个非常有用的列，可以在以后过滤匹配。

有了 564 行之后，我按照 Name.x(这是第一个数据集中的姓名列，带有“官方姓名”)将它们分组，并使用`slice_min`来只保留每个姓名之间距离最小的那一行。

然后我把所有的名字按降序排列，看距离最高的名字。我被告知，并不是每个调查参与者都完成了**两个**调查，因此一些名字将不得不被删除，因为事实上根本没有匹配。快速浏览这些名字，我看到第一次“真正的比赛”是在距离降到 0.27 以下后才开始的，因此增加了一个`filter`。

然后……完成了！我从两个完全不同的数据集中提取了两组相当混乱的名字，并用`fuzzyjoin.`将它们连接在一起。感谢阅读，我希望当你需要分析任何名字混乱、不匹配的调查数据时，这篇技巧对你有所帮助！

[*最初发表于 http://zachlim98.github.io/me*](http://zachlim98.github.io/me)