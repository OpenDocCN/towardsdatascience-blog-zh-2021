# 使用开源数据科学堆栈解决您的 MLOps 问题

> 原文：<https://towardsdatascience.com/solve-your-mlops-problems-with-an-open-source-data-science-stack-c76a484c92c8?source=collection_archive---------24----------------------->

![](img/a5856ed5af99b3aade96030c4408b7b2.png)

奥马尔·弗洛雷斯在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

# TL；速度三角形定位法(dead reckoning)

数据科学家面临挑战，需要工具来克服这些挑战。最好使用开源、同类最佳的模块化解决方案。从问题解决的角度考虑这些挑战也是一个好主意，而不是“给我最棒的工具”的方法。我提供了一个常见问题和这些问题的 OSS 解决方案的列表，并对这些问题何时变好/变坏进行了评论。[跳到列表](#9c67)

# 一个熟悉的问题

如果你是一名从事机器学习项目的数据科学家，你可能已经注意到了工作中反复出现的一个问题。

1.  **你有很多问题**，似乎有很多工具适合他们，但每个人都声称他们可以做任何事情，**而且很难知道每个任务使用什么工具**。更糟糕的是，您已经尝试了其中的一些工具，并感到失望。因为它们每个都有一个学习曲线，尝试另一个很可怕，可能会在你最终需要内部构建的东西上浪费更多时间。
2.  **快速行动至关重要**因为你需要向你组织的其他人展示这种新的人工智能事物实际上可以转化为商业价值，并且你希望专注于你最擅长的事情——理解你的数据，转换它，或者将其转化为商业见解，或者为你的产品/公司培训 ML 驱动的组件。
3.  **你知道你是团队的一员**——你的公司将成为一艘火箭船，你很快就会有一个庞大的团队(如果你还没有的话)，你已经需要与组织中的其他团队合作，比如领域专家、软件工程师和开发人员。
4.  最后，**您意识到这一领域瞬息万变，**因此选择一家可能过时的供应商，或者不支持您将来会使用的格式/工具是有问题的。但是，另一方面，[分析麻痹](https://en.wikipedia.org/wiki/Analysis_paralysis)也好不到哪里去(回到第 2 点)。

![](img/235643b1ca0d948b30f989baf2341bb3.png)

这家伙绝对不会将模型交付生产。[廷杰律师事务所](https://unsplash.com/@tingeyinjurylawfirm?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 拍摄的照片

我很高兴地告诉你，这个问题是可以解决的。您不必在购买可定制性较差、可能意味着您没有应对所面临挑战的最佳解决方案的端到端平台和构建可能完全符合您需求的内部解决方案之间做出选择，但这意味着您不再是一名数据科学家(恭喜您，您现在是一名软件工程师，这是晋升还是降级取决于您)。

这个黑客使用开源软件创建了一个开源数据科学栈。由于 ML 世界快速变化的本质，对于数据科学家面临的许多问题，有数百种开源解决方案，这些解决方案不会遇到上述相同的问题，我将在下面做出一些假设:

假设以下情况:

1.  最佳解决方案被定义为针对给定问题的最佳解决方案，它能够**与您使用的其他最佳解决方案**相对容易地集成。这意味着，任何要求您放弃其他与问题无关的工具来使用它的出色解决方案都不算数。
2.  **你不需要为了工具而工具**——你有你想要解决的问题，或者你想要改进的流程，你需要工具来帮助你完成这些事情。这个假设很重要。否则，您将要求一切，这意味着您将最终使用一个端到端平台，当您需要解决更具体的挑战时，该平台可能会崩溃。
3.  **数据科学家需要与开发人员不同的工具** —你应该立志不要重新发明轮子(例如，开发人员的自动化工具可能非常适合机器学习工作负载)，但处理代码并不是数据科学的全部。您至少需要考虑如何处理数据、模型、管道和实验。具体来说，在将被推广到生产的 ML 项目中，再现性需要被适当地解决。

现在，符合上述假设的开源堆栈以下列方式解决了这些挑战:

1.  **知道使用哪些工具**是这篇文章的目的。此外，通过为您的问题选择易于集成的单点解决方案，您可以避免失望——如果该工具不能解决您的问题，那么端到端平台可能也不能。
2.  **您可以快速行动**因为一旦出现问题，您会选择一个符合假设的工具，即它解决了一个实际问题，并且是您的问题的最佳解决方案，同时与您的堆栈的其余部分集成。这意味着您花在选择工具上的时间更少，将它与堆栈的其余部分集成的时间也更少。
3.  **在团队中工作**已经解决了，因为你将从寻找已经在组织的其他部分采用的工具开始。如果没有一个解决您的问题，这意味着您应该看看外面，通过选择与您的堆栈的其他部分集成的最佳解决方案，您将使其他人也很容易采用它们。这可能会大大缩短您的生产时间。
4.  **该领域的快速变化特性**得到了解决，因为如果您根据上述假设选择工具，您的平台就是完全模块化的。用新工具替换旧工具应该只需要最少的集成和时间。

通过选择开放堆栈(即开源工具)，您可以获得两个额外的好处:

1.  如果出现特殊需求，可以根据您的需求修改工具。
2.  你从与你职位相同的人那里获得社区支持——使用工具和经历挑战。这也意味着评估工具的缺陷要容易得多(只需进入他们的问题页面)。

*   当然，使用开源并不等同于避免锁定。比起晦涩难懂的或新的标准，你应该总是更喜欢被广泛支持的通用格式。

我上面写的一切都是现实的理想表现。在现实生活中，事情要复杂得多，还有其他的考虑因素在起作用。然而，使用这种思考过程和假设将会节省你的时间、空间和潜在的悲伤和金钱。

本文的其余部分将是我在过去几年中听到的数据科学家提出的问题，以及一些可用于将它们整合到您的堆栈中的开源工具。我会试着在每一个上面添加一些注释，以便在它更适合/不太适合这个任务的时候使用。

# 10 个 MLOps 问题以及如何使用开放式堆栈解决这些问题:

## 1.问题:您有不断变化的数据，并且您想要时间旅行/灾难恢复/治理:

您的数据是非结构化的:

*   https://github.com/iterative/dvc DVC——可能是这个列表中最轻量级的解决方案。如果你想最快上手，这是你的选择。
*   pachyderm—[https://github.com/pachyderm/pachyderm](https://github.com/pachyderm/pachyderm)—pachyderm 专注于 K8s 之上的管道，提供数据版本控制作为其管道系统的副产品。如果您在 K8s 之上工作，并且正在寻找一个重载管道解决方案，这可能适合您。
*   LakeFS—[https://github.com/treeverse/lakeFS](https://github.com/treeverse/lakeFS)—您的整个数据湖的版本。这对于非常大的规模是很好的，并且对于大规模流有很多优化，但是可能需要您的组织采用它

您的数据被结构化或存储在您可以查询的数据库中(在这种情况下，您需要同意更改您的数据库):

*   dolt—[https://github.com/dolthub/dolt](https://github.com/dolthub/dolt)—一个具有版本控制能力的关系数据库
*   https://github.com/terminusdb/terminusdb 的 terminus DB——一个具有版本控制能力的图形数据库
*   delta Lake—【https://github.com/delta-io/delta —具有特殊数据接收功能的完整版本化数据湖解决方案。这比列表中的其他两个解决方案要重要得多。

**注意:**这三种结构化数据解决方案都不如非结构化数据解决方案轻便，因为它们需要将数据转换成专用的数据格式或数据库。这对你来说可能是一个交易破坏者。

这个问题经常出现，但通常，提问者会询问数据版本化的解决方案。本着解决问题的精神，而不是为了添加工具而添加工具，回答两个主要问题很重要:

数据版本控制将完成什么任务:

*   您希望能够使用不同版本的数据来比较模型的行为吗？
*   您是否需要一个解决方案，以便在出现错误时恢复到早期版本。？
*   您是否在寻找一种解决方案来了解哪些数据在哪里使用？
*   您是否在寻找一种方法来添加/修改数据，而不破坏下游的消费项目？

您正在管理什么类型的数据:

*   它是否存储在数据库中，并且您想要管理整个数据库的版本？
*   它是否存储在数据库中，但您希望只管理查询到特定项目中的数据？
*   是像图像、文本或音频这样的非结构化数据吗？

每个问题的不同答案可能需要不同的工具。

## 2.问题:您不确定 ML 项目使用什么结构:

*   库克科特数据科学—[https://github.com/drivendata/cookiecutter-data-science](https://github.com/drivendata/cookiecutter-data-science)

考虑哪种结构对您的项目有意义可能会令人沮丧。你应该把你的数据和模型放在同一个文件夹里吗？在这方面还没有做很多工作，但 Cookiecutter 数据科学似乎是一个反复出现的名字，所以当你有疑问时，你可以使用它，它可能会满足你的需求(同时减轻你的精神负担)。

## 3.问题:您不确定如何跟踪您的实验元数据*:

这可能不是一个问题——但是人们一直在问这个问题，所以我也可以解决这个问题。有这么多的解决方案，所以选择的[悖论在这里很强烈，但幸运的是，你可以阅读我们的另一篇帖子，](https://en.wikipedia.org/wiki/The_Paradox_of_Choice)[关于选择哪个实验跟踪解决方案最适合你](https://dagshub.com/blog/how-to-compare-ml-experiment-tracking-tools-to-fit-your-data-science-workflow/)。

这里需要注意一些事情:

*   你应该尽可能多地记录，同时保持一种区分“垃圾”实验和“好”实验的方法(标签是一种很好的方法)。
*   避免完全删除不好的实验。他们可以教你很多好的实验。最好将它们放在一个单独的视图中。
*   最好使用通用格式，而不是专有或晦涩的格式。这将让您轻松地分析您的实验元数据。

## 4.问题:您已经有了一个模型，并且您认为您可以通过微调它的超参数来获得额外的几个百分点:

**注意:**在大多数情况下，超参数调优并不像描述的那样有效。通常，努力提高数据质量是一个更好的主意。

不过，这里有两个很棒的工具:

*   optuna—[https://github.com/optuna/optuna](https://github.com/optuna/optuna)—超参数调整和黑盒优化的最佳简单解决方案。
*   Ray Tune—[https://github.com/ray-project/ray](https://github.com/ray-project/ray)—如果你已经在使用 Ray 进行分布式训练，这很有用。它是一个适配器层，包括与 Optuna 以及其他调优算法的集成。

## 5.问题:你需要一个免费的 GPU(我们不都是吗):

*   谷歌可乐—[https://colab.research.google.com/](https://colab.research.google.com/)—努夫说。

![](img/5fcb43ec7cc6d9514ed6175c54b254a7.png)

照片由 [Nana Dua](https://unsplash.com/@nanadua11?utm_source=medium&utm_medium=referral) 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄

## 6.问题:您希望尽可能多地实现自动化。在更改参数/代码/数据时，您决定从模型的训练开始，或者更一般地说，从管道的运行开始:

它必须与您组织中的开发人员正在使用的工具一起工作吗？

*   詹金斯—[https://github.com/jenkinsci/jenkins](https://github.com/jenkinsci/jenkins)—可能是软件工程中最广泛使用的自动化解决方案。它的设置不是最用户友好的，但是如果您的组织已经在使用它，那么与它集成应该很简单。
*   git lab CI—【https://gitlab.com/gitlab-org/gitlab-runner 
*   GitHub 操作(非 OSS)*

您能否为您的 ML 管道创建专用服务:

*   https://github.com/PrefectHQ/prefect—[提督——它就像气流，但有一个可以说更直观的 API 和改进的数据管道功能。它肯定没有 Airflow 成熟，提供的集成也更少，但 Prefect 的作者声称解决了 Airflow 的一些缺点，如改进的调度、动态 DAG 支持等等。](https://github.com/PrefectHQ/prefect)
*   dagster—[https://github.com/dagster-io/dagster](https://github.com/dagster-io/dagster)—也能与 Airflow 一起工作，与 Prefect 相比，它的用户界面可以说更方便，但与 Prefect 相比，它更固执己见，这意味着更多的专用功能，但灵活性较差。
*   KF pipelines—[https://github.com/kubeflow/pipelines](https://github.com/kubeflow/pipelines)—Argo 管道的包装器。如果您已经在使用 Kubeflow，这一点尤其有用。否则，它可能不会提供优于其他两个选项的优势。

## 7.问题:您想要通过 API 访问您的模型:

另一个经常出现的问题是“您如何将您的模型部署到生产中？”。虽然这是一个需要完成的重要任务，但它通常是非常具体的。很难找到一个放之四海而皆准的解决方案，您需要注意以下主题:

1.  我只需要部署模型吗？或者，我是否需要一个部署整个数据处理管道的解决方案，否则将永远不会生成正确的模型输入？
2.  我是在使用 Scikit-Learn Pipelines 这样的标准框架，还是开发了定制的数据处理步骤/模型？
3.  我的部署系统有“工程”约束吗？它应该支持每小时数百万的请求吗？它的延迟是否应该低于某个阈值？在有压力的情况下，它应该是可伸缩的吗？

这些问题会引导你做出权衡。对系统的约束越多，需要的前期工程工作就越多，但是如果您只需要部署一个“简单”的模型推理 API，下面的方法可能会对您有所帮助:

*   谢顿—[https://github.com/SeldonIO/seldon-core](https://github.com/SeldonIO/seldon-core)或 KFServing—[https://github.com/kubeflow/kfserving](https://github.com/kubeflow/kfserving)—这两者都与 K8s 有关，所以这可能是一个主要的考虑因素。Seldon 集成到 KFServing 中，但你也可以把它作为一个独立的项目，它可能更成熟。支持标准模型格式，并允许您在需要时定义自定义包装器。
*   BentoML——为模型提供包装器(创建一个 docker 容器)，但不提供容器本身的编排。在这个意义上，它可以和谢顿一起使用。与谢顿相比，他更固执己见，因此可能不太灵活。
*   cortex—[https://github.com/cortexlabs/cortex](https://github.com/cortexlabs/cortex)—开始是一项 ML 部署服务，从那以后开始关注更广泛的“部署、管理和扩展无服务器容器”。它目前只支持 AWS，但是已经被广泛采用，并且支持多种类型的 API(实时、批处理、异步),这对于某些应用程序来说可能是至关重要的。

## 8.问题:您希望更好地了解模型的输出，以增加您对其性能的信任:

这对您来说可能是一个严重的问题，尤其是如果您的项目/组织需要确定性的和可解释的预测来推广到生产中(例如，当您不能冒险让您的模型有偏差时)。这是一个活跃的开发领域，您很可能需要为您的工作开发一些定制的可视化，特别是如果它不是一个通用领域(人脸识别或文本翻译)。然而，有一些框架可以让你的生活更轻松:

*   https://github.com/slundberg/shap-SHAP[-解释所有类型的模型预测，与单一的预测解释相比，可以说对模型或变量可解释性表现更好。](https://github.com/slundberg/shap)
*   莱姆[https://github.com/marcotcr/lime](https://github.com/marcotcr/lime)——可以说更擅长单一预测解释。
*   SHAPash—[https://github.com/MAIF/shapash](https://github.com/MAIF/shapash)—一种更全面的方法，为您的模型生成报告，并通过多个图表解释其结果。它与 SHAP 和石灰都相容

记住，在许多情况下，最好的解决方案是使用更简单的模型，这也是一个好主意。许多公司选择基于树的模型，因为它们本质上比神经网络更容易解释，同时在性能上不会损失太多。记住这不是一个非此即彼的情况也是一个好主意。您可以使用以上所有选项，并在需要时为您的仪表板提取细节。

## 9.问题:您想向某人(可能是内部利益相关者)展示您的工作演示，但没有学习 HTML、CSS 和 JS:

这一个是相当不言自明的。

*   streamlit—[https://github.com/streamlit/streamlit](https://github.com/streamlit/streamlit)—更专注于快速原型开发。与 Dash 相比，更加固执己见，这意味着更容易构建更简单的仪表板。
*   dash——https://github.com/plotly/dash[——更灵活，但入门更难。更适合企业环境和生产。](https://github.com/plotly/dash)
*   https://github.com/gradio-app/gradio 的 gradio——一个更加固执己见的工具，尤其是面向 ML 模型的演示，而不是 Streamlit 和 Dash 的更通用的仪表板功能。

## 10.问题:你已经有了一个生产中的模型，你担心它可能会出问题，所以你需要一些方法来确保预测是有意义的:

针对这个问题的开源解决方案相对较少，下面的解决方案虽然很早，但可能对您的需求有用。

*   ml watcher—[https://github.com/anodot/MLWatcher](https://github.com/anodot/MLWatcher)—更专注于实时监控，特别是概念漂移、数据异常和模型度量。
*   显然——[https://github.com/evidentlyai/evidently](https://github.com/evidentlyai/evidently)——一个基于报告的监控系统，它分析模型并为特定主题(如数据漂移和模型性能)提供交互式报告。据我所知，它们不提供任何实时功能，这意味着如果这对您很重要，您将需要手动设置。

# 摘要

这是一个诚实的尝试，以减轻一些分析瘫痪，以及“购买者”在选择 ML 工具栈时可能有的懊悔。我坚信，随着团队更好地理解他们想要解决的问题，以及他们愿意做出的权衡，开放堆栈将会出现。

通过选择模块化的开源工具，并解决您面临的实际问题，您将自己置于最佳位置，以利用已经为社区开发的自动化和最佳实践，同时仍然保留升级、更改和向堆栈添加新组件的能力。

如果您有其他通过合并最佳开源解决方案解决的问题，请告诉我，我会将它添加到文章中。