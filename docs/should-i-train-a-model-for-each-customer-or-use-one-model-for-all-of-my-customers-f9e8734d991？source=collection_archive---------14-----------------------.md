# 我应该为每个客户训练一个模型，还是为我的所有客户使用一个模型？

> 原文：<https://towardsdatascience.com/should-i-train-a-model-for-each-customer-or-use-one-model-for-all-of-my-customers-f9e8734d991?source=collection_archive---------14----------------------->

## **几乎每一个在软件即服务公司工作的数据科学家，最后都会来到题目中的问题:**我应该为每个客户训练一个模型，还是为我的所有客户使用一个模型？

![](img/2aadaea99147002fae83a09133a92647.png)

pch.vector 创建的人向量—【www.freepik.com 

我是 BigPanda 的高级数据科学家，这是一家向企业销售软件的 SaaS 公司。这意味着我们的任何机器学习功能都应该为许多不同的客户正常工作，他们每个人都有非常不同的数据分布，我们的模型也应该尽快为我们的新客户工作，这些客户有望保持指数增长。

这一挑战不仅仅是我们的，我从我的许多朋友那里听说过，他们从事不同领域的数据科学，如欺诈检测、电子商务、销售预测、广告推荐等。在这篇文章中，我将分享 4 种不同的策略来处理机器学习中的多租户问题，并强调这些策略的优缺点。我也将分享我在 BigPanda 的经验，关于我在生产 ML 模型中尝试的方法。

# 每个客户的型号

这可能是多客户场景中最常见的方法，我们有不同的客户，他们的数据分布各不相同，因此，为客户指定的模型可能会工作得最好。这就带来了更多的问题，即该模型对客户来说有多具体。我们是否对每个客户使用相同的模型，并根据他们的数据进行训练？我们需要为每个客户进行超参数调谐吗？我们要做特征选择吗？型号选择？

对这些问题中的每一个都回答“是”可能会增加模型的准确性，并增加模型的产品化和维护的复杂性。

**缺点**

*   **生产复杂性-** 为每个客户培训和优化一个模型需要模型培训、部署和监控方面的大量自动化，以确保您的系统可以扩展到 10 个以上的客户。
*   **较小的数据-** 您的一些客户可能没有大量数据，他们的模型可能也不太准确。
*   **冷启动-** 当新客户想要使用你的模型时，他必须等待模型有足够的数据来生成准确的预测。在不同的用例中，这可能需要几周甚至几个月的时间，并且会显著影响客户实现产品价值的时间。

**优点**

*   **该模型非常适合客户-** 学习不相关的数据会严重损害您的 ML 模型的准确性。通过只对客户数据进行训练，您可以确保所有训练数据都是相关的，并有助于您的模型。
*   **有时这是唯一可能的选择-** 在许多场景中，由于客户之间不同的特征分布，对多个客户进行训练会损害您的模型(例如，如果您的每个客户都在不同的国家或不同的行业)，因此为每个客户训练一个模型是唯一可能的方法。

**有什么要注意的？**

*   **模型验证-** 在研究阶段，你需要确保你的模型设计对各种各样的客户都起作用，尝试在不同的客户身上验证模型，并确保模型对大多数客户都是准确的，并分析你建模的弱点是什么。
*   **自动化-** 为每个客户培训一个模型时，您最终可能会有数百甚至数千个模型，为了达到这一规模，您必须在生产服务中实现大量自动化，以进行模型培训、优化、部署和监控。
*   **冷启动-** 你必须分析如何为新客户添加型号。你需要多少数据？需要做哪些优化？对新客户上线的验收测试是什么？

**我的外卖**

在 BigPanda 的 ML 特性中，我们为每个客户提供一个模型。我们这样做是因为我们客户的数据非常不同，每个客户都有不同的属性、不同的数据规模、不同的用例以及不同的内部术语。在研究和实施该解决方案的过程中，我们通过研究何时可以为新客户训练模型，并自动完成大部分模型训练和优化，将模型扩展到新客户。

# 全球模型

全局模型是最简单的方法，我们将忽略数据中有不同的客户，并根据我们拥有的所有数据训练一个 ML 模型。使用这种方法无疑避免了每个客户模型的大多数缺点，但是它引入了新的问题。

**缺点**

*   **数据分布的差异-** 根据不相关的数据训练模型通常会降低模型的准确性。很多时候，不同客户的数据差异很大，会影响模型的准确性。
*   **监控隐藏的问题-** 虽然监控模型的整体准确性很有吸引力，但是模型中的问题可能只针对一部分客户，这些问题不会影响模型的 KPI，但肯定会影响客户满意度。在全球模型中找到并解决这些问题可能非常困难。

**优势**

*   **工程工作-** 只训练和优化一个模型比许多模型容易得多，并且可以大大减少产品化和维护方面的工程工作。
*   **冷启动-** 通过全球模型方法，我们可以在有新客户时立即做出预测，这确实可以提高客户满意度。
*   **更大的数据集-** 通常在混合来自几个客户的数据后，你会有一个大的数据集，你可以用它来训练复杂而强大的模型。

**需要注意什么？**

*   **模型验证-** 在研究阶段，您需要确保您的模型能够在模型训练中没有数据的新客户身上发挥作用，这可以通过分组交叉验证来实现，您可以在几个客户身上训练您的模型，并在其他客户身上进行测试。
*   **模型弱点-** 模型对某些客户的准确性可能较低。识别哪些客户具有较低的准确性以及造成这种情况的原因对于算法的改进非常有益。
*   **跨客户的特性标准化-** 通常，您的模型的特性在不同的客户身上会有不同的分布。这可能会导致某些客户的模型精度降低，并使其他客户过度拟合。通过标准化每个客户的数据，我们可以减少这些差异，并建立一个更好的模型。

**我的外卖**

在 BigPanda 的另一个 ML 特性中，我们为所有客户提供了一个全球模型。我们决定使用全球模型，因为新客户能够立即使用这一模型对我们来说非常重要。在研究该模型时，我们重点确保在培训和测试中不使用相同的组织来验证该模型，并尝试设计跨客户通用的功能，以便该模型可以推广到每个新客户。

# 客户细分

下一个策略是一种介于每个客户模型和全球模型之间的中间策略。这种方法首先将我们的客户分成几个部分，然后为每个部分训练一个模型。在这种方法中，我们可以享受全局模型的一些优势(可扩展性和冷启动)，同时使用更多相关数据，并有望产生更准确的模型。

**缺点**

*   **如何细分？** -细分客户的方法有很多，我们可以按语言、国家、行业甚至更多，甚至使用一些聚类或嵌入模型来做细分。在拥有许多客户(数据差异太大)和很少客户(我们将拥有许多不同的模型)的细分市场之间也存在权衡，找到最佳的细分市场是一个困难的研究问题。
*   **仍然有其他策略的缺点-** 在客户细分后，您的模型将比客户少，但您可能仍然有几十个模型，这些模型也很难部署和维护，需要自动化和工程工作。

**优势**

*   **权衡控制-** 分段的数量通常控制模型精度(在或多或少相似的数据上训练)和操作复杂度(模型数量)之间的权衡，在这种方法中你可以选择最适合你的点。
*   **两全其美？-** 在某些用例中，客户细分可以让您两全其美，通过维护几个模型而不是数百个模型，为冷启动客户提供相关数据和模型的大型数据集，而不需要非常大的工程工作量。

**需要注意什么？**

*   **细分方法-** 您对客户进行细分的方法可能是模型中最重要的部分之一，这将极大地影响模型的准确性。确保测试和迭代不同的分割方法，并找到产生最佳模型的方法。
*   **工程工作-** 虽然使用客户细分比使用每用户模型简单得多，但仍然需要一些自动化、部署和培训方面的工程工作。

**我的外卖**

我还没有在我们的任何用例中尝试过这种方法，但我确实从业内的大学那里听说他们使用客户细分。他们大多表示，找到细分客户的最佳方式是一个难题，数据科学家必须对此投入大量精力。

# 迁移学习

使用迁移学习是 4 种方法中最先进的方法。在这种方法中，我们将首先使用大量数据对我们的所有数据训练一个全局模型，然后根据特定客户的数据对模型进行微调。这种方法将主要与可以在网络之间转移知识的深度学习模型一起工作。

**缺点**

*   **主要用于深度学习** -迁移学习主要用于深度神经网络，但对于许多应用程序(尤其是表格数据)，像 XGboost 这样的基于树的模型更准确，更易于解释，也更轻量级。因此，有时你将无法使用迁移学习与你选择的模式。
*   **需要非同寻常的协调-** 根据你的所有数据训练一个大型模型，然后对每个客户进行微调，这不是一个简单的过程，可能需要为每个模型的再训练建立一个复杂的管道。

**优点**

*   **可以非常准确-** 通过使用迁移学习，我们可以在预训练阶段自动利用数据中的共性，并在微调部分丢弃不相关的信息，这可能会导致非常准确的模型。BERT、GPT3 和 SimCLR 等模型证明了迁移学习的潜力。
*   **冷启动-** 在迁移学习场景中，我们不能像在全球模型中那样立即开始给出预测，但我们可以为只有数百或数千个数据点的新客户训练一个非常准确的模型。

**有什么要注意的？**

*   **如何迁移知识-** 迁移学习有很多方法。我们可以微调网络，提取嵌入或使用知识提炼。这些方法中的每一种都可能导致更好或更差的模型，这取决于用例。
*   **新客户-** 在预培训阶段无法获得的客户身上验证模型，并评估新客户培训好模型所需的数据量，这一点很重要。

**我的外卖**

我没有使用迁移学习来学习多个客户，但我在一些不同的用例中使用了迁移学习，它在提高模型性能方面表现出了极大的有效性。我相信这是一个很好的解决方案，在这种情况下，拥有一个带有少量标记数据的精确模型是很重要的。

# 结论

在这篇文章中，我回顾了 4 种不同的多客户场景建模方法，并试图强调每种方法的优缺点。标题中问题的答案是，这取决于您项目的业务和技术需求。模型应该有多精确？你愿意付出多少工程努力？新客户冷启动有多重要？不同客户的数据差异有多大？更多的问题将帮助你为你的问题选择正确的解决方案。