# å¦‚ä½•ä»¥æœ€ç®€å•çš„æ–¹å¼é…ç½® Github åŠ¨ä½œï¼Ÿ

> åŸæ–‡ï¼š<https://towardsdatascience.com/setting-up-python-environment-using-github-actions-9a81936be5c9?source=collection_archive---------21----------------------->

## æœ¬æ–‡æ—¨åœ¨è‡ªåŠ¨åŒ– GitHub ä¸Šæ‰˜ç®¡çš„ ML é¡¹ç›®ï¼Œå¹¶å‡å°‘é€šè¿‡æ‹‰è¯·æ±‚çš„ä»£ç ç ´åã€‚

![](img/f17c5f0527d25145385eff6b90f03df7.png)

[https://github.com/features/actions](https://github.com/features/actions)

# ä»‹ç»

åœ¨æˆ‘çš„[ä¸Šä¸€ç¯‡æ–‡ç« ](/how-to-set-up-python3-the-right-easy-way-11c18b0b4ac0)ä¸­ï¼Œæˆ‘ä¸€æ­¥ä¸€æ­¥åœ°å¼•å¯¼æ‚¨åœ¨æœ¬åœ°æœºå™¨ä¸Šä½¿ç”¨ pyenv æ­£ç¡®è®¾ç½® python3 ç¯å¢ƒã€‚ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç”±äºä½¿ç”¨ä¸åŒ python ç‰ˆæœ¬ç”šè‡³ç¼ºå°‘æ¨¡å—çš„ pull è¯·æ±‚æ‰€å¯¼è‡´çš„ä¸€äº›å†²çªï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€äº›é—®é¢˜ã€‚

æœ¬æ•™ç¨‹å°†æ¼”ç¤ºä¸ºä»»ä½•ä½¿ç”¨ Github actions æ’ä»¶çš„é¡¹ç›®å»ºç«‹æ ‡å‡†å·¥ä½œæµç¨‹çš„æ­¥éª¤ã€‚åœ¨é¡¹ç›® CI æ–‡ä»¶å¤¹ä¸­é…ç½® Github æ“ä½œå°†ä¿æŠ¤ä¸ç¬¦åˆå…³äºä»£ç æ ¼å¼ã€è¯­æ³•é”™è¯¯å’Œç‰ˆæœ¬å†²çªçš„ä»£ç æ ‡å‡†çš„ä»£ç åº“ pull è¯·æ±‚ã€‚æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ï¼

# å…ˆå†³æ¡ä»¶:

1.  Github è´¦æˆ·ã€‚
2.  ä»£ç ç¼–è¾‘å™¨â€” IDEï¼Œæˆ‘æ›´å–œæ¬¢ vscode
3.  YML è¯­æ³•åŸºç¡€çŸ¥è¯†â€” [è¿™é‡Œå¿«é€Ÿå›é¡¾](https://www.tutorialspoint.com/yaml/index.htm)
4.  å®‰è£…åœ¨æœ¬åœ°æœºå™¨ä¸Šçš„ python 3â€”[éµå¾ªè¿™é‡Œçš„æ­¥éª¤](/how-to-set-up-python3-the-right-easy-way-11c18b0b4ac0)ã€‚

# GitHub æœ‰å“ªäº›åŠ¨ä½œï¼Ÿ

Github actions æ˜¯è‡ªåŠ¨åŒ–å’Œç®¡ç†é¡¹ç›®å·¥ä½œæµå®Œæ•´å¼€å‘ç”Ÿå‘½å‘¨æœŸçš„æ’ä»¶ã€‚åœ¨åŠŸèƒ½ä¸Šç±»ä¼¼ Circleciã€Travisã€Gitlab ä½†æ˜¯ï¼Œå¦‚æœé¡¹ç›®å­˜å‚¨åº“æ˜¯å…¬å…±çš„ï¼Œé‚£ä¹ˆå®ƒæ˜¯å…è´¹çš„ã€‚

## ä»€ä¹ˆæ˜¯å·¥ä½œæµï¼Ÿ

Github åŠ¨ä½œçš„å·¥ä½œæµç¨‹æ˜¯ä¸€ç³»åˆ—å†™åœ¨ yml æ–‡ä»¶ä¸­çš„æ­¥éª¤æˆ–æŒ‡ç¤ºï¼Œæ¯æ¬¡ä½ æ¨é€åˆ° GitHub ä¸Šçš„ç‰¹å®šåˆ†æ”¯æ—¶éƒ½ä¼šè¿è¡Œã€‚

## ä¸ºä»€ä¹ˆä¸ºæ¯ä¸ªé¡¹ç›®å»ºç«‹å·¥ä½œæµç¨‹å¾ˆé‡è¦ï¼Ÿ

ä»é•¿è¿œæ¥çœ‹ï¼Œè®¾ç½®å·¥ä½œæµå¯ä»¥èŠ‚çœæ—¶é—´ï¼Œåœ¨æ¨é€/åˆå¹¶ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œæ‚¨å¯ä»¥å®‰å¿ƒã€‚å¯ä»¥å®šåˆ¶å·¥ä½œæµæ¥æ£€æŸ¥ yml æ–‡ä»¶ä¸­æè¿°ä¸ºæ­¥éª¤çš„ä¸åŒæµ‹è¯•ã€‚è¿™äº›æ£€æŸ¥å¯èƒ½æ˜¯ä½¿ç”¨ç¼–ç è¯­è¨€çš„æ­£ç¡®ç‰ˆæœ¬ã€å®‰è£…ä¾èµ–ï¼Œç”šè‡³æ˜¯æ£€æŸ¥ä»£ç æ ¼å¼å’Œè¯­æ³•é”™è¯¯ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‚¨å¯ä»¥ä¿è¯ä¸é‚£ä¹ˆæ‹…å¿ƒå°†ä»£ç åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸­â€”â€”è‡³å°‘ä¸ä¼šå‡ºç°ä»»ä½•é—®é¢˜ï¼

![](img/8abbe08a293cf861d464881b903c1db9.png)

[https://developer . sales force . com/blogs/2020/01/using-sales force-dx-with-github-actions . html](https://developer.salesforce.com/blogs/2020/01/using-salesforce-dx-with-github-actions.html)

æ‚¨å¯èƒ½æœ‰å¤šä¸ªå·¥ä½œæµï¼Œæ¯ä¸ªå·¥ä½œæµå¯èƒ½æœ‰å¤šä¸ªä½œä¸šã€‚å·¥ä½œæµæ¯æ¬¡éƒ½è¢«è§¦å‘ï¼Œ**æ¨é€åˆ°ä¸€ä¸ªç‰¹å®šçš„åˆ†æ”¯**ã€‚

# è®¾ç½® yml æ–‡ä»¶ä»¥ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬çš„ python

åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘å°†ä½¿ç”¨ä»¥ä¸‹å†…å®¹:

1.  pyenv-action ç”± Gabriel Falco å¼€å‘ï¼Œç”¨äºé€‰æ‹©æ­£ç¡®çš„ python ç‰ˆæœ¬ã€‚
2.  å°† Postgres é…ç½®ä¸ºæ•°æ®åº“çš„ Postgress docker æ˜ åƒã€‚
3.  Flak8 æ£€æŸ¥è¯­æ³•é”™è¯¯
4.  Pylint æ¥æ£€æŸ¥ä»£ç æ ¼å¼ã€‚

## é¦–å…ˆ:åˆå§‹åŒ– GitHub é¡¹ç›® repos

Github æ“ä½œå¯ä»¥åœ¨ç°æœ‰çš„å›è´­åè®®ä¸Šé…ç½®ï¼Œä¹Ÿå¯ä»¥ä»å¤´åˆ›å»ºä¸€ä¸ªã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä¼šä»å¤´å¼€å§‹ä¸€ä¸ªæ–°çš„ï¼›å¯¼èˆªåˆ° GitHubï¼Œæ–°å»ºä¸€ä¸ª repo å¹¶å‘½åï¼›æˆ‘å°†å®ƒå‘½åä¸º`github_actions`ã€‚ç„¶åå°† repo å…‹éš†åˆ°æ‚¨çš„æœ¬åœ°æœºå™¨ä¸Šï¼Œå¹¶åœ¨`.github/workflows/main.yml`ä¸Šåˆ›å»ºä¸€ä¸ª GitHub å·¥ä½œæµæ“ä½œæ–‡ä»¶â€”â€”è¿™æ˜¯å®šä¹‰æ­¥éª¤çš„åœ°æ–¹ã€‚

> æ‚¨å¯ä»¥ä½¿ç”¨ github workflows æ¨¡æ¿ï¼Œæ–¹æ³•æ˜¯è½¬åˆ° action tap å¹¶è§¦å‘ yml æ–‡ä»¶ã€‚

![](img/896b5dd30dd698ff133bd1efa5cf1d29.png)

Github repo ä¸Šçš„æ“ä½œé€‰é¡¹å¡â€”ä½œè€…å›¾ç‰‡

## ç¬¬äºŒ:å®šä¹‰é¡¹ç›®éœ€æ±‚ï¼›

æ‚¨å¯ä»¥é€šè¿‡åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥åŒ…å« requirements.txt æ–‡ä»¶:

```
$ pip freeze > requirements.txt
```

## ç¬¬ä¸‰:å®šä¹‰æ“ä½œä½œä¸š python ç‰ˆæœ¬:

æ¯ä¸ªå·¥ä½œæµå¯èƒ½æœ‰ä¸€ç»„ä½œä¸šï¼Œæ¯ä¸ªä½œä¸šåŒ…å«å‡ ä¸ªè¦æ‰§è¡Œçš„æ­¥éª¤ã€‚

æˆ‘ç”¨çš„æ˜¯ Gabrial å¼€å‘çš„ pyenv-action åŠ¨ä½œã€‚è¯¥æ“ä½œå°†æ‰§è¡Œä»¥ä¸‹æ“ä½œ:

*   å®‰è£… pyenv `1.2.21`ã€‚
*   å¯¼å‡º [PYENV_ROOT](https://github.com/pyenv/pyenv#environment-variables) ç¯å¢ƒå˜é‡ã€‚
*   åœ¨è·¯å¾„ä¸­æ³¨å…¥`$PYENV_ROOT/bin`ã€‚
*   åœ¨è·¯å¾„ä¸­æ³¨å…¥ [pyenv å«ç‰‡](https://github.com/pyenv/pyenv#understanding-shims)ã€‚
*   é¢„å®‰è£…æŒ‡å®šçš„ python ç‰ˆæœ¬ã€‚
*   è®¾ç½®é»˜è®¤ python ç‰ˆæœ¬(é€šè¿‡`pyenv local`)ã€‚â€” [pyenv-action](https://github.com/gabrielfalcao/pyenv-action)

æ‰“å¼€`main.yml`æ–‡ä»¶ï¼Œå¼€å§‹é…ç½® pyenv å¹¶é€‰æ‹©æ­£ç¡®çš„ python ç‰ˆæœ¬ã€‚ä»¥ä¸‹ä»£ç ç‰‡æ®µä½¿ç”¨ pyenv-action ç‰ˆæœ¬ 7 å®‰è£… pyenvï¼Œç„¶ååœ¨é€‰æ‹©ç‰ˆæœ¬ 3.8.6 åå‡çº§ pip å¹¶å°†å…¶è®¾ç½®ä¸ºé»˜è®¤ç‰ˆæœ¬ã€‚æ¥ä¸‹æ¥ï¼Œä½¿ç”¨é»˜è®¤ç‰ˆæœ¬åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œå¹¶å®‰è£…é¡¹ç›®ä¾èµ–é¡¹ã€‚

![](img/8769a38eeab494705986a04369ed54d1.png)

æˆåŠŸæ„å»ºâ€”ä½œè€…çš„å›¾åƒ

![](img/edca3bf39dff44013939c0c70f6dd13e.png)

è·å¾—æˆåŠŸæ„å»ºçš„å¥åº·ç»¿è‰²æ£€æŸ¥â€”å›¾ç‰‡ç”±ä½œè€…æä¾›

å®ƒæœ‰ä¸€ä¸ªæˆåŠŸçš„æ„å»ºï¼Œå¹¶ä¸”ä¼šå‡ºç°ä¸€ä¸ªä¸æäº¤ id ç›¸å…³è”çš„ç»¿è‰²å¥åº·æ£€æŸ¥ï¼Œå¦‚ä¸Šæ‰€ç¤ºã€‚

## å››:é…ç½® Postgres æœåŠ¡

ä¸ä¸Šä¸€æ­¥ç›¸åŒï¼›ä½†æ˜¯ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Postgres docker æ˜ åƒåœ¨æœåŠ¡éƒ¨åˆ†å®šä¹‰ Postgres æ•°æ®åº“è¿æ¥ã€‚ä¸€äº›è¿è¡ŒçŠ¶å†µæ£€æŸ¥è¢«é…ç½®ä¸ºç­‰å¾… Postgres å¯åŠ¨ã€‚æœ€åï¼Œç«¯å£ 5432 ä»æœåŠ¡å®¹å™¨æ˜ å°„åˆ°ä¸»æœºã€‚

![](img/8d4a09d2309cd9a21aac005ff9ef937e.png)

db_service æœåŠ¡å®¹å™¨å·²ç»æˆåŠŸæ„å»ºğŸ˜ã€‚

## äº”â€”å¯é€‰:é…ç½® pylint

åˆ©ç”¨ pylint å¯ä»¥æ£€æŸ¥æ¯ä¸ªæ¨é€åˆ°ä¸»åˆ†æ”¯çš„ä»£ç ç‰‡æ®µæ˜¯å¦æœ‰é”™è¯¯ï¼Œå¹¶å¼ºåˆ¶æ‰§è¡Œç¼–ç æ ‡å‡†ã€‚

> **Pylint æ˜¯ä¸€ä¸ªæ£€æŸ¥ Python ä»£ç ä¸­é”™è¯¯çš„å·¥å…·**ï¼Œè¯•å›¾æ‰§è¡Œä¸€ä¸ªç¼–ç æ ‡å‡†å¹¶å¯»æ‰¾ä»£ç æ°”å‘³ã€‚å®ƒè¿˜å¯ä»¥æŸ¥æ‰¾ç‰¹å®šçš„ç±»å‹é”™è¯¯ï¼Œå®ƒå¯ä»¥æ¨èå…³äºå¦‚ä½•é‡æ„ç‰¹å®šå—çš„å»ºè®®ï¼Œå¹¶ä¸”å¯ä»¥æä¾›å…³äºä»£ç å¤æ‚æ€§çš„ç»†èŠ‚ã€‚â€” [çš®æ—ç‰¹ 2 . 6 . 1-å¼€å‘ 1](http://pylint.pycqa.org/en/latest/#:~:text=Pylint%20is%20a%20tool%20that,details%20about%20the%20code's%20complexity.)

æˆ‘ä»¬å¯ä»¥åœ¨å®‰è£…å®Œéœ€æ±‚åå®‰è£… pylintï¼Œå¹¶è¿è¡Œ`pylint`ä½œä¸ºä¸‹ä¸€æ­¥

```
- name: Install dependencies run: pip install -r requirements.txt --upgrade pip pip install pylint- name: Analysing the code with pylint run: | pylint `ls -R|grep .py$|xargs`
```

![](img/6117318ad6ae2b42edb53d98b969e5c9.png)

æœ€ç»ˆçš„ main.yml æ–‡ä»¶å¯èƒ½å¦‚ä¸‹æ‰€ç¤º:

# æµ‹è¯•:å°†ä»£ç æ¨é€åˆ° Github repo

ç°åœ¨æ˜¯æ—¶å€™æ·»åŠ ä¸€äº›ä»£ç ï¼Œå¹¶å°è¯•å°†å…¶æ¨é€åˆ° GitHub åº“äº†ã€‚æˆ‘é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªæ¼”ç¤ºæ–‡ä»¶ï¼Œå¹¶å¼€å‘äº†ä¸€ç§ä»ä¸åŒå…ƒç´ å’Œå¤§å°çš„è¾“å…¥æ•°ç»„ä¸­ç”Ÿæˆéšæœºé‡‡æ ·çš„æ–¹æ³•ã€‚æ‰€æœ‰å­é›†çš„å¯èƒ½æ€§åº”è¯¥ç›¸ç­‰ã€‚

ä¸‹ä¸€æ­¥æ˜¯ä½¿ç”¨ pull è¯·æ±‚æˆ–ç›´æ¥ push to master æäº¤å’Œæ¨é€ Github å­˜å‚¨åº“å˜æ›´ã€‚ä¸€æ—¦å¯¹é¥æ§å™¨è¿›è¡Œäº†æ›´æ”¹ï¼Œåœ¨å°†æ›´æ”¹åˆå¹¶åˆ° master ä¹‹å‰ï¼Œå°†é’ˆå¯¹è¿™äº›æ›´æ”¹è¿è¡Œä¸åŒçš„æµ‹è¯•ã€‚

![](img/a57c2ca6c697bd25d9ff2a3e90f78267.png)

ä¸æˆåŠŸçš„æ„å»ºâ€”ä½œè€…çš„å›¾åƒ

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ ¹æ® pylint åŒ…ï¼Œç”±äºä¸é€‚å½“çš„æ ¼å¼åŒ–ï¼Œäº§ç”Ÿäº†ä¸€ä¸ªé”™è¯¯ï¼›æœ‰äº›é”™è¯¯æ˜¯å› ä¸ºæˆ‘æ²¡æœ‰éµå¾ª snake_case å‘½åçº¦å®šã€‚å¦‚æ‚¨æ‰€è§ï¼Œæ¨é€ä»£ç çš„æ¯”ç‡ä¸º 4.29/10ã€‚

> å¦‚æœæ‚¨æƒ³å¿½ç•¥ **pylint å¯¹ docstring** çš„æ£€æŸ¥ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸º`.pylint`çš„æ–°æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ç‰‡æ®µæ¥å¿½ç•¥ docstring æ¨¡å—ã€‚
> 
> **ã€MASTERã€‘
> disable =
> c 0114ï¼Œ# missing-module-docstring**

ç°åœ¨ï¼Œåœ¨åˆ›å»º pylint æ–‡ä»¶ä¹‹åï¼Œæäº¤å¹¶æ¨é€ Github å­˜å‚¨åº“æ›´æ”¹ï¼Œæ„å»ºåº”è¯¥ä¼šæˆåŠŸï¼Œå¹¶ä¸”åœ¨ repo é™„è¿‘ä¼šå‡ºç°ä¸€ä¸ªå¥åº·çš„ç»¿è‰²å¤é€‰æ ‡è®°ğŸ˜ã€‚

![](img/84f4112bcada255fe3dd242b06142251.png)

æˆåŠŸæ„å»ºâ€”ä½œè€…çš„å›¾åƒ

# ç»“è®ºå’Œè¦ç‚¹

Github action æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ’ä»¶ï¼Œå®ƒä½¿æœºå™¨å­¦ä¹ å¼€å‘å‘¨æœŸè‡ªåŠ¨åŒ–ã€‚æ‚¨å¯ä»¥å‘å·¥ä½œæµæ·»åŠ æ›´å¤šçš„æ­¥éª¤å’Œå·¥ä½œï¼ŒåŒ…æ‹¬éƒ¨ç½²åˆ°ä¸åŒçš„å¹³å°ï¼Œå¦‚ Iaasã€Paasã€Saas å’Œç°åœºã€‚æ­¤å¤–ï¼Œå®ƒå…è®¸æ‚¨ä½¿ç”¨ docker å®¹å™¨ä»¥åŠ Kubernetesã€‚æœ‰å¾ˆå¤š GitHub-actions æ˜¯ç”±ç¤¾åŒºçš„å¸‚åœºæ„å»ºçš„ï¼›å¦‚æœä½ æœ‰ç¼–ç¨‹èƒŒæ™¯æˆ–è€…éµå¾ªæ–‡æ¡£ï¼Œä½ ç”šè‡³å¯ä»¥åˆ›å»ºä½ çš„ [**å®šåˆ¶åŠ¨ä½œ**](https://docs.github.com/en/free-pro-team@latest/actions/learn-github-actions/finding-and-customizing-actions) ã€‚

å¸®åŠ©æˆ‘é…ç½®æ­¤å·¥ä½œæµçš„ä¸€äº›å‚è€ƒèµ„æ–™æ˜¯:

1.  [Github åŠ¨ä½œçš„å·¥ä½œæµè¯­æ³•](https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#on)
2.  [Postgresql Github åŠ¨ä½œ](https://github.com/Harmon758/postgresql-action)ç”± [Harmon](https://github.com/Harmon758)
3.  [Github åŠ¨ä½œæ–‡æ¡£â€”ç¯å¢ƒå˜é‡](https://docs.github.com/en/free-pro-team@latest/actions/reference/environment-variables)
4.  [å­¦ä¹  Github åŠ¨ä½œ](https://docs.github.com/en/free-pro-team@latest/actions/learn-github-actions)
5.  [Pyenv-è¡ŒåŠ¨](https://github.com/gabrielfalcao/pyenv-action)ç”±[åŠ å¸ƒé‡ŒåŸƒå°”Â·æ³•å°”ç§‘](https://github.com/gabrielfalcao)
6.  [çš®æ—ç‰¹æ–‡ä»¶](http://pylint.pycqa.org/en/latest/#:~:text=Pylint%20is%20a%20tool%20that,details%20about%20the%20code's%20complexity.)

æœ€åï¼Œæˆ‘å¸Œæœ›è¿™ä¸ºåˆ©ç”¨ GitHub åŠ¨ä½œè‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ é¡¹ç›®æä¾›äº†å…¨é¢çš„æŒ‡å¯¼ã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·å‘è¡¨åœ¨ä¸‹é¢çš„è¯„è®ºåŒºï¼›æˆ‘éå¸¸ä¹æ„å¸®å¿™ã€‚æ„Ÿè°¢é˜…è¯»å’Œå¿«ä¹å­¦ä¹ ğŸ‘