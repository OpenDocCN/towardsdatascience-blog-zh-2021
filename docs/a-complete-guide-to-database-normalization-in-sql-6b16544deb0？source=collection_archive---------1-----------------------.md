# SQL æ•°æ®åº“è§„èŒƒåŒ–å®Œå…¨æŒ‡å—

> åŸæ–‡ï¼š<https://towardsdatascience.com/a-complete-guide-to-database-normalization-in-sql-6b16544deb0?source=collection_archive---------1----------------------->

## ä½¿ç”¨ PostgreSQL æ­£é¢å¤„ç†æ··ä¹±çš„è¡¨æ ¼ã€‚

![](img/4e1b506aa4509f5a36852b2459925e0e.png)

è¨å§†Â·ç©†å¡è¾¾å§†åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹æ‘„çš„ç…§ç‰‡

å‡è®¾æ‚¨åˆšåˆšè¢«è¦æ±‚ç®¡ç†å…¬å¸çš„å…³ç³»æ•°æ®åº“ç³»ç»Ÿã€‚ä¸ºäº†ç»™äººç•™ä¸‹æ·±åˆ»å°è±¡ï¼Œæ‚¨å¾ˆå¿«è¿è¡Œäº†å‡ ä¸ªåˆå§‹æŸ¥è¯¢æ¥ç†Ÿæ‚‰æ•°æ®â€¦å´å‘ç°è¡¨æ ¼æ‚ä¹±æ— ç« ã€‚

ä½ å†»åƒµäº†ã€‚æ‚¨æ‹…å¿ƒä¸ä¸€è‡´çš„ä¾èµ–å…³ç³»å¯èƒ½ä¼šå¯¹æœªæ¥çš„æ•°æ®æ“ä½œæŸ¥è¯¢å’Œé•¿æœŸåˆ†æäº§ç”Ÿè´Ÿé¢å½±å“ã€‚ä½†æ˜¯æ‚¨ä¹Ÿä¸ç¡®å®šé‡‡å–ä»€ä¹ˆæ­¥éª¤æ¥æ­£ç¡®åœ°é‡æ–°è®¾è®¡è¡¨æ ¼ã€‚çªç„¶ï¼Œä¸€ç§ä¸å—æ¬¢è¿çš„å†²åŠ¨å¼€å§‹å›°æ‰°ä½ ï¼Œé‚£å°±æ˜¯ç¿»çœ‹ä½ å¾ˆä¹…ä»¥å‰ä¸Šè¿‡çš„æ•°æ®åº“ç®¡ç†è¯¾ç¨‹çš„ç¬”è®°ã€‚

å¬èµ·æ¥ç†Ÿæ‚‰å—ï¼Ÿ

ä¸è¦æƒŠæ…Œã€‚ä½ æ˜¯å¦ç»§æ‰¿äº†ä¸€ä¸ªæ‚ä¹±çš„æ•°æ®åº“ï¼Œæ— æ„é—´åˆæˆäº†ä¸€ä¸ªå®Œæ•´æ€§å¾ˆå·®çš„(å‘œå‘œï¼ğŸ˜¬)ï¼Œæˆ–è€…æƒ³å®Œå…¨é¿å…ä¸Šè¿°æƒ…å†µï¼Œ**æ•°æ®åº“è§„èŒƒåŒ–**æ˜¯æ‚¨çš„è§£å†³æ–¹æ¡ˆã€‚

# ä»€ä¹ˆæ˜¯æ•°æ®åº“è§„èŒƒåŒ–ï¼Ÿ

æ ¹æ®[ç»´åŸºç™¾ç§‘](https://en.wikipedia.org/wiki/Database_normalization)ä¸Šçš„æ•°æ®åº“è§„èŒƒåŒ–é¡µé¢:

> â€œè§„èŒƒåŒ–éœ€è¦ç»„ç»‡æ•°æ®åº“çš„åˆ—(å±æ€§)å’Œè¡¨(å…³ç³»),ä»¥ç¡®ä¿å®ƒä»¬çš„ä¾èµ–å…³ç³»ç”±æ•°æ®åº“å®Œæ•´æ€§çº¦æŸæ¥æ­£ç¡®å®æ–½ã€‚â€

å‘€ã€‚

ä¸è¦è®©è¿™äº›ç±»å‹çš„å®šä¹‰å“è·‘ä½ ã€‚ç®€å•åœ°è¯´ï¼Œè¿™æ„å‘³ç€**è§„èŒƒåŒ–æ˜¯åˆ›å»ºæœ€é«˜æ•ˆçš„å…³ç³»æ•°æ®åº“çš„è¿‡ç¨‹ã€‚**æœ¬è´¨ä¸Šï¼Œåº”è¯¥ç»„ç»‡æ•°æ®åº“ä»¥å‡å°‘å†—ä½™å¹¶é¿å…ä¾èµ–æ€§å¼‚å¸¸ã€‚

æ›´ç®€å•åœ°è¯´ï¼Œ*ä½ çš„æ•°æ®åº“ç»“æ„åº”è¯¥æœ‰ç›´è§‚çš„æ„ä¹‰ã€‚*å¦‚æœä½ çš„åŒäº‹å®³æ€•åœ¨ä½¿ç”¨ä½ åˆ›å»ºçš„æ•°æ®åº“æ—¶çŠ¯è‡´å‘½é”™è¯¯ï¼Œå³ä½¿ä½ å·²ç»å‘ä»–ä»¬è§£é‡Šäº†ï¼Œä½ çš„æ•°æ®åº“å¯èƒ½è¿˜æ²¡æœ‰è§„èŒƒåŒ–ã€‚

è¿™äº›è§„èŒƒåŒ–ç†å¿µå¯ä»¥åº”ç”¨äºæ•°æ®åº“**åˆæˆ**(ä»å¤´å¼€å§‹åˆ›å»ºæ•°æ®åº“)æˆ–**åˆ†è§£**(æ”¹è¿›ç°æœ‰è®¾è®¡)ã€‚

# ä»€ä¹ˆæ˜¯èŒƒå¼ï¼Ÿ

Giphy çš„ Gif

â€œè§„èŒƒåŒ–â€æ˜¯ä¸€ä¸ªå®½æ³›çš„æ¦‚å¿µï¼Œå½“æ‚¨è¿·å¤±åœ¨æ— æ•°æ‚ä¹±çš„è¡¨æ ¼ä¸­æ—¶ï¼Œå®ƒæ²¡æœ‰å¤ªå¤šçš„å®é™…ç”¨é€”ã€‚ä¸ºäº†ç»™è¿™ä¸ªè¿‡ç¨‹å¢åŠ å…·ä½“çš„æ­¥éª¤ï¼ŒåŸƒå¾·åŠ Â·fÂ·ç§‘å¾·åˆ¶å®šäº†è¯¦ç»†çš„æ­£å¼è§„åˆ™ã€‚

Codd çš„è§„èŒƒåŒ–æŒ‡å—æœ‰äº”ç§æ­£å¼çš„èŒƒå¼ï¼Œä½†æ˜¯(è°¢å¤©è°¢åœ°)å‰ä¸‰ç§é€šå¸¸å’Œä½ éœ€è¦çš„ä¸€æ ·æ·±å…¥ã€‚è®©æˆ‘ä»¬åœ¨è¿™é‡Œç®€å•å›é¡¾ä¸€ä¸‹:

## ç¬¬ä¸€èŒƒå¼(1NF)

è¿™ä¸€ç»„åˆå§‹è§„åˆ™ä¸ºä¿æŒæ•°æ®åº“çš„åˆç†ç»„ç»‡è®¾ç½®äº†åŸºæœ¬å‡†åˆ™ã€‚

*   åˆ é™¤ä»»ä½•é‡å¤çš„æ•°æ®ç»„*(å³æ³¨æ„åŒä¸€è¡¨æ ¼ä¸­é‡å¤çš„åˆ—æˆ–è¡Œ)*
*   ä¸ºæ¯ç»„ç›¸å…³æ•°æ®åˆ›å»ºå•ç‹¬çš„è¡¨
*   æ¯ä¸ªè¡¨åº”è¯¥æœ‰ä¸€ä¸ªä¸»é”®(*ï¼Œå³ä¸€ä¸ªç”¨éç©ºçš„å”¯ä¸€å€¼*æ ‡è¯†æ¯ä¸€è¡Œçš„å­—æ®µ)

## ç¬¬äºŒèŒƒå¼(2NF)

ä¸‹ä¸€ç»„è§„åˆ™å»ºç«‹åœ¨ 1NF ä¸­æ¦‚è¿°çš„è§„åˆ™ä¹‹ä¸Šã€‚

*   æ»¡è¶³ 1NF çš„æ‰€æœ‰è§„åˆ™
*   åˆ é™¤ä¸ä¾èµ–äºè¡¨ä¸»é”®çš„æ•°æ®*(å°†æ•°æ®ç§»åŠ¨åˆ°é€‚å½“çš„è¡¨æˆ–åˆ›å»ºæ–°çš„è¡¨å’Œä¸»é”®)*
*   å¤–é”®ç”¨äºæ ‡è¯†è¡¨å…³ç³»

## ç¬¬ä¸‰èŒƒå¼(3NF)

è¿™ç»„è§„åˆ™å°† 1NF å’Œ 2NF ä¸­æ¦‚è¿°çš„è§„åˆ™å‘å‰æ¨è¿›äº†ä¸€æ­¥ã€‚

*   æ»¡è¶³ 1NF å’Œ 2NF çš„æ‰€æœ‰è§„åˆ™
*   åˆ é™¤ä¾èµ–äºå…¶ä»–éé”®å±æ€§çš„å±æ€§*(å³åˆ é™¤ä¾èµ–äºéå¤–é”®æˆ–ä¸»é”®çš„åˆ—çš„åˆ—)*

# ä½ ä¸ºä»€ä¹ˆè¦åœ¨ä¹ï¼Ÿ

Giphy çš„ Gif

æ˜¯çš„ï¼Œé«˜ç«¯æ•°æ®åº“è§„èŒƒåŒ–é€šå¸¸è¢«è®¤ä¸ºæ˜¯ä¸€ç§å¥¢ä¾ˆï¼Œè€Œä¸æ˜¯ç»å¯¹çš„éœ€æ±‚ã€‚ä½†æ˜¯ï¼Œå³ä½¿æ˜¯æœç€æ­£ç¡®æ–¹å‘è¿ˆå‡ºçš„ä¸€å°æ­¥ï¼Œä¹Ÿæœ‰åŠ©äºé¿å…æ•°æ®å®Œæ•´æ€§éšç€æ—¶é—´çš„æ¨ç§»è€Œæ…¢æ…¢é€€åŒ–ã€‚

> ç¡®ä¿æ‚¨çš„æ•°æ®åº“ä¾èµ–å…³ç³»æœ‰é€»è¾‘æ„ä¹‰å¹¶ä¸”å†—ä½™è¢«æœ€å°åŒ–ï¼ŒåŒæ ·ä¹Ÿç¡®ä¿äº†æœ€å¤§ç¨‹åº¦çš„æœ‰æ´å¯ŸåŠ›çš„æŸ¥è¯¢å’Œåˆ†æã€‚

è§„èŒƒåŒ–è¿˜å¯ä»¥é˜²æ­¢æ•°æ®æ“ä½œ(æ¯”å¦‚åˆ é™¤ã€æ’å…¥å’Œæ›´æ–°)å¼‚å¸¸ã€‚å¦‚æœä¾èµ–å…³ç³»æ²¡æœ‰è¢«è§„èŒƒåŒ–ï¼Œæ‚¨å°†å†’å…è®¸éƒ¨åˆ†æ›´æ–°(å› æ­¤ï¼Œéƒ¨åˆ†ä¸æ­£ç¡®)æ•°æ®çš„é£é™©ã€‚éƒ¨åˆ†ä¸æ­£ç¡®çš„æ•°æ®=éƒ¨åˆ†ä¸æ­£ç¡®çš„æŸ¥è¯¢ç»“æœã€‚

# æ•°æ®åº“è§„èŒƒåŒ–ç¤ºä¾‹

ä¸ºäº†å……åˆ†ç†è§£è¿™äº›æŠ½è±¡çš„å®šä¹‰ï¼Œè®©æˆ‘ä»¬ç”¨ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥å›é¡¾ä¸€ä¸‹æ¯ä¸ªèŒƒå¼ã€‚åœ¨æ•´ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†å…³æ³¨äº*åˆ†è§£*ï¼Œä½†æ˜¯è¿™äº›æ¦‚å¿µä»ç„¶é€‚ç”¨äºåŸºäºåˆæˆçš„é¡¹ç›®ã€‚

å¯¹äºè¿™äº›ä¾‹å­ï¼Œæˆ‘ä¸ªäººä½¿ç”¨äº† [PostgreSQL](https://www.postgresql.org/) (ä¸€ä¸ªæµè¡Œçš„å¼€æºå…³ç³»æ•°æ®åº“)å’Œå®ƒçš„å¼€å‘å¹³å°å¯¹åº”ç‰© [pgAdmin](https://www.pgadmin.org/) ã€‚ä½†æ˜¯ï¼ŒåŒæ ·ï¼Œå¦‚æœæ‚¨å–œæ¬¢æ›¿ä»£çš„ SQL æœåŠ¡å™¨ï¼Œå¦‚ [MySQL](http://mysql.com) æˆ– [Oracle](https://www.oracle.com/database/) ï¼Œæ‚¨å¯ä»¥å°†è¿™é‡Œè®¨è®ºçš„æŠ€æœ¯ç§»æ¤åˆ°æ‚¨é€‰æ‹©çš„å¹³å°ä¸Šã€‚

å¦‚æœæ‚¨å¯¹è¿™äº›å·¥å…·å®Œå…¨ä¸ç†Ÿæ‚‰ï¼Œè¯·å‚è€ƒæä¾›çš„ç½‘ç«™çš„æ¦‚è¿°å’ŒæŒ‡å¯¼ä¿¡æ¯ï¼Œæˆ–è€… PostgreSQL/pgAdmin ä¸Šçš„æ•°æ®ç§‘å­¦æ–‡ç« ï¼Œå¦‚æœ¬ [one](/sql-cheat-sheet-776f8e3189fa) æˆ– [one](/a-practical-guide-to-getting-set-up-with-postgresql-a1bf37a0cfd7) ã€‚

## æ•°æ®

è®©æˆ‘ä»¬å‡è®¾ä½ è¢«ä¸€å®¶å…¬å¸é›‡ä½£ï¼Œè¿™å®¶å…¬å¸æœ‰ä¸€ä¸ªæ•°æ®åº“ï¼Œé‡Œé¢æœ‰ä½äºåŠ åˆ©ç¦å°¼äºšçš„æ²»ç–—å¸ˆçš„ä¿¡æ¯ã€‚å‡ºäºæœ¬æ•™ç¨‹çš„ç›®çš„ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªæ¨¡æ‹Ÿçš„ PostgreSQL æ•°æ®åº“ï¼Œé€šè¿‡ pgAdmin æ‰˜ç®¡ï¼Œå…¶ä¸­çš„æ•°æ®è¯•å›¾æ¨¡æ‹Ÿä¸€ä¸ªç±»ä¼¼çš„çœŸå®æ•°æ®åº“å¯èƒ½åŒ…å«çš„ä¸€å°éƒ¨åˆ†å†…å®¹ã€‚è¯¥æ•°æ®åº“åŒ…å«ä»¥ä¸‹è¡¨æ ¼:

![](img/2a9c4eaa5667c7cdad8537fe103771b0.png)

åŸå§‹æ•°æ®åº“æ¨¡å¼

ä»è¡¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æœ‰ä¸€ç³»åˆ—ä¸æ²»ç–—å¸ˆæœ‰å…³çš„å˜é‡ï¼Œä»–ä»¬åœ¨å“ªé‡Œå·¥ä½œï¼Œä»–ä»¬æ“…é•¿ä»€ä¹ˆï¼Œä»¥åŠæˆ‘ä»¬å¦‚ä½•è”ç³»ä»–ä»¬ã€‚

åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰ï¼Œå…ˆæµè§ˆä¸€ä¸‹å¯ç”¨æ•°æ®æœ¬èº«ã€‚åˆ†è§£ä¹‹å‰ä¸€å®šè¦ä»”ç»†æ£€æŸ¥ä½ çš„å€¼- *ä¸è¦å‡è®¾ä½ åªé€šè¿‡åˆ—åå°±çŸ¥é“è¡¨ä¸­æœ‰ä»€ä¹ˆã€‚*

![](img/c979e8f722c0fd432c7635fb0c691e5b.png)![](img/03203221ee838ef3b0a2ea9e5d2c242e.png)

æˆ‘ä»¬å°†åœ¨æ•´ä¸ªæ•™ç¨‹ä¸­ç»§ç»­ä½¿ç”¨è¿™äº›åˆæˆè¡¨ã€‚å¦‚æœæ‚¨æƒ³æŸ¥çœ‹ç”¨äºåˆ›å»ºå’Œå¡«å……è¿™äº›è¡¨çš„åŸå§‹ SQL è¯­æ³•ï¼Œè¯·è®¿é—®æˆ‘çš„ GitHub é¡¹ç›®æŠ¥å‘Š[è¿™é‡Œ](https://github.com/emiburns/complete_guide_to_database_normalization_in_SQL)ã€‚è¿˜è¯·è®°ä½**æ­¤å¤„ä½¿ç”¨çš„æ‰€æœ‰åˆæˆæ•°æ®ä»…ç”¨äºæ¼”ç¤ºç›®çš„**ï¼Œå¹¶ä¸èƒ½å‡†ç¡®ä»£è¡¨åŠ å·åŒ»é™¢ã€æ²»ç–—å¸ˆäººå£ç»Ÿè®¡æ•°æ®æˆ–å…¸å‹çš„æ•°æ®é›†è§„æ¨¡(æ‚¨å¯èƒ½å·²ç»çŸ¥é“ï¼ŒSQL é€šå¸¸ç”¨äºå¤§æ•°æ®é¡¹ç›®ï¼Œè€Œä¸æ˜¯æ€»å…±æœ‰ 20 è¡Œçš„è¡¨æ ¼)ã€‚

## æœ€åˆçš„è¯¢é—®

ä½¿ç”¨ä¸Šé¢æ˜¾ç¤ºçš„æ•°æ®åº“ï¼Œæ‚¨çš„å…¬å¸å¸Œæœ›æ‚¨è¿è¡Œä¸€ä¸ªæŸ¥è¯¢:

> ç¡®å®šåŒ—åŠ å·ä¸“é—¨æ²»ç–—æƒ…ç»ªéšœç¢çš„æ²»ç–—å¸ˆçš„æ•°é‡ï¼Œä»¥åŠè¿™äº›æ²»ç–—å¸ˆä¸­ï¼Œæœ‰å¤šå°‘ç›®å‰æ­£åœ¨æ¥å—æ–°ç—…äººã€‚

ç„¶è€Œï¼Œåœ¨æŸ¥çœ‹äº†è¿™äº›è¡¨ä¹‹åï¼Œæ‚¨ä¼šå‘ç°å°è¯•å‡†ç¡®çš„æŸ¥è¯¢å¯èƒ½æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚è¿™ä¸¤ä¸ªè¡¨ä¹‹é—´çš„å…³ç³»å°šæœªå»ºç«‹ï¼Œä¼¼ä¹æœ‰å†—ä½™ä¿¡æ¯ã€‚åœ¨è¿è¡Œè¯·æ±‚çš„æŸ¥è¯¢ä¹‹å‰ï¼Œæ‚¨å¿…é¡»è¿›è¡Œä¸€äº›åˆ†è§£ã€‚

## 1NF

å›æƒ³ä¸€ä¸‹ï¼Œè§„èŒƒåŒ–çš„ç¬¬ä¸€æ­¥(1NF)æ¶‰åŠæ­£ç¡®çš„è¡Œæ ‡è¯†å’Œæ­£ç¡®çš„æ•°æ®åˆ†ç»„ã€‚

æˆ‘ä»¬å…ˆæ¥è¡¥æ•‘ä¸€ä¸‹ä¸¤ä¸ªè¡¨çš„å…³ç³»:*æ²»ç–—å¸ˆ _ ç›®å½•*(çˆ¶è¡¨)å’Œ*åŒ»é™¢*(å­è¡¨)ã€‚*æ²»ç–—å¸ˆ _ ç›®å½•*å·²ç»æœ‰ä¸€ä¸ªä¸»é”®(â€œæ²»ç–—å¸ˆ _idâ€)ï¼Œä½†æ˜¯*åŒ»é™¢*ç¼ºå°‘ä¸»é”®å’Œå¤–é”®ã€‚æˆ‘ä»¬å¯ä»¥ç”¨åºåˆ—å’Œä¸»é”®è§„èŒƒä¸º*åŒ»é™¢*æ·»åŠ ä¸€ä¸ªé€’å¢çš„ä¸»é”®:

```
ALTER TABLE hospitals ADD COLUMN hospital_id SERIAL PRIMARY KEY;
```

æ·»åŠ ä¸€ä¸ªå¤–é”®å°†éœ€è¦ä»*æ²»ç–—å¸ˆç›®å½•*è¡¨ä¸­æå–ä¿¡æ¯ï¼Œä»¥å°†å…¶ä¸*åŒ»é™¢*å‡†ç¡®é“¾æ¥ã€‚å°½ç®¡*åŒ»é™¢*è¡¨ä¸­çš„â€œæ²»ç–—å¸ˆâ€åˆ—æœ‰æ¯ä¸ªæ²»ç–—å¸ˆçš„å§“åï¼Œä½†è¿™å¹¶ä¸æ˜¯ç†æƒ³çš„å¤–é”®ï¼Œå› ä¸ºæ­£å¦‚æ‚¨å°†åœ¨æ¥ä¸‹æ¥çš„æ­¥éª¤ä¸­çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬å°†æ›´æ–°*æ²»ç–—å¸ˆ _ ç›®å½•*ä¸­ç›¸åº”çš„â€œå§“åâ€åˆ—ã€‚ç›¸åï¼Œä¸ºäº†ä¸€è‡´èµ·è§ï¼Œè®©æˆ‘ä»¬å°†æ²»ç–—å¸ˆçš„ id æ·»åŠ åˆ°*åŒ»é™¢*ä¸­ã€‚

```
UPDATE hospital h 
SET therapist_id = td.therapist_id
FROM therapist_directory td
WHERE td.name = h.therapist;
```

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ–°åŒ»é™¢ä¸­åŒ…å«çš„â€œtherapist_idâ€åˆ—ï¼Œä»¥è¡¨æ˜å®ƒæ˜¯ä¸€ä¸ªå¤–é”®ï¼Œä»è€Œå‡†ç¡®åœ°é“¾æ¥æ•°æ®åº“ä¸­çš„è¡¨ã€‚å› æ­¤ï¼Œä»*åŒ»é™¢*ä¸­åˆ é™¤â€œæ²»ç–—å¸ˆâ€ä¸€æ ä¹Ÿå°†ç¡®ä¿è¡¨æ ¼ä¸­çš„æ•°æ®ä¸æ²»ç–—å¸ˆçš„å·¥ä½œåœ°ç‚¹ç‰¹åˆ«ç›¸å…³ã€‚

```
ALTER TABLE hospitals
    ADD CONSTRAINT fk_therapist_directory
    FOREIGN KEY (therapist_id)
    REFERENCES therapist_directory(therapist_id);
```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬è§£å†³è¡¨ä¸­å‡ºç°çš„å†—ä½™ä¿¡æ¯ã€‚

å†æ¬¡å¼•ç”¨æ•°æ®åï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼Œä¸ºäº†ä½¿æ•°æ®ä¿æŒæœ€ç®€åŒ–çš„å½¢å¼ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ SUBSTRING()å°†*æ²»ç–—å¸ˆ _ ç›®å½•*çš„â€œå§“åâ€åˆ—æ‹†åˆ†ä¸ºåå­—å’Œå§“æ°åˆ—ã€‚

```
/* make new last_name column */
ALTER TABLE therapist_directory ADD COLUMN last_name VARCHAR(30); /* add last name values to last_name */
UPDATE therapist_directory
SET last_name = 
    SUBSTRING(name, POSITION(' ' IN name)+1,   LENGTH(name)); /* update name column to first_name */
ALTER TABLE therapist_directory 
RENAME COLUMN name TO first_name; /* remove last name substring from first_name */
UPDATE therapist_directory
SET first_name = 
    SUBSTRING(first_name, 1, POSITION(' ' IN first_name)-1);
```

*æ²»ç–—å¸ˆ _ ç›®å½•*è¡¨ä¸­ä¹Ÿæœ‰é‡å¤çš„æ•°æ®ç»„(â€œä¸“ä¸š _ ä¸€â€ã€â€œä¸“ä¸š _ äºŒâ€ã€â€œä¸“ä¸š _ ä¸‰â€)ã€‚æˆ‘ä»¬å°†æŠŠè¿™äº›å˜é‡ç§»åˆ°å®ƒä»¬è‡ªå·±çš„è¡¨ä¸­ã€‚*ä¸è¦å¿˜è®°ç»™æ–°è¡¨æ·»åŠ ä¸€ä¸ªä¸»é”®å’Œå¤–é”®ï¼*(å‚è§ GitHub [æ­¤å¤„](https://github.com/emiburns/complete_guide_to_database_normalization_in_SQL)äº†è§£ä½¿ç”¨çš„å…¨éƒ¨ SQL)ã€‚

```
CREATE TABLE IF NOT EXISTS specialties( 
    specialties_key serial PRIMARY KEY, 
    speciality_one VARCHAR(100),  
    speciality_two VARCHAR(100),  
    speciality_three VARCHAR(100), 
    therapist_id INTEGER, 
    CONSTRAINT fk_therapist      
        FOREIGN KEY(therapist_id)    
        REFERENCES therapist_directory(therapist_id));
```

ç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ•°æ®åº“æ¨¡å¼ã€‚

![](img/00acaaaab405bdb369b0c8943fdbcea1.png)

åˆ°ç›®å‰ä¸ºæ­¢ä¸€åˆ‡çœ‹èµ·æ¥éƒ½å¾ˆå¥½ã€‚æ˜¯æ—¶å€™å» 2NF äº†ã€‚

## 2NF

å›æƒ³ä¸€ä¸‹ï¼Œç¬¬äºŒç§èŒƒå¼æ¶‰åŠåˆ é™¤ä¸ä¸»é”®æ— å…³çš„æ•°æ®ï¼Œå¹¶å»ºç«‹å¤–é”®æ¥å·©å›ºè¡¨å…³ç³»ã€‚

å› ä¸ºæˆ‘ä»¬æ‰€æœ‰çš„è¡¨ç›®å‰éƒ½æœ‰å¤–é”®(ä¸‡å²ï¼)ï¼Œæˆ‘ä»¬å¯ä»¥é‡ç‚¹è¯†åˆ«ä¸ç›¸å…³çš„æ•°æ®ã€‚

åœ¨*æ²»ç–—å¸ˆç›®å½•*ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸‰åˆ—ä¸â€œæ²»ç–—å¸ˆ idâ€ä¸»é”®ä¸åŒ¹é…:**ä¿é™©ã€æ–°æ‚£è€…å’Œç”µè¯**ã€‚â€œä¿é™©â€å’Œâ€œæ–°ç—…äººâ€å¹¶æ²¡æœ‰æŒ‡æ˜æ¯ä¸ªæ²»ç–—å¸ˆæ˜¯è°ã€‚ç›¸åï¼Œæ¯ä¸ªäººéƒ½æŒ‡å‡ºäº†é€‰æ‹©æ²»ç–—å¸ˆæ—¶è¦è€ƒè™‘çš„è®¿é—®è§„èŒƒã€‚

è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬å°†è¿™ä¸¤ä¸ªå˜é‡ç§»åˆ°å®ƒä»¬è‡ªå·±çš„åä¸º *visit_specifications* çš„è¡¨ä¸­ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å†æ¬¡ä½¿ç”¨ CREATE TABLE è¯­æ³•æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚å¹¶ä¸”ï¼Œè¯·è®°ä½ï¼Œåªè¦è¡¨æ˜¯ä»¥ä¸€å¯¹ä¸€çš„å…³ç³»è¿æ¥çš„ï¼Œé‚£ä¹ˆå¦‚æœä¸€ä¸ªåˆ—åŒæ—¶ä½œä¸ºä¸»é”®å’Œå¤–é”®ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚

```
CREATE TABLE IF NOT EXISTS visit_specifications( 
    therapist_id INTEGER PRIMARY KEY, 
    insurance VARCHAR(3) CHECK(insurance IN ('Yes', 'No')),        
    new_patients VARCHAR(3) CHECK(insurance IN ('Yes', 'No')),    
    CONSTRAINT fk_visits      
        FOREIGN KEY(therapist_id)    
        REFERENCES therapist_directory(therapist_id));
```

å¤ªå¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬åœ¨*æ²»ç–—å¸ˆ _ ç›®å½•*é‡Œåªå‰©ä¸‹ä¸€ä¸ªä¸ç›¸å…³çš„æ ç›®:**ç”µè¯**ã€‚ä»”ç»†çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åˆ—å‡ºçš„å·ç å®é™…ä¸Šæ˜¯åŒ»é™¢çš„ç”µè¯å·ç ï¼Œè€Œä¸æ˜¯æ¯ä¸ªæ²»ç–—å¸ˆçš„ä¸ªäººè”ç³»ä¿¡æ¯ã€‚

![](img/5885df2a1807a40bb93a877d31f8199a.png)

æˆ‘ä»¬å¯ä»¥ç»§ç»­å°†ç”µè¯å·ç æ·»åŠ åˆ°æ›´åˆé€‚çš„*åŒ»é™¢*è¡¨ä¸­ï¼Œä½†æ˜¯è¿™ç§ä¿®æ”¹ä¼šè¿å 3NFï¼è®©æˆ‘ä»¬è½¬åˆ°ç¬¬ä¸‰èŒƒå¼æ¥è¯¦ç»†è§£é‡Šä¸ºä»€ä¹ˆä¼šè¿™æ ·ã€‚

## 3NF

å›æƒ³ä¸€ä¸‹ï¼Œç¬¬ä¸‰ç§èŒƒå¼æ¶‰åŠåˆ é™¤ä¾èµ–äºåˆ—çš„**ã€‚**

â€¦è¿™å®é™…ä¸Šæ„å‘³ç€ä»€ä¹ˆï¼ŸğŸ¤¨

è®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥åœ°çœ‹â€œphoneâ€åˆ—çš„ä¾‹å­æ¥ç†è§£è¿™ä¸ªéœ€æ±‚ã€‚

å¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å¯ä»¥å°†â€œphoneâ€åˆ—æ·»åŠ åˆ°*åŒ»é™¢*è¡¨ä¸­ï¼Œä»¥æ›´å¥½åœ°åŒ¹é…â€œhospital_idâ€ä¸»é”®ã€‚ç„¶è€Œï¼Œç”µè¯å·ç å€¼å°†å–å†³äºâ€œhospital _ idâ€*å’Œ*åŒ»é™¢æ‰€åœ¨çš„åŸå¸‚ã€‚è®©æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ä¸Šä¸€ä¸ªæŸ¥è¯¢è¿”å›çš„æ•°æ®:

![](img/60df286265dd8ff2102d864495277176.png)

æˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼Œåœ¨åŒä¸€åŸå¸‚çš„åŒä¸€å®¶åŒ»é™¢å·¥ä½œçš„æ²»ç–—å¸ˆéƒ½æœ‰ç›¸åŒçš„ç”µè¯å·ç (*ä¾‹å¦‚ï¼Œæœ‰ 2 åæ²»ç–—å¸ˆåœ¨æ—§é‡‘å±±çš„è“åå­—è¯Šæ‰€å·¥ä½œ*ï¼Œä½†åœ¨ä¸åŒåœ°ç‚¹çš„åŒä¸€å®¶åŒ»é™¢å·¥ä½œçš„æ²»ç–—å¸ˆæœ‰ä¸åŒçš„ç”µè¯å·ç (*è¿˜æœ‰ 2 åæ²»ç–—å¸ˆä¹Ÿåœ¨è“åå­—è¯Šæ‰€å·¥ä½œï¼Œä½†å› ä¸ºä»–ä»¬ä½äºæ´›æ‰çŸ¶ï¼Œæ‰€ä»¥ä»–ä»¬çš„ç”µè¯å·ç ä¸æ—§é‡‘å±±çš„ä¸¤åè“åå­—è¯Šæ‰€æ²»ç–—å¸ˆçš„ç”µè¯å·ç ä¸åŒ*)ã€‚

è¿™æ„å‘³ç€ç”µè¯å·ç å–å†³äºåŒ»é™¢(ä¸»é”®)å’ŒåŒ»é™¢æ‰€åœ¨çš„åŸå¸‚ã€‚å°†â€œç”µè¯â€å€¼æ”¾å…¥ä»–ä»¬è‡ªå·±çš„è¡¨ä¸­ï¼Œè€Œä¸æ˜¯åŒ»é™¢çš„è¡¨ä¸­ï¼Œå¯ä»¥é˜²æ­¢åœ¨ä¸æ”¹å˜ç”µè¯å·ç çš„æƒ…å†µä¸‹æ„å¤–æ”¹å˜æ²»ç–—å¸ˆçš„åŸå¸‚ã€‚

è¿™æ˜¯ä¼ é€’ä¾èµ–çš„åŸºç¡€:*åˆ—å€¼æ ¹æ®ä¸»é”®å’Œè¡¨ä¸­çš„å…¶ä»–åˆ—è€Œå˜åŒ–ã€‚*

ä¸ºäº†é¿å…ç ´åæ•°æ®å®Œæ•´æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸‰ä¸ªè¡¨:ä¸€ä¸ªä¸ºæ¯ä¸ªç‰¹å®šä½ç½®çš„åŒ»é™¢å»ºç«‹ä¸€ä¸ªé”®ï¼Œä¸€ä¸ªæ ¹æ®åŒ»é™¢ id å»ºç«‹ç”µè¯å·ç ï¼Œä¸€ä¸ªä¸ºæ¯ä¸ªæ²»ç–—å¸ˆå¯¹åº”çš„åŒ»é™¢ idã€‚æœ€ç»ˆçš„æ•°æ®åº“æ¨¡å¼å¦‚ä¸‹æ‰€ç¤º(å†æ¬¡ä½¿ç”¨*ï¼ŒæŸ¥çœ‹æä¾›çš„ GitHub é¡µé¢* [*ï¼Œè¿™é‡Œçš„*](https://github.com/emiburns/complete_guide_to_database_normalization_in_SQL) *ç”¨äºå®Œæ•´çš„ SQL æŸ¥è¯¢*):

![](img/d90dce0e0d635af2311054f71789056a.png)

å¤ªæ£’äº†ï¼Œç°åœ¨æˆ‘ä»¬çš„åˆ—åªä¾èµ–äºå®ƒä»¬å„è‡ªçš„ä¸»é”®ï¼ğŸ¥³ï¼Œæˆ‘ä»¬çš„æ­£å¸¸åŒ–æ­¥éª¤åˆ°æ­¤ç»“æŸ

## é‡æ–°è®¿é—®æœ€åˆçš„æŸ¥è¯¢

æ—¢ç„¶æ•°æ®åº“ç¬¦åˆ 1NFã€2NF å’Œ 3NF æ ‡å‡†ï¼Œæ‚¨å¯ä»¥é‡æ–°è®¿é—®æ‚¨çš„å…¬å¸æ‰€è¯·æ±‚çš„æŸ¥è¯¢ã€‚ä»¥é˜²ä¸‡ä¸€ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå¤ä¹ :

> ç¡®å®šåŒ—åŠ å·ä¸“é—¨æ²»ç–—æƒ…ç»ªéšœç¢çš„æ²»ç–—å¸ˆçš„æ•°é‡ï¼Œä»¥åŠè¿™äº›æ²»ç–—å¸ˆä¸­ï¼Œæœ‰å¤šå°‘ç›®å‰æ­£åœ¨æ¥å—æ–°ç—…äººã€‚

å‡è®¾æƒ…ç»ªéšœç¢åŒ…æ‹¬â€œç„¦è™‘â€ã€â€œæŠ‘éƒâ€å’Œâ€œèºéƒç—‡â€ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŸ¥è¯¢ï¼Œè€Œä¸ä¼šå¯¹æ•°æ®å®Œæ•´æ€§äº§ç”Ÿæ€€ç–‘:

```
SELECT 
 sub.new_patients,
 COUNT(therapist_id) AS norcal_therapists
FROM 
 (SELECT s.therapist_id, s.speciality_one, s.speciality_two, s.speciality_three, td.new_patients 
  FROM specialties s 
   JOIN therapist_directory td ON s.therapist_id = td.therapist_id
   JOIN therapist_location tl ON td.therapist_id = tl.therapist_id
   JOIN locations l ON tl.hospital_id = l.hospital_id
  WHERE l.city ~ '(San Francisco|Oakland|San Jose|Sacramento|Auburn)') sub
WHERE 
 speciality_one ~ '(Anxiety|Depression|Bipolar)'
 OR speciality_two ~ '(Anxiety|Depression|Bipolar)'
 OR speciality_three ~ '(Anxiety|Depression|Bipolar)'
GROUP BY sub.new_patients;
```

![](img/a56628770c03a2eceb527e7348a9b4ac.png)

æ ¹æ®è°ƒæŸ¥ç»“æœï¼ŒåŒ—åŠ å·æœ‰ 11 åæ²»ç–—å¸ˆä¸“é—¨æ²»ç–—æƒ…ç»ªéšœç¢ï¼Œè€Œè¿™ 11 äººä¸­ï¼Œæœ‰ 9 äººç›®å‰æ­£åœ¨æ¥å—æ–°ç—…äººï¼

é™¤äº†åƒè¿™æ ·çš„ä¸€èˆ¬åˆ†æä¹‹å¤–ï¼Œå…·æœ‰éä¼ é€’ä¾èµ–åˆ—çš„è§„èŒƒåŒ–æ•°æ®åº“åŒæ ·å…è®¸æˆ‘ä»¬æ»¡æ€€ä¿¡å¿ƒåœ°å®Œæˆ**æ•°æ®æ“ä½œæŸ¥è¯¢**ã€‚å¦‚æœä½ çš„å…¬å¸è¦æ±‚ä½ æ”¹å˜ä¸€ä¸ªæ²»ç–—å¸ˆå·¥ä½œçš„åŸå¸‚(è€Œä¸æ˜¯åŒ»é™¢),ä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°ä½¿ç”¨ä¸€ä¸ªæ›´æ–°è¯­å¥æ¥å®Œæˆï¼Œè€Œä¸ç”¨æ‹…å¿ƒæ„å¤–åœ°æ²¡æœ‰åŒæ—¶æ›´æ–°ç”µè¯å·ç ã€‚

```
UPDATE
    therapist_location 
SET  
    hospital_id = (SELECT hospital_id        
                   FROM locations        
                   WHERE hospital_name = 'Open Clinic'          
                       AND city = 'San Jose')
WHERE 
    therapist_id = 15;
```

ä¸Šè¿°æŸ¥è¯¢å°† Sid Michael(therapist _ id = 15)çš„åŒ»é™¢ä½ç½®ä»å¥¥å…‹å…°æ›´æ”¹ä¸ºåœ£ä½•å¡ã€‚å› ä¸ºå¥¹çš„åŒ»é™¢ id ç°åœ¨åœ¨*æ²»ç–—å¸ˆ _ ä½ç½®*è¡¨ä¸­æ˜¯æœ€æ–°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦é€šè¿‡å¦ä¸€ä¸ªæ›´æ–°æŸ¥è¯¢æ¥æ‰‹åŠ¨æ›´æ”¹ Sid çš„è”ç³»ä¿¡æ¯ã€‚ç›¸åï¼ŒSid çš„è”ç³»ä¿¡æ¯ä¼šæ ¹æ®å¥¹çš„æ–°åŒ»é™¢ id è‡ªåŠ¨æ›´æ–°ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ª JOIN è¯­å¥å¯¹æ­¤è¿›è¡ŒåŒé‡æ£€æŸ¥ã€‚

```
SELECT  
    td.first_name,  
    td.last_name,   
    l.hospital_name,  
    l.city pn.phone_number 
FROM  
    therapist_directory td 
    JOIN   
        therapist_location tl   
        ON td.therapist_id = tl.therapist_id 
    JOIN   
        locations l   
        ON l.hospital_id = tl.hospital_id 
    JOIN   
        phone_numbers pn  
        ON tl.hospital_id = pn.hospital_id
WHERE  
    td.therapist_id = 15;
```

![](img/aef8fce36118567ba15648a2a383627b.png)

# ç®€çŸ­çš„é—­å¹•è¯

åˆ†è§£ä¸€ä¸ªæ•°æ®åº“å¯ä»¥ç®€å•åˆ° 1(NF)ï¼Œ2(NF)ï¼Œ3(NF)ï¼è¦æ›´æ·±å…¥åœ°äº†è§£æ¨¡æ‹Ÿçš„â€œNorthern_California_Therapistsâ€æ•°æ®åº“å’Œä¸ºæœ¬æ–‡åˆæˆçš„å•ä¸ª SQL æŸ¥è¯¢ï¼Œè¯·æŸ¥çœ‹æˆ‘çš„ç›¸å…³ GitHub çŸ¥è¯†åº“[è¿™é‡Œ](https://github.com/emiburns/complete_guide_to_database_normalization_in_SQL)ã€‚

æ­£å¸¸åŒ–å¿«ä¹ï¼ğŸ¤–