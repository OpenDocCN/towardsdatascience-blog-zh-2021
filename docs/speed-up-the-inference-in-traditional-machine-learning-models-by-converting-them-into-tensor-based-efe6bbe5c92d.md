# å¼ é‡æ˜¯ä½ æ‰€éœ€è¦çš„

> åŸæ–‡ï¼š<https://towardsdatascience.com/speed-up-the-inference-in-traditional-machine-learning-models-by-converting-them-into-tensor-based-efe6bbe5c92d?source=collection_archive---------24----------------------->

## åŠ å¿«æ‚¨çš„ scikit-learn æ¨¡å‹çš„æ¨ç†é€Ÿåº¦

![](img/ea334ef8e1f04a919e1a3431f80417c0.png)

å¼—æ‹‰å¤šÂ·å¸•è¯ºç»´å¥‡åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹æ‘„çš„ç…§ç‰‡

æ·±åº¦å­¦ä¹ æ¡†æ¶ç”±å¼ é‡ç»„æˆï¼Œä½œä¸ºå®ƒä»¬çš„åŸºæœ¬è®¡ç®—å•å…ƒã€‚ç»“æœï¼Œå®ƒä»¬å¯ä»¥åˆ©ç”¨ç¡¬ä»¶åŠ é€Ÿå™¨(ä¾‹å¦‚ï¼ŒGPU)ï¼Œä»è€ŒåŠ é€Ÿæ¨¡å‹è®­ç»ƒå’Œæ¨æ–­ã€‚ç„¶è€Œï¼Œåƒ [scikit-learn](https://scikit-learn.org/stable/) è¿™æ ·çš„ä¼ ç»Ÿæœºå™¨å­¦ä¹ åº“æ˜¯ä¸ºäº†åœ¨ CPU ä¸Šè¿è¡Œè€Œå¼€å‘çš„ï¼Œæ²¡æœ‰å¼ é‡çš„æ¦‚å¿µã€‚å› æ­¤ï¼Œä»–ä»¬æ— æ³•åˆ©ç”¨ GPUï¼Œå› æ­¤é”™è¿‡äº†æ·±åº¦å­¦ä¹ åº“äº«æœ‰çš„æ½œåœ¨åŠ é€Ÿã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£ä¸€ä¸ªåä¸º **Hummingbird** çš„åº“ï¼Œå®ƒå°±æ˜¯ä¸ºäº†å¼¥åˆè¿™ä¸€å·®è·è€Œåˆ›å»ºçš„ã€‚Hummingbird é€šè¿‡å°†ä¼ ç»Ÿæœºå™¨å­¦ä¹ æ¨¡å‹è½¬æ¢ä¸ºåŸºäºå¼ é‡çš„æ¨¡å‹ï¼ŒåŠ å¿«äº†å®ƒä»¬çš„æ¨ç†é€Ÿåº¦ã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨ GPU ä¸Šä½¿ç”¨ scikit-learn çš„å†³ç­–æ ‘å’Œéšæœºæ£®æ—ç­‰æ¨¡å‹ï¼Œå¹¶åˆ©ç”¨ç¡¬ä»¶åŠŸèƒ½ã€‚

# èœ‚é¸Ÿæ˜¯ä»€ä¹ˆï¼Ÿ

å¦‚ä¸Šæ‰€è¿°ï¼Œ[èœ‚é¸Ÿ](https://github.com/microsoft/hummingbird)æ˜¯ä¼ ç»Ÿæœºå™¨å­¦ä¹ æ¨¡å‹ä¸­ç”¨äºåŠ é€Ÿæ¨ç†çš„åº“ã€‚Hummingbird é€šè¿‡å°†è¿™äº›ä¼ ç»Ÿçš„æœºå™¨å­¦ä¹ ç®¡é“ç¼–è¯‘æˆå¼ é‡è®¡ç®—æ¥å®ç°è¿™ä¸€ç‚¹ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥åˆ©ç”¨ GPU å’Œ TPU ç­‰ç¡¬ä»¶åŠ é€Ÿï¼Œç”šè‡³æ˜¯ä¼ ç»Ÿçš„æœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œè€Œæ— éœ€é‡æ–°è®¾è®¡æ¨¡å‹ã€‚

è¿™åœ¨å‡ ä¸ªæ–¹é¢æ˜¯æœ‰ç›Šçš„ã€‚åœ¨èœ‚é¸Ÿçš„å¸®åŠ©ä¸‹ï¼Œç”¨æˆ·å¯ä»¥å—ç›Šäº:

*   åœ¨ç¥ç»ç½‘ç»œæ¡†æ¶ä¸­å®ç°çš„ä¼˜åŒ–ï¼›
*   åŸç”Ÿç¡¬ä»¶åŠ é€Ÿï¼›
*   æ‹¥æœ‰æ”¯æŒä¼ ç»Ÿå’Œç¥ç»ç½‘ç»œæ¨¡å‹çš„å•ä¸€å¹³å°ï¼›

![](img/8717c25d7a179a19749bae53551ceca0.png)

èœ‚é¸Ÿåº“é«˜å±‚æ¶æ„|æ¥æº:[å®˜æ–¹è®ºæ–‡](http://learningsys.org/neurips19/assets/papers/27_CameraReadySubmission_Hummingbird%20(5).pdf)

é™¤äº†ä¸Šè¿°ä¼˜ç‚¹ï¼Œèœ‚é¸Ÿè¿˜æä¾›äº†è®¸å¤šæ–¹ä¾¿çš„åŠŸèƒ½ï¼Œå…¶ä¸­ä¸€äº›åˆ—ä¸¾å¦‚ä¸‹ã€‚

## 1ï¸âƒ£ .æ–¹ä¾¿çš„ç»Ÿä¸€â€œæ¨ç†â€API

Hummingbird æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„ç»Ÿä¸€â€œæ¨ç†â€APIï¼Œå®ƒéå¸¸ç±»ä¼¼äº sklearn APIã€‚è¿™å…è®¸ç”¨ Hummingbird ç”Ÿæˆçš„æ¨¡å‹äº¤æ¢ sklearn æ¨¡å‹ï¼Œè€Œä¸å¿…æ›´æ”¹æ¨ç†ä»£ç ã€‚

## 2ï¸âƒ£.æ”¯æŒä¸»è¦æ¨¡å‹å’Œç‰¹å¾ã€‚

å½“å‰ç‰ˆæœ¬çš„ Hummingbird ç›®å‰æ”¯æŒä»¥ä¸‹æ“ä½œç¬¦:

![](img/0ddc4ef9f290511f7b6f9a137c3a9122.png)

è¿è¥å•†æ”¯æŒ b èœ‚é¸Ÿã€‚æ¥æº:[å®˜æ–¹ Github åº“](https://github.com/microsoft/hummingbird/wiki/Supported-Operators)

## 3ï¸âƒ£.è½¬æ¢èƒ½åŠ›

ç›®å‰ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨èœ‚é¸Ÿå°†æ‚¨è®­ç»ƒçš„ä¼ ç»Ÿ ML æ¨¡å‹è½¬æ¢ä¸º [PyTorch](https://pytorch.org/) ã€ [TorchScript](https://pytorch.org/docs/stable/jit.html) ã€ [ONNX](https://onnx.ai/) å’Œ [TVM](https://docs.tvm.ai/)

![](img/ae51c53b4b8f83f95b1436818a3c409b.png)

èœ‚é¸Ÿå¯ä»¥æŒ‰ä½œè€…è½¬æ¢ä½ è®­ç»ƒè¿‡çš„ä¼ ç»Ÿ ML |å›¾åƒ

# å·¥ä½œ

èœ‚é¸Ÿåº“çš„ä¸»è¦é‡ç‚¹æ˜¯åŠ å¿«ä¼ ç»Ÿæœºå™¨å­¦ä¹ æ¨¡å‹çš„æ¨ç†é€Ÿåº¦ã€‚å·²ç»å¼€å‘äº†å¾ˆå¤šä¸“é—¨çš„ç³»ç»Ÿï¼Œæ¯”å¦‚ ONNX Runtimeã€TensorRT å’Œ TVMã€‚ç„¶è€Œï¼Œè®¸å¤šè¿™äº›ç³»ç»Ÿéƒ½ä¸“æ³¨äºæ·±åº¦å­¦ä¹ ã€‚ä¼ ç»Ÿæ¨¡å‹çš„é—®é¢˜åœ¨äºï¼Œå®ƒä»¬æ˜¯ç”¨**å‘½ä»¤å¼ä»£ç **ä»¥ç‰¹å®šçš„æ–¹å¼è¡¨è¾¾çš„ã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›è§†è§‰è¡¨ç°æ¥ç†è§£å®ƒã€‚

![](img/b3a54b408c7ab87821777038684ddef2.png)

ä¼ ç»Ÿæœºå™¨å­¦ä¹ æ¨¡å‹å¦‚ä½•å·¥ä½œ|ä½œè€…å›¾ç‰‡|è½¬è½½è‡ª[èœ‚é¸Ÿä¼šè®®ã€‚](https://www.slideshare.net/databricks/tensors-are-all-you-need-faster-inference-with-hummingbird)

> ä¼ ç»Ÿæ¨¡å‹çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼Œå®ƒä»¬æ˜¯ä½¿ç”¨**å‘½ä»¤å¼ä»£ç **ä»¥ç‰¹å®šçš„æ–¹å¼è¡¨è¾¾çš„

è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªåŒ…å«å››åˆ—çš„æ•°æ®æ¡†æ¶ï¼Œå…¶ä¸­ä¸¤åˆ—æ˜¯åˆ†ç±»çš„ï¼Œå…¶ä½™ä¸¤åˆ—æ˜¯æ•°å­—çš„ã€‚è¿™äº›è¢«è¾“å…¥ä¸€ä¸ªæœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œæ¯”å¦‚é€»è¾‘å›å½’ï¼Œä»¥è¯†åˆ«å®ƒä»¬æ˜¯å±äº`class 0`è¿˜æ˜¯`class 1`ã€‚è¿™æ˜¯äºŒå…ƒåˆ†ç±»é—®é¢˜çš„ç»å…¸æ¡ˆä¾‹ã€‚å¦‚æœæˆ‘ä»¬æ·±å…¥è§‚å¯Ÿï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª DAG æˆ–æœ‰å‘æ— ç¯æ“ä½œå›¾ï¼Œç§°ä¸ºç®¡é“ã€‚ç®¡é“ç”±ç‰¹å¾å™¨ç»„æˆï¼Œè¿™äº›ç‰¹å¾å™¨å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†ï¼Œç„¶åå°†å…¶æä¾›ç»™é¢„æµ‹å™¨ï¼Œé¢„æµ‹å™¨å°†è¾“å‡ºé¢„æµ‹ã€‚è¿™åªæ˜¯ä¼ ç»Ÿæ¨¡å‹çš„ä¸€ä¸ªç®€å•è¡¨ç¤ºã€‚åœ¨æ‰€æœ‰ä¼ ç»Ÿçš„ ML æ¡†æ¶ä¸­ï¼Œæœ‰æˆç™¾ä¸Šåƒçš„è¿™äº›ç‰¹å¾å’Œé¢„æµ‹å™¨ã€‚å› æ­¤ï¼Œå¾ˆéš¾ç”¨ä¸€ç§å¯¹æ‰€æœ‰ä¸åŒæ¡†æ¶éƒ½æœ‰æ„ä¹‰çš„æ–¹å¼æ¥è¡¨ç¤ºå®ƒä»¬ã€‚

> æ·±åº¦å­¦ä¹ æ¨¡å‹è¢«è¡¨ç¤ºä¸ºå¼ é‡è¿ç®—çš„ DAG

å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬åœ¨æ·±åº¦å­¦ä¹ ä¸­ä¸»è¦ä¾èµ–å¼ é‡çš„æŠ½è±¡ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªå¤šç»´çŸ©é˜µã€‚æ·±åº¦å­¦ä¹ æ¨¡å‹ä¹Ÿè¡¨ç¤ºä¸º DAGï¼Œä½†æ˜ç¡®ä¸“æ³¨äºå¼ é‡ç®—å­ã€‚åœ¨ä¸‹å›¾ä¸­ï¼Œæˆ‘ä»¬æœ‰éå¸¸é€šç”¨çš„çŸ©é˜µè¿ç®—ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨å„ç§ç³»ç»Ÿä¸­è¡¨ç¤ºå‡ºæ¥ã€‚

![](img/df006d122c6b6bf8808c8b2f869ae679.png)

æ·±åº¦å­¦ä¹ æ¨¡å‹å¦‚ä½•å·¥ä½œ|ä½œè€…å›¾ç‰‡|è½¬è½½è‡ª[èœ‚é¸Ÿä¼šè®®ã€‚](https://www.slideshare.net/databricks/tensors-are-all-you-need-faster-inference-with-hummingbird)

æ·±åº¦å­¦ä¹ é¢„æµ‹æœåŠ¡ç³»ç»Ÿå¯ä»¥åˆ©ç”¨è¿™äº›å¼ é‡è¿ç®—ï¼Œå¹¶åˆ©ç”¨è¿™ç§æŠ½è±¡åœ¨è®¸å¤šä¸åŒçš„ç›®æ ‡ç¯å¢ƒä¸­å·¥ä½œã€‚

Hummingbird é€šè¿‡é‡æ–°é…ç½®ç®—æ³•è¿ç®—ç¬¦ï¼Œå°†ä¼ ç»Ÿçš„æµæ°´çº¿è½¬æ¢ä¸ºå¼ é‡è¿ç®—ã€‚ä¸‹é¢è¿™ä¸ªæ¥è‡ªä»–ä»¬[å®˜æ–¹åšå®¢](https://www.microsoft.com/en-us/research/group/gray-systems-lab/articles/announcing-hummingbird-a-library-for-accelerating-inference-with-traditional-machine-learning-models/)çš„ä¾‹å­è§£é‡Šäº†èœ‚é¸Ÿå°†å†³ç­–æ ‘ç¿»è¯‘æˆå¼ é‡çš„ç­–ç•¥ä¹‹ä¸€ï¼Œå…¶ä¸­æ¶‰åŠåˆ° GEMM(é€šç”¨çŸ©é˜µä¹˜æ³•)ã€‚

![](img/95212f65c65baa87bff9ca08f50ca5b7.png)

*å°†ç®€å•çš„å†³ç­–æ ‘è½¬åŒ–ä¸ºç¥ç»ç½‘ç»œ|è½¬è½½è‡ªèœ‚é¸Ÿçš„* [*å®˜æ–¹åšå®¢*](https://www.microsoft.com/en-us/research/group/gray-systems-lab/articles/announcing-hummingbird-a-library-for-accelerating-inference-with-traditional-machine-learning-models/)

# æ¼”ç¤º

èœ‚é¸Ÿçš„è¯­æ³•éå¸¸ç›´è§‚å’Œç®€æ´ã€‚è¦åœ¨ DNN æ¡†æ¶ä¸Šè¿è¡Œæ‚¨çš„ä¼ ç»Ÿ ML æ¨¡å‹ï¼Œæ‚¨åªéœ€è¦`import hummingbird.ml`å¹¶å°†`convert(model, 'dnn_framework')`æ·»åŠ åˆ°æ‚¨çš„ä»£ç ä¸­ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ [scikit-learn éšæœºæ£®æ—](https://scikit-learn.org/stable/modules/ensemble.html#forest)æ¨¡å‹å’Œ [PyTorch](https://pytorch.org/) ä½œä¸ºç›®æ ‡æ¡†æ¶çš„ä¾‹å­ã€‚

***ğŸ”—*** [***é“¾æ¥è®¿é—®æ•´ä¸ªä»£ç å’Œæ•°æ®é›†***](https://www.kaggle.com/parulpandey/random-forest-on-gpus-with-pytorch-backend)

![](img/652eba6eecd461d69422ca108af91cf5.png)

ä½¿ç”¨ä¸€ä¸ª [scikit-learn éšæœºæ£®æ—](https://scikit-learn.org/stable/modules/ensemble.html#forest)æ¨¡å‹å’Œ [PyTorch](https://pytorch.org/) ä½œä¸ºç›®æ ‡æ¡†æ¶ä½¿ç”¨ Hummingbird |å›¾ç‰‡ç”±ä½œè€…æä¾›

![](img/fcfc40c569aeafdc32f7eacfab910ffe.png)

CPU ä¸Šçš„éšæœºæ£®æ—å›å½’å™¨ä¸ GPU ä¸Šçš„éšæœºæ£®æ—å›å½’å™¨çš„æ—¶é—´æ¯”è¾ƒ|ç”±ä½œè€…ç»˜åˆ¶çš„å›¾åƒ| [é“¾æ¥åˆ°ä»£ç ](https://www.kaggle.com/parulpandey/random-forest-on-gpus-with-pytorch-backend)

# ç»“è®º

Hummingbird æ˜¯ä¸€ä¸ªå¾ˆæœ‰å‰é€”çš„åº“ï¼Œæ­£åœ¨ç ”ç©¶æœºå™¨å­¦ä¹ é¢†åŸŸçš„ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜ã€‚è®©ç”¨æˆ·èƒ½å¤Ÿä» CPU æ— ç¼è¿‡æ¸¡åˆ° GPUï¼Œå¹¶åˆ©ç”¨ç¡¬ä»¶åŠ é€Ÿå™¨æ¥åŠ é€Ÿæ¨ç†ï¼Œè¿™å°†æœ‰åŠ©äºç›´æ¥å…³æ³¨é—®é¢˜è€Œä¸æ˜¯ä»£ç ã€‚å¦‚æœæ‚¨æƒ³æ›´è¿›ä¸€æ­¥ï¼Œè¯·ç¡®ä¿æŸ¥çœ‹ä¸‹é¢çš„å‚è€ƒèµ„æ–™ã€‚æœ¬æ–‡ä»¥è¿™äº›å‚è€ƒèµ„æ–™ä¸ºåŸºç¡€ï¼Œå¦‚æœæ‚¨å†³å®šæ›´æ·±å…¥åœ°ç ”ç©¶è¯¥åº“çš„åº•å±‚è§£é‡Šï¼Œæ‚¨ä¹Ÿä¼šå‘ç°å®ƒä»¬å¾ˆæœ‰å¸®åŠ©ã€‚

## å‚è€ƒ

*   [https://github.com/microsoft/hummingbird](https://github.com/microsoft/hummingbird)
*   [å¼ é‡æ˜¯ä½ æ‰€éœ€è¦çš„:ç”¨èœ‚é¸Ÿæ›´å¿«çš„æ¨ç†](https://www.slideshare.net/databricks/tensors-are-all-you-need-faster-inference-with-hummingbird)
*   [ä¸ºç»Ÿä¸€æœºå™¨å­¦ä¹ é¢„æµ‹æœåŠ¡çš„å¼ é‡ç¼–è¯‘å™¨](https://arxiv.org/abs/2010.04804)ã€‚
*   [å°†ç»å…¸çš„ ML ç®¡é“ç¼–è¯‘æˆå¼ é‡è®¡ç®—ï¼Œä»¥å®ç°â€œä¸€åˆ€åˆ‡â€çš„é¢„æµ‹æœåŠ¡](http://learningsys.org/neurips19/assets/papers/27_CameraReadySubmission_Hummingbird%20(5).pdf)ã€‚