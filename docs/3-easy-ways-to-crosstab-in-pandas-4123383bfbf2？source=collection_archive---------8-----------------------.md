# ç†ŠçŒ«ä¸­äº¤å‰è¡¨çš„ 3 ç§ç®€å•æ–¹æ³•

> åŸæ–‡ï¼š<https://towardsdatascience.com/3-easy-ways-to-crosstab-in-pandas-4123383bfbf2?source=collection_archive---------8----------------------->

## æé«˜æ•°æ®å¤„ç†æŠ€èƒ½çš„å®ç”¨æŠ€å·§

äº¤å‰åˆ¶è¡¨æ˜¯æ£€éªŒä¸¤ä¸ªæˆ–æ›´å¤šåˆ†ç±»å˜é‡*æˆ–ç¦»æ•£å˜é‡*ä¹‹é—´å…³ç³»çš„ç®€å•è€Œæœ‰æ•ˆçš„æ–¹æ³•ã€‚åœ¨æœ¬å¸–ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹åœ¨ç†ŠçŒ«èº«ä¸Šåˆ›å»ºäº¤å‰è¡¨æ ¼çš„ä¸‰ç§ç®€å•è€Œæœ‰ç”¨çš„æ–¹æ³•ã€‚

![](img/2308a26f8d76e9de1569d75b4fa353a6.png)

ç”±[é©¬è…¾Â·å¾·å…‹æ–¯](https://unsplash.com/@maartendeckers?utm_source=medium&utm_medium=referral)åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹æ‘„çš„ç…§ç‰‡

# 0.æ•°æ®ğŸ“¦

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ *seaborn çš„æŠ€å·§*æ•°æ®é›†ã€‚

```
import pandas as pd # *This post uses pandas v1.3.0.*
from seaborn import load_dataset# Import data
df = load_dataset("tips")
df.head()
```

![](img/cb3e321ceec43bdbb8a0921598f18e40.png)

å…³äºè¿™ä¸ªæ•°æ®é›†(åŒ…æ‹¬æ•°æ®å­—å…¸)çš„ç»†èŠ‚å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°[(è¿™ä¸ªæºå®é™…ä¸Šæ˜¯é’ˆå¯¹ R çš„ï¼Œä½†æ˜¯å®ƒçœ‹èµ·æ¥æ˜¯æŒ‡åŒä¸€ä¸ªåº•å±‚æ•°æ®é›†)ã€‚æ•°æ®æè¿°å¼•ç”¨å¦‚ä¸‹ï¼Œä»¥ä¾¿å¿«é€Ÿè®¿é—®:](https://vincentarelbundock.github.io/Rdatasets/doc/reshape2/tips.html)

> ä¸€åæœåŠ¡å‘˜è®°å½•äº†ä»–åœ¨ä¸€å®¶é¤é¦†å·¥ä½œå‡ ä¸ªæœˆæœŸé—´æ”¶åˆ°çš„æ¯ä¸€ç¬”å°è´¹çš„ä¿¡æ¯

è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ•°æ®æ¡†çš„æ‘˜è¦:

```
df.info()
```

![](img/66c6d98b480471d15e00729d131f4ee0.png)

æœ‰ 244 ä¸ªè®°å½•å’Œ 7 ä¸ªå˜é‡(4 ä¸ªåˆ†ç±»å˜é‡å’Œ 3 ä¸ªæ•°å€¼å˜é‡)ã€‚æ²¡æœ‰ç¼ºå¤±å€¼ã€‚

# ğŸ“ 1.ä½¿ç”¨äº¤å‰è¡¨()

ç¬¬ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨`crosstab()`ã€‚è¿™ä¸ªå‡½æ•°ä½¿å¾—è®¡ç®—æ€»æ•°å’Œç™¾åˆ†æ¯”å˜å¾—éå¸¸å®¹æ˜“ã€‚

## ğŸ“˜ 1.1.è®¡æ•°å’Œç™¾åˆ†æ¯”

è®©æˆ‘ä»¬ç»Ÿè®¡ä¸€ä¸‹*æ—¶é—´*å’Œ*æ—¥æœŸ*çš„ç±»åˆ«:

```
pd.crosstab(df['time'], df['day'])
```

![](img/24c550b67d42c2260b881de49e5f8cfd.png)

ä»è¿™ä¸ªè¡¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ•°æ®é›†ä¸­æ²¡æœ‰å‘¨æœ«åˆé¤æ—¶é—´çš„è®°å½•ã€‚è¿™å¯èƒ½æš—ç¤ºæˆ‘ä»¬ï¼Œè¦ä¹ˆè®°å½•çš„æœåŠ¡å‘˜åœ¨å‘¨æœ«åˆé¤æ—¶é—´ä¸å·¥ä½œï¼Œè¦ä¹ˆé¤é¦†åœ¨å‘¨æœ«åˆé¤æ—¶é—´ä¸è¥ä¸šã€‚

é€šè¿‡è°ƒæ•´ä»¥ä¸‹å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨`crosstab()`è½»æ¾åœ°è½¬æ¢ä¸ºç™¾åˆ†æ¯”æˆ–ç›¸åŠ æ€»è®¡:
âœ…ï¸ ï¸ `normalize='columns'`:è½¬æ¢ä¸ºåˆ—%
âœ…ï¸ ï¸ `normalize='index'`:è½¬æ¢ä¸ºè¡Œ%
âœ…ï¸ ï¸ `normalize='all'`æˆ–ï¸ `normalize=True`:è½¬æ¢ä¸ºè¡¨%
âœ…ï¸ ï¸ `margins=True`:ç›¸åŠ æ€»è®¡(æ€»è®¡çš„ç±»å‹å–å†³äº`normalize`å‚æ•°)

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­:

```
pd.crosstab(df['time'], df['day'], normalize='index', margins=True)
```

![](img/c2e1d88452aac3e8625bd77559591605.png)

è¡Œæ€»è®¡åœ¨è¿™é‡Œä¸ä¼šæä¾›å¤ªå¤šçš„å€¼ï¼Œå› ä¸ºæ¯ä¸ªè¡Œæ€»è®¡åªä¼šæ˜¾ç¤º 1ï¼Œæ‰€ä»¥ pandas å¾ˆèªæ˜ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­åªæ˜¾ç¤ºåˆ—æ€»è®¡ã€‚å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨ Pythonï¼Œå°è¯•è°ƒæ•´åˆ°ä¸åŒçš„`normalize`å’Œ`margins`ç»„åˆï¼Œå¹¶æ³¨æ„è¡¨æ ¼æ˜¯å¦‚ä½•å˜åŒ–çš„ã€‚

## ğŸ“™ 1.2.èšåˆæ•°å€¼

é™¤äº†æŒ‰ç±»åˆ«è·å–è®¡æ•°å’Œç™¾åˆ†æ¯”ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æŒ‰ç±»åˆ«æŸ¥çœ‹æ•°å€¼å˜é‡çš„å€¼ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡*æ—¥*å’Œ*æ—¶*å¾—åˆ°ä¸­ä½æ•°*å°è´¹*ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
pd.crosstab(df['time'], df['day'], df['tip'], aggfunc='median')
```

![](img/3595aa85047681549a4ac032ef15f15d.png)

æˆ‘ä»¬è¿˜å¯ä»¥åœ¨è¡Œå’Œåˆ—ä¸­åŒ…å«å¤šä¸ªå˜é‡:

```
pd.crosstab([df['sex'], df['smoker']], 
            [df['time'], df['day']], 
            df['tip'], aggfunc='median')
```

![](img/832c68ae02b9d2cf91afdcad038612fe.png)

è¦è·å¾—å¤šä¸ªèšåˆï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­ä¼ é€’å®ƒä»¬:

```
pd.crosstab(df['time'], df['day'], df['tip'], 
            aggfunc=['median', 'mean'])
```

![](img/c02990e8a19c6cf0e2ec4b0b5406f936.png)

`crosstab()`çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼Œæ¯æ¬¡æˆ‘ä»¬æŒ‡å®šä¸€ä¸ªæœ‰ç‚¹é‡å¤çš„å˜é‡æ—¶ï¼Œæˆ‘ä»¬éƒ½éœ€è¦å¼•ç”¨æ•°æ®å¸§çš„åç§°ã€‚

# ğŸ“ 2.ä½¿ç”¨ pivot_table()

ä¸‹ä¸€ä¸ªå‡½æ•°(æˆ–æ–¹æ³•)æ˜¯`pivot_table()`ã€‚å½“æŒ‰ç±»åˆ«èšåˆæ•°å­—å˜é‡æ—¶ï¼Œè¿™ç§æ–¹æ³•éå¸¸çµæ´»ã€‚

## ğŸ“˜ 2.1.è®¡æ•°å’Œç™¾åˆ†æ¯”

è®©æˆ‘ä»¬ç”¨`pivot_table()`é‡æ–°åˆ›å»ºä¸Šä¸€èŠ‚çš„ç¬¬ä¸€ä¸ªäº¤å‰è¡¨:

```
pd.pivot_table(df, 'tip', 'time', 'day', aggfunc='count')
```

![](img/172f23041dfc3a58baccffe355b836e7.png)

ä¹Ÿå¯ä»¥ä½¿ç”¨ DataFrame æ–¹æ³•ç¼–å†™æ­¤æŸ¥è¯¢:

```
df.pivot_table('tip', 'time', 'day', aggfunc='count')
```

æˆ‘ä»¬å¯ä»¥ç”¨`margins=True`å¾—åˆ°è¡Œã€åˆ—å’Œè¡¨æ ¼çš„æ€»æ•°:

```
df.pivot_table('tip', 'time', 'day', aggfunc='count', margins=True)
```

![](img/fecca128b5e88f08a962de0294f9b285.png)

ä¸`crosstab()`ä¸åŒï¼Œæˆ‘ä»¬éœ€è¦ç¬¬ä¸‰ä¸ªå˜é‡:*æç¤º*æ¥è·å–è®¡æ•°ï¼Œå¹¶ä¸”æ²¡æœ‰ä¸€ä¸ªç®€å•çš„é€‰é¡¹æ¥è·å–ç™¾åˆ†æ¯”ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸å¿…åœ¨æ¯æ¬¡å¼•ç”¨å˜é‡æ—¶é‡å¤è¾“å…¥æ•°æ®å¸§åç§°ã€‚

## ğŸ“™ 2.2.èšåˆæ•°å€¼

è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä»ä¸Šä¸€èŠ‚ä¸­è·å–ç›¸åŒçš„ä¸‰ä¸ªè¡¨çš„è¯­æ³•:

```
df.pivot_table('tip', 'time', 'day', aggfunc='median')
```

![](img/0a16dfdd7427ebc4fc7267e4768f107f.png)

```
df.pivot_table('tip', ['sex', 'smoker'], ['time', 'day'], 
               aggfunc='median')
```

![](img/5eb25f1b931ce970fec65544cfe09c15.png)

```
df.pivot_table('tip', 'time', 'day', aggfunc=['median', 'mean'])
```

![](img/8dcb8789865d10e586d68b9037c4ffe1.png)

å¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨`pivot_table()`çœ‹å¤šä¸ªæ•°å€¼å˜é‡ã€‚è¿™åœ¨ç›®å‰çš„`crosstab()`ä¸­æ˜¯ä¸å¯èƒ½çš„ã€‚æˆ‘ä»¬å¯ä»¥æŒ‰å¦‚ä¸‹ç±»åˆ«èšåˆå¤šä¸ªæ•°å­—åˆ—:

```
df.pivot_table(['tip', 'total_bill'], 'time', 'day', 
               aggfunc='median')
```

![](img/afd133952a0a3e9252e90ac960c85409.png)

å¦‚æœæˆ‘ä»¬ä¸æŒ‡å®š values å‚æ•°ï¼Œå®ƒå°†ä½¿ç”¨ DataFrame ä¸­çš„æ‰€æœ‰æ•°å­—åˆ—ã€‚

```
df.pivot_table(index='time', columns='day', aggfunc='median')
```

![](img/46d3c5ce7c6388ed0989d8fcb9f0a4df.png)

å› ä¸ºæ²¡æœ‰æä¾›ç¬¬ä¸€ä¸ªå‚æ•°:valuesï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½å†æŒ‰ä½ç½®ä¼ é€’å‚æ•°ã€‚æ‰€ä»¥è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬å¿…é¡»æŒ‡å®šæ¯ä¸ªå‚æ•°ã€‚

# ğŸ“ 3.ä½¿ç”¨ groupby() + unstack()

è¿™ç§æ–¹æ³•éå¸¸ç±»ä¼¼äº SQL æˆ– R (tidyverse)ç­‰è¯­è¨€ä¸­çš„èšåˆæ–¹å¼ã€‚å› æ­¤ï¼Œè¿™å¯èƒ½æ˜¯æœ€å¸¸è§çš„è·å–äº¤å‰åˆ—è¡¨çš„æ–¹æ³•ã€‚

## ğŸ“˜ 3.1.è®¡æ•°å’Œç™¾åˆ†æ¯”

é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°*æ—¶é—´*å’Œ*æ—¥æœŸ*çš„è®¡æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
df.groupby(['time', 'day']).size().unstack()
```

![](img/563cbb83ac789cdcdf2f2307f20b13f3.png)

è·å¾—æ€»æ•°æˆ–è½¬æ¢æˆç™¾åˆ†æ¯”éœ€è¦é¢å¤–çš„æ•°æ®æ“ä½œï¼Œå› ä¸ºæˆ‘ä»¬ä¸å†åƒå‰ä¸¤èŠ‚é‚£æ ·ä½¿ç”¨ä¸“é—¨çš„å‡½æ•°ã€‚

## ğŸ“™ 3.2.èšåˆæ•°å€¼

ä¸ºäº†åœ¨ä¸­ä½æ•°*æç¤º*ä¸Šå¾—åˆ°ç›¸åŒçš„è¡¨æ ¼ï¼Œæˆ‘ä»¬ä½¿ç”¨:

```
df.groupby(['time', 'day'])['tip'].median().unstack()
```

![](img/d4effa78a5aaf581799aacfbb1985bd2.png)

```
df.groupby(['sex', 'smoker', 'time', 'day'])['tip']\
  .median().unstack(['time', 'day'])
```

![](img/dbaffdabfbfd5e3ba7340715810b1082.png)

æ­¤æ–¹æ³•æ˜¾ç¤ºæ¯ä¸ªç±»åˆ«ç»„åˆã€‚ç»“æœï¼Œç°åœ¨æ˜¾ç¤ºäº†å‘¨æœ«åˆé¤çš„ç©ºåˆ—ï¼Œè¾“å‡ºä¸å¦‚ä»¥å‰æ¸…æ™°ã€‚

æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å¤šä¸ªèšåˆå‡½æ•°:

```
df.groupby(['time', 'day'])['tip'].agg(['median', 'mean']).unstack()
```

![](img/b4625b5a73b6c3eb145d8daa4cb6d170.png)

ç±»ä¼¼äº`pivot_table()`ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å¤šä¸ªæ•°å€¼å˜é‡:

```
df.groupby(['time', 'day'])[['tip', 'total_bill']].median()\
  .unstack()
```

![](img/05f421741a3ff65f0d95b68141bda31f.png)

ä¸`pivot_table()`ç›¸æ¯”ï¼Œé€šè¿‡*æ—¶é—´*å’Œ*å¤©*ç”¨`groupby()`å’Œ`unstack()`æ›´å®¹æ˜“å¾—åˆ°æ‰€æœ‰æ•°å€¼å˜é‡çš„ç»Ÿè®¡:

```
df.groupby(['time', 'day']).median().unstack()
```

![](img/8210958086f9d6d95f476514ae7f38ed.png)

è¿™å°±æŠŠå®ƒå¸¦åˆ°äº†è¿™ç¯‡å¸–å­çš„ç»“å°¾ï¼è™½ç„¶è¿™ä¸‰ç§æ–¹æ³•æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œä½†å¯¹äºæŸäº›ä»»åŠ¡ï¼Œå…¶ä¸­ä¸€ç§æ–¹æ³•å¯ä»¥æä¾›æ¯”å…¶ä»–æ–¹æ³•æ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚å¸Œæœ›æ‚¨åœ¨ä¸‹ä¸€ä¸ªæ•°æ®æ“ä½œä»»åŠ¡ä¸­èƒ½å¤Ÿç†Ÿç»ƒåœ°ä½¿ç”¨å®ƒä»¬ï¼

![](img/417d0bdf46a871d6f444a969567599b5.png)

å¡ç¼ªå°”Â·å¸ƒæ—æ ¼æ£®åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹æ‘„çš„ç…§ç‰‡

*æ‚¨æƒ³è®¿é—®æ›´å¤šè¿™æ ·çš„å†…å®¹å—ï¼Ÿåª’ä½“ä¼šå‘˜å¯ä»¥æ— é™åˆ¶åœ°è®¿é—®åª’ä½“ä¸Šçš„ä»»ä½•æ–‡ç« ã€‚å¦‚æœæ‚¨ä½¿ç”¨* [*æˆ‘çš„æ¨èé“¾æ¥*](https://zluvsand.medium.com/membership)*æˆä¸ºä¼šå‘˜ï¼Œæ‚¨çš„ä¸€éƒ¨åˆ†ä¼šè´¹å°†ç›´æ¥ç”¨äºæ”¯æŒæˆ‘ã€‚*

æ„Ÿè°¢æ‚¨é˜…è¯»è¿™ç¯‡æ–‡ç« ã€‚å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œè¿™é‡Œæœ‰æˆ‘å…³äºç†ŠçŒ«çš„ä¸€äº›å…¶ä»–å¸–å­çš„é“¾æ¥:
â—¼ï¸ï¸ [åœ¨ç†ŠçŒ«ä¸­ç¼–å†™ 5 ä¸ªå¸¸è§çš„ SQL æŸ¥è¯¢](/writing-5-common-sql-queries-in-pandas-90b52f17ad76?source=your_stories_page-------------------------------------)
â—¼ï¸ï¸ [åœ¨ç†ŠçŒ«ä¸­ç¼–å†™é«˜çº§ SQL æŸ¥è¯¢](/writing-advanced-sql-queries-in-pandas-1dc494a17afe?source=your_stories_page-------------------------------------)
â—¼ï¸ï¸ [ç»™ç†ŠçŒ«ç”¨æˆ·çš„ 5 ä¸ªæç¤º](/5-tips-for-pandas-users-e73681d16d17?source=your_stories_page-------------------------------------)
â—¼ï¸ï¸ [åœ¨ç†ŠçŒ«ä¸­è¿›è¡Œæ•°æ®èšåˆçš„ 5 ä¸ªæç¤º](/5-tips-for-data-aggregation-in-pandas-7eaa8476dc75?source=your_stories_page-------------------------------------)
â—¼ï¸ï¸ [å¦‚ä½•åœ¨ç†ŠçŒ«æ•°æ®æ¡†æ¶ä¸­è½¬æ¢å˜é‡](/transforming-variables-in-a-pandas-dataframe-bce2c6ef91a1?source=your_stories_page-------------------------------------)
â—¼ï¸ï¸ [3 ä¸ªç®€å•æ–¹æ³•](https://medium.com/p/5b2cbe73d60e/edit)

å†è§ğŸƒ ğŸ’¨