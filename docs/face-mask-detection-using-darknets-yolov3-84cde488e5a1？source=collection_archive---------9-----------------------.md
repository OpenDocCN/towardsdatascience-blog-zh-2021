# ä½¿ç”¨ darknet çš„ YOLOv3 è¿›è¡Œé¢å…·æ£€æµ‹

> åŸæ–‡ï¼š<https://towardsdatascience.com/face-mask-detection-using-darknets-yolov3-84cde488e5a1?source=collection_archive---------9----------------------->

## æ–°å† è‚ºç‚:å¦‚ä½•ä½¿ç”¨ YOLOv3 æ„å»ºé¢å…·æ£€æµ‹å™¨çš„æ•™ç¨‹ã€‚*ä¸ºäº†ä¾¿äºæ¨æ–­ï¼Œè§†é¢‘æµå’Œå›¾åƒéƒ½å¯ä»¥ä½¿ç”¨ã€‚

è¿™ç¯‡æ–‡ç« æ—¨åœ¨ä¸ºé‚£äº›æƒ³è¦è®­ç»ƒæ¥è‡ª YOLO å®¶æ—çš„ç‰©ä½“æ¢æµ‹å™¨çš„äººæä¾›å®Œæ•´çš„æŒ‡å—(ä¸€æ­¥ä¸€æ­¥)ã€‚ç”±äºç–«æƒ…ï¼Œè¿™æ ·çš„ä»»åŠ¡ä¼¼ä¹å¾ˆçƒ­é—¨ã€‚

å¯¹äºæœ¬æ•™ç¨‹ï¼Œæˆ‘å°†ä½¿ç”¨ [YOLOv3](https://github.com/AlexeyAB/darknet) ï¼Œè¿™æ˜¯ YOLO å®¶æ—æœ€å¸¸ç”¨çš„ç‰ˆæœ¬ä¹‹ä¸€ï¼Œå®ƒåŒ…å«äº†ç”¨äºå®æ—¶åœºæ™¯çš„æœ€å…ˆè¿›çš„å¯¹è±¡æ£€æµ‹ç³»ç»Ÿï¼Œå®ƒçš„å‡†ç¡®æ€§å’Œé€Ÿåº¦ä»¤äººæƒŠè®¶ã€‚YOLOv4ã€YOLOv5 ç­‰æ–°ç‰ˆæœ¬å¯èƒ½ä¼šè·å¾—æ›´å¥½çš„ç»“æœï¼Œåœ¨æˆ‘çš„ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘è¿˜å°†å°è¯•è¿™äº›æ¶æ„ï¼Œå¹¶ä¸æ‚¨åˆ†äº«æˆ‘çš„å‘ç°ã€‚

å‡è®¾ä½ å·²ç»æŒæ¡äº†ä½¿ç”¨æ·±åº¦å­¦ä¹ æŠ€æœ¯çš„ç‰©ä½“æ£€æµ‹ï¼Œç‰¹åˆ«æ˜¯ä½ çŸ¥é“å…³äº YOLO çš„åŸºç¡€çŸ¥è¯†ï¼Œè®©æˆ‘ä»¬å¼€å§‹æˆ‘ä»¬çš„ä»»åŠ¡â€¦

![](img/378cd20c2726201656f8a1fcc7fcd592.png)

åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Š[å®‰èˆ’ A](https://unsplash.com/@anshu18?utm_source=medium&utm_medium=referral) çš„ç…§ç‰‡

ä½ å¯ä»¥åœ¨æˆ‘çš„ Github [repo](https://github.com/skanelo/Face-Mask-Detection) ä¸Šæ‰¾åˆ°è¿™ä¸ªä¸Šä¼ çš„é¡¹ç›®ã€‚

# ç¯å¢ƒğŸŒ 

ä¸ºäº†å®ç°è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘åˆ©ç”¨äº† Google Colab çš„èµ„æºã€‚æˆ‘çš„ç¬¬ä¸€ä¸ªé¢„å¤„ç†æ­¥éª¤å®éªŒæ˜¯åœ¨æˆ‘çš„ç¬”è®°æœ¬ç”µè„‘ä¸Šè¿›è¡Œçš„ï¼Œå› ä¸ºå®ƒä»¬çš„è®¡ç®—æˆæœ¬ä¸é«˜ï¼Œä½†æ˜¯æ¨¡å‹æ˜¯åœ¨ Colab ä¸Šä½¿ç”¨ **GPU** è¿›è¡Œè®­ç»ƒçš„ã€‚

![](img/99223ee638a3bbc2d565231622f22367.png)

åœ¨ Colab ä¸Šé€šè¿‡**ç¼–è¾‘** - > **ç¬”è®°æœ¬è®¾ç½®**æœ‰äººå¯ä»¥æ¿€æ´» **GPUï¼Œ**æˆ‘*æ³•å¸ˆä½œè€…*

# èµ„æ–™ç»„ğŸ“š

é¦–å…ˆï¼Œä¸ºäº†æ„å»ºä¸€ä¸ªæ©è†œæ£€æµ‹å™¨ï¼Œæˆ‘ä»¬éœ€è¦ç›¸å…³æ•°æ®ã€‚æ­¤å¤–ï¼Œç”±äº YOLO çš„æ€§è´¨ï¼Œæˆ‘ä»¬éœ€è¦å¸¦è¾¹ç•Œæ¡†çš„æ³¨é‡Šæ•°æ®ã€‚ä¸€ç§é€‰æ‹©æ˜¯é€šè¿‡ä»ç½‘ä¸Šæˆ–é€šè¿‡æ‹æ‘„æœ‹å‹/ç†Ÿäººçš„ç…§ç‰‡æ”¶é›†å›¾åƒæ¥å»ºç«‹æˆ‘ä»¬è‡ªå·±çš„æ•°æ®é›†ï¼Œå¹¶ä½¿ç”¨ç‰¹å®šçš„ç¨‹åºå¦‚ [LabelImg](https://github.com/tzutalin/labelImg) æ‰‹å·¥æ³¨é‡Šå®ƒä»¬ã€‚ç„¶è€Œï¼Œè¿™ä¸¤ç§æƒ³æ³•éƒ½éå¸¸ä¹å‘³å’Œè€—æ—¶(å°¤å…¶æ˜¯åè€…)ã€‚å¦ä¸€ä¸ªé€‰é¡¹ï¼Œä¹Ÿæ˜¯ç›®å‰ä¸ºæ­¢å¯¹æˆ‘æ¥è¯´æœ€å¯è¡Œçš„ï¼Œæ˜¯ä½¿ç”¨å…¬å¼€å¯ç”¨çš„æ•°æ®é›†ã€‚æˆ‘ä» Kaggle ä¸­é€‰æ‹©äº†[äººè„¸é¢å…·æ£€æµ‹æ•°æ®é›†ï¼Œå¹¶å°†å…¶ç›´æ¥ä¸‹è½½åˆ°æˆ‘çš„ Google Drive ä¸­(ä½ å¯ä»¥åœ¨è¿™é‡Œ](https://www.kaggle.com/andrewmvd/face-mask-detection)[æŸ¥çœ‹å¦‚ä½•åš](https://laptrinhx.com/how-to-download-kaggle-datasets-into-google-colab-via-google-drive-1107891156/))ã€‚ä¸‹è½½çš„æ•°æ®é›†åŒ…å«ä¸¤ä¸ªæ–‡ä»¶å¤¹:

*   **å›¾åƒ**ï¼ŒåŒ…å« 853ã€‚png æ–‡ä»¶
*   **æ³¨è§£**ï¼ŒåŒ…å« 853 ä¸ªå¯¹åº”ã€‚xml æ³¨é‡Šã€‚

ä¸‹è½½æ•°æ®é›†åï¼Œæˆ‘ä»¬éœ€è¦å°†ã€‚xml æ–‡ä»¶è½¬æ¢æˆã€‚æ›´å‡†ç¡®åœ°è¯´ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»º YOLO æ ¼å¼æ¥è®­ç»ƒæˆ‘ä»¬çš„æ¨¡å‹ã€‚ä¸‹é¢æ˜¾ç¤ºäº†ä¸€ä¸ªç¤ºä¾‹:

å‡è®¾è¿™æ˜¯ä¸€ä¸ªåªåŒ…å« 3 ä¸ªè¾¹ç•Œæ¡†çš„å›¾åƒçš„æ³¨é‡Š(è¿™å¯ä»¥ä»ä¸­çš„ â€¦ è·¨åº¦çš„æ•°é‡çœ‹å‡º)ã€‚xml æ ¼å¼ã€‚

ä¸ºäº†åˆ›å»ºä¸€ä¸ª. txt æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ä»æ¯ä¸€ä¸ª 5 ä»¶äº‹ã€‚xml æ–‡ä»¶ã€‚å¯¹äº an ä¸­çš„æ¯ä¸ª *<å¯¹è±¡>â€¦</å¯¹è±¡>* ã€‚xml æ–‡ä»¶å–æ•°**ç±»**(å³*åç§°>â€¦</åç§°>* å­—æ®µ)ï¼Œä»¥åŠ**è¾¹ç•Œæ¡†**çš„åæ ‡(å³*<bnd box>â€¦</bnd box>*ä¸­çš„ 4 ä¸ªå±æ€§)ã€‚ç†æƒ³çš„æ ¼å¼å¦‚ä¸‹æ‰€ç¤º:

`<class_name> <x_center> <y_center> <width> <height>`

ç„¶è€Œï¼Œä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ª[è„šæœ¬](https://github.com/skanelo/Face-Mask-Detection/blob/main/xml_to_yolo.py)æ¥è·å–æ¯ä¸ªå¯¹è±¡çš„ä¸Šè¿° 5 ä¸ªå±æ€§ã€‚xml æ–‡ä»¶å¹¶åˆ›å»ºç›¸åº”çš„ã€‚txt æ–‡ä»¶ã€‚ *(* ***æ³¨:*** *æ›´å¤šå…³äºè½¬æ¢çš„æ–¹æ³•çš„è§£ææ­¥éª¤å¯ä»¥åœ¨æˆ‘çš„è„šæœ¬ä¸­æ‰¾åˆ°)ã€‚*

ä¾‹å¦‚ï¼Œ`image1.jpg`å¿…é¡»æœ‰ä¸€ä¸ªå…³è”çš„`image1.txt`ï¼ŒåŒ…å«:

```
1 0.18359375 0.337431693989071 0.05859375 0.10109289617486339
0 0.4013671875 0.3333333333333333 0.080078125 0.12021857923497267
1 0.6689453125 0.3155737704918033 0.068359375 0.13934426229508196
```

è€Œè¿™æ­£æ˜¯ä¸Šé¢çš„è½¬æ¢ã€‚xml æ–‡ä»¶è½¬æ¢ä¸º. txt æ–‡ä»¶ã€‚ *(* ***æ³¨:*** *å°†å¯¹åº”çš„å›¾åƒåˆ†ç»„åˆ°åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­è‡³å…³é‡è¦ã€‚txt æ³¨é‡Š)ã€‚*

å½“ç„¶ï¼Œåœ¨ç»§ç»­è®­ç»ƒä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç»å¯¹ç¡®å®šè½¬æ¢æ˜¯æ­£ç¡®çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬å°†ä¸ºæˆ‘ä»¬çš„ç½‘ç»œæä¾›æœ‰æ•ˆçš„æ•°æ®ã€‚ä¸ºæ­¤ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ª[è„šæœ¬](https://github.com/skanelo/Face-Mask-Detection/blob/main/show_bb.py)ï¼Œå®ƒè·å–ä¸€ä¸ªå›¾åƒåŠå…¶å¯¹åº”çš„ã€‚txt æ³¨é‡Šï¼Œå¹¶æ˜¾ç¤ºå¸¦æœ‰åŸºæœ¬äº‹å®è¾¹ç•Œæ¡†çš„å›¾åƒã€‚å¯¹äºä¸Šè¿°ç¤ºä¾‹ï¼Œå›¾åƒå¦‚ä¸‹æ‰€ç¤º:

![](img/036741fa74c2dd8204070901761d2b00.png)

maksssksksss0.png æ¥è‡ª [Kaggle çš„](https://www.kaggle.com/andrewmvd/face-mask-detection)å…¬å¼€å‘å¸ƒçš„é¢å…·æ£€æµ‹æ•°æ®é›†

è¿™æ˜¯å½“æˆ‘ä»¬çŸ¥é“åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬åšå¾—å¾ˆå¥½ï¼Œä½†è®©æˆ‘ä»¬ç»§ç»­ä¸‹å»â€¦

# ç«è½¦æµ‹è¯•åˆ†è£‚â‡ï¸

ä¸ºäº†åœ¨è®­ç»ƒé˜¶æ®µè®­ç»ƒå’ŒéªŒè¯æˆ‘ä»¬çš„æ¨¡å‹ï¼Œæˆ‘ä»¬å¿…é¡»å°†æ•°æ®åˆ†æˆä¸¤ç»„ï¼Œè®­ç»ƒç»„å’ŒéªŒè¯ç»„ã€‚æ¯”ä¾‹åˆ†åˆ«ä¸º***90â€“10%***ã€‚å› æ­¤ï¼Œæˆ‘åˆ›å»ºäº†ä¸¤ä¸ªæ–°æ–‡ä»¶å¤¹ï¼Œå°† 86 å¼ å›¾ç‰‡åŠå…¶ç›¸åº”çš„æ³¨é‡Šæ”¾å…¥ test_folderï¼Œå°†å…¶ä½™ 767 å¼ å›¾ç‰‡æ”¾å…¥ train_folderã€‚

*å†å¿è€ä¸€ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›æœ€åçš„æ¶¦è‰²ï¼Œæˆ‘ä»¬å·²ç»å‡†å¤‡å¥½è®­ç»ƒæˆ‘ä»¬çš„æ¨¡å‹äº†* **ğŸ˜…**

![](img/b54c03cdbace0162a32384d1d4799422.png)

å¸ƒé²æ–¯Â·é©¬æ–¯åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šçš„ç…§ç‰‡

# å…‹éš†æš—ç½‘æ¡†æ¶â¬‡ï¸

ä¸‹ä¸€æ­¥æ˜¯é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤å…‹éš† [**æš—ç½‘**å›è´­](https://github.com/AlexeyAB/darknet):

```
!git clone [https://github.com/AlexeyAB/darknet](https://github.com/AlexeyAB/darknet)
```

ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹çš„æƒé‡ï¼Œä»¥ä¾¿åº”ç”¨è¿ç§»å­¦ä¹ ï¼Œè€Œä¸æ˜¯ä»å¤´å¼€å§‹è®­ç»ƒæ¨¡å‹ã€‚

```
!wget https://pjreddie.com/media/files/darknet53.conv.74
```

**darknet53.conv.74** æ˜¯ YOLOv3 ç½‘ç»œçš„ä¸»å¹²ï¼Œå®ƒæœ€åˆæ˜¯ä¸º ImageNet æ•°æ®é›†ä¸Šçš„åˆ†ç±»è€Œè®­ç»ƒçš„ï¼Œå¹¶æ‰®æ¼”æå–å™¨çš„è§’è‰²ã€‚ä¸ºäº†ä½¿ç”¨è¿™ä¸€ç‚¹è¿›è¡Œæ£€æµ‹ï¼Œåœ¨è®­ç»ƒä¹‹å‰ï¼Œéšæœºåˆå§‹åŒ– YOLOv3 ç½‘ç»œä¸­å­˜åœ¨çš„é™„åŠ æƒé‡ã€‚ä½†æ˜¯å½“ç„¶ï¼Œä»–ä»¬ä¼šåœ¨è®­ç»ƒé˜¶æ®µå¾—åˆ°ä»–ä»¬åº”æœ‰çš„ä»·å€¼è§‚ã€‚

# æœ€åä¸€æ­¥ğŸš¨

æˆ‘ä»¬éœ€è¦åˆ›å»º 5 ä¸ªæ–‡ä»¶æ¥å®Œæˆæˆ‘ä»¬çš„å‡†å¤‡å·¥ä½œï¼Œå¹¶å¼€å§‹è®­ç»ƒæ¨¡å‹ã€‚

1.  **face_mask.names** :åˆ›å»ºæ–‡ä»¶ _ *ã€‚åŒ…å«é—®é¢˜ç±»åˆ«çš„åç§°*ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼ŒåŸå§‹ Kaggle æ•°æ®é›†æœ‰ 3 ä¸ªç±»åˆ«:*å¸¦ _ æ©ç *ã€*ä¸å¸¦ _ æ©ç *å’Œ*æ©ç  _ ç£¨æŸ _ ä¸æ­£ç¡®ã€‚ä¸ºäº†ç®€åŒ–ä»»åŠ¡ï¼Œæˆ‘å°†åä¸¤ä¸ªç±»åˆ«åˆå¹¶æˆä¸€ä¸ªã€‚å› æ­¤ï¼Œå¯¹äºæˆ‘ä»¬çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬æ ¹æ®æŸäººæ˜¯å¦æ°å½“åœ°ä½©æˆ´äº†å¥¹çš„/ä»–çš„é¢å…·ï¼Œå°†**åˆ†ä¸ºä¸¤ä¸ª**ç±»åˆ«:*å¥½*å’Œ*å*ã€‚*

```
1\. Good
2\. Bad
```

2. **face_mask.data** :åˆ›å»ºä¸€ä¸ª _ *ã€‚æ•°æ®*æ–‡ä»¶ï¼ŒåŒ…å«ä¸æˆ‘ä»¬çš„é—®é¢˜ç›¸å…³çš„ä¿¡æ¯ï¼Œå°†åœ¨ç¨‹åºä¸­ä½¿ç”¨:

```
classes = 2
train = data/train.txt
valid  = data/test.txt
names = data/face_mask.names
backup = backup/
```

***æ³¨:*** *å¦‚æœæ²¡æœ‰å¤‡ä»½æ–‡ä»¶å¤¹ï¼Œå°±åˆ›å»ºä¸€ä¸ªï¼Œå› ä¸ºæ¯ 1000 æ¬¡è¿­ä»£åéƒ½ä¼šä¿å­˜æƒé‡ã€‚è¿™äº›å®é™…ä¸Šæ˜¯ä½ çš„æ£€æŸ¥ç‚¹ï¼Œä»¥é˜²æ„å¤–ä¸­æ–­ï¼Œä»é‚£é‡Œä½ å¯ä»¥ç»§ç»­è®­ç»ƒè¿‡ç¨‹ã€‚*

3. **face_mask.cfg** :è¿™ä¸ªé…ç½®æ–‡ä»¶å¿…é¡»æ ¹æ®æˆ‘ä»¬çš„é—®é¢˜è¿›è¡Œè°ƒæ•´ï¼Œå³æˆ‘ä»¬éœ€è¦å¤åˆ¶ yolov3.cfgï¼Œå°†å…¶é‡å‘½åä¸º *_ã€‚cfg* å¹¶åº”ç”¨å¦‚ä¸‹æ‰€è¿°çš„ä¿®æ­£:

*   å°†ç”Ÿäº§çº¿æ‰¹æ¬¡æ›´æ”¹ä¸º[æ‰¹æ¬¡=64](https://gist.github.com/skanelo/794ce78fdd136bff336a478644c0e736#file-face_mask-cfg-L6)
*   å°†è¡Œç»†åˆ†æ”¹ä¸º[ç»†åˆ†=16](https://gist.github.com/skanelo/794ce78fdd136bff336a478644c0e736#file-face_mask-cfg-L7) ( ***æ³¨:*** *å¦‚æœå‡ºç°å†…å­˜ä¸è¶³é—®é¢˜ï¼Œå°†è¯¥å€¼å¢åŠ åˆ° 32 æˆ– 64* )
*   å°†è¾“å…¥å°ºå¯¸æ›´æ”¹ä¸ºé»˜è®¤çš„*å®½åº¦=416* ï¼Œ*é«˜åº¦=416ã€‚(* ***æ³¨*** *:å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘ä»è¿™ä¸ªåˆ†è¾¨ç‡å¼€å§‹ï¼Œå¯¹æˆ‘çš„æ¨¡å‹è¿›è¡Œäº† 4000 æ¬¡è¿­ä»£çš„è®­ç»ƒï¼Œä½†ä¸ºäº†å®ç°æ›´å‡†ç¡®çš„é¢„æµ‹ï¼Œæˆ‘* [*æé«˜äº†åˆ†è¾¨ç‡*](https://github.com/AlexeyAB/darknet#how-to-improve-object-detection) *ï¼Œå¹¶ç»§ç»­äº† 3000 æ¬¡è¿­ä»£çš„è®­ç»ƒè¿‡ç¨‹*)ã€‚
*   å°†è¡Œ [max_batches](https://gist.github.com/skanelo/794ce78fdd136bff336a478644c0e736#file-face_mask-cfg-L20) æ”¹ä¸º(#classes * 2000)ï¼Œè¿™æ ·æˆ‘ä»¬çš„ä»»åŠ¡ *(* ***æ³¨*** *)å°±æœ‰ 4000 æ¬¡è¿­ä»£:å¦‚æœä½ åªæœ‰ä¸€ä¸ª***ç±»åˆ«ï¼Œä½ ä¸åº”è¯¥åªè®­ç»ƒä½ çš„æ¨¡å‹ 2000 æ¬¡è¿­ä»£ã€‚å»ºè®® 4000 æ¬¡è¿­ä»£æ˜¯æ¨¡å‹çš„æœ€å°è¿­ä»£æ¬¡æ•°)*ã€‚*
*   *å°†ç”Ÿäº§çº¿æ­¥é•¿æ›´æ”¹ä¸º [max_batches](https://gist.github.com/skanelo/794ce78fdd136bff336a478644c0e736#file-face_mask-cfg-L22) çš„ 80%å’Œ 90%ã€‚å¯¹äºæˆ‘ä»¬çš„ä¾‹å­ï¼Œ80/100 * 4000 = 3200ï¼Œ90 / 100 * 4000 = 3600ã€‚*
*   *ä½¿ç”¨ ctrl+F å¹¶æœç´¢å•è¯â€œyoloâ€ã€‚è¿™å°†æŠŠä½ ç›´æ¥å¸¦åˆ° yolo_layersï¼Œåœ¨é‚£é‡Œä½ æƒ³åšä¸¤ä»¶äº‹ã€‚æ›´æ”¹**ç±»åˆ«æ•°é‡**(å¯¹äºæˆ‘ä»¬çš„æ¡ˆä¾‹ç±»åˆ«=2)å¹¶æ›´æ”¹[yolo]çº¿ä¸Šæ–¹ä¸¤ä¸ªå˜é‡çš„è¿‡æ»¤å™¨æ•°é‡ã€‚è¿™ä¸ªå˜åŒ–å¿…é¡»æ˜¯**è¿‡æ»¤å™¨=(ç±»+ 5) * 3** ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºæˆ‘ä»¬çš„ä»»åŠ¡ï¼Œè¿‡æ»¤å™¨= (2 + 5) * 3 = 21ã€‚åœ¨æˆ‘ä»¬çš„ã€‚cfg æ–‡ä»¶ï¼Œæœ‰ 3 ä¸ª yolo_layersï¼Œå› æ­¤ä½ åº”è¯¥åšä¸Šè¿°çš„å˜åŒ– 3 æ¬¡ã€‚*

*4. **train.txt** ä¾‹å¦‚ï¼Œæˆ‘çš„ train.txt æ–‡ä»¶çš„ä¸€ä¸ªç‰‡æ®µå¦‚ä¸‹æ‰€ç¤º:*

```
*/content/gdrive/MyDrive/face_mask_detection/mask_yolo_train/maksssksksss734.png
/content/gdrive/MyDrive/face_mask_detection/mask_yolo_train/maksssksksss735.png
/content/gdrive/MyDrive/face_mask_detection/mask_yolo_train/maksssksksss736.png
/content/gdrive/MyDrive/face_mask_detection/mask_yolo_train/maksssksksss737.png
/content/gdrive/MyDrive/face_mask_detection/mask_yolo_train/maksssksksss738.png
...*
```

**(* ***æ³¨:*** *æ­£å¦‚æˆ‘å‰é¢æåˆ°çš„ã€‚png æ–‡ä»¶åº”è¯¥ä¸å®ƒä»¬å¯¹åº”çš„ã€‚txt æ³¨è§£**

*å› æ­¤ï¼Œæˆ‘ä»¬çš„é¡¹ç›®ç»“æ„å¦‚ä¸‹:*

```
***MyDrive**
â”œâ”€â”€**darknet**
      â”œâ”€â”€...
      â”œâ”€â”€**backup**
      â”œâ”€â”€...
      â”œâ”€â”€**cfg**
            â”œâ”€â”€face_mask.cfg â”œâ”€â”€...
      â”œâ”€â”€**data**
            â”œâ”€â”€face_mask.data
            â”œâ”€â”€face_mask.names
            â”œâ”€â”€train.txt
            â”œâ”€â”€test.txtâ”œâ”€â”€**face_mask_detection**
      â”œâ”€â”€**annotations** *(contains original .xml files)* â”œâ”€â”€**images** *(contains the original .png images)* â”œâ”€â”€**mask_yolo_test** *(contains .png % .txt files for testing)* â”œâ”€â”€**mask_yolo_train** *(contains .png % .txt files for training)*
      â”œâ”€â”€ show_bb.py
      â””â”€â”€ xml_to_yolo.py*
```

# *è®©æˆ‘ä»¬å¼€å§‹è®­ç»ƒå§ğŸ“ˆ*

*åœ¨æˆ‘ä»¬[ç¼–è¯‘](https://github.com/AlexeyAB/darknet#how-to-compile-on-linux-using-make)æ¨¡å‹ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦æ›´æ”¹ç›¸å…³çš„æƒé™ï¼Œå¦‚ä¸‹æ‰€ç¤º:*

```
*!chmod +x ./darknet*
```

*æœ€åï¼Œæˆ‘ä»¬å¯ä»¥ä»è·‘æ­¥å¼€å§‹è®­ç»ƒ:*

```
*!./darknet detector train data/face_mask.data cfg/face_mask.cfg backup/face_mask_last.weights -dont_show -i 0 -map*
```

*æ ‡å¿—`-map` ä¼šé€šè¿‡æ‰“å°å‡ºå¹³å‡ä¸¢å¤±ã€ç²¾åº¦ã€å¬å›ã€å¹³å‡ç²¾åº¦(AP)ã€å¹³å‡ç²¾åº¦(mAP)ç­‰é‡è¦æŒ‡æ ‡æ¥é€šçŸ¥æˆ‘ä»¬è®­ç»ƒçš„è¿›åº¦ã€‚*

*![](img/dde1fcc9ce9211a01f4c9a99644050b4.png)*

*ä½œè€…å›¾ç‰‡*

*ç„¶è€Œï¼Œæ§åˆ¶å°ä¸­çš„ mAP æŒ‡ç¤ºå™¨è¢«è®¤ä¸ºæ˜¯æ¯”æŸè€—æ›´å¥½çš„æŒ‡æ ‡ï¼Œæ‰€ä»¥åœ¨ mAP å¢åŠ æ—¶è¿›è¡Œè®­ç»ƒã€‚*

**(* ***æ³¨:*** *è®­ç»ƒè¿‡ç¨‹å¯èƒ½éœ€è¦* ***å¤šä¸ªå°æ—¶****â€¦â€¦è¿™æ˜¯æ­£å¸¸çš„ã€‚å¯¹äºè¿™ä¸ªé¡¹ç›®ï¼Œä¸ºäº†è®­ç»ƒæˆ‘çš„æ¨¡å‹åˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘éœ€è¦å¤§çº¦ 15 ä¸ªå°æ—¶ã€‚ä½†æ˜¯æˆ‘åœ¨å¤§çº¦ 7 ä¸ªå°æ—¶å†…å®Œæˆäº† 4000 ä¸ªæ­¥éª¤çš„è®­ç»ƒï¼Œå¯¹è¿™ä¸ªæ¨¡å‹æœ‰äº†ç¬¬ä¸€å°è±¡*ã€‚*

# *æµ‹è¯•(å’Œè®¨è®º)æ—¶é—´åˆ°äº†ğŸ‰*

*æ˜¯çš„â€¦æ¨¡å‹å·²ç»å‡†å¤‡å¥½å±•ç¤ºäº†ï¼ï¼ï¼è®©æˆ‘ä»¬å°è¯•ä¸€äº›å®ƒä»æœªè§è¿‡çš„å›¾åƒã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦è¿è¡Œ:*

```
*!./darknet detector test data/face_mask.data cfg/face_mask.cfg backup/**face_mask_best.weights***
```

*ä½ æ˜¯å¦æ³¨æ„åˆ°æˆ‘ä»¬ä½¿ç”¨äº† **face_mask_best.weights** è€Œä¸æ˜¯*face _ mask _ final . weights*ï¼Ÿå¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬çš„æ¨¡å‹å°†æœ€ä½³æƒé‡(**map . 5*****87.16%***è¢«è¾¾åˆ°)ä¿å­˜åœ¨å¤‡ä»½æ–‡ä»¶å¤¹ä¸­ï¼Œä»¥é˜²æˆ‘ä»¬å¯¹å…¶è¿›è¡Œæ¯”å®ƒåº”è¯¥çš„æ›´å¤šçš„æ—¶æœŸçš„è®­ç»ƒ(è¿™å¯èƒ½ä¼šå¯¼è‡´è¿‡åº¦æ‹Ÿåˆ)ã€‚*

*ä¸‹é¢æ˜¾ç¤ºçš„ç¤ºä¾‹å–è‡ª[åƒç´ ](https://www.pexels.com/)ï¼Œæ˜¯é«˜åˆ†è¾¨ç‡å›¾åƒï¼Œç”¨è‚‰çœ¼çœ‹ï¼Œæˆ‘å¯ä»¥è¯´å®ƒä»¬ä¸æ¥è‡ªä¸åŒç‚¹çš„è®­ç»ƒ/æµ‹è¯•æ•°æ®é›†éå¸¸ä¸åŒï¼Œå› æ­¤å®ƒä»¬å…·æœ‰ä¸åŒçš„åˆ†å¸ƒã€‚æˆ‘é€‰æ‹©è¿™æ ·çš„å›¾ç‰‡æ˜¯ä¸ºäº†çœ‹çœ‹è¿™ä¸ªæ¨¡å‹çš„æ¦‚æ‹¬èƒ½åŠ›æœ‰å¤šå¼ºã€‚*

*![](img/a38c5fbdfca1eda0f61d596883f97787.png)**![](img/941c10217882b25336e3728940efa5ea.png)**![](img/aaba67c8a98ab92e32180033b9683b6b.png)*

***(å·¦)**æ¨¡ç‰¹å¯¹ä¸€å¼ ç…§ç‰‡çš„é¢„æµ‹[å¤æ´›ç‰¹æ¢…](https://www.pexels.com/@charlotte-may?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)æ¥è‡ª[æ´¾å…‹æ–¯](https://www.pexels.com/photo/crop-attractive-asian-woman-putting-on-mask-on-street-5965831/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels) | **(ä¸­)**æ¨¡ç‰¹å¯¹ä¸€å¼ ç…§ç‰‡çš„é¢„æµ‹[è’‚å§†é“æ ¼æ‹‰æ–¯](https://www.pexels.com/@tim-douglas?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)æ¥è‡ª[æ´¾å…‹æ–¯](https://www.pexels.com/photo/women-in-masks-with-shopping-bags-walking-on-street-during-coronavirus-6567212/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels) | **(å³)**æ¨¡ç‰¹å¯¹ä¸€å¼ ç…§ç‰‡çš„é¢„æµ‹æ¥è‡ª[å®‰å¨œä»€éŸ¦èŒ¨](https://www.pexels.com/@shvetsa?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)æ¥è‡ª[æ´¾å…‹æ–¯](https://www.pexels.com/photo/photo-of-person-wearing-protective-wear-while-holding-globe-4167541/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)*

*åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæ¨¡å‹æ˜¯å‡†ç¡®çš„ï¼Œå¹¶ä¸”å¯¹å…¶é¢„æµ‹ç›¸å½“æœ‰ä¿¡å¿ƒã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå³è¾¹çš„å›¾åƒæ²¡æœ‰å°†æ¨¡å‹ä¸åœ°çƒä¸Šé¢å…·çš„å­˜åœ¨æ··æ·†ã€‚å®ƒæ­ç¤ºäº†è¿™äº›é¢„æµ‹ä¸ä»…ä»…æ˜¯åŸºäºé¢å…·çš„å­˜åœ¨ï¼Œè¿˜åŸºäºå®ƒå‘¨å›´çš„ç¯å¢ƒã€‚*

*![](img/9af5ab65315c1000d1e25f3e9d559f77.png)**![](img/22c9b3b0fffc78ca4ebb1ed04f45c6b9.png)*

***(å·¦)**æ¨¡ç‰¹å¯¹ä¸€å¼ ç…§ç‰‡çš„é¢„æµ‹[é‡‘å¾·å°”ä¼ åª’](https://www.pexels.com/@kindelmedia?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)å‘è‡ª[ä½©å…‹æ–¯](https://www.pexels.com/photo/people-smiling-on-the-poolside-7294264/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels) | **(å³)**æ¨¡ç‰¹å¯¹ä¸€å¼ ç…§ç‰‡çš„é¢„æµ‹[äºšå†å±±å¤§Â·å¸•è¨é‡Œå…‹](https://www.pexels.com/@apasaric?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)å‘è‡ª[ä½©å…‹æ–¯](https://www.pexels.com/photo/woman-wearing-black-monokini-2038014/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)*

*è¿™ä¸¤ä¸ªä¾‹å­æ¸…æ¥šåœ°è¡¨æ˜ï¼Œè¢«æç»˜çš„äººæ²¡æœ‰æˆ´é¢å…·ï¼Œè€Œä¸”æ¨¡ç‰¹ä¹Ÿå¾ˆå®¹æ˜“è¯†åˆ«è¿™ä¸€ç‚¹ã€‚*

*![](img/bb581904a572aebbe530cafa83c0fd75.png)**![](img/da73d7a18c1d4c47fcc3737318109c0c.png)*

***(å·¦)**æ¨¡ç‰¹å¯¹ä¸€å¼ ç…§ç‰‡çš„é¢„æµ‹[è¯ºç›Â·è«æ»•æ£®](https://www.pexels.com/@norma-mortenson?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)æ¥è‡ª[æ´¾å…‹æ–¯](https://www.pexels.com/photo/men-putting-food-on-a-thermal-bag-4393665/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels) | **(å³)**æ¨¡ç‰¹å¯¹ä¸€å¼ ç…§ç‰‡çš„é¢„æµ‹[ç”Ÿæ´»è¦ç´§](https://www.pexels.com/@life-matters-3043471?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)æ¥è‡ª[æ´¾å…‹æ–¯](https://www.pexels.com/photo/man-with-raised-fist-in-a-protest-4614144/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)*

*åœ¨ä¸Šé¢çš„ä¸¤ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸¤ä¸ªç±»åˆ«éƒ½å‡ºç°çš„æƒ…å†µä¸‹æµ‹è¯•æ¨¡å‹çš„æ€§èƒ½ã€‚è¯¥æ¨¡å‹ç”šè‡³å¯ä»¥åœ¨æ¨¡ç³Šçš„èƒŒæ™¯ä¸­è¯†åˆ«äººè„¸ï¼Œè¿™ä¸€äº‹å®ä»¤äººé’¦ä½©ã€‚æˆ‘è¿˜è§‚å¯Ÿåˆ°ï¼Œä¸å…¶åé¢çš„é¢„æµ‹(åœ¨æ¨¡ç³ŠåŒºåŸŸä¸Šä¸º 100%)ç›¸æ¯”ï¼Œå…¶ä¸å¤ªç¡®å®šçš„æœ€å‰é¢çš„é¢„æµ‹(åœ¨æ¸…æ™°åŒºåŸŸä¸Šä»…ä¸º 38%)å¯èƒ½ä¸è¢«è®­ç»ƒçš„æ•°æ®é›†çš„è´¨é‡æœ‰å…³ï¼Œå› æ­¤å®ƒä¼¼ä¹åœ¨ä¸€å®šç¨‹åº¦ä¸Šå—åˆ°å½±å“(è‡³å°‘å®ƒä¸æ˜¯ä¸å‡†ç¡®çš„ğŸ˜… ).*

## *æœ€åä¸€æ¬¡æµ‹è¯•ğŸµ*

*å½“ç„¶ï¼ŒYOLO çš„ä¸€å¤§ä¼˜åŠ¿æ˜¯å®ƒçš„é€Ÿåº¦ã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œæˆ‘è¿˜æƒ³å‘æ‚¨å±•ç¤ºå®ƒåœ¨è¾“å…¥è§†é¢‘æ—¶æ˜¯å¦‚ä½•å·¥ä½œçš„:*

```
*!./darknet detector demo data/face_mask.data cfg/face_mask.cfg backup/face_mask_best.weights -dont_show vid1.mp4 -i 0 -out_filename res1.avi*
```

*![](img/f3d20a8c767be061f4647574d59dfcb8.png)*

*ä½œè€…å¯¹è§†é¢‘æµã€å›¾åƒçš„æ¨æ–­*

# *ç»“è®ºğŸ‘*

*è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ä¸ªåˆ†æ­¥æ•™ç¨‹ï¼Œä»‹ç»å¦‚ä½•åœ¨è‡ªå®šä¹‰æ•°æ®é›†ä¸Šä½¿ç”¨ YOLOv3 æ„å»ºè‡ªå·±çš„æ£€æµ‹å™¨ã€‚å¸Œæœ›ä½ è§‰å¾—æœ‰ç”¨ã€‚è¯·éšæ—¶ç»™æˆ‘åé¦ˆæˆ–è¯¢é—®ä»»ä½•ç›¸å…³é—®é¢˜ã€‚*

*éå¸¸æ„Ÿè°¢æ‚¨çš„å®è´µæ—¶é—´ï¼ä¸€ä¼šå„¿è§â€¦ğŸ˜œ*