# ç†ŠçŒ«åœ¨äºšé©¬é€Š S3 ä¸Šè¯»å†™æ–‡ä»¶

> åŸæ–‡ï¼š<https://towardsdatascience.com/reading-and-writing-files-from-to-amazon-s3-with-pandas-ccaf90bfe86c?source=collection_archive---------0----------------------->

## ä½¿ç”¨ boto3 åº“å’Œ s3fs æ”¯æŒçš„ pandas APIs

![](img/18248c0cb4df88af1ecfdb8e9cdaff96.png)

# **å†…å®¹**

*   åœ¨ S3 ä¸Šå°†ç†ŠçŒ«æ•°æ®å¸§å†™å…¥ CSV æ–‡ä»¶
*   >ä½¿ç”¨ boto3
*   >ä½¿ç”¨ s3fs æ”¯æŒçš„ pandas API
*   å°† S3 çš„ CSV æ–‡ä»¶è¯»å…¥ç†ŠçŒ«æ•°æ®æ¡†
*   >ä½¿ç”¨ boto3
*   >ä½¿ç”¨ s3fs æ”¯æŒçš„ pandas API
*   æ‘˜è¦

# **âš è¯·åœ¨ç»§ç»­ä¹‹å‰é˜…è¯»**

è¦ç»§ç»­å­¦ä¹ ï¼Œæ‚¨éœ€è¦å®‰è£…ä»¥ä¸‹ Python åŒ…

*   boto3
*   s3fs
*   ç†ŠçŒ«

å½“ boto3 å’Œ s3fs éƒ½è¢«æŒ‡å®šä¸ºé¡¹ç›®ä¸­çš„ä¾èµ–é¡¹æ—¶ï¼Œå­˜åœ¨ä¸€ä¸ªå…³äºä¾èµ–é¡¹è§£æçš„çªå‡ºé—®é¢˜ã€‚å¦‚æœä½ å¯¹ç»†èŠ‚æ„Ÿå…´è¶£ï¼Œè¯·çœ‹[è¿™æœŸ GitHub](https://github.com/dask/s3fs/issues/357)ã€‚å¹¸è¿çš„æ˜¯ï¼Œè¿™ä¸ªé—®é¢˜å·²ç»è§£å†³äº†ï¼Œä½ å¯ä»¥åœ¨ GitHub ä¸Šäº†è§£æ›´å¤šã€‚

åœ¨é—®é¢˜è§£å†³ä¹‹å‰ï¼Œå¦‚æœä½ éœ€è¦ä¸¤ä¸ªåŒ…(ä¾‹å¦‚ï¼Œåœ¨ç›¸åŒçš„ç¯å¢ƒä¸­è¿è¡Œä¸‹é¢çš„ä¾‹å­ï¼Œæˆ–è€…æ›´ä¸€èˆ¬åœ°ï¼Œä½¿ç”¨ s3fs è¿›è¡Œç†ŠçŒ«åˆ° S3 çš„ä¾¿æ·äº¤äº’ï¼Œä½¿ç”¨ boto3 è¿›è¡Œä¸ AWS çš„å…¶ä»–ç¼–ç¨‹äº¤äº’)ï¼Œä½ å¿…é¡»å°†ä½ çš„ s3fs å›ºå®šåˆ°ç‰ˆæœ¬â€œâ‰¤0.4â€ï¼Œä½œä¸º[è§£å†³æ–¹æ³•](https://github.com/dask/s3fs/issues/357#issuecomment-709976012)(æ„Ÿè°¢[é©¬ä¸Â·åè´å°”](https://medium.com/u/82474497d5c2?source=post_page-----ccaf90bfe86c--------------------------------))ã€‚

åœ¨é—®é¢˜è§£å†³ä¹‹å‰:

```
python -m pip install boto3 pandas "s3fs<=0.4"
```

é—®é¢˜è§£å†³å:

```
python -m pip install boto3 pandas s3fs
```

ğŸ’­åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ä½ ä¼šæ³¨æ„åˆ°ï¼Œè™½ç„¶æˆ‘ä»¬éœ€è¦å¯¼å…¥ boto3 å’Œ pandasï¼Œä½†æ˜¯æˆ‘ä»¬ä¸éœ€è¦å¯¼å…¥ s3fsï¼Œå°½ç®¡æˆ‘ä»¬éœ€è¦å®‰è£…è¿™ä¸ªåŒ…ã€‚åŸå› æ˜¯æˆ‘ä»¬åœ¨ä»£ç ä¸­ç›´æ¥ä½¿ç”¨äº† boto3 å’Œ pandasï¼Œä½†ä¸ä¼šç›´æ¥ä½¿ç”¨ s3fsã€‚å°½ç®¡å¦‚æ­¤ï¼Œç†ŠçŒ«è¿˜æ˜¯éœ€è¦å®ƒæ¥è¿æ¥ S3 äºšé©¬é€Šã€‚

> ç†ŠçŒ«ç°åœ¨ä½¿ç”¨ s3fs æ¥å¤„ç† S3 è¿æ¥ã€‚è¿™ä¸ä¼šç ´åä»»ä½•ä»£ç ã€‚ç„¶è€Œï¼Œç”±äº`s3fs`ä¸æ˜¯å¿…éœ€çš„ä¾èµ–é¡¹ï¼Œæ‚¨éœ€è¦å•ç‹¬å®‰è£…å®ƒï¼Œå°±åƒä»¥å‰ç‰ˆæœ¬çš„ pandas ä¸­çš„`boto`ã€‚( [GH11915](https://github.com/pandas-dev/pandas/issues/11915) )ã€‚
> 
> [ç†ŠçŒ« 0.20.1 ç‰ˆå‘è¡Œè¯´æ˜](https://pandas.pydata.org/pandas-docs/dev/whatsnew/v0.20.0.html#whatsnew-0200-api-breaking-s3)

# åœ¨ S3 ä¸Šå°†ç†ŠçŒ«æ•°æ®å¸§å†™å…¥ CSV æ–‡ä»¶

## ä½¿ç”¨ boto3

ä½¿ç”¨ boto3 åº“å°†ç†ŠçŒ«æ•°æ®æ¡†å†™å…¥ S3 ä¸Šçš„ CSV æ–‡ä»¶çš„æ¼”ç¤ºè„šæœ¬

## ä½¿ç”¨ s3fs æ”¯æŒçš„ pandas API

ä½¿ç”¨ s3fs æ”¯æŒçš„ç†ŠçŒ« API å°†ç†ŠçŒ«æ•°æ®æ¡†å†™å…¥ S3 ä¸Šçš„ CSV æ–‡ä»¶çš„æ¼”ç¤ºè„šæœ¬

# å°† S3 çš„ CSV æ–‡ä»¶è¯»å…¥ç†ŠçŒ«æ•°æ®æ¡†

## ä½¿ç”¨ boto3

ä½¿ç”¨ boto3 åº“å°† S3 çš„ CSV æ–‡ä»¶è¯»å…¥ç†ŠçŒ«æ•°æ®æ¡†çš„æ¼”ç¤ºè„šæœ¬

## ä½¿ç”¨ s3fs æ”¯æŒçš„ pandas API

ä½¿ç”¨ s3fs æ”¯æŒçš„ pandas APIs å°† CSV æ–‡ä»¶ä» S3 è¯»å…¥ pandas æ•°æ®æ¡†çš„æ¼”ç¤ºè„šæœ¬

# æ‘˜è¦

å¦‚æœæ‚¨åœ¨å·²ç»æœ‰ boto3 çš„ç¯å¢ƒä¸­ä½¿ç”¨ pandasï¼Œå¹¶ä¸”è¿˜å¿…é¡»ä¸å…¶ä»– AWS æœåŠ¡äº¤äº’ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½å¸Œæœ›ä½¿ç”¨ boto3ã€‚

ç„¶è€Œï¼Œä½¿ç”¨ boto3 éœ€è¦ç¨å¾®å¤šä¸€ç‚¹çš„ä»£ç ï¼Œå¹¶ä¸”ä½¿ç”¨äº†`[io.StringIO](https://docs.python.org/3/library/io.html#text-i-o)` [ã€æ–‡æœ¬ I/O çš„å†…å­˜æµã€‘](https://docs.python.org/3/library/io.html#text-i-o)å’Œ Python çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨(`[with](https://docs.python.org/3/reference/compound_stmts.html#the-with-statement)`[è¯­å¥](https://docs.python.org/3/reference/compound_stmts.html#the-with-statement))ã€‚è¿™æ˜¯å¦å¤–ä¸¤ä¸ªä½ å¯èƒ½è¿˜ä¸çŸ¥é“ï¼Œæˆ–è€…ä¸æƒ³å­¦ä¹ æˆ–è€…æƒ³å»â€œç®€å•åœ°â€è¯»/å†™ä¸€ä¸ªæ–‡ä»¶åˆ°äºšé©¬é€Š S3 çš„äº‹æƒ…ã€‚

ä¸è¿‡ï¼Œæˆ‘è¿˜æ˜¯å»ºè®®å­¦ä¹ å®ƒä»¬ï¼›ä»–ä»¬ç»å¸¸å‡ºç°ï¼Œå°¤å…¶æ˜¯`with`å£°æ˜ã€‚ä½†æ˜¯ï¼Œpandas æ»¡è¶³äº†æˆ‘ä»¬è¿™äº›â€œç®€å•åœ°â€æƒ³ä»äºšé©¬é€Š S3 è¯»å†™æ–‡ä»¶çš„äººï¼Œé€šè¿‡ä½¿ç”¨ s3fs æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œå…¶ä»£ç å³ä½¿æ˜¯ pandas çš„æ–°æ‰‹ç”¨æˆ·ä¹Ÿä¼šæ„Ÿåˆ°ç†Ÿæ‚‰ã€‚

```
aws_credentials = { "key": "***", "secret": "***", "token": "***" }
df = pd.read_csv("s3://...", storage_options=aws_credientials)
```

æˆ–è€…

```
aws_credentials = { "key": "***", "secret": "***", "token": "***" }
df.to_csv("s3://...", index=False, storage_options=aws_credentials)
```

æ„Ÿè°¢æ‚¨çš„é˜…è¯»ï¼

# ä½ æ¥ä¸‹æ¥åº”è¯¥è¯»çš„æ–‡ç« 

*   [4 ä¸ªå¤„ç†è„æ•°æ®çš„å¯çˆ± Python å‡½æ•°](/4-cute-python-functions-for-working-with-dirty-data-2cf7974280b5)
*   [æé«˜ Python ä»£ç åº“ä¸­çš„ä»£ç è´¨é‡](https://onelharrison.medium.com/improving-code-quality-in-python-codebases-f70983f2e309)
*   [å¦‚ä½•é€’å½’åè½¬é“¾è¡¨](https://medium.com/the-core/how-to-recursively-reverse-a-linked-list-9990d59fc13f)

# æ›´å¤šè®¡ç®—èµ„æº

åœ¨[OnelTalksTech.com](https://oneltalkstech.com)è§‚çœ‹æ¶µç›–å„ç§è®¡ç®—ä¸»é¢˜çš„è§†é¢‘