# åŸºäº PyCaret çš„å¤šæ—¶é—´åºåˆ—é¢„æµ‹

> åŸæ–‡ï¼š<https://towardsdatascience.com/multiple-time-series-forecasting-with-pycaret-bc0a779a22fe?source=collection_archive---------2----------------------->

## ä½¿ç”¨ PyCaret é¢„æµ‹å¤šä¸ªæ—¶é—´åºåˆ—çš„åˆ†æ­¥æ•™ç¨‹

![](img/7a759e3e5437938bb7b153b6c75bd509.png)

py caretâ€”â€”Python ä¸­çš„å¼€æºã€ä½ä»£ç æœºå™¨å­¦ä¹ åº“

# PyCaret

PyCaret æ˜¯ä¸€ä¸ªå¼€æºçš„ä½ä»£ç æœºå™¨å­¦ä¹ åº“å’Œç«¯åˆ°ç«¯çš„æ¨¡å‹ç®¡ç†å·¥å…·ï¼Œå†…ç½®äº Python ä¸­ï¼Œç”¨äºè‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ å·¥ä½œæµã€‚å®ƒå› å…¶æ˜“ç”¨æ€§ã€ç®€å•æ€§ä»¥åŠå¿«é€Ÿæœ‰æ•ˆåœ°æ„å»ºå’Œéƒ¨ç½²ç«¯åˆ°ç«¯ ML åŸå‹çš„èƒ½åŠ›è€Œå¹¿å—æ¬¢è¿ã€‚

PyCaret æ˜¯ä¸€ä¸ªæ›¿ä»£çš„ä½ä»£ç åº“ï¼Œå¯ä»¥ç”¨æ¥ç”¨å‡ è¡Œä»£ç æ›¿æ¢æ•°ç™¾è¡Œä»£ç ã€‚è¿™ä½¿å¾—å®éªŒå‘¨æœŸæˆå€åœ°å¿«é€Ÿå’Œæœ‰æ•ˆã€‚

py caret**ç®€å•**T2 å¥½ç”¨ã€‚PyCaret ä¸­æ‰§è¡Œçš„æ‰€æœ‰æ“ä½œéƒ½é¡ºåºå­˜å‚¨åœ¨ä¸€ä¸ª**ç®¡é“**ä¸­ï¼Œè¯¥ç®¡é“å¯¹äº**éƒ¨ç½²æ˜¯å®Œå…¨è‡ªåŠ¨åŒ–çš„ã€‚**æ— è®ºæ˜¯è¾“å…¥ç¼ºå¤±å€¼ã€ä¸€é”®ç¼–ç ã€è½¬æ¢åˆ†ç±»æ•°æ®ã€ç‰¹å¾å·¥ç¨‹ï¼Œç”šè‡³æ˜¯è¶…å‚æ•°è°ƒæ•´ï¼ŒPyCaret éƒ½å®ç°äº†è‡ªåŠ¨åŒ–ã€‚

æœ¬æ•™ç¨‹å‡è®¾æ‚¨å¯¹ PyCaret æœ‰ä¸€å®šçš„äº†è§£å’Œç»éªŒã€‚å¦‚æœæ‚¨ä»¥å‰æ²¡æœ‰ä½¿ç”¨è¿‡ï¼Œæ²¡å…³ç³»ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¿™äº›æ•™ç¨‹å¿«é€Ÿå…¥é—¨:

*   [PyCaret 2.2 å·²ç»å‘å¸ƒâ€”â€”æ–°åŠŸèƒ½](/pycaret-2-2-is-here-whats-new-ad7612ca63b)
*   [å®£å¸ƒ PyCaret 2.0](/announcing-pycaret-2-0-39c11014540e)
*   [å…³äº PyCaret ä½ ä¸çŸ¥é“çš„äº”ä»¶äº‹](/5-things-you-dont-know-about-pycaret-528db0436eec)

# **é‡è¿°**

åœ¨æˆ‘çš„[ä¸Šä¸€ç¯‡æ•™ç¨‹](/time-series-forecasting-with-pycaret-regression-module-237b703a0c63)ä¸­ï¼Œæˆ‘å·²ç»æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ PyCaret é€šè¿‡ [PyCaret å›å½’æ¨¡å—](https://pycaret.readthedocs.io/en/latest/api/regression.html)ä½¿ç”¨æœºå™¨å­¦ä¹ æ¥é¢„æµ‹æ—¶é—´åºåˆ—æ•°æ®ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰é˜…è¯»ï¼Œä½ å¯ä»¥å…ˆé˜…è¯»[ä½¿ç”¨ PyCaret å›å½’æ¨¡å—è¿›è¡Œæ—¶é—´åºåˆ—é¢„æµ‹](/time-series-forecasting-with-pycaret-regression-module-237b703a0c63)æ•™ç¨‹ï¼Œç„¶åå†ç»§ç»­é˜…è¯»æœ¬æ•™ç¨‹ï¼Œå› ä¸ºæœ¬æ•™ç¨‹å»ºç«‹åœ¨ä¸Šä¸€ç¯‡æ•™ç¨‹ä¸­æ¶‰åŠçš„ä¸€äº›é‡è¦æ¦‚å¿µä¹‹ä¸Šã€‚

# æ­£åœ¨å®‰è£… PyCaret

å®‰è£… PyCaret éå¸¸å®¹æ˜“ï¼Œåªéœ€è¦å‡ åˆ†é’Ÿã€‚æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒæ¥é¿å…ä¸å…¶ä»–åº“çš„æ½œåœ¨å†²çªã€‚

PyCaret çš„é»˜è®¤å®‰è£…æ˜¯ pycaret çš„ç²¾ç®€ç‰ˆæœ¬ï¼Œå®ƒåªå®‰è£…è¿™é‡Œåˆ—å‡ºçš„[ç¡¬ä¾èµ–é¡¹](https://github.com/pycaret/pycaret/blob/master/requirements.txt)ã€‚

```
**# install slim version (default)** pip install pycaret**# install the full version**
pip install pycaret[full]
```

å½“ä½ å®‰è£… pycaret çš„å®Œæ•´ç‰ˆæœ¬æ—¶ï¼Œè¿™é‡Œåˆ—å‡ºçš„æ‰€æœ‰å¯é€‰çš„ä¾èµ–é¡¹[ä¹Ÿä¼šè¢«å®‰è£…ã€‚](https://github.com/pycaret/pycaret/blob/master/requirements-optional.txt)

# ğŸ‘‰PyCaret å›å½’æ¨¡å—

PyCaret **å›å½’æ¨¡å—**æ˜¯ä¸€ä¸ªå—ç›‘ç£çš„æœºå™¨å­¦ä¹ æ¨¡å—ï¼Œç”¨äºä¼°è®¡**å› å˜é‡**(é€šå¸¸ç§°ä¸ºâ€œç»“æœå˜é‡â€ï¼Œæˆ–â€œç›®æ ‡â€)å’Œä¸€ä¸ªæˆ–å¤šä¸ª**è‡ªå˜é‡**(é€šå¸¸ç§°ä¸ºâ€œç‰¹å¾â€ï¼Œæˆ–â€œé¢„æµ‹å™¨â€)ä¹‹é—´çš„å…³ç³»ã€‚

å›å½’çš„ç›®æ ‡æ˜¯é¢„æµ‹è¿ç»­å€¼ï¼Œå¦‚é”€å”®é¢ã€æ•°é‡ã€æ¸©åº¦ã€å®¢æˆ·æ•°é‡ç­‰ã€‚PyCaret ä¸­çš„æ‰€æœ‰æ¨¡å—éƒ½æä¾›äº†è®¸å¤š[é¢„å¤„ç†](https://www.pycaret.org/preprocessing)åŠŸèƒ½ï¼Œé€šè¿‡[è®¾ç½®](https://www.pycaret.org/setup)åŠŸèƒ½ä¸ºå»ºæ¨¡å‡†å¤‡æ•°æ®ã€‚å®ƒæœ‰è¶…è¿‡ 25 ä¸ªç°æˆçš„ç®—æ³•å’Œå‡ ä¸ªå›¾æ¥åˆ†æè®­ç»ƒæ¨¡å‹çš„æ€§èƒ½ã€‚

# ğŸ‘‰èµ„æ–™ç»„

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘å°†å±•ç¤ºå¤šæ—¶é—´åºåˆ—æ•°æ®é¢„æµ‹çš„ç«¯åˆ°ç«¯å®ç°ï¼ŒåŒ…æ‹¬è®­ç»ƒå’Œé¢„æµ‹æœªæ¥å€¼ã€‚

æˆ‘ä½¿ç”¨äº† Kaggle çš„[å•†åº—å•†å“éœ€æ±‚é¢„æµ‹æŒ‘æˆ˜](https://www.kaggle.com/c/demand-forecasting-kernels-only)æ•°æ®é›†ã€‚è¯¥æ•°æ®é›†æœ‰ 10 ä¸ªä¸åŒçš„å•†åº—ï¼Œæ¯ä¸ªå•†åº—æœ‰ 50 ä¸ªé¡¹ç›®ï¼Œå³äº”å¹´(2013 å¹´è‡³ 2017 å¹´)å…± 500 ä¸ªæ¯æ—¥çº§åˆ«çš„æ—¶é—´åºåˆ—æ•°æ®ã€‚

![](img/d6e3619c8a8a56c34cfc31ea737e1b1b.png)

æ ·æœ¬æ•°æ®é›†

# ğŸ‘‰åŠ è½½å¹¶å‡†å¤‡æ•°æ®

```
**# read the csv file** import pandas as pd
data = pd.read_csv('train.csv')
data['date'] = pd.to_datetime(data['date'])**# combine store and item column as time_series**
data['store'] = ['store_' + str(i) for i in data['store']]
data['item'] = ['item_' + str(i) for i in data['item']]
data['time_series'] = data[['store', 'item']].apply(lambda x: '_'.join(x), axis=1)
data.drop(['store', 'item'], axis=1, inplace=True)**# extract features from date**
data['month'] = [i.month for i in data['date']]
data['year'] = [i.year for i in data['date']]
data['day_of_week'] = [i.dayofweek for i in data['date']]
data['day_of_year'] = [i.dayofyear for i in data['date']]data.head()
```

![](img/9472742a4063484ca0943f411ceca9f7.png)

ä»æ•°æ®ä¸­å–æ ·è¡Œ

```
**# check the unique time_series**
data['time_series'].nunique()
>>> 500
```

# ğŸ‘‰å¯è§†åŒ–æ—¶é—´åºåˆ—

```
**# plot multiple time series with moving avgs in a loop**import plotly.express as pxfor i in data['time_series'].unique():
    subset = data[data['time_series'] == i]
    subset['moving_average'] = subset['sales'].rolling(30).mean()
    fig = px.line(subset, x="date", y=["sales","moving_average"], title = i, template = 'plotly_dark')
    fig.show()
```

![](img/8a5c6bba9bb61c1bf4a71c742f551a26.png)

store_1_item_1 æ—¶é—´åºåˆ—å’Œ 30 å¤©ç§»åŠ¨å¹³å‡å€¼

![](img/92e2ae7924c011ac7a83c79af60d1d70.png)

store_2_item_1 æ—¶é—´åºåˆ—å’Œ 30 å¤©ç§»åŠ¨å¹³å‡å€¼

# ğŸ‘‰å¼€å§‹åŸ¹è®­è¿‡ç¨‹

ç°åœ¨æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº†æ•°æ®ï¼Œè®©æˆ‘ä»¬å¼€å§‹è®­ç»ƒå¾ªç¯ã€‚æ³¨æ„æ‰€æœ‰åŠŸèƒ½ä¸­çš„`verbose = False`ï¼Œä»¥é¿å…è®­ç»ƒæ—¶åœ¨æ§åˆ¶å°ä¸Šæ‰“å°ç»“æœã€‚

ä¸‹é¢çš„ä»£ç æ˜¯æˆ‘ä»¬åœ¨æ•°æ®å‡†å¤‡æ­¥éª¤ä¸­åˆ›å»ºçš„å›´ç»•`time_series`åˆ—çš„å¾ªç¯ã€‚æ€»å…±æœ‰ 150 ä¸ªæ—¶é—´åºåˆ—(10 å®¶å•†åº— x 50 ä»¶å•†å“)ã€‚

ä¸‹é¢çš„ç¬¬ 10 è¡Œæ˜¯è¿‡æ»¤æ•°æ®é›†çš„`time_series`å˜é‡ã€‚å¾ªç¯ä¸­çš„ç¬¬ä¸€éƒ¨åˆ†æ˜¯åˆå§‹åŒ–`setup`å‡½æ•°ï¼Œç„¶åæ˜¯`compare_models`å¯»æ‰¾æœ€ä½³æ¨¡å‹ã€‚ç¬¬ 24â€“26 è¡Œæ•è·ç»“æœï¼Œå¹¶å°†æœ€ä½³æ¨¡å‹çš„æ€§èƒ½æŒ‡æ ‡é™„åŠ åˆ°ä¸€ä¸ªåä¸º`all_results`çš„åˆ—è¡¨ä¸­ã€‚ä»£ç çš„æœ€åä¸€éƒ¨åˆ†ä½¿ç”¨`finalize_model`å‡½æ•°åœ¨æ•´ä¸ªæ•°æ®é›†ä¸Šé‡æ–°è®­ç»ƒæœ€ä½³æ¨¡å‹ï¼ŒåŒ…æ‹¬æµ‹è¯•é›†ä¸­å‰©ä¸‹çš„ 5%,å¹¶å°†åŒ…æ‹¬æ¨¡å‹åœ¨å†…çš„æ•´ä¸ªç®¡é“ä¿å­˜ä¸º pickle æ–‡ä»¶ã€‚

[https://gist . github . com/moe zali 1/f 258195 ba1c 677654 abffb 0 D1 ACB 2c 0](https://gist.github.com/moezali1/f258195ba1c677654abffb0d1acb2cc0)

æˆ‘ä»¬ç°åœ¨å¯ä»¥ä»`all_results`åˆ—è¡¨åˆ›å»ºä¸€ä¸ªæ•°æ®å¸§ã€‚å®ƒå°†æ˜¾ç¤ºä¸ºæ¯ä¸ªæ—¶é—´åºåˆ—é€‰æ‹©çš„æœ€ä½³æ¨¡å‹ã€‚

```
concat_results = pd.concat(all_results,axis=0)
concat_results.head()
```

![](img/39e890492b26eca22f3d4b9823de8335.png)

concat_results ä¸­çš„æ ·æœ¬è¡Œ

# åŸ¹è®­è¿‡ç¨‹ğŸ‘‡

![](img/922a02bee4875e10b3c8912236be8b80.png)

åŸ¹è®­è¿‡ç¨‹

# ğŸ‘‰ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹ç”Ÿæˆé¢„æµ‹

æ—¢ç„¶æˆ‘ä»¬å·²ç»è®­ç»ƒäº†æ¨¡å‹ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨å®ƒä»¬æ¥ç”Ÿæˆé¢„æµ‹ï¼Œä½†æ˜¯é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºç”¨äºè¯„åˆ†çš„æ•°æ®é›†(X å˜é‡)ã€‚

```
**# create a date range from 2013 to 2019**
all_dates = pd.date_range(start='2013-01-01', end = '2019-12-31', freq = 'D')**# create empty dataframe**
score_df = pd.DataFrame()**# add columns to dataset**
score_df['date'] = all_dates
score_df['month'] = [i.month for i in score_df['date']]
score_df['year'] = [i.year for i in score_df['date']]
score_df['day_of_week'] = [i.dayofweek for i in score_df['date']]
score_df['day_of_year'] = [i.dayofyear for i in score_df['date']]score_df.head()
```

![](img/f28d245d115f59aa92fb593186e6f94c.png)

score_df æ•°æ®é›†ä¸­çš„æ ·æœ¬è¡Œ

ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¾ªç¯æ¥åŠ è½½ç»è¿‡è®­ç»ƒçš„ç®¡é“ï¼Œå¹¶ä½¿ç”¨`predict_model`å‡½æ•°æ¥ç”Ÿæˆé¢„æµ‹æ ‡ç­¾ã€‚

```
from pycaret.regression import load_model, predict_modelall_score_df = []for i in tqdm(data['time_series'].unique()):
    l = load_model('trained_models/' + str(i), verbose=False)
    p = predict_model(l, data=score_df)
    p['time_series'] = i
    all_score_df.append(p)concat_df = pd.concat(all_score_df, axis=0)
concat_df.head()
```

![](img/5f3fea837151e0c77b3a2b1a13af76e1.png)

å¯¹ concat_df ä¸­çš„è¡Œè¿›è¡Œé‡‡æ ·

æˆ‘ä»¬ç°åœ¨å°†åŠ å…¥`data`å’Œ`concat_df`ã€‚

```
final_df = pd.merge(concat_df, data, how = 'left', left_on=['date', 'time_series'], right_on = ['date', 'time_series'])
final_df.head()
```

![](img/9bfa0719bd602c9365dba7a9c8010f67.png)

final_df ä¸­çš„æ ·æœ¬è¡Œ

æˆ‘ä»¬ç°åœ¨å¯ä»¥åˆ›å»ºä¸€ä¸ªå¾ªç¯æ¥æŸ¥çœ‹æ‰€æœ‰çš„å›¾ã€‚

```
for i in final_df['time_series'].unique()[:5]:
    sub_df = final_df[final_df['time_series'] == i]

    import plotly.express as px
    fig = px.line(sub_df, x="date", y=['sales', 'Label'], title=i, template = 'plotly_dark')
    fig.show()
```

![](img/e4a014ffe56421f922fa50db372d4648.png)

store_1_item_1 å®é™…é”€å”®é¢å’Œé¢„æµ‹æ ‡ç­¾

![](img/f73c671973c9b7e4a7e0e78f108a2eb4.png)

store_2_item_1 å®é™…é”€å”®é¢å’Œé¢„æµ‹æ ‡ç­¾

æˆ‘å¸Œæœ›æ‚¨ä¼šå–œæ¬¢ PyCaret çš„æ˜“ç”¨æ€§å’Œç®€å•æ€§ã€‚åœ¨ä¸åˆ° 50 è¡Œä»£ç å’Œä¸€ä¸ªå°æ—¶çš„å®éªŒä¸­ï¼Œæˆ‘è®­ç»ƒäº†è¶…è¿‡ 10ï¼Œ000 ä¸ªæ¨¡å‹(25 ä¸ªä¼°è®¡å€¼ x 500 ä¸ªæ—¶é—´åºåˆ—)ï¼Œå¹¶ç”Ÿäº§äº† 500 ä¸ªæœ€ä½³æ¨¡å‹æ¥ç”Ÿæˆé¢„æµ‹ã€‚

# å³å°†æ¨å‡ºï¼

ä¸‹å‘¨æˆ‘å°†å†™ä¸€ç¯‡å…³äºä½¿ç”¨ [PyCaret å¼‚å¸¸æ£€æµ‹æ¨¡å—](https://pycaret.readthedocs.io/en/latest/api/anomaly.html)å¯¹æ—¶é—´åºåˆ—æ•°æ®è¿›è¡Œæ— ç›‘ç£å¼‚å¸¸æ£€æµ‹çš„æ•™ç¨‹ã€‚è¯·åœ¨ [Medium](https://medium.com/@moez-62905) ã€ [LinkedIn](https://www.linkedin.com/in/profile-moez/) å’Œ [Twitter](https://twitter.com/moezpycaretorg1) ä¸Šå…³æ³¨æˆ‘ï¼Œè·å–æ›´å¤šæ›´æ–°ã€‚

ä½¿ç”¨ Python ä¸­çš„è¿™ä¸ªè½»é‡çº§å·¥ä½œæµè‡ªåŠ¨åŒ–åº“ï¼Œæ‚¨å¯ä»¥å®ç°çš„ç›®æ ‡æ˜¯æ— é™çš„ã€‚å¦‚æœä½ è§‰å¾—è¿™å¾ˆæœ‰ç”¨ï¼Œè¯·ä¸è¦å¿˜è®°ç»™æˆ‘ä»¬ GitHub åº“ä¸Šçš„â­ï¸ã€‚

æƒ³äº†è§£æ›´å¤šå…³äº PyCaret çš„ä¿¡æ¯ï¼Œè¯·åœ¨ LinkedIn å’Œ Youtube ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚

åŠ å…¥æˆ‘ä»¬çš„ä¼‘é—²é¢‘é“ã€‚é‚€è¯·é“¾æ¥[æ­¤å¤„](https://join.slack.com/t/pycaret/shared_invite/zt-p7aaexnl-EqdTfZ9U~mF0CwNcltffHg)ã€‚

# æ‚¨å¯èƒ½è¿˜å¯¹ä»¥ä¸‹å†…å®¹æ„Ÿå…´è¶£:

[ä½¿ç”¨ PyCaret 2.0](/build-your-own-automl-in-power-bi-using-pycaret-8291b64181d)
[åœ¨ Power BI ä¸­æ„å»ºæ‚¨è‡ªå·±çš„ AutoML ä½¿ç”¨ Docker](/deploy-machine-learning-pipeline-on-cloud-using-docker-container-bec64458dc01)
[åœ¨ Azure ä¸Šéƒ¨ç½²æœºå™¨å­¦ä¹ ç®¡é“åœ¨ Google Kubernetes å¼•æ“ä¸Šéƒ¨ç½²æœºå™¨å­¦ä¹ ç®¡é“](/deploy-machine-learning-model-on-google-kubernetes-engine-94daac85108b)
[åœ¨ AWS Fargate ä¸Šéƒ¨ç½²æœºå™¨å­¦ä¹ ç®¡é“](/deploy-machine-learning-pipeline-on-aws-fargate-eb6e1c50507)
[æ„å»ºå¹¶éƒ¨ç½²æ‚¨çš„ç¬¬ä¸€ä¸ªæœºå™¨å­¦ä¹  web åº”ç”¨](/build-and-deploy-your-first-machine-learning-web-app-e020db344a99)
[ä½¿ç”¨ AWS Fargate server less](/deploy-pycaret-and-streamlit-app-using-aws-fargate-serverless-infrastructure-8b7d7c0584c2)
[éƒ¨ç½² PyCaret å’Œ Streamlit åº”ç”¨](/build-and-deploy-machine-learning-web-app-using-pycaret-and-streamlit-28883a569104)

# é‡è¦é“¾æ¥

[æ–‡æ¡£](https://pycaret.readthedocs.io/en/latest/installation.html)
[åšå®¢](https://medium.com/@moez_62905)
[GitHub](http://www.github.com/pycaret/pycaret)
[stack overflow](https://stackoverflow.com/questions/tagged/pycaret)
[å®‰è£… PyCaret](https://pycaret.readthedocs.io/en/latest/installation.html) [ç¬”è®°æœ¬æ•™ç¨‹](https://pycaret.readthedocs.io/en/latest/tutorials.html) [è´¡çŒ®äº PyCaret](https://pycaret.readthedocs.io/en/latest/contribute.html)

# æƒ³äº†è§£æŸä¸ªç‰¹å®šæ¨¡å—ï¼Ÿ

å•å‡»ä¸‹é¢çš„é“¾æ¥æŸ¥çœ‹æ–‡æ¡£å’Œå·¥ä½œç¤ºä¾‹ã€‚

[åˆ†ç±»](https://pycaret.readthedocs.io/en/latest/api/classification.html) [å›å½’](https://pycaret.readthedocs.io/en/latest/api/regression.html)
[èšç±»](https://pycaret.readthedocs.io/en/latest/api/clustering.html)
å¼‚å¸¸æ£€æµ‹
[è‡ªç„¶è¯­è¨€å¤„ç†](https://pycaret.readthedocs.io/en/latest/api/nlp.html) [å…³è”è§„åˆ™æŒ–æ˜](https://pycaret.readthedocs.io/en/latest/api/arules.html)