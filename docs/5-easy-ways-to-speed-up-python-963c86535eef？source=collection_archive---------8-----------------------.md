# 加速 Python 的 5 种简单方法

> 原文：<https://towardsdatascience.com/5-easy-ways-to-speed-up-python-963c86535eef?source=collection_archive---------8----------------------->

## 使用这 5 种不同的技术加速你的 python！

![](img/a0c52c7393ede8cb820bd0c5d2819e0a.png)

(src =[https://pixabay.com/images/id-2025863/](https://pixabay.com/images/id-2025863/)

# 介绍

Python 很快发现自己是世界上最受欢迎的编程语言之一，在 T2 TIOBE 指数 T3 上徘徊在第一名和第二名之间。在全球范围内，Python 被用于数据科学和机器学习、脚本编写、软件工程，甚至 web 开发。造成这种情况的原因有很多。首先，Python 是一种非常高级的脚本语言。这使得 Python 非常容易学习。

另一件应该提到的事情是 Python 奇妙的生态系统。大多数其他类似语言的包生态系统通常注册了不到五万个包，而 Python 有大约二十万个。这些软件包也跨越了各种不同的学科。这意味着 Python 很可能是当今使用的最通用的语言之一。然而，不管 Python 有多么强大的生态系统，不管它是一种多么好的语言，没有一种语言没有它的问题。

鉴于 Python 的高级语法和声明性编程特性，可以假设 Python 很可能是一种脚本语言。这意味着它不是被编译，而是被编译的编程语言主动读取，在这个例子中是 C 编程语言。幸运的是，C 是底层迭代编程的标准。这意味着 Python 通常能与许多其他使用 C 语言的语言以及 C 语言本身相处融洽。其实可以从 c 写 Python。

然而，对于任何一种解释型编程语言来说，速度总是一个问题，Python 也不例外。虽然与其他类似的语言相比，Python 是一种非常快速的语言，但它的速度仍然比不上一些编译后的低级解决方案，如 C 或 C++。速度往往是 Python 的致命弱点。虽然这种语言有许多优点，但解释的速度通常被认为是它最大的弱点。然而，有一些简单的技术可以用来非常有效地提高 Python 的速度。

# №1:迭代工具

迭代是一件会显著降低计算速度的事情。当然，任何循环都是如此，尤其是在 Python 这样的语言中。虽然 Python 确实支持多线程，但一般来说，控制线程和进程的语法过于声明性，无法像在其他编程语言中那样有效地控制它们。因为 Python 本质上是相当单线程的，所以当它在循环中工作时，迭代经常会使整个应用程序停止。

Python 的标准库中也包含了一个很好的模块来加速这些循环技术，它就是 Itertools。Itertools 模块附带了一些工具，可以通过其他包而不是 Python.h 提供的替代 C 实现快速循环。这些函数通常会导致更快的迭代。我有一整篇文章更详细地介绍了使用 itertools 加速一些算法的例子，你可以在这里阅读:

[](/wicked-fast-python-with-itertools-55c77443f84c) [## 使用 Itertools 的超快速 Python

### 快速浏览一种简单的方法，通过使用 itertools 让 Python 更快、更有效地进行机器学习…

towardsdatascience.com](/wicked-fast-python-with-itertools-55c77443f84c) 

# №2:线程

另一种提高 Python 速度的标准库方法是使用多线程。Python 是作为单线程的高级编程语言而构建的，所以在很多方面，当用 Python 实现多线程时，它会变得更加困难。然而，在大多数例子中，创建一个新流程只是一个简单的调用。

我发现在 Python 中使用线程的最大问题是进程是未命名的，并且不可管理。这意味着您可以在做其他事情时创建进程来处理循环和算术，但很难回调这些线程并管理它们正在做的事情。当然，在大多数情况下，这是不必要的，所以这对于一般的 Python 程序员来说肯定是很方便的。我们可以通过首先从 Python 的标准库中导入线程模块来使用线程:

```
import threading
```

接下来，我们需要为新线程编写一个函数:

```
import time as ti
def sleeper():
    ti.sleep(5)
    print("Hello")
```

现在我们可以通过初始化线程来构造一个新的对象。线程类别:

```
x = threading.Thread(target = sleeper)
```

我们可以使用目标函数的关键字参数来设定我们的目标。如果我们的函数需要提供参数，那么我们可以添加 args 关键字参数。我还会举一个例子:

```
import time as ti
def sleeper(n):
    ti.sleep(n)
    print("Hello")x = threading.Thread(target = sleeper, args = (5))
```

然后我们可以用 Thread.start()启动我们的线程:

```
x.start()
```

不用说，在加速代码的时候，同时做两件事是非常有效的。尽管 Python 中的线程实现不是世界上最好的，但它确实值得了解和使用！

# №3:数字巴

即时编译(Just In Time compilation)或 JIT 编译是一种编译技术，它使解释的代码同时被编译、执行和编译。每当我们编译 Python 应用程序时，都要考虑到一定的开销，因为代码中的所有数据都需要注册和分配数据。这是为了每当调用这些对象时，Python 在每个作用域中都有一个对此的引用。JIT 编译可以用来减少这种开销。

使用 JIT 编译，我们不是在运行应用程序之前分配所有这些数据，而是在应用程序运行时进行。这减少了编译到执行的开始时间，就像在线程中一次做多件事一样，在编译时一次做多件事也可以显著加快代码的速度。

Python 中通常使用的包是一个名为 Numba 的包。Numba 实现的伟大之处在于它非常容易使用！Numba 使用一个简单的装饰器让 Python 在某些函数和类上激活 JIT。我写了一篇关于 Numba 的文章，如果你想了解更多，可以看看:

[](/numba-jit-compilation-but-for-python-373fc2f848d6) [## Numba: JIT 编译，但是用于 Python

### 快速浏览一下 2020 年让 Python 变得更好的神奇工具。

towardsdatascience.com](/numba-jit-compilation-but-for-python-373fc2f848d6) 

# №4: Cython

另一个加速 Python 的流行选择是 Cython。Cython 是一种你可以利用 C 语言速度的方法，甚至不需要了解或编写 C 语言。虽然它当然没有使用 C 语言那么快，但这是坚持使用 Python 的一个很好的方法，同时也加快了速度。

许多程序员将 Cython 视为 Python 速度的可靠解决方案，但我认为这是一个错误。Cython 并不适用于 Python 中的所有内容。在很多情况下，Python 无法正确地执行 Cythonize，虽然这种情况不太常见，但总是有可能的。使用 Cython 处理依赖关系也可能是一场噩梦，如果计划在您的技术堆栈中使用它，这是一件需要考虑的重要事情。我们可以从 Cython 中导入 cythonize 函数。从 Cython 包中构建模块。当然，这个模块不在标准库中，所以您需要自己添加。您还需要从标准库工具 setuptools 创建一个设置，因此我将导入这两个工具:

```
**from** **setuptools** **import** setup
**from** **Cython.Build** **import** cythonize
```

我们需要构建一个 Cython 构建文件，通常称为 setup.py

```
setup(
    ext_modules = cythonize("example.pyx")
)
```

您还需要将正在使用的任何 Python 模块命名为. pyx 文件，而不是. py 文件。最后，为了构建我们的 Cython，我们将使用 Python 命令行界面，如下所示:

```
python setup.py build_ext --inplace
```

这将创建一个示例。所以，这个文件现在是一个编译后的二进制文件，我们可以从 Python 中使用它，我们可以简单地导入它，并像您可能期望的那样在 Python 代码中使用它。

# №6:并行计算

您可以选择利用的另一个解决方案是并行计算。并行计算结合了图形卡的能力和计算机处理器的能力。在我们使用并行计算之前，我们应该总是考虑图形处理器实际上做什么。图形处理器是一种专门的设备，擅长特定的任务，而不擅长其他任务。换句话说，没有 APU 的处理器将是一个糟糕的图形处理器。同样，中央处理器将是一个可怕的图形处理器。

考虑到这一点，我们应该考虑到图形处理器非常擅长处理大量的数字。这意味着当应用于机器学习中的统计计算时，它们是很棒的，所以在许多数据科学的情况下，并行计算确实可以显著提高速度。前面我们谈到了使用 Numba 的 JIT 编译来加速代码，但是 Numba 包也提供了用于 CUDA 编程的工具。当然这是针对 Nvidia 卡的。

```
from numba import cuda
```

为了使用 CUDA，您还需要导出一个环境变量。我个人的~/里就有这个。当然，如果您不希望在 Bash 的每次使用中都声明这个变量，那么您可以简单地将它放入一个终端会话中:

```
export NUMBA_ENABLE_CUDASIM=1
```

像 Numba 的 JIT 一样，我们简单地使用一个装饰器来决定一个函数是否要使用 CUDA，这非常简单！更酷的是，我们可以将 CUDA 和 JIT 结合起来，获得令人难以置信的快速结果！

```
from numba import cuda

@cuda.jit
def example(io_array):
    print(io_array)
```

现在我们知道了并行计算，我们应该考虑到这种语言的实现肯定不是世界上最好的。Python 有缺点，并行计算无疑是其中之一。与其他语言相比，在 Python 中使用 CUDA 总是更加困难，因为它的基础从来没有考虑到并行计算。这是 Julia 的一个优点，它是在并行计算开始流行的时候建立的。我有一篇文章详细介绍了如何使用它的 CUDA 实现，对于那些对 Julia 感兴趣的人，你可以在这里阅读:

[](/julias-fantastic-cuda-implementation-and-why-it-is-better-than-python-s-ca76e575c526) [## Julia 神奇的 CUDA 实现

### 使用 CUDA.jl 包探索简单并行计算的真正力量。

towardsdatascience.com](/julias-fantastic-cuda-implementation-and-why-it-is-better-than-python-s-ca76e575c526) 

另一个巨大的负面影响是，为了实际使用并行计算，你需要一个图形处理单元。图形卡是计算机中最昂贵的硬件之一，所以获得一个能够帮助你的代码快速运行的图形卡是非常困难的，这是这种技术的一个很大的缺点。此外，如果你像我一样喜欢笔记本电脑的便利性，很可能你不会找到一款内置图形处理器的非常轻的笔记本电脑。就个人而言，我喜欢 11-13 英寸的笔记本电脑，但我通常会选择体积庞大的 15 英寸笔记本电脑，这不是我对电脑的偏好。

# №7:功能工具

另一个非常容易使用的解决方案是 FuncTools。这个模块在标准库中，它是如此的通用，以至于很难涵盖其中的所有内容。这个包提供了许多装饰器，可以真正加速你的代码，或者只是让你的语法更加用户友好。我认为 Functools 肯定是一个值得了解的包。

正如我提到的，FuncTools 有很多能力。例如，这个包可以让 Python 使用单分派，这改变了类型和函数一起使用的方式。这个模块本身非常棒，在很多情况下非常有用，没有理由不使用它。该模块还提供了一个缓存装饰器，允许您缓存 Python 中的值以备后用，这对于代码中经常使用的函数非常有用。

# №8: C

如果这些解决方案似乎都不适合你，你可以时不时地使用 C 语言。Python 最大的特点之一就是它是用 C 语言构建的，所以在需要速度的时候，C 语言通常可以作为语言的后备。您也不需要用 C 编写所有代码，并且可以从 Python 中调用它。当然，这将是这个列表中其他解决方案的一个巨大转变。c 是一门伟大的语言，但是它的命令式本质确实使得它需要花费更多的时间来编写。

# 结论

Python 是一门伟大的语言。由于各种原因，这种语言最近变得如此流行，当涉及到机器学习应用程序时，它是一个很好的选择。然而，机器学习在硬件上可能很难，与 C 和 C++等编译语言相比，Python 往往会停滞不前。然而，使用这些技术，您可以非常容易地大幅提高 Python 的速度，并使其在某些问题上的应用实际上非常接近 c 语言的速度。感谢您阅读我的文章，祝您编程愉快！