# 数据科学中的因果推理:多重比较的有效推理覆盖

> 原文：<https://towardsdatascience.com/causal-inference-in-data-science-valid-inferential-coverage-with-multiple-comparisons-750e9e3f0259?source=collection_archive---------32----------------------->

## *FWER* 和 *FDR* 上限程序的数学严格推导和计算模拟

![](img/4ec939cc696485da9565c41a0594ca1d.png)

照片由[埃米尔·佩龙](https://unsplash.com/@emilep?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 拍摄

# 1:背景和动机

因果推理是众多从业者感兴趣的领域，包括统计学家、数据科学家、机器学习科学家和其他计算研究人员。关于随机和非随机环境中因果效应位置参数的无偏估计的恢复，我已经写了几篇文章，包括:

*   [因果推理中的有效抽样框架](/efficient-sampling-frameworks-in-causal-inference-data-science-52ad44e15f48)
*   [因果推断中的双重稳健估计技术](/doubly-robust-estimators-for-causal-inference-in-statistical-estimation-3c00847e9db)
*   [半参数结构嵌套模型的 G-估计](/causal-inference-in-data-science-g-estimation-of-structural-nested-models-d11b1e3c9360?source=post_stats_page-------------------------------------)
*   [在存在 M 偏差结构的情况下恢复因果效应](/causal-inference-in-data-science-structure-of-m-bias-with-confounding-adjustment-70e4a263ad08)
*   [在 AB 试验/随机试验中对边缘结构建模的需求，用于信息性审查调整](/causal-inference-in-data-science-a-b-testing-and-the-need-for-marginal-structural-modeling-b9ab299681bb)

在这篇文章中，我们将重点转移到因果效应估计的推理覆盖的有效估计。具体来说，我在这里提供了一个相当严格和数学支持的多重测试问题的介绍，这是特别重要的大规模多终点分析。

让我们用一个简单的例子来说明多重测试问题:

回想一下，在假设检验框架中，当一个无效假设被拒绝，而另一个假设被接受时，就会出现第一类错误，但这是在无效假设事实上为真的情况下。理想情况下，我们希望用一个阈值来“控制”第一类错误发生的概率。我们把这个阈值称为α*。*

*现在假设分析有两个结果终点。我们需要进行两个独立的假设检验。让我们假设这两个假设检验是相互独立的。我们为两个测试中的每一个指定单独的 I 型误差阈值 ***a*** =0.05:*

*![](img/422ea9b1f1fd7257d16599d170b649d8.png)*

*作者图片*

*问题是，如果我们的两个测试中的两个各自的无效假设事实上都为真，那么两个假设测试中的 ***至少有一个*** 产生“统计显著性结果”(即 p 值≤ ***a*** )的概率有多大，从而导致我们拒绝该测试的各自的无效假设，而选择另一个测试:*

*![](img/85a564f74867bb738907e2b4d38418a5.png)*

*作者图片*

*尽管我们将每个个体假设检验控制在个体 I 型错误阈值*= 0.05，但 *FWER* 几乎是该阈值的两倍( *FWER* =0.0975)。**

**随着被研究的单个测试数量的增加，这种现象变得越来越严重。假设所有感兴趣的测试都是独立的，如果我们有 14 个感兴趣的假设测试(实际上都是空的)，每个假设测试都有一个测试特定的第一类错误阈值 ***a*** =0.05，那么 *FWER* 就变得不比掷硬币好( *FWER* ≈0.512):**

**![](img/696b13445036fd5d9117db31731c25c2.png)**

**作者图片**

**这个问题与因果效应的有效估计有什么关系？在随机和非随机分析的因果推断中，研究多个终点和/或多个感兴趣的结果可能非常常见。**

**假设我们是一家制药公司，正在测试一种新药对几个感兴趣的拟议结果的因果影响。不为公众所知的是，这种新药是一种“糖丸”安慰剂，对任何实质性相关的医疗结果没有真正的因果关系。假设我们偷偷意识到了上面的数学现象，我们特意提出了 100 个我们感兴趣的不同结果，以增加我们获得 FDA 药物批准的可能性。如果在个体水平α阈值 ***a*** =0.05 下进行每个假设检验，从概率上讲，我们实际上可以保证产生至少一个具有统计显著性的检验，即使所有的检验实际上都是无效的。这被通俗地称为*“钓 p 值”或“p 黑客”*。我们只是不断地进行越来越多的测试，直到我们“发现”一个具有统计学意义的结果，并错误地认为它是一个“重要的发现”。在分析中，这是一个不受欢迎的动机。我们需要一种数学上严格的方法来防止这种激励，并调整我们的结果。**

**在本文中，我们将介绍两个通用框架来调整多重比较问题:**

*   **家族错误率( *FWER* )**
*   **错误发现率( *FDR***

**并且以一种数学上严格的方式将涵盖不同的方法来上限化 *FWER* 和/或 *FDR* 。我们也将进行一个计算模拟来进一步检验这些方法在实际应用中的效果。**

**这篇文章的目录如下:**

**![](img/b215c08e5dc96b4aed9a940aca8cf7b6.png)**

**作者图片**

# **2: **家庭式错误率(FWER)****

## **2.1:FWER 的数学规范**

**让我们举一个玩具的例子:**

**![](img/9cdbc7b8852b9489bf942eea473d7b2a.png)**

**作者图片**

**![](img/a0676f8e71622c12348439fc47891dee.png)**

**作者图片**

## **2.2: Bonferroni 程序**

**![](img/dd9ee58ba29e8e6688719137947d4aad.png)**

**作者图片**

**![](img/8d2560d893256c99aaf30a466b288682.png)**

**作者图片**

## **2.3: Sidak 程序**

**![](img/f93cde5ddada1ee48c4c57c665662645.png)**

**作者图片**

**![](img/1b3ea879b67e5408ff8251952deff45e.png)**

**作者图片**

## **2.4:霍尔姆-邦费罗尼(HB)降压程序**

**![](img/e2f82b561bbcc8f815de97858d90e3e6.png)**

**作者图片**

**![](img/4d33410a387b6f568c82e4b5f222a4c2.png)**

**作者图片**

## **2.5:霍尔姆-西达克(HS)降压程序**

**![](img/8d7f64c1715daea9d4aab98bbcb8c2f7.png)**

**作者图片**

**![](img/f149655ab619f41e836e448348294fc6.png)**

**作者图片**

## **2.6:霍赫伯格升压程序**

**![](img/37db9a0ab63f8cb9ce2811720e27c439.png)**

**作者图片**

## **2.7:排列程序**

**![](img/90dee49997bdc794a50588efb9f14b00.png)**

# **3:错误发现率(FDR)**

## **3.1:FDR 的数学规范**

**让我们回到我们的玩具例子:**

**![](img/490d5dcc078d92fda4ba0058481f12a8.png)**

**作者图片**

**![](img/13154caed55153fa406ffa6834259e7c.png)**

**作者图片**

## **3.2: Benjamini-Hochberg(波黑)升压程序**

**![](img/4846571cbfb2da10f28e76f73c8d1d64.png)**

**作者图片**

## **3.3:Benjamin-Yekutieli(BY)升级程序**

**![](img/26b696268a2ce8c4fe5fd41ce379d095.png)**

**作者图片**

# **4:简短的旁白**

## **4.1: **负相关假设检验****

**在我们对 *FWER* 和 *FDR* 控制技术的讨论中，我们提到了感兴趣的统计测试的依赖结构。我们的一些控制技术在任意依赖结构下是有效的，而另一些只在独立或正相关结构下有效。然而，在实践中，除非我们使用单侧检验技术来恢复特定检验的 p 值，否则负相关检验并不值得特别关注。**

**为了理解为什么会出现这种情况，让我们检查一下我们所说的“相关测试”是什么意思。重要的是，“假设检验的相关性”不一定等同于“变量的相关性”或“数据的相关性”。例如，如果我们认为两个统计测试“正相关”，我们规定如果我们已经进行了其中一个统计测试并发现它产生了一个具有统计显著性的结果，那么剩余的统计测试产生一个具有统计显著性的结果的条件概率 ***比其相应的所述结果的边际概率*** 大。回想一下，对于双边统计推断测试，如果测试统计量在其零样本下的抽样分布的任一侧*足够极端，我们认为该测试具有统计显著性。也就是说，如果两个检验中的“变量”或“数据”是负相关的，并且其中一个假设检验产生了具有统计学意义的结果，这就告诉我们，另一个假设检验有很大的概率产生一个极端的检验统计量，但是在各自的抽样分布的另一侧处于零。因为我们进行的是双边假设检验，这个足够极端的检验统计量导致了一个小的具有统计显著性的 p 值，从而导致了两个正相关的检验，即使这两个检验中的数据是负相关的。***

**在双边检验的情况下，两个检验呈负相关意味着如果我们完成了其中一个统计检验并发现它产生了具有统计意义的结果，则剩余的统计检验产生具有统计意义的结果的条件概率低于相同结果的相应边际概率。如果你仔细思考前面的陈述，你会发现这是一个奇怪的场景。很难假设一个真实世界的用例会发生这种情况。**

**因此，如果我们专门进行双边检验，负相关检验的合理可能性很低，不必特别关注。然而，在单侧测试的情况下，当选择 *FWER* 和 *FDR* 调整程序时，应仔细权衡负相关测试的可能性。**

## **4.2: **阿尔法支出****

**接下来，我们将讨论“阿尔法支出”的概念。我发现在 *FWER* 的上下文中解释这个概念最有意义。**

**让我们假设我们是在不相关测试的 Sidak 程序所需的假设下工作的，但是只有两个感兴趣的测试:**

**![](img/2cbcbb8bad4956843167d913e88b6420.png)**

**作者图片**

**![](img/fdbecad94c404f52a833d1a154bab588.png)**

**作者图片**

**对于阿尔法支出，把我们的 *FWER* 想象成一个货币金额。我们可以把这笔钱花在每个单独测试的 alpha 阈值上。我们在每个门槛上花费的金额不需要相同，只要我们保持在总货币的预算之内。**

**事实上，阿尔法支出是我们一直在用本文中描述的所有方法执行的事情，我们只是没有明确地这样说。我们一直使用的阿尔法支出的“默认”形式是在所有个人阈值上的“相等”支出。**

**注:在实践中，任何杠杆α支出方案必须在分析的研究设计阶段加以规定；我们不能在收集了数据并对其进行了分析之后，再追溯性地指定这些阈值。这样做将不再束缚*号前锋*和*号罗斯福*。**

# **5.FWER & FDR 控制方法的计算机模拟**

**下面是本文中讨论的 7 个 *FWER* 方法和 2 个 *FDR* 方法的 Python 计算模拟。**

**对于每种 *FWER* 和 *FDR* 方法，进行了四次计算分析，每次分析指定 2000 次模拟，每次 200 次假设检验。根据 *FWER* 和 *FDR* 方法的四个模拟在 200 个测试假设(200 或 150)中的真零假设数量以及 200 个测试的相关结构(不相关或正相关)上有所不同。所有测试都是在假设双边推理测试的情况下进行的。**

**让我们导入需要的库和助手函数:**

**…接下来指定恢复模拟数据集的函数:**

**…我们的 FWER 分析功能:**

**…我们的 FDR 分析功能:**

**…以及恢复我们的模拟结果:**

**以下是我们计算模拟的经验结果:**

**![](img/522eb69a8d9f2801a6f00970981026b2.png)**

**作者图片**

**上面的计算模拟结果很好地反映了这件作品中数学推导出的材料。例如，Holm-Bonferroni 程序通常比 Bonferroni 程序在估计的 *FWER* 上产生更严格的上限。**

**以上计算模拟的完整代码/笔记本，请参见下面的 [**github 链接**](https://github.com/atrothman/Multiple_Testing_Procedures) 。**

# **6.总结和结论**

**这包括我们对多重比较问题的解释，在实践中对 FWER 和 FDR 进行上限的方法，以及演示这些方法的计算机模拟。我也鼓励任何发现上述材料有见地的人创建他们自己的模拟示例，利用我的代码作为起点，并自己进行实验！**

**如果你想了解更多关于因果推理的方法和注意事项，我会推荐哈佛大学的 Miguel Hernan 和 Jamie Robins(我以前的两位教授)的教科书“ *Causal Inference: What If* ”，加州大学洛杉矶分校的 Judea Pearl 的“Causal”，斯坦福大学的达芙妮·黑仔和耶路撒冷希伯来大学的 Nir Friedman 的“概率图形模型:原理和技术，以及加州大学伯克利分校的 Mark van der Laan 和斯坦福大学的 Sheri Rose 的两本关于*目标最大似然估计*的教科书这些都是很棒的文章。我计划在未来写更多关于因果推理的深度文章。**

**[因果推断:如果](https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/)会怎样**

**[因果关系](http://bayes.cs.ucla.edu/BOOK-2K/)**

**[概率图形模型:原理和技术](https://mitpress.mit.edu/books/probabilistic-graphical-models)**

**[目标最大似然估计](https://vanderlaan-lab.org/papers/)**

**希望以上有见地。正如我在以前的一些文章中提到的，我认为没有足够的人花时间去做这些类型的练习。对我来说，这种基于理论的洞察力让我在实践中更容易使用方法。我个人的目标是鼓励该领域的其他人采取类似的方法。我打算将来写一些基础作品，所以请随时在 [**LinkedIn**](http://www.linkedin.com/in/andrew-rothman-49739630) 上与我联系， [**在 Medium**](https://anr248.medium.com/) 上关注我的更新！**