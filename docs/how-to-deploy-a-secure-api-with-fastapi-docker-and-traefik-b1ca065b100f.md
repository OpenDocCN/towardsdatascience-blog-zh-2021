# å¦‚ä½•ç”¨ FastAPIã€Docker å’Œ Traefik éƒ¨ç½²å®‰å…¨ API

> åŸæ–‡ï¼š<https://towardsdatascience.com/how-to-deploy-a-secure-api-with-fastapi-docker-and-traefik-b1ca065b100f?source=collection_archive---------2----------------------->

## é…ç½® HTTP **S** çš„æŒ‡å—

![](img/dda9997ed60843f9a7620a353384f849.png)

ç…§ç‰‡ç”±[é£:D](https://unsplash.com/@flyd2069?utm_source=medium&utm_medium=referral) åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

å½“æˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ª API æ¥æœåŠ¡ä¸€ä¸ªæœºå™¨å­¦ä¹ æ¨¡å‹æ—¶ï¼Œæˆ‘ä»¬å¾ˆå°‘å…³å¿ƒé‚£ä¸ªç»¿è‰²çš„æŒ‚é”ï¼Œå®ƒä½¿å¾— HTTP è¿æ¥è¢«è®¤ä¸ºæ˜¯å®‰å…¨çš„ï¼Œæµè§ˆå™¨æ˜¯å¿«ä¹çš„ã€‚

![](img/cf05160bacc4eed4326384ddb225472b.png)

ä½œè€…å›¾ç‰‡

æˆ‘ä»¬é€šå¸¸è®¤ä¸º HTTPS æ˜¯ç†æ‰€å½“ç„¶çš„ï¼Œæˆ‘ä»¬å¯èƒ½è®¤ä¸ºå®ƒåªæ˜¯é€šè¿‡ä¸€äº›ç®€å•çš„é…ç½®å°±å¯ä»¥æ‰“å¼€*ã€‚*

*äº‹å®æ˜¯ï¼Œæ·»åŠ  HTTPS éœ€è¦å‡ ä¸ªæ­¥éª¤ã€‚*

> *è¿™å°±æ˜¯è¿™ç¯‡æ–‡ç« çš„ç›®çš„:è§£é‡Šä¸ºä»€ä¹ˆ HTTPS å¾ˆé‡è¦ï¼Œä»¥åŠå½“ä½ ç”¨ Python æ„å»º web åº”ç”¨å’Œ API æ—¶ï¼Œå¦‚ä½•å°†å®ƒæ·»åŠ åˆ°ä½ çš„éƒ¨ç½²ä¸­ã€‚*

*ä»¥ä¸‹æ˜¯æˆ‘ä»¬å°†åœ¨æœ¬å¸–ä¸­ä»‹ç»çš„å†…å®¹:*

1.  ***HTTPS ç®€ä»‹:å®ƒæ˜¯å¦‚ä½•è¿ä½œçš„ï¼Œä¸ºä»€ä¹ˆä½ åº”è¯¥å…³æ³¨å®ƒï¼Ÿ***
2.  ***ç”¨ FastAPI æ„å»º API***
3.  ***ä»‹ç» Traefik åŠå…¶å¦‚ä½•å¤„ç† HTTPS***
4.  ***é€šè¿‡ Docker é›†æˆ FastAPI å’Œ Traefik***
5.  ***åœ¨ AWS ä¸Šéƒ¨ç½²***

*è¿™ä¸ªæŒ‡å—å°†æœ€ç»ˆå¸®åŠ©æ‚¨æ·»åŠ  HTTPS åˆ°æ‚¨çš„é¡¹ç›®ã€‚æ‚¨å¯ä»¥é‡ç”¨ä»¥ä¸‹ä»£ç æ¥æ„å»ºå®‰å…¨çš„é¡¹ç›®ã€‚*

*äº‹ä¸å®œè¿Ÿï¼Œè®©æˆ‘ä»¬ç›´æ¥å¼€å§‹å§ğŸš€*

**PS*:æ­¤ä»£ç åœ¨*[*Github*](https://github.com/ahmedbesbes/fastapi-ssl)*ä¸Šæœ‰ã€‚**

**PS**:å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äº FastAPIã€Docker å’Œ Github çš„åŠ¨ä½œï¼Œä¸€å®šè¦çœ‹çœ‹æˆ‘ä¹‹å‰çš„* [*å¸–å­*](/how-to-deploy-a-machine-learning-model-with-fastapi-docker-and-github-actions-13374cbd638a) *ã€‚**

*[](/how-to-deploy-a-machine-learning-model-with-fastapi-docker-and-github-actions-13374cbd638a) [## å¦‚ä½•ç”¨ FastAPIã€Docker å’Œ Github åŠ¨ä½œéƒ¨ç½²æœºå™¨å­¦ä¹ æ¨¡å‹

### å…·æœ‰ CI/CD çš„ç«¯åˆ°ç«¯ç®¡é“

towardsdatascience.com](/how-to-deploy-a-machine-learning-model-with-fastapi-docker-and-github-actions-13374cbd638a)* 

# *å¤åˆ¶æœ¬æ•™ç¨‹éœ€è¦ä»€ä¹ˆ*

*   *æ³¨å†Œçš„åŸŸåã€‚ä½ å¯ä»¥èŠ±å‡ å—é’±åœ¨ T42 ä¹°åˆ°ä¸€ä¸ª*
*   *å®‰è£…åœ¨æœ¬åœ°æœºå™¨ä¸Šçš„ Docker å’Œ docker-compose:ä½ å¯ä»¥éµå¾ªå®˜æ–¹çš„[æ–‡æ¡£](https://docs.docker.com/engine/install/ubuntu/)*
*   *éƒ¨ç½² API çš„è¿œç¨‹æœåŠ¡å™¨:æˆ‘åœ¨ AWS EC2 ä¸Šä½¿ç”¨äº†ä¸€ä¸ª`t2-medium`å®ä¾‹ã€‚ä»»ä½•åŒç­‰çš„ä¸œè¥¿éƒ½åº”è¯¥æ˜¯å¥½çš„ã€‚
    ç¡®ä¿è¿™ä¸ªå®ä¾‹æœ‰**å›ºå®šçš„ IP åœ°å€**ã€‚*
*   *åœ¨æ‚¨çš„åŸŸæä¾›è€…ä¸Šï¼Œåˆ›å»ºä¸€ä¸ªæŒ‡å‘å®ä¾‹ IP åœ°å€çš„ A è®°å½•ã€‚æˆ‘ç›®å‰æ‹¥æœ‰ ahmedbesbes.comï¼Œä¸ºäº†è¿™ä¸ªæ•™ç¨‹ï¼Œæˆ‘åˆ›é€ äº†ä»¥ä¸‹è®°å½•:**ssl.ahmedbesbes.comã€‚**ä½ å¯ä»¥é€šè¿‡é€‰æ‹©ä»»ä½•ä½ æƒ³è¦çš„å­åŸŸæ¥å¯¹ä½ çš„åŸŸåšåŒæ ·çš„äº‹æƒ…ã€‚
    OVH çš„ç•Œé¢çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„( [OVH](https://www.ovh.com/) æ˜¯æˆ‘çš„åŸŸåæä¾›å•†)*

*![](img/aa9574eba08abf5138e64000b3fa715c.png)*

*ä½œè€…æˆªå›¾*

# *ä»€ä¹ˆæ˜¯ HTTPSï¼Œä½ ä¸ºä»€ä¹ˆè¦å…³å¿ƒå®ƒï¼Ÿ*

*HTTPS æ˜¯åŸºäºåŠ å¯†åè®®çš„ HTTPã€‚è¿™ä¸ªåè®®è¢«ç§°ä¸ºä¼ è¾“å±‚å®‰å…¨æ€§( **TLS** )ï¼Œå®ƒä»¥å‰è¢«ç§°ä¸ºå®‰å…¨å¥—æ¥å­—å±‚( **SSL** )ã€‚*

*æ¢å¥è¯è¯´ï¼ŒHTTPS æ˜¯åŠ å¯†çš„ï¼Œä»¥å¢åŠ æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚*

## *å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ*

*HTTPS èƒŒåçš„åè®® TLS ä½¿ç”¨ä¸å¯¹ç§°çš„[å…¬é’¥åŸºç¡€è®¾æ–½](https://en.wikipedia.org/wiki/Public-key_cryptography)ã€‚è¯¥ç³»ç»Ÿä½¿ç”¨ä¸¤ç§ä¸åŒçš„å¯†é’¥æ¥åŠ å¯†åŒæ–¹ä¹‹é—´çš„é€šä¿¡:*

1.  *ç§äººé’¥åŒ™ğŸ”:æ­¤å¯†é’¥ç”±ç½‘ç«™æ‰€æœ‰è€…æ§åˆ¶ï¼Œå®ƒæ˜¯ç§æœ‰çš„ï¼Œä½äºè¿œç¨‹ web æœåŠ¡å™¨ä¸Šã€‚å®ƒç”¨äº**è§£å¯†ç”±å…¬é’¥åŠ å¯†çš„ä¿¡æ¯***
2.  *å…¬é’¥ğŸ”‘:ä»»ä½•å¸Œæœ›ä»¥å®‰å…¨æ–¹å¼ä¸æœåŠ¡å™¨äº¤äº’çš„äººéƒ½å¯ä»¥ä½¿ç”¨æ­¤å¯†é’¥ã€‚è¿™ä¸ªå¯†é’¥çš„ä½œç”¨æ˜¯**åŠ å¯†æ•°æ®**,ç§é’¥ç¨åä¼šè§£å¯†è¿™äº›æ•°æ®ã€‚*

*![](img/3a4cf1bc94860e8b56d6f5eabedcb0a9.png)*

*å›¾ç‰‡ç”±ä½œè€…ä¿®æ”¹*

## *æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦ HTTPSï¼Ÿ*

*HTTPS æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åè®®ã€‚æ‚¨éœ€è¦å®ƒæœ‰ä¸‰ä¸ªä¸»è¦åŸå› :*

*   ***éšç§**:è¿™æ ·å°±æ²¡äººèƒ½æ‹¦æˆªæˆ–å·å¬ä½ çš„æ¶ˆæ¯(æ¶ˆæ¯å¯ä»¥æ˜¯ä½ å‘å¸ƒç»™æœ‹å‹çš„æ–‡å­—ï¼Œä½ å¡«å†™è¡¨æ ¼çš„ä¿¡ç”¨å¡ä¿¡æ¯ï¼Œå›¾åƒï¼Œè§†é¢‘ï¼Œæˆ–è€…ä½ é€šè¿‡ç½‘ç»œä¸Šä¼ çš„ä»»ä½•ä¸œè¥¿)ã€‚å½“é€šè¿‡ HTTPS å‘é€æ—¶ï¼Œè¯¥æ•°æ®è¢«**åŠ å¯†ï¼Œ**å³å˜æˆä¸€ä¸ªé•¿çš„å­—æ¯æ•°å­—ä¸²ã€‚*
*   *å®Œæ•´æ€§:è¿™æ ·ä½ å‘é€çš„ä¿¡æ¯åœ¨åˆ°è¾¾ç›®çš„åœ°çš„é€”ä¸­ä¸ä¼šè¢«ä»»ä½•å½¢å¼çš„æ“çºµã€‚*
*   ***è®¤è¯**:è¿™æ ·ä½ è¯·æ±‚çš„è¿œç¨‹æœåŠ¡å™¨å°±èƒ½ç¡®å®šä½ å°±æ˜¯ä½ å£°ç§°çš„é‚£ä¸ªäºº*

*é™¤äº†ç»™ä½ çš„åº”ç”¨å¢åŠ ä¸€ä¸ªå®‰å…¨å±‚ï¼ŒHTTPS è¿˜æ˜¯é«˜è´¨é‡è½¯ä»¶å®è·µçš„ä¿è¯ã€‚è¿™å¯¹äºå»ºç«‹å¯ä¿¡çš„ç”¨æˆ·ç¾¤éå¸¸é‡è¦ã€‚*

*ä¸»è¦çš„äº’è”ç½‘å…¬å¸éƒ½éå¸¸é‡è§† HTTPSã€‚äº‹å®ä¸Šï¼Œè°·æ­Œ[åœ¨ 2014 å¹´å®£å¸ƒ](https://seo-hacker.com/google-adopt-https/)æ‹¥æœ‰ HTTPS å°†æé«˜ä½ åœ¨æœç´¢ç»“æœä¸­çš„æ’åã€‚è°·æ­Œè¿˜è®© Chrome å°†æ‰€æœ‰æ²¡æœ‰ HTTPS çš„ç½‘ç«™æ ‡è®°ä¸ºä¸å®‰å…¨ã€‚*

*![](img/3743977a5dce39c8c9b68f96e34190cc.png)*

*çœ‹å®Œè¿™ä¸ªè°è¿˜æƒ³è®¿é—®ä½ çš„ç½‘ç«™ï¼Ÿ(å›¾ç‰‡ç”±ä½œè€…æä¾›)*

*æ˜¯æ—¶å€™å°† HTTPS æ·»åŠ åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºä¸­äº†ï¼*

# *ç”¨ FastAPI æ„å»ºæœ€å° API*

*åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­ä¸Šå®‰è£…å¹¶è¿è¡Œ FastAPIã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ä¿æŠ¤å®ƒã€‚*

*åœ¨è¿›å…¥ä»£ç ä¹‹å‰ï¼Œä¸‹é¢æ˜¯é¡¹ç›®ç»“æ„çš„æ ·å­:*

*![](img/672973ca16ccd789e309f2c7378ec233.png)*

*ä½œè€…æˆªå›¾*

*è®©æˆ‘ä»¬ä»åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¼€å§‹:*

```
***mkdir fastapi-ssl && cd _
pipenv install fastapi***
```

*æ²¡ä»€ä¹ˆç‰¹åˆ«çš„ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæœ‰ä¸¤æ¡è·¯çº¿çš„ API:*

*   *ä¸€ä¸ªå¤„ç† **GET è¯·æ±‚**å¹¶åœ¨æµè§ˆå™¨ä¸Šæ˜¾ç¤ºä»¥ä¸‹ JSON å“åº”*

```
***{"message": "Hello FastAPI + SSL"}***
```

*   *å¦ä¸€ä¸ªå¤„ç† **POST è¯·æ±‚ã€‚**è¿™ä¸ªè·¯ç”±éœ€è¦ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªé”®:`text`å’Œ`author`çš„ä¸»ä½“ï¼Œå¹¶å‘å›ä¸€ä¸ª JSON å¯¹è±¡ä½œä¸ºå“åº”ï¼Œå…¶ä¸­åŒ…å«å·²ç»å‘é€çš„ç›¸åŒçš„`text`å’Œ`author`ä»¥åŠä¸€ä¸ªé™„åŠ çš„`status`æ¶ˆæ¯ã€‚*

```
***{"status": "message received", "text": "Hello", "author": "Ahmed"}***
```

*ä¸‹é¢çš„ä»£ç å®šä¹‰äº†è¿™ä¸¤æ¡è·¯çº¿ã€‚*

*ä¸€ä¸ªéå¸¸ç®€å•çš„ APIï¼Œæœ‰ä¸¤æ¡è·¯å¾„*

*æŸ¥çœ‹è¿™ç¯‡[æ–‡ç« ](https://fastapi.tiangolo.com/)ï¼Œäº†è§£æ›´å¤šå…³äºç”¨ FastAPI æ„å»º API çš„ä¿¡æ¯ã€‚*

# *ä»€ä¹ˆæ˜¯ Traefikï¼Ÿå®ƒå¦‚ä½•å¸®åŠ© HTTPSï¼Ÿ*

*åœ¨ç”¨ Docker æ‰“åŒ… app ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆä»‹ç»ä¸€ä¸‹ Traefikã€‚*

> *Traefik æ˜¯ä¸€ä¸ªå¼€æºçš„åå‘ä»£ç†å’Œè´Ÿè½½å¹³è¡¡å™¨ï¼Œé€‚ç”¨äºåŸºäº HTTP å’Œ TCP çš„åº”ç”¨ç¨‹åºï¼Œå®ƒç®€å•ã€åŠ¨æ€ã€è‡ªåŠ¨ã€å¿«é€Ÿã€åŠŸèƒ½å…¨é¢ã€ç»è¿‡ç”Ÿäº§éªŒè¯ï¼Œæä¾›æŒ‡æ ‡ï¼Œå¹¶ä¸æ¯ä¸€ç§ä¸»è¦çš„é›†ç¾¤æŠ€æœ¯é›†æˆâ€¦*

*Traefik çš„ç›®æ ‡æ˜¯æ‹¦æˆªæ¥è‡ªäº’è”ç½‘çš„ä¼ å…¥ HTTP è¯·æ±‚ï¼Œå¹¶å°†å®ƒä»¬è·¯ç”±åˆ° Docker è¿è¡Œçš„ä¸“ç”¨å®¹å™¨ã€‚å®ƒå¯ä»¥å°†ä»»ä½• DNS è®°å½•é™„åŠ åˆ°æ­£åœ¨è¿è¡Œçš„æœåŠ¡ä¸Šã€‚*

*![](img/de21de62d94ed0cc250cb71e5a00ba9b.png)*

*ç‰¹æ‹‰è²å…‹åœ¨ä¸­é—´*

*Traefik æ˜¯äº‘åŸç”Ÿçš„ã€‚è¿™æ„å‘³ç€å®ƒå¯ä»¥è½»æ¾åœ°ä¸ Docker å’Œ Kubernetes ç­‰äº‘æŠ€æœ¯é›†æˆã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°† Traefik é“¾æ¥åˆ° Dockerã€‚*

*ä¸Šé¢çš„æ¨±æ¡ƒ:Traefik è‡ªåŠ¨æ”¯æŒ**è®©æˆ‘ä»¬åŠ å¯†**è¯ä¹¦ã€‚è¿™æ„å‘³ç€å®ƒä¼šè‡ªåŠ¨ä¸ºæ‚¨å¤„ç†è¿™äº›æ–‡ä»¶çš„åˆ›å»ºå’Œæ›´æ–°ï¼Œä»¥ç¡®ä¿ HTTPS é…ç½®æ­£ç¡®ã€‚*

# ***è®©æˆ‘ä»¬åŠ å¯†ä»€ä¹ˆï¼Ÿ***

> *Let's Encrypt æ˜¯ä¸€ä¸ªå…è´¹çš„ã€è‡ªåŠ¨åŒ–çš„ã€å¼€æ”¾çš„è®¤è¯æœºæ„(CA)ï¼Œä¸ºå…¬ä¼—çš„åˆ©ç›Šè€Œè¿è¡Œã€‚è¿™æ˜¯ç”±[äº’è”ç½‘å®‰å…¨ç ”ç©¶å°ç»„(ISRG)](https://www.abetterinternet.org/) æä¾›çš„æœåŠ¡ã€‚*

*Let's Encrypt æ˜¯ä¸€ä¸ªä¼šä¸ºæˆ‘ä»¬é¢å‘å…è´¹ SSL è¯ä¹¦çš„ç»„ç»‡ã€‚*

## ***ä»€ä¹ˆæ˜¯ SSL è¯ä¹¦ï¼Ÿ***

*SSL è¯ä¹¦å…è®¸ç½‘ç«™æ‹¥æœ‰ HTTPSã€‚*

*å®ƒæ˜¯ä¸€ä¸ªä¿å­˜åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºçš„è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€‚å®ƒä½¿ SSL/TLS åŠ å¯†æˆä¸ºå¯èƒ½ï¼Œå¹¶ä¿å­˜è¯¸å¦‚å…¬é’¥å’Œç½‘ç«™èº«ä»½ç­‰ä¿¡æ¯ã€‚*

*å½“å®¢æˆ·ç«¯(ä¾‹å¦‚æ‚¨çš„æµè§ˆå™¨)å°è¯•è¿æ¥åˆ°å®‰å…¨ç½‘ç«™æ—¶ï¼Œå®ƒé¦–å…ˆä¼šè·å¾—æ­¤è¯ä¹¦çš„å‰¯æœ¬ã€‚è¿™å…è®¸å®¢æˆ·ç«¯æ£€æŸ¥è¿œç¨‹æœåŠ¡å™¨çš„èº«ä»½å¹¶è·å¾—å…¬é’¥ï¼Œä»¥ä¾¿å¯åŠ¨åŠ å¯†ä¼šè¯ã€‚*

# *ä¸º HTTPS è®¾ç½® Traefik*

*è®©æˆ‘ä»¬ä»é…ç½® Traefik å¼€å§‹ã€‚è¿™å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ TOML æ–‡ä»¶æ¥å®Œæˆã€‚è¯¥æ–‡ä»¶å°†ä½äº`services/traefik`ä¸­*

*Traefik é…ç½®æ–‡ä»¶*

*è®©æˆ‘ä»¬è¯¦ç»†ä»‹ç»ä¸€ä¸‹æ¯ä¸€éƒ¨åˆ†éƒ½å‘ç”Ÿäº†ä»€ä¹ˆ:*

*`**[entrypoints]**`*

*æ­¤éƒ¨åˆ†æŒ‡å®š Traefik å°†ä¾¦å¬çš„ç«¯å£ã€‚è¿™äº›ç«¯å£æ˜¯ **80** å’Œ **443** ã€‚80 æ˜¯é»˜è®¤çš„ HTTP ç«¯å£ï¼Œ443 æ˜¯ HTTPS ç«¯å£ã€‚æˆ‘ä»¬å°†åˆ†åˆ«ç§°å®ƒä»¬ä¸º`web`å’Œ`websecure`ã€‚*

*ç„¶åï¼Œæˆ‘ä»¬å‘Šè¯‰ Traefik å°† HTTP é‡å®šå‘åˆ° HTTPSã€‚*

*`**[accessLog]**`*

*è¿™ä¸ªéƒ¨åˆ†å‘Šè¯‰ Traefik å°†æ—¥å¿—æ‰“å°åˆ°`stdout`ä»¥äº†è§£è°ç»™è°æ‰“äº†ç”µè¯ã€‚*

*`**[providers]**`*

*åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†é…ç½®æ‰€è°“çš„æä¾›è€…ã€‚*

> **æä¾›å•†*æ˜¯åŸºç¡€è®¾æ–½ç»„ä»¶ï¼Œæ— è®ºæ˜¯ç¼–æ’å™¨ã€å®¹å™¨å¼•æ“ã€äº‘æä¾›å•†è¿˜æ˜¯é”®å€¼å­˜å‚¨ã€‚å…¶æ€æƒ³æ˜¯ï¼ŒTraefik æŸ¥è¯¢æä¾›è€… APIï¼Œä»¥ä¾¿æ‰¾åˆ°æœ‰å…³è·¯ç”±çš„ç›¸å…³ä¿¡æ¯ï¼Œå½“ Traefik æ£€æµ‹åˆ°å˜åŒ–æ—¶ï¼Œå®ƒä¼šåŠ¨æ€æ›´æ–°è·¯ç”±ã€‚*

***æˆ‘ä»¬å¸Œæœ› Traefik åœ¨ Docker å®¹å™¨å‰å……å½“ä»£ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†é€‰æ‹© Docker ä½œä¸ºæä¾›è€…ä¹‹ä¸€ã€‚***

*å°†`exposedByDefault`è®¾ç½®ä¸º`false`ä»…ä»…æ„å‘³ç€ Traefik ä¸ä¼šåœ¨æ‰€æœ‰å®¹å™¨å‰å……å½“ä»£ç†ã€‚å®ƒåªä¼šåœ¨é‚£äº›æœ‰ docker-compose ä¸­æè¿°çš„ç‰¹å®šæ ‡ç­¾çš„äººé¢å‰è¿™æ ·åšã€‚(æˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„ Docker éƒ¨åˆ†ä»‹ç»è¿™äº›æ ‡ç­¾)*

*`**[certificatesResolvers.letsencrypt.name]**`*

*æœ¬èŠ‚é…ç½®è¯ä¹¦è§£æå™¨ã€‚æ¢å¥è¯è¯´ï¼ŒTraefik å°†é€šè¿‡ [ACME](https://github.com/ietf-wg-acme/acme/) åè®®ä¸ Let's Encrypt é€šä¿¡:è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ‚¨å¿…é¡»è®¾ç½®ä¸€ä¸ªæœ‰æ•ˆçš„ç”µå­é‚®ä»¶åœ°å€å’Œæ–‡ä»¶åï¼ŒTraefik å°†æŠŠå®ƒä» Let's Encrypt æ¥æ”¶çš„ä¿¡æ¯ä¿å­˜åœ¨è¿™é‡Œã€‚å½“ Traefik ä¸ Let's Encrypt é€šä¿¡æ—¶ï¼Œå¯ä»¥æˆåŠŸç”Ÿæˆå’Œæ›´æ–°è¯ä¹¦ã€‚*

# *ä½¿ç”¨ Docker å‡†å¤‡éƒ¨ç½²*

*åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬åœ¨ docker-compose æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸¤ä¸ªå®¹å™¨:ä¸€ä¸ªç”¨äº FastAPI web æœåŠ¡ï¼Œå¦ä¸€ä¸ªç”¨äºå¯åŠ¨ Traefikã€‚*

****æ³¨æ„ï¼Œæ‚¨å¯ä»¥æœ‰å¤šä¸ªè¿è¡Œä¸åŒæœåŠ¡çš„å®¹å™¨ï¼ŒTraefik ä¼šå°†æµé‡è·¯ç”±åˆ°è¿™äº›å®¹å™¨ã€‚****

*è®©æˆ‘ä»¬è¯¦ç»†è¯´æ˜æ¯ä¸ªå®¹å™¨ä¸­å‘ç”Ÿäº†ä»€ä¹ˆ:*

***â€”** `**api**`*

*æˆ‘ä»¬é¦–å…ˆé€šè¿‡å¼•ç”¨ä»¥ä¸‹ Dockerfile æ–‡ä»¶çš„è·¯å¾„æ¥æ„å»ºæ˜ åƒ:*

*ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰å°†è¢« Traefik è¯»å–çš„ docker æ ‡ç­¾*

*   *`traefik.enable=true`ç¡®ä¿ Traefik çœ‹åˆ°è¯¥å®¹å™¨å¹¶å°†æµé‡è·¯ç”±åˆ°è¯¥å®¹å™¨*
*   *å…¶ä»–æ ‡ç­¾å®šä¹‰äº†æŒ‡å‘å®¹å™¨çš„ DNS è®°å½•(ssl.ahmedbesbes.comï¼Œä¹Ÿå°±æ˜¯æˆ‘ä¸ºè¿™ä¸ª API è®¾ç½®çš„åŸŸ)ã€‚ä»–ä»¬è¿˜å‘Šè¯‰ Traefik ä½¿ç”¨ TLS å¹¶ä½¿ç”¨ Let's Encrypt æ¥è§£æè¯ä¹¦ã€‚*

***â€”â€”**â€”â€”`**traefik**`*

*æˆ‘ä»¬é¦–å…ˆä»å®˜æ–¹æ³¨å†Œä¸­æå–å›¾åƒã€‚*

*æˆ‘ä»¬å°†å®¹å™¨ä¸Šçš„ç«¯å£ 80 å’Œ 443 æ˜ å°„åˆ°ä¸»æœºä¸Šçš„ç«¯å£ 80 å’Œ 443ã€‚*

*æˆ‘ä»¬å®šä¹‰äº†ä¸‰ä¸ªå·:*

1.  *ç¬¬ä¸€ä¸ªå·ä½¿ Traefik çŸ¥é“å…¶ä»–å®¹å™¨*
2.  *ç¬¬äºŒä¸ªå·å°† Traefik é…ç½®æ–‡ä»¶ä¼ é€’ç»™å®¹å™¨*
3.  *ç¬¬ä¸‰ä¸ªå·å°†ç”Ÿæˆçš„è¯ä¹¦ä¿å­˜åœ¨ä¸»æœºä¸Šï¼Œè¿™æ ·å°±ä¸ä¼šåœ¨æ¯æ¬¡å®¹å™¨é‡æ–°å¯åŠ¨æ—¶é‡æ–°ç”Ÿæˆå®ƒä»¬ã€‚è¿™å¾ˆé‡è¦ï¼Œå› ä¸º Let's Encrypt å¯¹æ‚¨å¯ä»¥è·å¾—çš„è¯ä¹¦æ•°é‡æœ‰é™åˆ¶*

# *åœ¨ AWS ä¸Šéƒ¨ç½²*

*ç¡®ä¿æœ¬åœ°ä¸€åˆ‡æ­£å¸¸ï¼Œè¿æ¥åˆ°è™šæ‹Ÿæœºï¼Œå…‹éš†å­˜å‚¨åº“ï¼Œå¹¶åœ¨æ ¹ç›®å½•ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤:*

```
***docker-compose up --build -d***
```

*ä¸ºäº†è®© Github åŠ¨ä½œçš„éƒ¨ç½²æ›´é¡ºåˆ©ï¼Œçœ‹çœ‹æˆ‘ä¹‹å‰çš„[å¸–å­](/how-to-deploy-a-machine-learning-model-with-fastapi-docker-and-github-actions-13374cbd638a)ã€‚*

# *èµ„æº*

*ä¸‹é¢æ˜¯æˆ‘ç”¨æ¥å­¦ä¹  HTTPSã€Traefik å’Œç”¨ Docker éƒ¨ç½² FastAPI åº”ç”¨ç¨‹åºçš„èµ„æºçš„æ±‡ç¼–åˆ—è¡¨ã€‚*

*ä¸è¦çŠ¹è±«ï¼Œè®©æˆ‘çŸ¥é“ä½ åœ¨è¿™æ–¹é¢æ‰¾åˆ°çš„å…¶ä»–æœ‰ç”¨çš„èµ„æºğŸ˜‰*

*[](https://howhttps.works/) [## HTTPS æ˜¯å¦‚ä½•è¿ä½œçš„

### ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ä¸ºä»€ä¹ˆä½ çš„æµè§ˆå™¨åœ°å€æ ä¼šå‡ºç°ä¸€ä¸ªç»¿è‰²çš„é”å›¾æ ‡ï¼Ÿä¸ºä»€ä¹ˆå®ƒå¾ˆé‡è¦ï¼Ÿæˆ‘ä»¬ä¹Ÿæ˜¯ï¼Œè€Œä¸”â€¦

howhttpsã€‚ä½œå“](https://howhttps.works/) [](https://www.valentinog.com/blog/traefik/) [## ä½¿ç”¨ Dockerã€Traefik å’Œ Let's Encrypt éƒ¨ç½² FastAPI åº”ç”¨ç¨‹åº

### å½“ç”¨ Docker å’Œ Let's Encrypt æŠŠæ‰€æœ‰çš„éƒ¨åˆ†ç»„åˆèµ·æ¥é…ç½® Traefik æ—¶ï¼Œæˆ‘ç”¨äº† 15 ä¸ªâ€¦

www.valentinog.com](https://www.valentinog.com/blog/traefik/) [](https://fastapi.tiangolo.com/tr/deployment/docker/) [## ä½¿ç”¨ Docker - FastAPI éƒ¨ç½²

### è­¦å‘Šå½“å‰é¡µé¢ä»ç„¶æ²¡æœ‰è¯¥è¯­è¨€çš„ç¿»è¯‘ã€‚ä½†æ˜¯ä½ å¯ä»¥å¸®å¿™ç¿»è¯‘ä¸€ä¸‹â€¦

fastapi.tiangolo.com](https://fastapi.tiangolo.com/tr/deployment/docker/) [](https://www.digitalocean.com/community/tutorials/how-to-use-traefik-v2-as-a-reverse-proxy-for-docker-containers-on-ubuntu-20-04) [## å¦‚ä½•åœ¨ Ubuntu 20.04 | DigitalOcean ä¸Šä½¿ç”¨ Traefik v2 ä½œä¸º Docker å®¹å™¨çš„åå‘ä»£ç†

### Docker å¯èƒ½æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œ web åº”ç”¨ç¨‹åºçš„ä¸€ç§æœ‰æ•ˆæ–¹å¼ï¼Œä½†æ˜¯æ‚¨å¯èƒ½å¸Œæœ›åœ¨â€¦

www.digitalocean.com](https://www.digitalocean.com/community/tutorials/how-to-use-traefik-v2-as-a-reverse-proxy-for-docker-containers-on-ubuntu-20-04) [](https://traefik.io/blog/traefik-2-tls-101-23b4fbee81f1/) [## å¦‚ä½•ç”¨ TLS - Traefik 2 & TLS 101 é…ç½® Traefik 2

### æ¯ä¸ªäººçš„ HTTPS (& TCP over TLS)ï¼æˆ‘å–œæ¬¢æˆä¸ºä¸€åå¼€å‘äººå‘˜æœ‰æˆç™¾ä¸Šåƒçš„åŸå› (é™¤äº†å¯¹â€¦

traefik.io](https://traefik.io/blog/traefik-2-tls-101-23b4fbee81f1/) [](https://www.digitalocean.com/community/tutorials/how-to-use-traefik-v2-as-a-reverse-proxy-for-docker-containers-on-ubuntu-20-04) [## å¦‚ä½•åœ¨ Ubuntu 20.04 | DigitalOcean ä¸Šä½¿ç”¨ Traefik v2 ä½œä¸º Docker å®¹å™¨çš„åå‘ä»£ç†

### Docker å¯èƒ½æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œ web åº”ç”¨ç¨‹åºçš„ä¸€ç§æœ‰æ•ˆæ–¹å¼ï¼Œä½†æ˜¯æ‚¨å¯èƒ½å¸Œæœ›åœ¨â€¦

www.digitalocean.com](https://www.digitalocean.com/community/tutorials/how-to-use-traefik-v2-as-a-reverse-proxy-for-docker-containers-on-ubuntu-20-04) 

[https://www . cloud flare . com/fr-fr/learning/SSL/what-is-https/](https://www.cloudflare.com/fr-fr/learning/ssl/what-is-https/)

# æ„Ÿè°¢é˜…è¯»ğŸ™

è®©æˆ‘ä»¬ç»“æŸå®ƒã€‚è¿™ç¯‡æ–‡ç« æä¾›äº†ä¸€ä¸ªæœºä¼š:

*   äº†è§£ HTTPS åŠå…¶å¸¦æ¥çš„å¥½å¤„
*   äº†è§£å…³äº Traefik ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä½œä¸ºåå‘ä»£ç†æ¥åˆ›å»º HTTPS è¿æ¥çš„æ›´å¤šä¿¡æ¯
*   ä½¿ç”¨ Docker é€šè¿‡ Traefik éƒ¨ç½²å’Œç®¡ç† FastAPI

æˆ‘å¸Œæœ›è¿™æ˜¯åœ¨æ‚¨çš„é¡¹ç›®ä¸­å®æ–½ HTTPS çš„è‰¯å¥½å¼€ç«¯ã€‚

åŒæ ·ï¼Œä»£ç å¯ä»¥åœ¨ [Github](https://github.com/ahmedbesbes/fastapi-ssl) ä¸Šè·å¾—:ä½ å¯ä»¥éšæ„ä½¿ç”¨å®ƒæˆ–è€…ä¸ºä½ çš„é¡¹ç›®ä¿®æ”¹å®ƒã€‚

æˆ‘å°±è®²åˆ°è¿™é‡Œï¼Œä¸‹æ¬¡è§ï¼

![](img/dd0564e2ac1f60795e518ddbb55558d3.png)

ç…§ç‰‡ç”±[å¡æ–¯æ»•Â·æ€€æ©å‰å°”ç‰¹](https://unsplash.com/@karsten116?utm_source=medium&utm_medium=referral)åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹æ‘„

# æ–°åˆ°ä¸­ï¼Ÿæ‚¨å¯ä»¥æ¯æœˆè®¢é˜… 5 ç¾å…ƒï¼Œå¹¶è§£é”æ— é™çš„æ–‡ç« â€” [å•å‡»æ­¤å¤„ã€‚](https://ahmedbesbes.medium.com/membership)*