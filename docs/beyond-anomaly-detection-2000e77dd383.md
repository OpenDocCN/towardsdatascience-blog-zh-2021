# 超越异常检测

> 原文：<https://towardsdatascience.com/beyond-anomaly-detection-2000e77dd383?source=collection_archive---------27----------------------->

## 异常检测！=威胁检测。

![](img/0f201c1e4dc2ce05a9294977ffe77900.png)

来自 Pixabay 的奇莫诺

任何熟悉安全操作中威胁检测的人都可能听过类似的解释。它总是像这样，“剖析正常行为，然后检测异常。”该过程包括从您环境中的几个不同传感器生成数据，并使用该数据来定义某种基线阈值。然后，您可以根据超出该特定阈值的任何传感器数据生成警报。这一切都有点抽象——让我们更深入一点。

熟悉机器学习的人都会知道监督学习和非监督学习这两个术语。通常人们将无监督学习与异常检测联系在一起，但我们实际上可以使用其中任何一种来检测异常。事实上，我们可以将机器学习的思想应用于人类学习和静态分析。最佳威胁检测通常由静态检测(规则)、机器学习和人类学习的某种组合组成。我们将把无监督学习的重点放在聚类上，将监督学习的重点放在分类上。

**聚类。**当人类和算法执行聚类时，它们会为不同的数据块生成逻辑组。这些组将从数据特征的组合中出现，而不是依赖于任何特定的特征作为标签。换句话说，数据中不应该直接显示“该产品属于 A 组”。分析师或算法会根据该产品与 A 组中其他产品的“接近度”将该产品归入 A 组。在异常检测中，分析师或算法会生成这些组，并且“接近度”的测量值是阈值。如果一个数据项位于这个阈值之外，离集群太“远”，这就是异常。

安全分析师可以根据工作时间生成一个简单的聚类。如果组织有 9-5 个工作时间，我们可以在下午 1 点左右生成一个阈值为+/- 4 小时的集群。任何超出这个时间范围的事情都会产生警报。更现实的集群应该根据服务、交互时长、数据量和其他因素将不同的交互分组到用户和管理员的不同基本活动中。奇怪的活动会落在这些集群之外，分析师可以对它们进行调查。如果他们发现活动是良性的，他们可以将它们添加到一个新的集群组中，或者扩展阈值以消除这些错误警报。

**分类。关于数据项的哪些特征是特征还是标签，没有正式的规定。我们可以将数据的任何特征指定为标签，并使用其他特征来预测它。在这种情况下，我们使用数据中的不同字段来预测另一个字段。分析师或算法可以选择哪些字段提供最佳阈值，以便仅警告真正的异常。我们还可以将不同流中的不同数据条目组合成一个[单个数据对象](https://medium.com/nerd-for-tech/detect-campaigns-not-attack-traffic-87b9f6891712)，然后使用不同的数据条目进行高保真预测。**

例如，如果我们考虑[一个 NGINX 日志条目](https://linuxize.com/post/nginx-log-files/)，我们在一个条目中有以下特征:IP 地址、日期、方法、URL、协议、状态、发送的字节、referer 和用户代理。现在，让我们想象一家企业，其中大多数用户在工作日的任何时候都使用/home URL 从浏览器访问 web 服务器。他们的请求使用 GET 方法，响应非常大，因为它提供了整个网页。然而，有些开发人员通过 API 从他们的代码中访问 web 服务器。他们向/api URL 发出 POST 请求，并得到简短的响应。他们通常只在临近工作日开始时提出这些要求。在这种情况下，使用 POST 方法的早期请求、简短响应和无用户代理字符串的组合将强烈预测/api URL。

上述方法将允许您检测异常，我们可以调查这些异常以发现威胁，对吗？这依赖于几个假设:

1.  攻击流量比真实流量更加动态。换句话说，您的真实流量将通过聚类和分类保持可预测性，而攻击流量将是不可预测的流量。
2.  在您能够生成的所有可用异常检测算法中，您选择的算法将最好地检测攻击。如果您专注于最佳异常检测，您将实现最佳威胁检测。

这些都是很强的假设。这些可能支持最基本的攻击，但高级攻击者正试图使针看起来像干草，这样你就不会看到他们的攻击是异常的。与此同时，大多数环境的变化速度正在迅速加快，因此新的异常流量将会越来越频繁地出现。还有，在不使用实际攻击数据测试这些算法的情况下，如何验证这些假设？即使您想使用异常检测，您也会想看看您的异常检测算法对实际攻击数据的效果如何。然后，使用真实的攻击数据，您可以生成算法，直接将数据对象分类为恶意或良性。您还可以让您的数据对象生成方法匹配不同的攻击生命周期，而不仅仅是做出有根据的猜测。你甚至可以[将你的异常检测方法与其他方法结合起来，生成非常逼真的警报。](/ensemble-methods-in-machine-learning-what-are-they-and-why-use-them-68ec3f9fef5f)

无论我们是在生成规则，训练分析师，还是使用机器学习，我们都应该有真实的数据，用我们实际上在寻找的东西来标记。在这种情况下，我们应该有良性传感器数据，我们将使用这些数据在异常检测方法中分析正常行为，*和*我们还应该有相同的传感器数据用于我们想要检测的恶意行为。因此，异常检测是不够的，它本身不会让您检测到巨大的威胁。