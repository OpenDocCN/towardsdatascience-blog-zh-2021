# é¢å‘ Excel ç”¨æˆ·çš„ Python ç¬¬ 1 éƒ¨åˆ†

> åŸæ–‡ï¼š<https://towardsdatascience.com/python-for-excel-users-part-1-c44bacff4adc?source=collection_archive---------19----------------------->

## å¼€å§‹ä½¿ç”¨ pandas å¤„ç†æ•°æ®

![](img/0919c02c0d273f2a614d32e4980343fb.png)

è¿™æ˜¯ä¸€ä¸ªæ•™ç¨‹ç³»åˆ—çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œé¢å‘æ‰€æœ‰æƒ³å¼€å§‹ä½¿ç”¨ python è€Œä¸æ˜¯ Excel çš„äººï¼Œä¾‹å¦‚ï¼Œè‡ªåŠ¨åŒ–ä»»åŠ¡æˆ–æé«˜é€Ÿåº¦å’Œå¯ä¼¸ç¼©æ€§ã€‚æˆ–è€…åªæ˜¯å‡ºäºå¥½å¥‡ã€‚

å½“å‡ºç°ä»¥ä¸‹æƒ…å†µæ—¶ï¼Œæ‚¨å¤„äºæ­£ç¡®çš„ä½ç½®:

*   æ‚¨å¯ä»¥ä½¿ç”¨ Excel åˆå¹¶å„ç§å·¥ä½œè¡¨æˆ–è¡¨æ ¼(ä½¿ç”¨è¯¸å¦‚ Indexã€Matchã€VLookup
*   ä½¿ç”¨ç®€å•çš„æ•°å­¦è¿ç®—ï¼Œå¦‚æ±‚å’Œä¸å¹³å‡
*   ä½¿ç”¨æ¡ä»¶èšåˆå‡½æ•°(ä¾‹å¦‚ï¼Œæ¯ä¸ªç±»åˆ«çš„äº¤æ˜“æ€»å’Œ)æˆ–æ•°æ®é€è§†è¡¨

è¿™ç¯‡åšæ–‡ä¸ä¼šæ¶µç›–æ‚¨éœ€è¦äº†è§£çš„å…³äºè½¬å‚¨ Excel çš„æ‰€æœ‰å†…å®¹ï¼Œè¿™ä¹Ÿä¸æ˜¯æœ¬ç³»åˆ—çš„ç›®æ ‡ã€‚ç¬¬ 1 éƒ¨åˆ†æ—¨åœ¨å¸®åŠ©æ‚¨ä» Excel è½¬å‘ Python/Pandasã€‚

è™½ç„¶ Excel æœ‰å®ƒè‡ªå·±çš„ä½ç½®ï¼Œè€Œä¸”éå¸¸å¿«é€Ÿå’Œæ–¹ä¾¿ï¼Œä½†æˆ‘å¸Œæœ›è¿™ä¸ªåšå®¢æ–‡ç« ç³»åˆ—èƒ½å¤Ÿå¸®åŠ©æ‚¨æ¢ç´¢é™¤ Excel ä¹‹å¤–çš„å…¶ä»–æ•°æ®å¤„ç†æ–¹å¼ã€‚

ä½ å¯ä»¥åœ¨ Jupyter ç¬”è®°æœ¬ä¸Šæ‰¾åˆ°è¿™ç¯‡åšæ–‡ï¼Œä»¥åŠæˆ‘ä»¬åœ¨ [HOSD æŒ‡å¯¼ GitHub repo](https://github.com/HOSD-Mentoring/presentations/tree/main/From%20Excel%20to%20Python%20-%20Part%201) ä¸­ä½¿ç”¨çš„æ•°æ®ã€‚

## æœ¬æ•™ç¨‹çš„ç›®æ ‡

æˆ‘ä»¬å°†åƒåœ¨ Excel ä¸­ä¸€æ ·æ¢ç´¢å’Œç»„åˆä¸åŒçš„é”€å”®æ•°æ®è¡¨ã€‚è¿™äº›è¡¨æ ¼æ˜¯:

*   å‘½ä»¤
*   è®¢å• _ è¡Œ
*   åˆ¶å“

ä¸€ä¼šå„¿ä¼šæœ‰æ›´å¤šå…³äºæ•°æ®çš„ç»†èŠ‚ã€‚

## è¦æ±‚

è™½ç„¶ Python çš„ä¸€äº›åŸºæœ¬ç»éªŒä¼šæœ‰æ‰€å¸®åŠ©ï¼Œä½†ä½ ä¸å¿…æˆä¸ºä¸€åç¨‹åºå‘˜æˆ–æ•°æ®ç§‘å­¦å®¶æ¥éµå¾ªæœ¬æ•™ç¨‹ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥å¬è¯´è¿‡ç†ŠçŒ«ï¼Œå¹¶äº²è‡ªèŠ±äº†ä¸€äº›æ—¶é—´ä¸ python æ‰“äº¤é“ã€‚åªè¦èƒ½è®©è‡ªå·±æ„Ÿåˆ°èˆ’é€‚ï¼Œä¸æ°”é¦å°±è¡Œäº†ã€‚è¯•ç€è·Ÿä¸Šå¹¶é˜…è¯»æˆ‘ä»¬æ²¡æœ‰æ¶‰åŠçš„å†…å®¹ã€‚ä½ å¯ä»¥éšæ—¶å›åˆ°è¿™é‡Œã€‚

# 1.å½¢åŠ¿

![](img/063f07a7f7f942b5fe3d14dfb7668efc.png)

æ¥æº:pix abay[https://pix abay . com/photos/office-startup-business-home-office-594132/](https://pixabay.com/photos/office-startup-business-home-office-594132/)

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ åˆšå¼€å§‹åœ¨ä¸€å®¶å¤§å‹å·´è¥¿åœ¨çº¿é›¶å”®å•†çš„é”€å”®éƒ¨é—¨å·¥ä½œã€‚è¿™æ˜¯ä½ çš„ç¬¬ä¸€å¤©ã€‚ä½ è®¾ç½®å¥½ä½ çš„ç”µè„‘ï¼Œä»ä½ å…¬å¸çš„å’–å•¡å¸ˆé‚£é‡Œå¾—åˆ°ä¸€æ¯å¾ˆæ£’çš„åŒä»½æµ“ç¼©å’–å•¡ã€‚ä¼‘æ¯å®¤é‡Œçš„æ—§å’–å•¡æœºï¼Œä½ å·²ç»å‡†å¤‡å¥½å¼€å§‹äº†ï¼

ä¸å¹¸çš„æ˜¯ï¼Œç°åœ¨æ˜¯å¤å¤©ï¼Œä½ å›¢é˜Ÿä¸­çš„æ¯ä¸ªäººéƒ½åœ¨åº¦å‡ã€‚è¿™è®©ä½ æœ‰å¾ˆå¤šé—®é¢˜å’Œæ—¶é—´**è‡ªå·±æ¢ç´¢å…¬å¸æ•°æ®**ã€‚å¤ªå¥½äº†ï¼

## ä½ è„‘ä¸­çš„ä¸€äº›é—®é¢˜æ˜¯:

*   ğŸ¬ä»¥äº¤æ˜“æ•°é‡è¡¡é‡ï¼Œè¿™å®¶å…¬å¸å®é™…ä¸Šæœ‰å¤šå¤§ï¼Ÿ
*   ğŸ’µæŒ‰å¹´æ”¶å…¥è®¡ç®—çš„å…¬å¸è§„æ¨¡ï¼Ÿ
*   ğŸ‘—æ¯ä¸ªç±»åˆ«æˆ‘ä»¬æä¾›å¤šå°‘äº§å“ï¼Ÿ
*   ğŸ“¦æˆ‘ä»¬çš„äº¤ä»˜æœ‰å¤šæˆåŠŸï¼Ÿ

æ‚¨çŸ¥é“æ‚¨å¯ä»¥ç®€å•åœ°é€šè¿‡ä½¿ç”¨æ ‡å‡†å…¬å¼å’Œä¸€ä¸ªæ•°æ®é€è§†è¡¨æ¥ä½¿ç”¨å’Œç»„åˆ Excel ä¸­çš„ä¸‰ä¸ªè¡¨ Ordersã€Order_lines å’Œ Products æ¥å›ç­”è¿™äº›é—®é¢˜ã€‚

ä½†æ˜¯å› ä¸ºæ²¡æœ‰äººåœ¨ä½ èº«è¾¹ï¼Œä½ å¼€å§‹ä¸€ä»½æ–°å·¥ä½œæ ‡å¿—ç€ä½ èŒä¸šç”Ÿæ¶¯çš„ä¸€ä¸ªæ–°æ—¶ä»£ï¼Œæ‰€ä»¥è¿™æ¬¡ä½ æƒ³åšå¾—ä¸åŒã€‚ä¸ºä»€ä¹ˆä¸è¯•è¯• LinkedIn ä¸Šäººäººéƒ½åœ¨è°ˆè®ºçš„è¿™ä¸ªå«åš python çš„å¾ˆé…·çš„ä¸œè¥¿å‘¢ï¼Ÿå¥½å•Šï¼Œæˆ‘ä»¬èµ°å§ï¼

# 2.å¼€å§‹â€”æ•°æ®

æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨çš„æ•°æ®æ˜¯ Olist çš„[å·´è¥¿ç”µå­å•†åŠ¡å…¬å…±æ•°æ®é›†çš„æ”¹ç¼–å’Œç®€åŒ–ç‰ˆæœ¬ã€‚](https://www.kaggle.com/olistbr/brazilian-ecommerce)

åœ¨ Excel ä¸­ï¼Œä½ å¯ä»¥åšç±»ä¼¼äºæ‰“å¼€ä¸€ä¸ªæ–°çš„ Excel æ–‡æ¡£ï¼Œè¿›å…¥æ•°æ®>è·å–æ•°æ®>ä»æ–‡æœ¬ï¼Œç„¶åæœç´¢ã€‚csv æ–‡ä»¶ï¼Œå¹¶å•å‡»æ–‡æœ¬å¯¼å…¥å‘å¯¼(é€‰æ‹©åˆ†éš”ç¬¦ã€æ–‡ä»¶ç¼–ç ã€æ•°æ®æ ¼å¼ç­‰ã€‚)æˆ–è€…æ‚¨åªéœ€åŒå‡»ã€‚csv æ–‡ä»¶ï¼Œå¸Œæœ› Excel ä¼šè‡ªå·±æ­£ç¡®åœ°è§£å†³æ‰€æœ‰é—®é¢˜(å“å“Ÿï¼).

![](img/0e61c6dbdc9affeea4138aee2f917c67.png)

ä½†æ˜¯ç°åœ¨æˆ‘ä»¬åœ¨ python çš„åœŸåœ°ä¸Šï¼Œäº‹æƒ…æœ‰ç‚¹ä¸åŒ(ä½†æ˜¯ä¸ä¼šæ›´éš¾ï¼).

ä½¿ç”¨ã€‚csv æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åŒ…[ç†ŠçŒ«](https://pandas.pydata.org/docs/)å°†å…¶ä½œä¸º dataframe(è¡¨æ ¼çš„åˆ«ç§°)è¯»å–ã€‚æˆ‘ä»¬å°†å¯¼å…¥çš„è¡¨ä¿å­˜åœ¨å…·æœ‰é€‚å½“åç§°çš„å˜é‡ä¸­ã€‚æ•°æ®å¸§åç§°é€šå¸¸ä»¥ df ç»“å°¾ã€‚

```
# setup notebook and load tables
import pandas as pd

orders_df = pd.read_csv("data/Orders.csv")
order_lines_df = pd.read_csv("data/Order_lines.csv")
products_df = pd.read_csv("data/Products.csv")
```

å¤ªå¥½äº†ï¼æˆ‘ä»¬åˆšåˆšå°†ä¸‰ä¸ªè¡¨åŠ è½½åˆ°æˆ‘ä»¬çš„ python ç¨‹åºä¸­ã€‚

æˆ‘ä»¬æœ‰å—ï¼Ÿ

ä¸ Excel ä¸åŒï¼Œå¯¼å…¥çš„æ•°æ®ä¸ä¼šç«‹å³æ˜¾ç¤ºã€‚å¦‚æœä½ ä¸æ˜ç¡®è¯´å‡ºä½ æƒ³çœ‹ä»€ä¹ˆï¼ŒPython æ˜¯ç›¸å½“æ²‰é»˜çš„ã€‚

åœ¨æ‚¨ä½¿ç”¨ pandas çš„ read_csv()æ–¹æ³•å¯¼å…¥ csv æ–‡ä»¶å¹¶å°†å…¶ä¿å­˜ä¸º something_df ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ **something_df.head(5)** æ˜¾ç¤ºå‰ 5 è¡Œã€‚

è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°çœ‹åˆ°è¡¨çš„æ ·å­ä»¥åŠæˆ‘ä»¬æ­£åœ¨å¤„ç†å“ªäº›åˆ—ã€‚è®©æˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„ä¸‰å¼ æ¡Œå­åšé‚£ä»¶äº‹ã€‚

**è®¢å•**å°†é™ˆè¿°æ‰€æœ‰äº¤æ˜“ã€äº¤æ˜“å‘ç”Ÿçš„æ—¶é—´ä»¥åŠè®¢å•æ˜¯å¦å·²æˆåŠŸå±¥è¡Œã€‚æ¯ä¸ªè®¢å•éƒ½æœ‰ä¸€ä¸ª order_id(æ¯ä¸ªè®¢å•å”¯ä¸€)ã€customer_id(æ¯ä¸ªå®¢æˆ·å”¯ä¸€)ã€order_status å’Œè´­ä¹°æ—¥æœŸã€‚

```
# Preview of the Orders table
orders_df.head(5)
```

![](img/409311cbf3d49cde744a3e73e54d9a75.png)

ä½†æ˜¯ï¼Œorders_df ä¸åŒ…å«å•ä¸ªè®¢å•çš„å†…å®¹ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦æŸ¥çœ‹ä¸€ä¸‹ **Order_lines** è¡¨ï¼Œå¹¶ä½¿ç”¨è®¢å• id è¿æ¥è¿™ä¸¤ä¸ªè¡¨ã€‚åœ¨ order_lines_df ä¸­ï¼Œæ¯ä¸€è¡ŒæŒ‡ä¸€ä¸ªäº¤æ˜“é¡¹ç›®ï¼ŒåŒ…æ‹¬æ•°é‡ã€ä»·æ ¼å’Œè¿è´¹å€¼ã€‚

```
# Preview of Order_lines table
order_lines_df.head(5)
```

![](img/b3776a6c3445da856ea6db384a60d0be.png)

äº§å“ç±»åˆ«è¿˜ä¸æ˜¯è¿™ä¸ªè¡¨çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†**äº§å“**è¡¨(products_df)ä¸ order_lines_df ç»“åˆèµ·æ¥ï¼Œä»¥é˜²æˆ‘ä»¬æƒ³è¦åˆ†æç±»åˆ«çº§åˆ«çš„æ•°æ®ã€‚ç›®å‰ï¼Œproducts_df ä¸­åªæœ‰ä¸¤åˆ—ï¼Œäº§å“ id å’Œç›¸å…³çš„äº§å“ç±»åˆ«ã€‚

```
# Preview of Products table
products_df.head(5)
```

![](img/274c9ff104ad4c157c4dcae586bd3980.png)

# 3.ç”¨æ•°æ®å›ç­”æˆ‘ä»¬çš„é—®é¢˜

![](img/b13a3a34d2a98d1c320919fecc0949e9.png)

æ¥æº:pix abay[https://pix abay . com/photos/audit-chart-graph-hand-writing-3229739/](https://pixabay.com/photos/audit-chart-graph-hand-writing-3229739/)

ç°åœ¨æˆ‘ä»¬å·²ç»æŠŠæ‰€æœ‰çš„ä¸œè¥¿éƒ½è½½å…¥äº†ç¬”è®°æœ¬ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹ç”¨æ•°æ®æ¥å›ç­”æˆ‘ä»¬çš„é—®é¢˜äº†ã€‚

## 3.1 ğŸ¬ä»¥äº¤æ˜“æ•°é‡è¡¡é‡ï¼Œè¿™å®¶å…¬å¸å®é™…ä¸Šæœ‰å¤šå¤§ï¼Ÿ

å› ä¸ºæˆ‘ä»¬åœ¨é”€å”®éƒ¨é—¨å·¥ä½œï¼Œæ‰€ä»¥å½“æˆ‘ä»¬åœ¨è¿™é‡Œè°ˆè®ºå…¬å¸è§„æ¨¡æ—¶ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯**äº¤æ˜“æ•°é‡**ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä½¿ç”¨ python çš„ len()æ–¹æ³•è®¡ç®— order_df ä¸­çš„è¡Œæ•°å¼€å§‹ã€‚è¿™ç±»ä¼¼äºå•å‡» Excel ä¸­çš„åˆ—å¹¶åœ¨å±å¹•åº•éƒ¨è¯»å–è®¡æ•°ã€‚

```
len(orders_df)99441
```

æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ order_id åˆ—ä½¿ç”¨ pandas pd.unique()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†è¿”å› order_id çš„å”¯ä¸€å€¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”è¯¥æ²¡æœ‰ä»€ä¹ˆä¸åŒï¼Œå› ä¸ºè®¢å• id æœ¬è´¨ä¸Šæ˜¯å”¯ä¸€çš„ã€‚

ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å¯¹æœ‰é‡å¤é¡¹çš„åˆ—(å¦‚ customer_id)ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯¹æ•´ä¸ªè¡¨ä½¿ç”¨ len()çš„ç»“æœå°†æ˜¯ä¸æ­£ç¡®çš„ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬æ­£ç¡®åœ°ä½¿ç”¨ pd.unique()æ¥è·å–å”¯ä¸€çš„è®¢å• idï¼Œç„¶åå¯¹å…¶ä½¿ç”¨ len()ã€‚

æ³¨æ„:å¯ä»¥ä½¿ç”¨ table_df["column_name"]æ¥è®¿é—®è¡¨ä¸­çš„åˆ—

```
len(pd.unique(orders_df["order_id"]))99441
```

èµ·åˆï¼Œæˆ‘ä»¬å¯¹å¤§é‡çš„äº¤æ˜“æ„Ÿåˆ°æƒŠè®¶ï¼Œä½†éšåæˆ‘ä»¬æ³¨æ„åˆ°ä¸¤ä»¶äº‹:

*   **å¹¶éæ‰€æœ‰è®¢å•éƒ½å·²äº¤ä»˜**ã€‚æˆ‘ä»¬åº”è¯¥åªæŸ¥çœ‹ä½¿ç”¨ order_status æˆåŠŸäº¤ä»˜çš„è®¢å•ã€‚
*   è¿™äº›äº¤æ˜“å‘ç”Ÿåœ¨ 2016â€“2018 çš„ä¸‰ä¸ª**å¹´ã€‚æˆ‘ä»¬åº”è¯¥çœ‹çœ‹æ¯å¹´çš„äº¤æ˜“æ•°é‡ã€‚**

æˆ‘ä»¬å…ˆæŠŠæ‰€æœ‰æ²¡æœ‰å‘è´§æˆåŠŸçš„è®¢å•è¿‡æ»¤æ‰ã€‚ä¸ºäº†æ‰¾å‡ºæœ‰å¤šå°‘ order_status é€‰é¡¹ï¼Œæˆ‘ä»¬å°†åœ¨ Excel ä¸­å•å‡»è¯¥åˆ—çš„è¿‡æ»¤å™¨ã€‚

![](img/da91ece489e535f14f160c37c8ac6ee1.png)

Excel åªå‘æˆ‘ä»¬æ˜¾ç¤ºå”¯ä¸€çš„å€¼ï¼Œè¿™å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯æ­£å¦‚æˆ‘ä»¬åˆšåˆšäº†è§£åˆ°çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ order_status åˆ—ä¸Šä½¿ç”¨ pd.unique()æ¥è¾¾åˆ°åŒæ ·çš„ç›®çš„ã€‚

```
pd.unique(orders_df["order_status"])array(['delivered', 'invoiced', 'shipped', 'processing', 'unavailable',
       'canceled', 'created', 'approved'], dtype=object)
```

åœ¨ Excel ä¸­ï¼Œæˆ‘ä»¬åªéœ€å–æ¶ˆé€‰æ‹©é™¤â€œå·²äº¤ä»˜â€ä¹‹å¤–çš„æ‰€æœ‰é€‰é¡¹æ¥è¿‡æ»¤æˆ‘ä»¬çš„è¡¨æ ¼ã€‚Excel å°†æ£€æŸ¥æ¯ä¸€è¡Œï¼Œåªæ˜¾ç¤º order_status ç­‰äºâ€œå·²äº¤ä»˜â€çš„è¡Œã€‚

æˆ‘ä»¬å¯ä»¥å‘Šè¯‰ python ä¹Ÿè¿™æ ·åšã€‚å¦‚æœæˆ‘ä»¬çš„è®¡ç®—æœºæ˜¯ä¸€ä¸ªäººï¼Œæˆ‘ä»¬ä¼šå‘Šè¯‰å¥¹:è¯·ä»¥ order_df è¡¨ä¸ºä¾‹ï¼Œåªæ˜¾ç¤º order_df è¡¨ä¸­â€œorder_statusâ€åˆ—ç­‰äºâ€œdeliveredâ€çš„è¡Œã€‚å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬çš„è®¡ç®—æœºä¸æ˜¯äººï¼Œéœ€è¦æ›´å°‘çš„æ–‡æœ¬æ¥åšåŒæ ·çš„äº‹æƒ…ã€‚

ç¿»è¯‘æˆ python å°±æ˜¯:

```
orders_df[orders_df["order_status"]=="delivered"]
```

![](img/0ee30994f9e40bf02796f58c4056e19d.png)

æˆ‘ä»¬åº”è¯¥å°†è¿‡æ»¤åçš„ç»“æœä¿å­˜åˆ°å¦ä¸€ä¸ªæ•°æ®å¸§ä¸­ï¼Œä»¥ä¾¿è¿›ä¸€æ­¥ä½¿ç”¨è¯¥è¡¨ã€‚

```
delivered_orders_df = orders_df[orders_df["order_status"]=="delivered"]
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹æ¯å¹´çš„äº¤æ˜“è¿›è¡Œç»†åˆ†ã€‚æˆ‘ä»¬å°†æŠŠ order_purchase_timestamp åˆ—è½¬æ¢æˆä¸€ä¸ªæ—¥æœŸæ—¶é—´åˆ—ã€‚ç„¶åæˆ‘ä»¬å°†**ä»ä¸­æå–å¹´ä»½**ï¼Œå¹¶ä¿å­˜åˆ°ä¸€ä¸ªåä¸ºâ€œyearâ€çš„**æ–°åˆ—ä¸­ã€‚**

è¿™ç±»ä¼¼äºä½¿ç”¨ Excel çš„ Year()å…¬å¼ã€‚

![](img/24ddb277b6498effaed4d85541a9295a.png)

```
# the data type of this column is not yet datetime
delivered_orders_df["order_purchase_timestamp"].dtypesdtype('O')# convert to datetime
delivered_orders_df["order_purchase_timestamp"] = pd.to_datetime(delivered_orders_df["order_purchase_timestamp"])
delivered_orders_df["order_purchase_timestamp"].dtypesdtype('<M8[ns]')# extract the year from datetime and save to new column
delivered_orders_df["order_year"] = delivered_orders_df["order_purchase_timestamp"].dt.year# show the new table
delivered_orders_df.head(5)
```

![](img/8a2057cb2726b3a6aef0bfd7a50c87c6.png)

å¤ªå¥½äº†ï¼ç°åœ¨ï¼Œæˆ‘ä»¬æ‹¥æœ‰äº†ç»Ÿè®¡æ¯å¹´äº¤ä»˜è®¢å•æ‰€éœ€çš„ä¸€åˆ‡ã€‚åœ¨ Excel ä¸­ï¼Œæˆ‘ä»¬ä¼šæŒ‰å¹´ä»½è¿‡æ»¤ï¼Œå¯¹æ¯ä¸€è¡Œè¿›è¡Œè®¡æ•°ï¼Œå¹¶å°†å…¶å†™å…¥ä¸€ä¸ªæ–°çš„æ±‡æ€»è¡¨ã€‚

æ›´é«˜çº§çš„ Excel ç”¨æˆ·å¯ä»¥è·³è¿‡è¿™ä¸€æ‰‹åŠ¨ä»»åŠ¡ï¼Œä½¿ç”¨ä»¥å¹´ä»½ä¸ºåˆ—çš„æ•°æ®é€è§†è¡¨ï¼Œå¹¶è®¡ç®— order_id çš„å€¼ã€‚

![](img/50f215bbc0d9abd68358edddf57e1a9f.png)

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ pandas **groupby** å’Œ **agg** å‡½æ•°æ¥å®ç°åŒæ ·çš„åŠŸèƒ½ã€‚å¯¹äºè¿™æ ·ä¸€ä¸ªç®€å•çš„ä»»åŠ¡æ¥è¯´ï¼Œè¯­æ³•å¯èƒ½çœ‹èµ·æ¥ä»¤äººç”Ÿç•ï¼Œä½†æ˜¯è¿™ä¸ªå‡½æ•°æ˜¯éå¸¸é€šç”¨å’Œå¼ºå¤§çš„ï¼Œè¿™æ˜¯ Excel çš„ pivot æ¢¦å¯ä»¥æ±‚çš„ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬é€‰æ‹©è¦èšåˆçš„è¡¨(what)ï¼Œç„¶åå®šä¹‰è¦èšåˆçš„åˆ—(where)ï¼Œæ¥ç€å®šä¹‰èšåˆå‡½æ•°(how)ã€‚

```
delivered_orders_df.groupby(by=["order_year"], as_index=False).agg({'order_id':'count'})
```

![](img/832ea7d6c5e678bc4caa135954d18e2f.png)

## 3.2 ğŸ’µæŒ‰å¹´æ”¶å…¥è®¡ç®—çš„å…¬å¸è§„æ¨¡ï¼Ÿ

åœ¨äº¤æ˜“æ•°é‡æ—è¾¹ï¼Œæˆ‘ä»¬è¿˜æƒ³æ‰¾å‡ºæ”¶å…¥ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ order_id ä½œä¸ºé”®å°† delivered_order_df ä¸ order_lines_df ç»“åˆèµ·æ¥ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬æ³¨æ„åˆ° order_lines è¡¨æœ‰å…³äºè®¢å•å•†å“æ•°é‡å’Œä»·æ ¼çš„ä¿¡æ¯ï¼Œä½†è¿˜æ²¡æœ‰æ”¶å…¥çš„ä¿¡æ¯ã€‚

å› æ­¤ï¼Œè¿™æ˜¯æˆ‘ä»¬éœ€è¦åšçš„:

*   ç”¨ order_item * price çš„å€¼åœ¨ order_lines_df ä¸­åˆ›å»ºä¸€ä¸ªåˆ—â€œline_revenueâ€
*   åˆ›å»ºä¸€ä¸ªæ±‡æ€»è¡¨ï¼Œå°†æ¯ä¸ªè®¢å•çš„ line_revenue æ±‡æ€»ä¸º order_revenue
*   å°†èšåˆè¡¨ä¸ delivered_orders_df åˆå¹¶ï¼Œå¹¶åˆè®¡æ¯å¹´çš„ order_revenue

åœ¨ Excel ä¸­ï¼Œæˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ªæ–°åˆ—ï¼Œä½¿ç”¨ä¸€ä¸ªæ•°æ®é€è§†è¡¨ï¼Œä½¿ç”¨ç±»ä¼¼ VLOOKUP çš„ä¸œè¥¿å°†æ•°æ®é€è§†è¡¨ä¸å…¶ä»–è¿‡æ»¤è¡¨åˆå¹¶ï¼Œåœ¨ç»“æœè¡¨ä¸Šæ„å»ºå¦ä¸€ä¸ªæ•°æ®é€è§†è¡¨â€¦

æˆ‘ä»¬ä¸è¦é‚£æ ·åšã€‚è¿™ä¸æ˜¯ä¸€ä¸ªå¤æ‚çš„ä»»åŠ¡ï¼Œä½†æ˜¯æˆ‘ä»¬å·²ç»æ˜ç™½ä¸ºä»€ä¹ˆæˆ‘ä»¬åº”è¯¥åˆ‡æ¢åˆ° Python æ¥å®Œæˆè¿™æ ·çš„ä»»åŠ¡ã€‚ä¸€æ—¦ä½ ä¹ æƒ¯äº†è¯­æ³•å’Œè¿‡ç¨‹ï¼Œä¸€åˆ‡éƒ½ä¼šå˜å¾—æ›´å®¹æ˜“å’Œæ›´å®¹æ˜“å®ç°ã€‚

```
order_lines_df.head()
```

![](img/b3776a6c3445da856ea6db384a60d0be.png)

```
# create new column and save the result of order_item_id * price
order_lines_df["line_revenue"] = order_lines_df["order_item_id"] * order_lines_df["price"]
order_lines_df.head()
```

![](img/3931f6f530720d380291916517e2e140.png)

```
# aggregate table and sum up line_revenue to get the total order value per order id
order_lines_agg_df = order_lines_df.groupby(by=["order_id"], as_index=False).agg({"line_revenue":"sum"})
order_lines_agg_df.head(5)
```

![](img/435b964363f95b73c91b8b4f5bd47efb.png)

```
delivered_orders_df.head(5)
```

![](img/8a2057cb2726b3a6aef0bfd7a50c87c6.png)

ç°åœ¨æˆ‘ä»¬æƒ³åˆå¹¶ä¸Šé¢çš„ä¸¤ä¸ªè¡¨ï¼Œorder_lines_agg_df å’Œ delivered_orders_dfã€‚å°±ç»“æœè€Œè¨€ï¼Œæˆ‘ä»¬æ‰€åšçš„ç±»ä¼¼äº Excel çš„ VLOOKUP()å…¬å¼ï¼Œä½†æ˜¯æˆ‘ä»¬**ä½¿ç”¨ order_id ä½œä¸ºé”®**æ¥åˆå¹¶ä¸¤ä¸ªè¡¨ã€‚python ä»£ç éå¸¸ç®€å•ï¼Œå‡ ä¹åƒæ•£æ–‡ä¸€æ ·ã€‚

ä¹‹åï¼Œæˆ‘ä»¬é‡å¤ä¸Šé¢åœ¨è®¡ç®—æ¯å¹´çš„äº¤æ˜“æ•°é‡æ—¶æ‰€åšçš„äº‹æƒ…ï¼Œä½†è¿™æ¬¡æˆ‘ä»¬å¯¹ order_revenue æ±‚å’Œã€‚

```
# merge the two tables to get revenue per order
delivered_orders_merged_df = pd.merge(left=delivered_orders_df, right=order_lines_agg_df, how="left", on="order_id")
delivered_orders_merged_df.head(5)
```

![](img/35ff38eeb1c1a3cd00dd8541ae26ad81.png)

```
revenue_per_year_df = delivered_orders_merged_df.groupby(by=["order_year"], as_index=False).agg({"order_revenue":"sum"})
revenue_per_year_df.columns = ["order_year", "total_revenue"]
revenue_per_year_df
```

![](img/e8b29d1fe72a35394e9d239d731b58d0.png)

è¿™çœ‹èµ·æ¥ä¸å¯¹ï¼Œå¯¹å§ï¼Ÿä¸å®Œå…¨æ˜¯ã€‚è¿™è¢«ç§°ä¸º**ç§‘å­¦è®°æ•°æ³•**ï¼Œå…¶ä¸­éå¸¸å¤§æˆ–éå¸¸å°çš„æ•°å­—æ˜¾ç¤ºä¸ºè®¡ç®—ç»“æœã€‚

4.649029e+4 è¡¨ç¤º 4.649029 * 10â´è¡¨ç¤º 4.649029 * 10000 è¡¨ç¤º 46490.29ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ç‰‡æ®µæ›´æ”¹ Jupyter ç¬”è®°æœ¬æ˜¾ç¤ºæ•°å­—çš„æ–¹å¼ã€‚

```
pd.set_option('display.float_format', lambda x: '%.2f' % x)# display float numbers up to second decimal point
revenue_per_year_df
```

![](img/d4c9a46d1eaa554b7eb8cb90a2ff27d1.png)

å¤ªå¥½äº†ï¼çœ‹èµ·æ¥æˆ‘ä»¬å…¬å¸å¾ˆæœ‰æ´»åŠ›ã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—å„ç§å„æ ·çš„ä¸œè¥¿ã€‚æ¯”å¦‚æ¯å¹´çš„å®¢æˆ·æ•°é‡å’Œå¹³å‡è®¢å•ä»·å€¼ã€‚äº¤æ˜“ä¸å®¢æˆ·çš„æ¯”ç‡å¯èƒ½ä¹Ÿå¾ˆæœ‰æ„æ€ï¼Œå› ä¸ºå½“ä¸€å®¶å…¬å¸çš„æ”¶å…¥ä»…åŸºäºå°‘æ•°é«˜ä»·å€¼å®¢æˆ·æ—¶ï¼Œè¯¥å…¬å¸å¯èƒ½ä¼šé¢ä¸´é£é™©ã€‚å¦‚æœä»–ä»¬è½¬å‘æˆ‘ä»¬çš„ç«äº‰å¯¹æ‰‹å‘¢ï¼Ÿ

ä¸€æ—¦ä½ å®Œæˆæœ¬æ•™ç¨‹ï¼Œè¿™äº›éƒ½æ˜¯å¾ˆå¥½çš„è°ƒæŸ¥é—®é¢˜ã€‚ä½†é¦–å…ˆè®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„å…¶ä»–é—®é¢˜ã€‚

## 3.3 ğŸ‘—æ¯ä¸ªç±»åˆ«æˆ‘ä»¬æä¾›å¤šå°‘äº§å“ï¼Ÿ

æ—¢ç„¶æ‚¨å·²ç»çŸ¥é“äº†å¦‚ä½•è®¡ç®—ä¸€ä¸ªåˆ—çš„å”¯ä¸€å€¼ï¼Œç°åœ¨è¿™å°†å˜å¾—éå¸¸å®¹æ˜“ã€‚ä¸Šé¢ï¼Œæˆ‘ä»¬è®¡ç®—äº† orders_df ä¸­å”¯ä¸€ order _ ids çš„æ•°é‡ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¿…é¡»è®¡ç®— products_df ä¸­çš„ product_idï¼Œä»¥å¤§è‡´äº†è§£æˆ‘ä»¬çš„äº§å“èŒƒå›´ï¼Œå³**æˆ‘ä»¬æä¾›å¤šå°‘ä¸åŒçš„äº§å“**ã€‚

```
products_df.head()
```

![](img/274c9ff104ad4c157c4dcae586bd3980.png)

```
# count unique products in our database
len(pd.unique(products_df["product_id"]))32951
```

ç”±äºæˆ‘ä»¬è¿˜æƒ³çŸ¥é“æ¯ä¸ªç±»åˆ«çš„**äº§å“æ•°é‡ï¼Œæˆ‘ä»¬å¤åˆ¶ä¸Šé¢çš„æ–¹æ³•ï¼Œè®¡ç®—æ¯å¹´çš„äº¤æ˜“æ•°é‡ã€‚æˆ‘ä»¬ç°åœ¨å°†ä½¿ç”¨â€œäº§å“ç±»åˆ«åç§°â€è€Œä¸æ˜¯â€œè®¢å•å¹´ä»½â€,å¹¶ä¸”ä½¿ç”¨â€œäº§å“æ ‡è¯†â€è€Œä¸æ˜¯â€œè®¢å•æ ‡è¯†â€æ¥è®¡æ•°ã€‚**

```
# count products per category
products_per_category_df = products_df.groupby(by=["product_category_name"], as_index=False).agg({"product_id":"count"})
products_per_category_df.columns = ["product_category_name", "product_id_count"]
products_per_category_df.head(5)
```

![](img/d6f65967c21976d9d6f61a6793228d87.png)

```
# number of categories
len(products_per_category_df)73
```

å“‡ï¼Œæˆ‘ä»¬æä¾› 73 ä¸ªç±»åˆ«çš„è¿‘ 33ï¼Œ000 ç§äº§å“ï¼Ÿå°±äº§å“æ•°é‡è€Œè¨€ï¼Œå‰ 5 å¤§ç±»åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

åƒåœ¨ Excel ä¸­ä¸€æ ·ï¼Œæˆ‘ä»¬åªéœ€æŒ‰ product_id_count å¯¹è¡¨è¿›è¡Œæ’åºã€‚

```
# sort by product_id_count descending
products_per_category_df.sort_values(by=["product_id_count"], ascending=False).head(5)
```

![](img/9235658edc7ff00ad80c04f098e7357a.png)

è¿™å¯èƒ½æ˜¯ä½ å‘ç°åœ¨å·´è¥¿å…¬å¸å·¥ä½œæ—¶æ‡‚è‘¡è„ç‰™è¯­å¾ˆæœ‰å¸®åŠ©çš„åœ°æ–¹â€¦

## 3.4 ğŸ“¦æˆ‘ä»¬çš„äº¤ä»˜æœ‰å¤šæˆåŠŸï¼Ÿ

åœ¨ 3.1 ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåªåŒ…å«æˆåŠŸäº¤ä»˜è®¢å•çš„æ–°è¡¨ã€‚å¦‚æœæˆ‘ä»¬è®¡ç®—è¯¥è¡¨çš„å”¯ä¸€è®¢å• id æ•°ï¼Œå¹¶å°†è¯¥æ•°é™¤ä»¥æœªè¿‡æ»¤çš„ orders_df è¡¨ä¸­çš„å”¯ä¸€è®¢å• id æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°æˆåŠŸäº¤ä»˜çš„ç™¾åˆ†æ¯”ã€‚

```
unique_orderids_total = len(pd.unique(orders_df["order_id"]))
unique_orderids_delivered = len(pd.unique(delivered_orders_df["order_id"]))

# calculate ratio and round to second decimal point
round(unique_orderids_delivered/unique_orderids_total,2)0.97
```

97%çš„äº¤ä»˜æˆåŠŸç‡æ˜¯æˆ‘ä»¬å…¬å¸å€¼å¾—éª„å‚²çš„äº‹æƒ…ã€‚

# 4.æ‘˜è¦

ç°åœ¨ï¼Œç”±äº pandasï¼Œæˆ‘ä»¬äº†è§£åˆ°ä½¿ç”¨ python æ˜¯ Excel çš„çœŸæ­£æ›¿ä»£æ–¹æ³•ï¼Œæˆ‘ä»¬æœ‰ç‚¹å¿˜ä¹æ‰€ä»¥ï¼Œæ ¹æ®æ¥è‡ªä¸‰ä¸ªåŸå§‹è¡¨çš„èšåˆæ•°æ®è®¡ç®—äº†å„ç§ KPIã€‚å¿«é€Ÿçœ‹ä¸€ä¸‹æ‰‹è¡¨å°±èƒ½çŸ¥é“æˆ‘ä»¬çš„èƒƒå·²ç»çŸ¥é“äº†ä»€ä¹ˆ:è¯¥åƒåˆé¥­äº†ï¼

ä½†æ˜¯åœ¨æˆ‘ä»¬å»å…¬å¸ä¹‹å‰ã€‚æ–‡é¼æœºå™¨ï¼Œæˆ‘ä»¬æƒ³ä¿å­˜æˆ‘ä»¬æ‰€åšçš„ï¼Œå¹¶å°†å…¶å‘é€ç»™æˆ‘ä»¬çš„åŒäº‹ã€‚æˆ‘ä»¬å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ï¼Ÿ

æˆ‘ä»¬å¯ä»¥ç®€å•åœ°**å°†æ•°æ®å¸§å¯¼å‡ºä¸º csv æ–‡ä»¶**ï¼Œå¹¶å°†å®ƒä»¬å‘é€ç»™é‚£äº›å–œæ¬¢ä½¿ç”¨ Excel çš„äººã€‚

```
# Export dataframe as csv for Excel
products_per_category_df.to_csv("output/products_per_category_df.csv", index=False)
```

ä»Šå¤©ï¼Œæˆ‘ä»¬å­¦ä¹ äº†ä¸€äº›åŸºæœ¬ä½†å¼ºå¤§çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°å…è®¸æˆ‘ä»¬ç”¨ Python ä»£æ›¿ Excel å·¥ä½œã€‚è¿™é‡Œæœ‰ä¸€ä¸ªæ€»ç»“ã€‚

*   *pd.read_csv()* å¯ä»¥ç”¨æ¥å¯¼å…¥ã€‚ä½œä¸ºæ•°æ®å¸§çš„ csv æ–‡ä»¶
*   *table_df.head()* å‘æˆ‘ä»¬å±•ç¤ºäº†è¯¥è¡¨çš„é¢„è§ˆè¾“å‡º
*   ä¸ºäº†è®¿é—® table_df çš„ä¸€åˆ—ï¼Œæˆ‘ä»¬é”®å…¥*table _ df[" column _ name "]*
*   *len(PD . unique(table _ df[" column _ name "])*ç»™å‡ºè¯¥åˆ—ä¸­å”¯ä¸€å€¼çš„æ•°é‡
*   æˆ‘ä»¬å¯ä»¥å°†ä¸¤åˆ—ç›¸ä¹˜ï¼Œå¹¶ä½¿ç”¨*table _ df[" new "]= table _ df[" col 1 "]* table _ df[" col 2 "]*å°†ç»“æœä¿å­˜åœ¨æ–°åˆ—ä¸­
*   é™¤äº† Excel çš„æ•°æ®é€è§†è¡¨ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ±‡æ€»æ¯ä¸ªç±»åˆ«çš„å€¼ï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨*table _ df . group by(by =[" category "]ï¼Œas_index=False)è®¡ç®—æ¯å¹´çš„äº¤æ˜“æ¬¡æ•°æˆ–åˆè®¡æ¯ä¸ªè®¢å•çš„æ”¶å…¥ã€‚agg({"col3":"sum"})*
*   é™¤äº†åœ¨ Excel ä¸­ä½¿ç”¨ VLOOKUP()ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ *pd.merge(left=table_1_dfï¼Œright=table_2_dfï¼Œhow="left "ï¼Œon="key_column")*

æˆ‘å»ºè®®ä½ ç»§ç»­ä¸‹å»ï¼Œè¿›ä¸€æ­¥ç ”ç©¶è¿™ä¸ªæ•°æ®é›†æˆ–ä½ è‡ªå·±çš„æ•°æ®é›†ã€‚æ¯å½“ä½ ä¸çŸ¥é“å¦‚ä½•åšæŸä»¶äº‹æ—¶ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯æŸ¥çœ‹ç†ŠçŒ«æ–‡æ¡£æˆ–è°·æ­Œä½ çš„ç‰¹å®šé—®é¢˜(â€œæ¥è‡ªå­—ç¬¦ä¸²çš„ python æ—¥æœŸæ—¶é—´â€æˆ–â€œpython æ•°æ®é€è§†è¡¨â€)ï¼Œçœ‹çœ‹å…¶ä»–äººæ˜¯å¦‚ä½•åšçš„ã€‚åªæ˜¯ä¸è¦æ°”é¦ï¼Œç»§ç»­å­¦ä¹ ï¼

![](img/44bc973e1a66a6d3c7268eb11f3c3b13.png)

å¼€å§‹æ€»æ˜¯è‰°éš¾çš„ï¼Œä½†åšæŒä¸‹å»ï¼Œä½ ä¼šæ¯”ä»»ä½• Excel ä¸“ä¸šäººå‘˜æ›´æœ‰æ•ˆã€æ›´å¿«ã€‚å¦‚æœä½ éœ€è¦ä¸€äº›å…³äºæ•°æ®åˆ†æå’Œæ•°æ®ç§‘å­¦æ˜¯å¦å¯ä»¥æˆä¸ºä½ çš„èŒä¸šé“è·¯çš„ä¸€èˆ¬æ€§æŒ‡å¯¼ï¼Œæˆ‘ä»¬ [HOSD è¾…å¯¼å…¬å¸æä¾›å…è´¹çš„ä¸€å¯¹ä¸€è¾…å¯¼](http://www.hosd-mentoring.com)ã€‚

åªéœ€åœ¨æˆ‘ä»¬çš„ç½‘ç«™ä¸Šç‚¹å‡»ä¸€ä¸‹ï¼Œæ‚¨å°±å¯ä»¥é¢„çº¦æˆ‘ä»¬çš„å¯¼å¸ˆã€‚ä¸è¦å®³ç¾:)

æ­¤å¤–ï¼Œæˆ‘ä»¬æƒ³å®£å¸ƒï¼Œæœ¬æ•™ç¨‹å’Œè®¸å¤šå…¶ä»–æ•™ç¨‹å°†åœ¨ä¼šè®®ç»“æŸæ—¶å˜æˆä¸€ä¸ªå¸¦æœ‰é—®ç­”ç¯èŠ‚çš„åœ¨çº¿ç ”è®¨ä¼šã€‚è¦äº†è§£æ›´å¤šå…³äºæˆ‘ä»¬çš„äº§å“æˆ–ä¸æˆ‘ä»¬è”ç³»ï¼Œè¯·åŠ¡å¿…å‰å¾€æˆ‘ä»¬çš„ [HOSD LinkedIn é¡µé¢](https://www.linkedin.com/company/hosd-mentoring/)ã€‚

åšæŒå­¦ä¹ ï¼

ä¹”çº³æ–¯

HOSD åˆ›å§‹äººå…¼æ•°æ®åˆ†æå¸ˆå¯¼å¸ˆ