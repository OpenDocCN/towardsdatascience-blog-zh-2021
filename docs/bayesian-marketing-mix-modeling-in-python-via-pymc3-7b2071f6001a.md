# é€šè¿‡ PyMC3 åœ¨ Python ä¸­è¿›è¡Œè´å¶æ–¯è¥é”€ç»„åˆå»ºæ¨¡

> åŸæ–‡ï¼š<https://towardsdatascience.com/bayesian-marketing-mix-modeling-in-python-via-pymc3-7b2071f6001a?source=collection_archive---------0----------------------->

## [è¥é”€åˆ†æ](https://medium.com/tag/marketing-analytics)

## ä¸€æ¬¡æ€§ä¼°è®¡é¥±å’Œåº¦ã€æ®‹ç•™å’Œå…¶ä»–å‚æ•°ï¼ŒåŒ…æ‹¬å®ƒä»¬çš„ä¸ç¡®å®šæ€§

![](img/65ecd8a5ada4c720fae72c522f1441a5.png)

ç”±[æ ¼é›·æ ¼Â·æ‹‰ç§‘é½](https://unsplash.com/@grakozy?utm_source=medium&utm_medium=referral)åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹æ‘„çš„ç…§ç‰‡

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æƒ³ç»“åˆæˆ‘åœ¨æ—©æœŸæ–‡ç« ä¸­è®¨è®ºçš„ä¸¤ä¸ªæ¦‚å¿µ:**è´å¶æ–¯å»ºæ¨¡**å’Œ**è¥é”€ç»„åˆå»ºæ¨¡**ã€‚å› ä¸ºä½ å¾ˆæœ‰å¯èƒ½å¯¹è¿™ä¸¤ä¸ªä¸»é¢˜éƒ½ä¸ç†Ÿæ‚‰ï¼Œæ‰€ä»¥è®©æˆ‘ç»™ä½ ä¸€ä¸ªå¿«é€Ÿçš„ä»‹ç»å’Œè¿›ä¸€æ­¥çš„é˜…è¯»ã€‚æˆ‘ä¼š

1.  æ¿€å‘ä»€ä¹ˆæ˜¯è¥é”€ç»„åˆå»ºæ¨¡ï¼Œ
2.  è´å¶æ–¯å»ºæ¨¡æ˜¯ä»€ä¹ˆï¼Œä»¥åŠ
3.  ä¸ºä»€ä¹ˆå°†ä¸¤è€…ç»“åˆèµ·æ¥æ˜¯æœ‰æ„ä¹‰çš„ã€‚

ç„¶åï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨ [PyMC3](https://docs.pymc.io/en/v3/) è¿›è¡Œå®è·µã€‚

# **å‡†å¤‡å·¥ä½œ**

å¦‚æœä½ æ˜¯æˆ‘æ–‡ç« çš„çƒ­å¿ƒè¯»è€…(*è°¢è°¢ï¼*)ï¼Œä½ å¯ä»¥è·³è¿‡å‡ èŠ‚ç›´æ¥çœ‹ä»£ç ã€‚å¦åˆ™ï¼Œè¯·ç»§ç»­é˜…è¯»ã€‚

## è¥é”€ç»„åˆå»ºæ¨¡

æ¯ä¸ªä¼ä¸šçš„ä¸€ä¸ªåŸºæœ¬é—®é¢˜æ˜¯å†³å®šåœ¨å“ªäº›æ¸ é“ä¸ŠèŠ±è´¹è¥é”€é¢„ç®—ã€‚ä½ å¯ä»¥æ¯å¤©èŠ± 1000â‚¬åœ¨ç”µè§†å¹¿å‘Šä¸Šï¼Œ2000â‚¬åœ¨å¹¿æ’­å¹¿å‘Šä¸Šï¼Œ3000â‚¬åœ¨ç½‘é¡µæ¨ªå¹…å¹¿å‘Šä¸Šï¼Œè·Ÿç€æ„Ÿè§‰èµ°ã€‚ä½†è¿™æœ‰ä»€ä¹ˆå¥½å¤„å—ï¼Ÿ

ä¹Ÿè®¸ç½‘é¡µæ¨ªå¹…é¢‘é“å·²ç»åœ¨ T21 é¥±å’Œäº†ï¼Œåœ¨é‚£é‡ŒåªèŠ± 1500â‚¬å’Œ 3000â‚¬ä¸€æ ·å¥½ã€‚è¿™æ ·ä½ å°±å¯ä»¥èŠ‚çœ 1500â‚¬ï¼Œæˆ–è€…æŠŠå®ƒä»¬æŠ•å…¥åˆ°å…¶ä»–æ›´å¥½çš„é”€å”®æ¸ é“ã€‚

æˆ–è€…ä¹Ÿè®¸ä¸€äº›é¢‘é“ç”šè‡³æœ‰è´Ÿçš„æŠ•èµ„å›æŠ¥ç‡â€”â€”ä½ åœ¨å¹¿å‘Šä¸ŠèŠ±çš„æ¯ä¸€æ¬§å…ƒï¼Œä½ å¾—åˆ°çš„å›æŠ¥ä¸åˆ°ä¸€æ¬§å…ƒã€‚æˆ‘ä»¬ç»å¯¹ä¸åº”è¯¥åœ¨è¿™æ ·ä¸€ä¸ªé¢‘é“ä¸Šæµªè´¹å¤ªå¤šçš„é’±ï¼Œè‡³å°‘ä»å•†ä¸šè§’åº¦æ¥çœ‹å®ƒæ²¡æœ‰æˆ˜ç•¥é‡è¦æ€§ã€‚

è¦å›ç­”è¿™æ ·çš„é—®é¢˜ï¼Œä½ å¿…é¡»äº†è§£ä¸åŒçš„**åª’ä½“æ”¯å‡º**(ç”µè§†ã€å¹¿æ’­â€¦â€¦)**å¦‚ä½•å½±å“ä½ çš„é”€å”®**æˆ–å…¶ä»–æ„Ÿå…´è¶£çš„ KPIã€‚

åœ¨è¥é”€ç»„åˆå»ºæ¨¡ä¸­ï¼Œä½ ä»åª’ä½“æ”¯å‡ºæ•°æ®é›†å¼€å§‹ã€‚å®ƒé€šå¸¸é€šè¿‡ä¸€äº›*æ§åˆ¶å˜é‡*è¿›è¡Œæ‰©å±•ï¼Œå³å…³äºä»»ä½•å¯èƒ½å½±å“ç›®æ ‡ KPI çš„ä¿¡æ¯ï¼Œå¦‚å‡æœŸã€å¤©æ°”ã€è¶³çƒé”¦æ ‡èµ›ã€åœå·¥ã€äº§å“ä»·æ ¼ç­‰ç­‰ã€‚ä¸è¿‡ï¼Œä¸ºäº†ç®€æ´èµ·è§ï¼Œæˆ‘ä»¬å°†çœç•¥æ§åˆ¶å˜é‡ã€‚ç„¶åï¼Œå½“ç„¶ï¼Œä½ éœ€è¦ä¸€ä¸ªä½ æƒ³è¦é¢„æµ‹çš„ KPIã€‚è¿™é€šå¸¸æ˜¯é”€å”®é¢ã€æ–°å®¢æˆ·æ•°é‡ç­‰ç­‰ã€‚å› æ­¤ï¼Œå…¸å‹çš„æ•°æ®é›†å¯èƒ½å¦‚ä¸‹æ‰€ç¤º:

![](img/77402c22e145801cbebde8cd067765c5.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

åœ¨æˆ‘ä»¥å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘æ›´è¯¦ç»†åœ°æè¿°äº†åŠ¨æœºä»¥åŠå¦‚ä½•è¿›è¡Œè¥é”€ç»„åˆå»ºæ¨¡ã€‚ä¸ºäº†ç†è§£æœ¬æ–‡çš„å…¶ä½™éƒ¨åˆ†ï¼Œè¯·åœ¨è¿™é‡ŒæŸ¥çœ‹å®ƒä»¬:

[](/introduction-to-marketing-mix-modeling-in-python-d0dd81f4e794) [## Python å¸‚åœºè¥é”€ç»„åˆå»ºæ¨¡ç®€ä»‹

### å“ªäº›å¹¿å‘Šæ”¯å‡ºçœŸæ­£æ¨åŠ¨äº†ä½ çš„é”€å”®ï¼Ÿ

towardsdatascience.com](/introduction-to-marketing-mix-modeling-in-python-d0dd81f4e794) [](/an-upgraded-marketing-mix-modeling-in-python-5ebb3bddc1b6) [## Python ä¸­å‡çº§çš„è¥é”€ç»„åˆå»ºæ¨¡

### è®©æˆ‘å¹³åº¸çš„è¥é”€ç»„åˆæ¨¡å¼æ›´åŠ å¼ºå¤§

towardsdatascience.com](/an-upgraded-marketing-mix-modeling-in-python-5ebb3bddc1b6) 

## è´å¶æ–¯å»ºæ¨¡

è®¸å¤šä¼°è®¡å™¨å’Œæ¨¡å‹æºäºä¸€ç§*æœ€å¤§ä¼¼ç„¶*æ–¹æ³•ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä½ æƒ³ä¼°è®¡ä¸€æšç¡¬å¸æ­£é¢æœä¸Šçš„æ¦‚ç‡ *p* ã€‚ä½ **ç¿»è½¬ 10 æ¬¡**ï¼Œçœ‹åˆ° **8 ä¸ªå¤´**ï¼Œä½ å¾—å‡ºä»€ä¹ˆç»“è®ºï¼Ÿæ¦‚ç‡çš„è‡ªç„¶ä¼°è®¡æ˜¯ *p* = 8 / 10 = 80%ï¼Œè¿™ä¹Ÿæ˜¯æœ€å¤§ä¼¼ç„¶ä¼°è®¡ã€‚ä½ ä¹Ÿå¯ä»¥è®¡ç®—ä¸€ä¸ªç½®ä¿¡åŒºé—´ï¼Œçœ‹çœ‹è¿™ä¸ªä¼°è®¡æ˜¯å¦å¯é ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³èµ°å¦ä¸€æ¡è·¯ã€‚

æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æƒ³è¦åŠ å…¥ä¸€äº›å…³äºæ¦‚ç‡ *p* çš„**å…ˆéªŒçŸ¥è¯†**ã€‚å¦‚æœä½ ä»é’±åŒ…é‡ŒéšæœºæŠ½å–äº†ç¡¬å¸ï¼Œæ¯”å¦‚æ²¡æœ‰ç†ç”±è®¤ä¸ºç¡¬å¸æœ‰åå·®ï¼Œé‚£ä¹ˆ *p* åº”è¯¥ä¸ä¼šç¦» 50%å¤ªè¿œï¼Œå‡è®¾ä½ ä¸æ˜¯é­”æœ¯å¸ˆã€‚

ä½¿ç”¨è´å¶æ–¯å»ºæ¨¡ï¼Œæ‚¨å¯ä»¥å°†è¿™ç§å…ˆéªŒçŸ¥è¯†ç»“åˆèµ·æ¥ï¼Œæœ€ç»ˆå¾—åˆ°å¯¹ *p* çš„*å¯†åº¦*ä¼°è®¡ï¼Œå³ä¸æ˜¯å•ä¸ªå€¼ï¼Œè€Œæ˜¯æ•´ä¸ªåˆ†å¸ƒã€‚è¿™ä¸ªåˆ†å¸ƒå¯èƒ½åœ¨æœ€å¤§ä¼¼ç„¶ä¼°è®¡å’Œå…ˆéªŒä¹‹é—´çš„æŸå¤„æœ‰ä¸€ä¸ªå³°å€¼ï¼Œå¯èƒ½æ˜¯ 65%ã€‚

![](img/04ff4209cf2144d8a284661368f82c97.png)

çº¢è‰²æ›²çº¿çš„æ¨¡å¼æ˜¯æœ€å¤§ä¼¼ç„¶ä¼°è®¡ã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè´å¶æ–¯å»ºæ¨¡æ˜¯å…³äºåœ¨å…ˆéªŒçŸ¥è¯†å’Œè§‚å¯Ÿåˆ°çš„æ•°æ®ä¹‹é—´æ‰¾åˆ°ä¸€ä¸ªå¹³è¡¡ç‚¹ã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œè¿™æ„å‘³ç€:æ²¡æœ‰ä»»ä½•æ•°æ®ï¼Œæˆ‘ä»¬ä»è“è‰²æ›²çº¿å¼€å§‹ã€‚è¿™åªæ˜¯ä¸€ç§ä¿¡å¿µï¼Œä¸€ç§ç›´è§‰ã€‚ç„¶åï¼Œæˆ‘ä»¬è§‚å¯Ÿæ•°æ®ï¼Œå‘Šè¯‰æˆ‘ä»¬å°†è“è‰²æ›²çº¿å‘çº¢è‰²æ›²çº¿ç§»åŠ¨ã€‚æˆ‘ä»¬ä»¥é»„è‰²æ··åˆæ›²çº¿ç»“æŸï¼Œå®ƒæç»˜äº†æ‰€è°“çš„*åéªŒ*åˆ†å¸ƒã€‚

ä½ å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»æ›´å¤šå…³äºåŠ¨æœºçš„ä¿¡æ¯:

[](/a-gentle-introduction-to-bayesian-inference-6a7552e313cb) [## è´å¶æ–¯æ¨ç†çš„ç®€æ˜ä»‹ç»

### äº†è§£é¢‘ç‡ä¸»ä¹‰è€…å’Œè´å¶æ–¯æ¨ç†æ–¹æ³•ä¹‹é—´çš„åŒºåˆ«

towardsdatascience.com](/a-gentle-introduction-to-bayesian-inference-6a7552e313cb) 

ç°åœ¨ï¼Œç†è§£ç†è®ºæ˜¯å¥½çš„ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¿…é¡»èƒ½å¤Ÿåº”ç”¨å®ƒæ¥å®Œæˆäº‹æƒ…ã€‚é€šå¸¸ï¼Œæˆ‘ä½¿ç”¨ä»¤äººæ•¬ç•çš„ python åº“ [PyMC3](https://docs.pymc.io/en/v3/) è¿›è¡Œè´å¶æ–¯å»ºæ¨¡ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°å®ƒçš„ä½œç”¨:

[](/bayesian-linear-regression-in-python-via-pymc3-ab8c2c498211) [## é€šè¿‡ PyMC3 åœ¨ Python ä¸­å®ç°è´å¶æ–¯çº¿æ€§å›å½’

### äº†è§£å¦‚ä½•æ¨æ–­æ¨¡å‹å‚æ•°å¹¶å¯¹æ–°æ•°æ®è¿›è¡Œé¢„æµ‹ï¼ŒåŒ…æ‹¬ä¸ç¡®å®šæ€§ä¼°è®¡ï¼

towardsdatascience.com](/bayesian-linear-regression-in-python-via-pymc3-ab8c2c498211) 

## ä¸ºä»€ä¹ˆè¥é”€æ··åˆå»ºæ¨¡ä¸è´å¶æ–¯ï¼Ÿ

æ‚¨å¯ä»¥ç”¨è®¸å¤šè¶…å‚æ•°æ¥å®šä¹‰è¥é”€ç»„åˆæ¨¡å‹:

*   é¥±å’Œåº¦
*   ç»“è½¬å¼ºåº¦
*   ç»“è½¬é•¿åº¦
*   â€¦

ç„¶åï¼Œå¯ä»¥ä½¿ç”¨è¶…å‚æ•°ä¼˜åŒ–æ–¹æ³•æ¥æ‰¾åˆ°æœ€ä¼˜ç»„åˆã€‚è¿™å°±æ˜¯æˆ‘åœ¨å¦ä¸€ç¯‡å…³äºè¥é”€ç»„åˆå»ºæ¨¡çš„æ–‡ç« ä¸­æ‰€åšçš„ï¼Œ [**ç”¨ Python**](/an-upgraded-marketing-mix-modeling-in-python-5ebb3bddc1b6) **å‡çº§çš„è¥é”€ç»„åˆå»ºæ¨¡ã€‚**

è¿™ç§æ–¹æ³•å¾ˆå¥½ï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹æˆ‘ä¸å–œæ¬¢:

> è¶…å‚æ•°ä¼°è®¡é€šå¸¸æ˜¯ä¸ç¨³å®šçš„ã€‚

è¿™æ„å‘³ç€å®Œå…¨ä¸åŒçš„è¶…å‚æ•°é›†å¯èƒ½äº§ç”ŸåŒæ ·å¥½çš„æ¨¡å‹ã€‚å¯èƒ½ä¼šæœ‰

*   **å‹å· A** çš„ç”µè§†æ®‹ç•™å¼ºåº¦ä¸º 0.4ï¼Œç”µè§†é¥±å’Œåº¦ä¸º 0.8ï¼Œä»¥åŠ
*   **å‹å· B** ç”µè§†ç»“è½¬å¼ºåº¦ 0.9ï¼Œç”µè§†é¥±å’Œåº¦ 0.5ï¼Œ

ä¸¤è€…åœ¨æµ‹è¯•è£…ç½®ä¸Šå…·æœ‰ç›¸åŒçš„ *r* æˆ– MAPEã€‚ä»é¢„æµ‹çš„è§’åº¦æ¥çœ‹ï¼Œè¿™ä¸¤ç§æ¨¡å‹æ˜¯å¯ä»¥äº’æ¢çš„ï¼Œ**å¦‚æœä½ ä¿æŒåœ¨ä½ ç›®å‰æ‰€çœ‹åˆ°çš„è¥é”€æ”¯å‡ºèŒƒå›´å†…ã€‚**

ç„¶è€Œï¼Œä½¿ç”¨æ¨¡å‹ A è¿›è¡Œå¤–æ¨å®Œå…¨ä¸åŒäºä½¿ç”¨æ¨¡å‹ b è¿›è¡Œå¤–æ¨ã€‚è¿™æ˜¯ä¸€ç§ç›¸å½“ä¸ä»¤äººæ»¡æ„å’Œéº»çƒ¦çš„è¡Œä¸ºï¼Œå› ä¸ºå¤–æ¨æ˜¯ä¼˜åŒ–åª’ä½“é¢„ç®—æ—¶è¦åšçš„äº‹æƒ…ã€‚å¦‚æœä½ è¿‡å»ä¸€ç›´æ¯å¤©èŠ± 0â‚¬åˆ° 1000â‚¬åœ¨ç”µè§†å¹¿å‘Šä¸Šï¼Œä¸ºäº†ä¼˜åŒ–ï¼Œä½ å¿…é¡»çŸ¥é“å½“ä½ èŠ± 5000â‚¬ç”šè‡³ 10000â‚¬æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚

> ä½ éœ€è¦ä¸€ä¸ªå…·æœ‰å‡ºè‰²æ¨æ–­èƒ½åŠ›çš„æ¨¡å‹ã€‚

é€šå¸¸ï¼Œä½ ä¸å¾—ä¸åœ¨ä¸¤ä¸ªä»¥ä¸Šçš„å‹å·ä¸­é€‰æ‹©ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨è‡³å°‘å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼è¿›è¡Œæ“ä½œ

*   ä½ å¯ä»¥é€‰æ‹©ä½ åˆ›å»ºçš„ç¬¬ä¸€ä¸ªæ¨¡å‹ï¼Œå› ä¸ºä½ ç”šè‡³æ²¡æœ‰æ„è¯†åˆ°è¿™ä¸ªé—®é¢˜ã€‚è¿™ç§æ–¹æ³•ç®€å•ä½†å±é™©ã€‚
*   æ‚¨å¯ä»¥é€‰æ‹©ä¸€ä¸ªå¯¹æ‚¨ã€ä¸€äº›é¢†åŸŸä¸“å®¶æˆ–åˆ©ç›Šç›¸å…³è€…æ¥è¯´æ­£ç¡®çš„æ¨¡å‹ã€‚å¯¹äºä¸€äº›äººæ¥è¯´ï¼Œè¿™æ˜¯å¯ä»¥çš„ï¼Œä½†æˆ‘ä¸å–œæ¬¢å°†äº§å‡ºé¢„æœŸæ”¾å…¥æ¨¡å‹ä¸­ï¼Œå› ä¸ºä¸‹é¢çš„é—®é¢˜:

> å¦‚æœæœ‰äººå·²ç»çŸ¥é“äº†ç­”æ¡ˆï¼Œæˆ‘ä¸ºä»€ä¹ˆè¿˜è¦å»ºç«‹ä¸€ä¸ªå¤åˆ¶è¿™ä¸ªç­”æ¡ˆçš„æ¨¡å‹å‘¢ï¼Ÿ

ä»è¿™é‡Œä¹Ÿå¯èƒ½æœ‰ä¸€äº›åˆç†çš„æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ç°åœ¨æƒ³å‘ä½ å±•ç¤ºå¦‚ä½•ä½¿ç”¨è´å¶æ–¯å»ºæ¨¡æ¥è§„é¿è¿™ä¸ªé—®é¢˜ã€‚

# å»ºæ¨¡å¼€å§‹ï¼

é¦–å…ˆï¼Œè®©æˆ‘ä»¬è·å–æ•°æ®é›†ã€‚

```
import pandas as pd

data = pd.read_csv(
  'https://raw.githubusercontent.com/Garve/datasets/4576d323bf2b66c906d5130d686245ad205505cf/mmm.csv',
  parse_dates=['Date'],
  index_col='Date'
)

X = data.drop(columns=['Sales'])
y = data['Sales']
```

ç„¶åï¼Œæˆ‘ä»¬å¿…é¡»å®šä¹‰é¥±å’Œåº¦å’Œç»“è½¬åŠŸèƒ½ï¼Œç±»ä¼¼äºä¸Šä¸€ç¯‡æ–‡ç« ã€‚åœ¨ PyMC3 è¯­è¨€ä¸­ï¼Œå®ƒå¯èƒ½æ˜¯è¿™æ ·çš„:

```
import theano.tensor as tt

def saturate(x, a):
    return 1 - tt.exp(-a*x)

def carryover(x, strength, length=21):
    w = tt.as_tensor_variable(
        [tt.power(strength, i) for i in range(length)]
    )

    x_lags = tt.stack(
        [tt.concatenate([
            tt.zeros(i),
            x[:x.shape[0]-i]
        ]) for i in range(length)]
    )

    return tt.dot(w, x_lags)
```

é¥±å’Œåº¦å‡½æ•°åº”è¯¥å¾ˆå®¹æ˜“æŒæ¡ã€‚ç„¶è€Œï¼Œç»“è½¬æœ‰ç‚¹éº»çƒ¦ã€‚åŸºæœ¬ä¸Šï¼Œæ‚¨å¯ä»¥å°†é—ç•™è½¬æ¢è¡¨ç¤ºä¸ºçŸ©é˜µå‘é‡ä¹˜æ³•ã€‚ä½ åªéœ€è¦å…ˆç»„è£…çŸ©é˜µ`x_lags`å’Œå‘é‡`w`å°±å¯ä»¥äº†ã€‚ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥è½¬æ¢è¾“å…¥å‘é‡ *x* = ( *x* â‚ï¼Œ *x* â‚‚ï¼Œ *x* â‚ƒï¼Œ *x* â‚„)ï¼Œç»“è½¬é•¿åº¦ä¸º 3 via

![](img/9a3f84b356c9d9da93af43e52ab1d3ac.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

ä¸Šé¢ä»£ç ä¸­çš„`carryover`å‡½æ•°å°±æ˜¯è¿™æ ·åšçš„ã€‚æœ‰äº†è¿™äº›åŠŸèƒ½ï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥å¼€å§‹å»ºæ¨¡äº†ã€‚

```
import pymc3 as pm

with pm.Model() as mmm:
    channel_contributions = []

    for channel in X.columns:
        coef = pm.Exponential(f'coef_{channel}', lam=0.0001)
        sat = pm.Exponential(f'sat_{channel}', lam=1)
        car = pm.Beta(f'car_{channel}', alpha=2, beta=2)

        channel_data = X[channel].values
        channel_contribution = pm.Deterministic(
            f'contribution_{channel}',
            coef * saturate(
                carryover(
                    channel_data,
                    car
                ),
                sat
            )
        )

        channel_contributions.append(channel_contribution)

    base = pm.Exponential('base', lam=0.0001)
    noise = pm.Exponential('noise', lam=0.0001)

    sales = pm.Normal(
        'sales',
        mu=sum(channel_contributions) + base,
        sigma=noise,
        observed=y
    )

    trace = pm.sample(return_inferencedata=True, tune=3000)
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ‰€æœ‰å‚æ•°(ä¸å†æœ‰è¶…å‚æ•°ï¼)ç”¨ç²—ä½“æ ‡å‡ºã€‚å®ƒæ˜¯å›å½’ç³»æ•°ã€é¥±å’Œå¼ºåº¦ã€æ®‹ç•™å¼ºåº¦ã€åŸºçº¿å’Œå™ªéŸ³ã€‚

> è¯·æ³¨æ„ï¼Œæˆ‘æ²¡æœ‰è€ƒè™‘ç»“è½¬é•¿åº¦ï¼Œè€Œæ˜¯å°†å…¶è®¾ç½®ä¸º 21ã€‚è¿™æ˜¯å› ä¸ºæˆ‘è¿˜ä¸çŸ¥é“å¦‚ä½•åœ¨ PyMC3 ä¸­ç”¨å¯å˜ç»´åº¦åœ¨`carrover`å‡½æ•°ä¸­åˆ›å»ºçŸ©é˜µå’Œå‘é‡ã€‚ä½†é€šå¸¸ï¼Œæˆ‘ä¼šç”¨æ³Šæ¾éšæœºå˜é‡æ¥è¡¨ç¤ºé—ç•™é•¿åº¦ã€‚å¦‚æœä½ çŸ¥é“å¦‚ä½•æ­£ç¡®åœ°åšè¿™ä»¶äº‹ï¼Œè¯·ç»™æˆ‘ç•™è¨€ï¼*ğŸ˜‰*ä¹Ÿè®¸ç°åœ¨ä¹Ÿæ˜¯ç»™ pyro ä¸€ä¸ªæœºä¼šçš„å¥½æ—¶æœºï¼ŒPyMC3 è¿™æ ·çš„å¦ä¸€ç§æ¦‚ç‡ç¼–ç¨‹è¯­è¨€ã€‚

## æ¨¡å‹è¾“å‡ºçš„åˆ†æ

ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹é€šå¸¸çš„å›¾ç‰‡ã€‚è®©æˆ‘ä»¬ä»åéªŒåˆ†å¸ƒå¼€å§‹ã€‚æ‰§è¡Œ

```
import arviz as az

az.plot_posterior(
    trace,
    var_names=['~contribution'],
    filter_vars='like'
)
```

ç”Ÿäº§

![](img/8629135909c418844dc95f3b5bc75e64.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥çœ‹åˆ°æ‰€æœ‰å‚æ•°çš„åéªŒæ¦‚ç‡ã€‚å®ƒä»¬éƒ½æœ‰å¾ˆå¥½çš„å•å³°å½¢çŠ¶ã€‚æ‚¨è¿˜å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¢ç´¢å˜é‡å¯¹çš„è¡Œä¸º

```
az.plot_joint(
    trace,
    var_names=['coef_TV', 'sat_TV'],
)
```

![](img/afebccb806cddad392778d6d97c2c058.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

è¿™é‡Œä½ å¯ä»¥çœ‹åˆ°é¥±å’Œå¼ºåº¦å’Œå›å½’ç³»æ•°ä¸æ˜¯ç‹¬ç«‹çš„ï¼Œè€Œæ˜¯è´Ÿç›¸å…³çš„:ç³»æ•°è¶Šé«˜ï¼Œé¥±å’Œå‚æ•°è¶Šä½ã€‚è¿™æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºè¾ƒé«˜çš„ç³»æ•°å¯ä»¥è¡¥å¿è¾ƒæ…¢å¢åŠ çš„é¥±å’Œæ›²çº¿(=è¾ƒä½çš„`sat_TV`),åä¹‹äº¦ç„¶ã€‚

è®©æˆ‘ä»¬çœ‹å¦ä¸€ä¸ªä¾‹å­:

```
az.plot_joint(
    trace,
    var_names=['car_TV', 'sat_TV'],
)
```

![](img/5316cba67c47529a75c31e4486864e52.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

**åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸ºä»€ä¹ˆè¶…å‚æ•°ä¼˜åŒ–å¯èƒ½ä¼šæœ‰é—®é¢˜ã€‚è¿™å¼ å›¾ç‰‡ä¸­çš„æ¯ä¸ªç‚¹éƒ½æ˜¯ä¸€ä¸ªæ½œåœ¨çš„æ¨¡å‹ï¼Œä½ å¯ä»¥é€šè¿‡è¶…å‚æ•°ä¼˜åŒ–æ‰¾åˆ°å®ƒã€‚**

å¯¹äºä¸€ä¸ªçœŸæ­£å”¯ä¸€çš„æœ€ä½³æ¨¡å‹ï¼Œæˆ‘ä»¬æ›´æ„¿æ„çœ‹åˆ°ä¸€ä¸ªç‚¹äº‘ç´§ç´§çš„é›†ä¸­åœ¨ä¸€ä¸ªç‚¹ä¸Š(car_TV_trueï¼Œsat_TV_true)ã€‚ç„¶è€Œï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ° TV æ®‹ç•™å¼ºåº¦å¯ä»¥å…·æœ‰åœ¨ 0.4 å’Œ 0.5 ä¹‹é—´çš„åˆç†å€¼ï¼Œè¿™å–å†³äºé¥±å’Œåº¦å‚æ•°ã€‚

åœ¨æˆ‘ä»¬ä¸‹ç»“è®ºä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ£€æŸ¥ä¸€ä¸‹è¿™ä¸ªæ¨¡å‹æ˜¯å¦å¥½ã€‚æ‰§è¡Œ

```
import matplotlib.pyplot as plt

with mmm:
    posterior = pm.sample_posterior_predictive(trace)

means = posterior['sales'].mean(0)
stds = posterior['sales'].std(0)

plt.figure(figsize=(20, 8))
plt.plot(y.values, linewidth=2, c='r', label='Observations')
plt.plot(means, linewidth=1, c='b', label='Mean prediction')
plt.fill_between(np.arange(len(y)), means - 2*stds, means + 2*stds, alpha=0.33)
plt.legend()
```

ç»™äº†æˆ‘ä»¬

![](img/86652dca48c42f1f6d7e82ec46a1cd90.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

æ‰€ä»¥çœ‹èµ·æ¥è¿™ä¸ªæ¨¡å‹æ‰¾åˆ°äº†ä¸€äº›æœ‰ç”¨çš„ä¸œè¥¿ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä¸ä¼šè¿›ä¸€æ­¥è¯¦ç»†è®¨è®ºå¦‚ä½•è¯„ä¼°æ¨¡å‹çš„æ€§èƒ½ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å°†æ¥è¿™æ ·åšã€‚

## æ¸ é“è´¡çŒ®

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å¤„ç†äº†åˆ†å¸ƒï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬æœ€å–œæ¬¢çš„æ¸ é“è´¡çŒ®å›¾ï¼Œè®©æˆ‘ä»¬å†æ¬¡ä»¥å•ä¸ªå€¼ç»“æŸã€‚ç”±äºæˆ‘ä»¬åœ¨ PyMC3 ä»£ç ä¸­å¼•å…¥äº†ä¸€äº›é€šé“è´¡çŒ®å˜é‡ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç®€çŸ­çš„`compute_mean`å‡½æ•°è½»æ¾æå–å®ƒä»¬ã€‚

```
def compute_mean(trace, channel):
    return (trace
            .posterior[f'contribution_{channel}']
            .values
            .reshape(4000, 200)
            .mean(0)
           )

channels = ['Banners', 'Radio', 'TV']
unadj_contributions = pd.DataFrame(
    {'Base': trace.posterior['base'].values.mean()},
    index=X.index
)

for channel in channels:
    unadj_contributions[channel] = compute_mean(trace, channel)

adj_contributions = (unadj_contributions
                     .div(unadj_contributions.sum(axis=1), axis=0)
                     .mul(y, axis=0)
                    )

ax = (adj_contributions
      .plot.area(
          figsize=(16, 10),
          linewidth=1,
          title='Predicted Sales and Breakdown',
          ylabel='Sales',
          xlabel='Date'
      )
     )

handles, labels = ax.get_legend_handles_labels()
ax.legend(
    handles[::-1], labels[::-1],
    title='Channels', loc="center left",
    bbox_to_anchor=(1.01, 0.5)
)
```

![](img/253b2b1c7707ed253f6d5e9f5104d3e5.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

çœ‹èµ·æ¥ä¸é”™ï¼

# æ€»ç»“ä¸å±•æœ›

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†ä½¿ç”¨æœ€å¤§ä¼¼ç„¶æ³•çš„è¥é”€ç»„åˆå»ºæ¨¡å¯èƒ½ä¼šå› ä¸ºè¶…å‚æ•°ä¼°è®¡è€Œå˜å¾—å›°éš¾ã€‚å¯èƒ½æœ‰è®¸å¤šæ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šè¡¨ç°è‰¯å¥½ï¼Œä½†å…·æœ‰å®Œå…¨ä¸åŒçš„å¤–æ¨è¡Œä¸ºâ€”â€”è¿™äº›(è¶…)å‚æ•°éå¸¸ä¸ç¨³å®šã€‚

ç„¶è€Œï¼Œé€‚å½“çš„å¤–æ¨æ˜¯ä¼˜åŒ–çš„å…³é”®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ªåŸºæœ¬çš„è¥é”€ç»„åˆæ¨¡å‹ï¼Œåœ¨è´å¶æ–¯è®¾ç½®ä¸­å…·æœ‰é¥±å’Œå’Œç»“è½¬æ•ˆåº”ã€‚è¿™è¢«è¯æ˜æ˜¯æœ‰ç”¨çš„ï¼Œå› ä¸ºå®ƒä¸€æ¬¡ä¼°è®¡æ‰€æœ‰çš„å‚æ•°ï¼Œç»™æˆ‘ä»¬æ›´ç¨³å®šçš„å‚æ•°ä¼°è®¡ã€‚

ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ PyMC3 å®ç°äº†å®ƒï¼Œå¹¶å†æ¬¡åˆ›å»ºäº†ä¸€ä¸ªæ¼‚äº®çš„è´¡çŒ®å›¾è¡¨ï¼Œä»¥æŸ¥çœ‹æ¸ é“æ”¯å‡ºå¯¹é”€å”®é¢çš„è´¡çŒ®ã€‚

## æ¨¡å‹æ‰©å±•

æˆ‘ä»¬ç°åœ¨å¯ä»¥é‡‡ç”¨æˆ‘ä»¬å·²ç»åˆ›å»ºçš„è´å¶æ–¯æ¨¡å‹ï¼Œå¹¶è¿›ä¸€æ­¥æ‰©å±•å®ƒã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥éšæ—¶é—´å˜åŒ–çš„å‚æ•°ã€‚å¦‚æœä¸¤å¹´å‰ç”µè§†é—ç•™å¼ºåº¦å¼€å§‹ä¸º 0.8ï¼Œä½†éšç€æ—¶é—´çš„æ¨ç§»æ…¢æ…¢ä¸‹é™åˆ° 0.5ï¼Œè¿™å¯èƒ½æ˜¯æœ‰ç”¨çš„ï¼Œè¿™æ˜¯*æ¦‚å¿µæ¼‚ç§»*çš„ä¸€ä¸ªä¾‹å­ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨**é«˜æ–¯éšæœºæ¸¸èµ°**ï¼Œè½»æ¾åœ°å¯¹æ­¤å»ºæ¨¡ï¼Œå¦‚æˆ‘å…³äºæ»šåŠ¨å›å½’çš„å¦ä¸€ç¯‡æ–‡ç« æ‰€ç¤º:

[](/rockin-rolling-regression-in-python-via-pymc3-e4722b6118cd) [## é€šè¿‡ PyMC3 åœ¨ Python ä¸­å®ç°æ»šåŠ¨å›å½’

### å­¦ä¹ å¦‚ä½•å¤„ç†å˜åŒ–çš„å‚æ•°

towardsdatascience.com](/rockin-rolling-regression-in-python-via-pymc3-e4722b6118cd) 

åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å˜åŒ–çš„åŸºçº¿è¿›è¡Œå»ºæ¨¡ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»æŠŠåŸºçº¿å½“ä½œä¸€ä¸ªå•ä¸€çš„æ•°å­—ï¼Œå®ƒåœ¨æ•´ä¸ªè®­ç»ƒæœŸé—´æ˜¯å›ºå®šçš„ã€‚ä½†ä¹Ÿè®¸éšç€æ—¶é—´çš„æ¨ç§»ï¼Œç”±äºæˆ‘ä»¬çš„æˆ˜ç•¥å¹¿å‘ŠåŠªåŠ›ï¼Œå®ƒä¹Ÿå¢åŠ äº†ã€‚è¿™æ˜¯ä½¿ç”¨æˆ‘ä»¬æ—§çš„è¶…å‚æ•°ä¼˜åŒ–æœ€å¤§ä¼¼ç„¶æ¨¡å‹å¾ˆéš¾è§£å†³çš„é—®é¢˜ã€‚

æˆ‘å¸Œæœ›ä½ ä»Šå¤©å­¦åˆ°äº†æ–°çš„ã€æœ‰è¶£çš„ã€æœ‰ç”¨çš„ä¸œè¥¿ã€‚æ„Ÿè°¢é˜…è¯»ï¼

**ä½œä¸ºæœ€åä¸€ç‚¹ï¼Œå¦‚æœä½ **

1.  **æƒ³æ”¯æŒæˆ‘å¤šå†™ç‚¹æœºå™¨å­¦ä¹ å’Œ**
2.  **æ— è®ºå¦‚ä½•éƒ½è¦è®¡åˆ’è·å¾—ä¸­ç­‰è®¢é˜…é‡ï¼Œ**

**ä¸ºä»€ä¹ˆä¸åš** [**é€šè¿‡è¿™ä¸ªé“¾æ¥**](https://dr-robert-kuebler.medium.com/membership) **ï¼Ÿè¿™å°†å¯¹æˆ‘å¸®åŠ©å¾ˆå¤§ï¼ğŸ˜Š**

*è¯´å®è¯ï¼Œç»™ä½ çš„ä»·æ ¼æ²¡æœ‰å˜åŒ–ï¼Œä½†å¤§çº¦ä¸€åŠçš„è®¢é˜…è´¹ç›´æ¥å½’æˆ‘ã€‚*

éå¸¸æ„Ÿè°¢ï¼Œå¦‚æœä½ è€ƒè™‘æ”¯æŒæˆ‘çš„è¯ï¼

> *æœ‰é—®é¢˜å°±åœ¨* [*LinkedIn*](https://www.linkedin.com/in/dr-robert-k%C3%BCbler-983859150/) *ä¸Šå†™æˆ‘ï¼*