# èšç±»å›¾åƒåˆ†å‰²

> åŸæ–‡ï¼š<https://towardsdatascience.com/image-segmentation-with-clustering-b4bbc98f2ee6?source=collection_archive---------10----------------------->

## K å‡å€¼å’Œæ¨¡ç³Š C å‡å€¼èšç±»çš„åŸºæœ¬åŸç†åŠå…¶åœ¨å›¾åƒåˆ†å‰²ä¸­çš„åº”ç”¨

åœ¨æˆ‘ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ¦‚è¿°äº†ç»å…¸çš„å›¾åƒåˆ†å‰²æ–¹æ³•ã€‚ç°åœ¨æ˜¯æ—¶å€™æ£€æŸ¥åŸºäºäººå·¥æ™ºèƒ½çš„å›¾åƒåˆ†å‰²æ–¹æ³•äº†ï¼Œæˆ‘ä»¬å°†ä»èšç±»å¼€å§‹ã€‚

åœ¨å¼€å§‹ä½¿ç”¨èšç±»è¿›è¡Œå›¾åƒåˆ†å‰²ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹â€œä»€ä¹ˆæ˜¯èšç±»ï¼Ÿâ€"å¦‚ä½•ç”¨ Python å®ç°ä¸€ä¸ªåŸºæœ¬çš„èšç±»æ–¹æ³•ï¼Ÿ"

**ä»€ä¹ˆæ˜¯é›†ç¾¤**

æ— éæ˜¯æŠŠç»™å®šçš„æ•°æ®æŒ‰ç…§ç›¸ä¼¼æ€§è¿›è¡Œåˆ†ç»„ï¼Œæœ€åå¾—åˆ°ä¸åŒçš„èšç±»ã€‚æ ¹æ®æˆ‘ä»¬ä½¿ç”¨çš„èšç±»æ–¹æ³•ï¼Œæˆ‘ä»¬å¯¹æ•°æ®åˆ†ç»„çš„æ–¹å¼ä¼šå‘ç”Ÿå˜åŒ–ã€‚è®©æˆ‘ä»¬è€ƒå¯Ÿ 2 ç§ä¸åŒçš„æœ€å¸¸ç”¨çš„å›¾åƒåˆ†å‰²ç±»å‹:åˆ†å‰²èšç±»å’Œæ¨¡ç³Šèšç±»

***åˆ’åˆ†èšç±»***

åˆ†åŒºèšç±»æ–¹æ³•å°†æ•°æ®ç»†åˆ†ä¸º k ä¸ªç»„ï¼Œå…¶ä¸­ k æ˜¯ç”¨æˆ·é¢„å®šä¹‰çš„æ•°å­—ã€‚å¯¹äº **K-means èšç±»**ï¼Œå“ªä¸€ç§æ˜¯æœ€æµè¡Œçš„åˆ’åˆ†èšç±»æ–¹æ³•

1.  æˆ‘ä»¬é€‰æ‹©æ•°æ®ä¸­çš„ **k ä¸ªéšæœºç‚¹**ä½œä¸ºèšç±»çš„**ä¸­å¿ƒï¼Œå¹¶é€šè¿‡æŸ¥çœ‹è¯¥ç‚¹ä¸ä¸­å¿ƒ**ä¹‹é—´çš„ L2 è·ç¦»å°†æ¯ä¸ªç‚¹åˆ†é…ç»™**æœ€è¿‘çš„èšç±»ã€‚**
2.  è®¡ç®—æ¯ä¸ªèšç±»çš„å¹³å‡å€¼ï¼Œå°†è¯¥å¹³å‡å€¼æŒ‡å®šä¸ºè¯¥èšç±»çš„æ–°ä¸­å¿ƒã€‚
3.  å°†æ¯ä¸ªæ•°æ®ç‚¹é‡æ–°åˆ†é…åˆ°å…¶æœ€è¿‘çš„èšç±»ä¸­å¿ƒã€‚é‡å¤æ­¥éª¤ 2ã€‚

è¯¥è¿‡ç¨‹ç»§ç»­è¿›è¡Œ**ç›´åˆ°æ²¡æœ‰æ–°çš„åˆ†é…è¢«æ‰§è¡Œ**(å› æ­¤æ¨¡å‹è¢«æ”¶æ•›ï¼Œæ²¡æœ‰ä»€ä¹ˆå¯è¿›ä¸€æ­¥è¿›è¡Œçš„)**æˆ–è€…å¯¹äºç»™å®šçš„è¿­ä»£æ¬¡æ•°**ã€‚å› æ­¤ï¼ŒK-means èšç±»æ˜¯ä¸€ç§**è¿­ä»£**æ–¹æ³•ï¼Œå…¶ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥ç¡®å®šè¿­ä»£æ¬¡æ•°ã€‚

ç°åœ¨è®©æˆ‘ä»¬å¯è§†åŒ–ä¸€äº›éšæœºæ•°æ®ï¼Œå¯¹æ¯ä¸ªæ•°æ®åº”ç”¨ 10 æ¬¡è¿­ä»£çš„ K å‡å€¼èšç±»ã€‚

```
from sklearn.cluster import KMeans
from sklearn.datasets import make_blobs
import numpy as np
from matplotlib import pyplot as plt
import cv2""" Plot the data """data = np.array([[1, 2], [1, 4], [1, 0],[10, 2], [10, 4], [10, 0]])
data = np.array([[1, 5], [3, 1], [10, 3], [10, 2], [10, 1], [1, 0], [2, 15], [0.5, 4.9], [5, 3], [7, 13], [18, 18], [1.9, 0.5]]) 
data = np.random.randint(100, size=(2,2))centers = [[1, 1], [-1, -1], [1, -1]]
data, _ = make_blobs(n_samples=10000, centers=centers, cluster_std=0.6)# Plot the data
plt.scatter(data[:,0],data[:,1])
plt.xlabel('x'),plt.ylabel('y')
plt.show()""" Visualize K means for each iteration """""" create an empty list for each cluster, k is the cluster number """k = 2
clusters = [[[0 for _ in range(2)] for _ in range(1)] for _ in range(k)]for i in range(k):
    clusters[i].pop() #if we dont do that, additional [0,0] points will be stayed added in our data

""" Visualize each iteration. """for i in range(1,10):
    kmeans = KMeans(n_clusters=k, random_state = 0, max_iter=i).fit(data)
    for index,data_point in enumerate(data):
        clusters[kmeans.labels_[index]].append(list(data_point))

    for i in range(k):
        clusters[i] = np.array(clusters[i])
        plt.scatter(clusters[i][:,0],clusters[i][:,1])
        clusters[i] = clusters[i].tolist() 
    plt.show()
```

![](img/28381c353dea7d03dd2677f483e10003.png)

å‰ä¸¤ä¸ªç¤ºä¾‹è¢«åˆ†ä¸º 2 ä¸ªç»„ï¼Œç¬¬ä¸‰ä¸ªç¤ºä¾‹åˆ†ä¸º 3 ä¸ªç»„â€œä½œè€…å›¾ç‰‡â€

æˆ‘ä»¬çœ‹åˆ°ï¼Œç”šè‡³åœ¨ç¬¬ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬å°±è·å¾—äº†æœ€ç»ˆç»“æœã€‚å› ä¸ºæ•°æ®éå¸¸å°ï¼Œåˆå§‹èšç±»æ•ˆæœå¾ˆå¥½ã€‚è®©æˆ‘ä»¬å¯¹ä¸‹é¢éšæœºç”Ÿæˆçš„æ•°æ®è¿è¡Œç›¸åŒçš„ä»£ç ï¼Œå¹¶å°†å®ƒä»¬åˆ†æˆ 5 ä¸ªç»„ã€‚

centers = [[1ï¼Œ1]ï¼Œ[-1ï¼Œ-1]ï¼Œ[1ï¼Œ-1]]
dataï¼Œ_ = make_blobs(n_samples=10000ï¼Œcenters=centersï¼Œcluster_std=0.6)

![](img/e6bb8977f55526801635725578dfa706.png)

â€œä½œè€…æä¾›çš„å›¾åƒâ€

ç°åœ¨æˆ‘ä»¬å¯ä»¥æ›´å¥½åœ°çœ‹åˆ°åœ¨æ¯æ¬¡è¿­ä»£ä¸­é›†ç¾¤æ˜¯å¦‚ä½•æ›´æ–°çš„ï¼

æ˜¯æ—¶å€™å¯¹çœŸå®å›¾åƒåº”ç”¨ K-means èšç±»å¹¶è·å¾—åˆ†æ®µè¾“å‡ºäº†ï¼

```
""" Image Segmentation """img = cv2.imread("bird1.jpg", cv2.IMREAD_UNCHANGED) 
img = cv2.imread("birds2.jpg", cv2.IMREAD_UNCHANGED)  
img = cv2.imread("peppers3.jpg", cv2.IMREAD_UNCHANGED)  
vectorized = img.reshape((-1,3))kmeans = KMeans(n_clusters=5, random_state = 0, n_init=5).fit(vectorized)centers = np.uint8(kmeans.cluster_centers_)
segmented_data = centers[kmeans.labels_.flatten()]

segmented_image = segmented_data.reshape((img.shape))
plt.imshow(segmented_image)
plt.pause(1)
```

![](img/d68d657d2a5811946dbbe6b071f9b5e6.png)

â€œä½œè€…æä¾›çš„å›¾åƒâ€

![](img/d27dc999d8710033687b10dda6855bfb.png)

â€œä½œè€…æä¾›çš„å›¾åƒâ€

![](img/7ccd20b7d939d81614547dac4ed1c11b.png)

â€œä½œè€…æä¾›çš„å›¾åƒâ€

ä½ å¯ä»¥æ„è¯†åˆ°æˆ‘æ²¡æœ‰ä½¿ç”¨é‚£æ¬¡ç¡®å®šè¿­ä»£æ¬¡æ•°å‚æ•°çš„ **max_iter** ã€‚æˆ‘å°†è¿™ä¸€å†³å®šç•™ç»™æ¨¡å‹ï¼Œè¿™æ ·å½“èšç±»ä¸­æ²¡æœ‰å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåˆ†å‰²å°±åœæ­¢äº†ã€‚å¦ä¸€æ–¹é¢ï¼Œ **n_init** å‚æ•°å†³å®šäº†åœ¨åˆå§‹æ­¥éª¤ä¸­ç”¨ä¸åŒçš„éšæœºèšç±»ä¸­å¿ƒå®Œæˆå¤šå°‘æ¬¡ä¸åŒçš„è¯•éªŒã€‚è¯¥ç®—æ³•é€‰æ‹©æœ€ä½³æ‹Ÿåˆï¼Œè¿™ç»™å‡ºäº†æœ€ä½³åˆ†å‰²ã€‚

æˆ‘ä»¬å¯ä»¥æ„è¯†åˆ°éšç€**å¢åŠ  k** ï¼Œç»“æœ**ä¼šå˜å¾—æ›´å¥½**å’Œæ›´è¯¦ç»†ï¼

ä¸‹é¢æ˜¯è¯¥èŠ‚ä¸­ä½¿ç”¨çš„ä»£ç çš„[**githu**](https://github.com/YCAyca/Image-Segmentation/tree/main/Clustering)**b**é“¾æ¥:

**æ¨¡ç³Šèšç±»**

æ¨¡ç³Šèšç±»æ˜¯ä¸€ç§**ç¡¬**èšç±»ç±»å‹ï¼Œè€Œåˆ’åˆ†èšç±»è¢«ç§°ä¸º**è½¯**ã€‚å…¶åŸå› æ˜¯ï¼Œåœ¨åˆ’åˆ†èšç±»ä¸­ï¼Œ **1 ä¸ªæ•°æ®ç‚¹å¯èƒ½ä»…åœ¨ 1 ä¸ªèšç±»**ä¸­ï¼Œåœ¨æ¨¡ç³Šèšç±»ä¸­ï¼Œæˆ‘ä»¬æœ‰æ¯ä¸ªèšç±»çš„æ•°æ®ç‚¹çš„**æ¦‚ç‡ï¼Œå¹¶ä¸”å®ƒä»¬å¯èƒ½**å±äºè¯¥æ¦‚ç‡æ°´å¹³çš„ä»»ä½•èšç±»ã€‚****

è®©æˆ‘ä»¬æ¥çœ‹çœ‹æœ€å¸¸è§çš„æ¨¡ç³Šèšç±»ç±»å‹**æ¨¡ç³Š C å‡å€¼èšç±»**ï¼Œçœ‹çœ‹å¦‚ä½•è®¡ç®—ç‚¹çš„æ¦‚ç‡ã€èšç±»çš„ä¸­å¿ƒç­‰ã€‚[1]

1.  éšæœºåˆå§‹åŒ–æ¦‚ç‡çŸ©é˜µã€‚å› æ­¤ï¼Œä¸ºæ¯ä¸ªæ•°æ®-èšç±»å¯¹åˆ†é…æƒé‡ï¼Œè¿™æ˜¯æŒ‡æ•°æ® x ä½äºèšç±» C ä¸­çš„æ¦‚ç‡ã€‚
2.  è®¡ç®—èšç±»çš„ä¸­å¿ƒ(è´¨å¿ƒ)ï¼Œ
3.  æ ¹æ®æ–°çš„èšç±»ä¸­å¿ƒè®¡ç®—æ–°çš„æ¦‚ç‡ã€‚
4.  é‡å¤ 2ã€‚ç¬¬ä¸‰ã€‚æ­¥è¿›ï¼Œç›´åˆ°ä¸­å¿ƒä¸å˜æˆ–ç»™å®šè¿­ä»£æ¬¡æ•°

è®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸ªä¾‹å­:

æˆ‘ä»¬æœ‰ 4 ä¸ªæ•°æ®ç‚¹ p1ã€p2ã€p3ã€p4 äºŒç»´ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰è¿™äº›ç‚¹çš„ x å’Œ y åæ ‡ï¼Œæˆ‘ä»¬æƒ³æŠŠå®ƒä»¬åˆ†æˆä¸¤ä¸ªç»„ã€‚

1.  æˆ‘ä»¬éšæœºåˆå§‹åŒ–æƒé‡çŸ©é˜µ:

![](img/05df8182e4134b8d174fc21c04f6778f.png)

â€œä½œè€…æä¾›çš„å›¾åƒâ€

2.æˆ‘ä»¬æ ¹æ®åˆå§‹æ¦‚ç‡ç”¨ä¸‹é¢çš„å…¬å¼è®¡ç®—èšç±»çš„è´¨å¿ƒ:

![](img/c3af92c03bdfe105dbd70e36a17ee99f.png)

â€œä½œè€…æä¾›çš„å›¾åƒâ€

æ³¨æ„**æ¨¡ç³Šå‚æ•°**æ˜¯æˆ‘ä»¬åº”è¯¥é€‰æ‹©çš„ï¼Œå°±åƒèšç±»æ•°ä¸€æ ·ï¼Œå®ƒå¯ä»¥åœ¨ 1 < m < âˆä¹‹é—´é€‰æ‹©

è®©æˆ‘ä»¬é€šè¿‡é€‰æ‹© **m = 2** å°†å…¬å¼åº”ç”¨äºæˆ‘ä»¬çš„ç¤ºä¾‹æ¡ˆä¾‹:

![](img/e79a2e36c4d436fe23c1732cc38f25bf.png)

â€œä½œè€…æä¾›çš„å›¾åƒâ€

å› ä¸ºæˆ‘ä»¬æœ‰ 2D ç‚¹ï¼Œæ‰€ä»¥ç¾¤é›†çš„ä¸­å¿ƒä¹Ÿæ˜¯ 2Dã€‚æ‰€ä»¥æˆ‘ä»¬ç”¨æˆ‘ä»¬ç‚¹çš„ x åæ ‡è®¡ç®— C1x(ç¬¬ä¸€ä¸ªèšç±»çš„ x åæ ‡)ï¼Œç”¨æˆ‘ä»¬ç‚¹çš„ y åæ ‡è®¡ç®— C1y(ç¬¬ä¸€ä¸ªèšç±»çš„ y åæ ‡)ã€‚

å½“æˆ‘ä»¬å¯¹ C2 ä¹Ÿåº”ç”¨åŒæ ·çš„å…¬å¼æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°å¦‚ä¸‹ç»“æœ

![](img/59f3ac5890e4500beca63849c2f5e007.png)

â€œä½œè€…æä¾›çš„å›¾åƒâ€

æˆ‘ä»¬å¾—åˆ°äº†æˆ‘ä»¬çš„èšç±»ä¸­å¿ƒï¼Œç°åœ¨æ˜¯æ—¶å€™æ ¹æ®æ–°çš„èšç±»ä¸­å¿ƒæ¥è®¡ç®—ç‚¹çš„æ¦‚ç‡äº†ã€‚

3.æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å…¬å¼è®¡ç®—æ–°çš„æ¦‚ç‡â€”â€”æƒé‡:

![](img/696606d106f0b30e3a72b8b32d703fe4.png)

â€œä½œè€…æä¾›çš„å›¾åƒâ€

åˆ«å¿˜äº†åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ m = 2ï¼Œæ‰€ä»¥ 1/m-1 = 1ã€‚

![](img/adc06db40a7fe0df5a9feb1c61202cf5.png)

â€œä½œè€…æä¾›çš„å›¾åƒâ€

![](img/b52b45f20751fcc6e4853a04b9bd3b1e.png)

â€œä½œè€…æä¾›çš„å›¾åƒâ€

è¯¸å¦‚æ­¤ç±»ï¼æˆ‘æ²¡æœ‰è®¡ç®—æ¯ä¸ªç‚¹å’Œèšç±»çš„æƒé‡ï¼Œè€Œæ˜¯æƒ³æ‰‹åŠ¨æ˜¾ç¤ºæ¯ä¸ªæ­¥éª¤çš„é€»è¾‘ã€‚

æˆ‘å¸Œæœ›å¤§å®¶æ¸…æ¥šæ¨¡ç³Š C å‡å€¼èšç±»çš„åŸºæœ¬é€»è¾‘å’Œåº”ç”¨ã€‚ç°åœ¨æ˜¯æ—¶å€™åšä¸€äº›å®éªŒå¹¶æ£€æŸ¥ç»“æœäº†ã€‚

![](img/561db65854c9b9f8646a295e92353620.png)

â€œä½œè€…æä¾›çš„å›¾åƒâ€

é€‰æ‹©æ¨¡ç³Šå‚æ•° m å¤ªå¤§ä¼šå¯¼è‡´ç»“æœå¤±çœŸã€‚æˆ‘ä»¬å†æ¬¡çœ‹åˆ°ï¼Œéšç€èšç±»æ•°çš„å¢åŠ ï¼Œæˆ‘ä»¬è·å¾—äº†æ›´è¯¦ç»†å’Œæ›´å¥½çš„åˆ†å‰²ç»“æœã€‚

å¦‚æœæ‚¨ä½¿ç”¨ Linuxï¼Œæ‚¨å¯ä»¥å°è¯•ä½¿ç”¨ PyPI [1]ä¸­çš„ fuzzy c means æ¨¡å—ï¼Œæˆ‘åœ¨ windows ä¸Šå®‰è£…å®ƒæ—¶é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œå°½ç®¡æˆ‘æŒ‰ç…§å»ºè®®ä½¿ç”¨äº† pip install fuzzy-c-means[windows]å‘½ä»¤ã€‚æ„Ÿè°¢[2]ä¸­çš„ fuzzy c æ„å‘³ç€ä»å¤´å¼€å§‹å®ç°ï¼Œæˆ‘åœ¨å‡†å¤‡æœ€åä¸€éƒ¨åˆ†æ—¶ä½¿ç”¨äº†å®ƒã€‚

åœ¨å›¾åƒåˆ†å‰²ä¸ç¥ç»ç½‘ç»œéƒ¨åˆ†å†è§ï¼ğŸ‘

[1][https://pypi.org/project/fuzzy-c-means/](https://pypi.org/project/fuzzy-c-means/)

[2][https://github . com/jeongHwarr/variable _ FCM _ segmentation/blob/master/FCM . py](https://github.com/jeongHwarr/various_FCM_segmentation/blob/master/FCM.py)

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæ‰€æœ‰ç”¨äºä¸åŒä»£ç éƒ¨åˆ†å®éªŒçš„å›¾ç‰‡éƒ½æ¥è‡ª unsplash.com